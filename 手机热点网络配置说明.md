# 手机热点网络配置说明

## 问题

使用手机热点连接时，App 无法访问 `localhost:3000`，因为：
- `localhost` 指向的是手机本身，不是电脑
- 需要使用电脑的**局域网 IP 地址**

## 解决方案

### 1. 获取电脑的局域网 IP

在终端运行以下命令：

```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig | findstr "IPv4"
```

或者查看 Core 服务启动时打印的 "Local network" 地址。

**示例输出**：
```
inet 172.20.10.2 netmask 0xfffffff0 broadcast 172.20.10.15
```

### 2. 配置环境变量

创建或编辑 `app/.env.local` 文件：

```bash
# 使用电脑的局域网 IP（替换为你的实际 IP）
EXPO_PUBLIC_API_BASE_URL=http://172.20.10.2:3000
```

### 3. 确保 Core 服务监听所有网络接口

检查 `core/src/server.ts`，确保服务器监听 `0.0.0.0`：

```typescript
app.listen(PORT, '0.0.0.0', () => {
  console.log(`[Server] Core service is running on port ${PORT}`);
  console.log(`[Server] Local network: http://172.20.10.2:${PORT}/health`);
});
```

### 4. 重启服务

1. 重启 Core 服务
2. 重启 Expo App（或重新加载）

## 验证

1. 在浏览器访问：`http://172.20.10.2:3000/health`
2. 应该看到：`{"status":"ok","version":"1.0.0"}`

## 常见问题

### Q: IP 地址会变化吗？
A: 是的，每次连接不同的热点或 WiFi，IP 可能会变化。需要重新获取并更新环境变量。

### Q: 可以使用 localhost 吗？
A: 只有在以下情况可以使用：
- 使用 USB 连接（Android）
- 手机和电脑在同一 WiFi 网络
- 使用 iOS 模拟器（模拟器可以访问宿主机的 localhost）

### Q: 如何快速切换？
A: 可以创建多个环境变量文件：
- `.env.local` - 手机热点（使用局域网 IP）
- `.env.wifi` - 同一 WiFi（使用 localhost）

然后根据情况切换使用。

## 当前配置

根据检测，你的电脑 IP 是：**172.20.10.2**

已在代码中更新默认值为 `http://172.20.10.2:3000`，如果 IP 变化，请更新环境变量。






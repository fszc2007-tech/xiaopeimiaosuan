# æ—¶é—´åæ ‡å¡ç‰‡å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

**ç›®æ ‡**ï¼šåœ¨ä¸»é¡µæœ€é¡¶éƒ¨ç¬¬ä¸€å¼ å¡ä½ç½®ï¼Œæ–°å¢ã€Œæ—¶é—´åæ ‡å¡ç‰‡ã€ï¼Œä¸€å¥è¯å›ç­”ã€Œæˆ‘ç°åœ¨åœ¨å“ªä¸€è¿ã€å“ªä¸€å¹´ã€å“ªä¸€æœˆï¼Ÿã€ï¼Œå¹¶æä¾›ã€Œä¸€é”®é—®ä»Šå¹´ã€å…¥å£å¼•å¯¼ç”¨æˆ·è¿›å…¥èŠå¤©ã€‚

**åŸåˆ™**ï¼š
- âœ… ä¸ç°æœ‰ç³»ç»Ÿå‚æ•°ä¿æŒä¸€è‡´
- âœ… å¤ç”¨ç°æœ‰ `luckRhythm` æ•°æ®ç»“æ„
- âœ… å¤ç”¨ç°æœ‰æµå¹´æµæœˆè®¡ç®—å‡½æ•°
- âœ… éµå¾ªç°æœ‰å¡ç‰‡ UI è§„èŒƒ
- âœ… éµå¾ªç°æœ‰èŠå¤©æ¥å£è§„èŒƒ

**æ–‡æ¡£è§„èŒƒ**ï¼š
- **è·¯å¾„å‘½å**ï¼šæ–‡æ¡£ä¸­ç»Ÿä¸€ä¸å†™æ–‡ä»¶åç¼€ï¼ˆå¦‚ `.ts`ã€`.js`ã€`.tsx`ï¼‰ï¼Œå®é™…æ–‡ä»¶ç±»å‹ä»¥é¡¹ç›®è§„èŒƒä¸ºå‡†
- **ç±»å‹å‘½å**ï¼šåç«¯æ•°æ®ç»“æ„ç»Ÿä¸€å‘½åä¸º `TimeCoordinateDto`ï¼Œå‰ç«¯ ViewModel ç»Ÿä¸€å‘½åä¸º `TimeCoordinateVM`
- **å‚æ•°å‘½å**ï¼šå‰ç«¯å¯¼èˆªå‚æ•°ä½¿ç”¨ `presetQuestion`ï¼Œåç«¯ API ä½¿ç”¨ `message`

---

## ä¸€ã€ç°æœ‰æ¶æ„æ¢³ç†

### 1.1 å‘½ç›˜è®¡ç®—æ€»å…¥å£

- **å‘½ç›˜è®¡ç®—ç»Ÿä¸€ç”± `BaziEngine.compute(chart)` äº§å‡º `analysis` å¯¹è±¡**
- `analysis` ä¸­å·²åŒ…å«ï¼š
  - `luckRhythm`ï¼ˆå¤§è¿èŠ‚å¥ï¼‰ï¼šåŒ…å«å½“å‰å¤§è¿å¹²æ”¯ã€åç¥ã€å¹´é¾„æ®µã€é˜¶æ®µæ ‡ç­¾ç­‰
  - `fortune`ï¼ˆæµå¹´æµæœˆï¼‰ï¼šé€šè¿‡ `fortune.liuNianPillar()` å’Œ `fortune.liuYuePillar()` è®¡ç®—
  - å…¶ä»–å·²å­˜åœ¨çš„å¡ç‰‡æ•°æ®ï¼ˆå‘½æ ¼ç¸½è©•ã€ç”¨ç¥æ ¼å±€ã€èƒ½é‡æµé€šç­‰ï¼‰

### 1.2 è¡Œè¿ç›¸å…³æ¨¡å—

- **å¤§è¿**ï¼š`analysis.luckRhythm`ï¼Œå…¶ä¸­ `currentLuck` å·²ç»™å‡ºï¼š
  - å¹²æ”¯ï¼š`stem` + `branch`
  - åç¥ï¼š`tenGod`
  - å¹´é¾„æ®µï¼š`ageRange`ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼Œå¦‚"çº¦ 31 å²åˆ° 41 å²"ï¼‰
  - é˜¶æ®µï¼š`stage`ï¼ˆ'æ‰“åŸºç¡€æœŸ' | 'æ‹“å±•å†²åˆºæœŸ' | 'è°ƒæ•´è½¬æŠ˜æœŸ' | 'æ²‰æ·€æ”¶è·æœŸ'ï¼‰
  - å–œå¿Œï¼š`favourLevel`ï¼ˆ'ç”¨ç¥' | 'ä¸­æ€§' | 'å¿Œç¥'ï¼‰

- **æµå¹´**ï¼šé€šè¿‡ `fortune.liuNianPillar(year)` è®¡ç®—æµå¹´å¹²æ”¯/åç¥
  - å‡½æ•°ä½ç½®ï¼š`core/engine/fortune/index`
  - è¿”å›ï¼š`{ stem, branch, year, lichunUTC }`

- **æµæœˆ**ï¼šé€šè¿‡ `fortune.liuYuePillar(dateUTC, yearStem)` è®¡ç®—æµæœˆå¹²æ”¯/åç¥
  - å‡½æ•°ä½ç½®ï¼š`core/engine/fortune/index`
  - ç­¾åï¼š`liuYuePillar(dateUTC: Date, yearStem: string)`
  - è¿”å›ï¼š`{ stem, branch, prevTerm, nextTerm }`
  - **æ³¨æ„**ï¼šå…·ä½“ç­¾åä»¥ `fortune/index` å®é™…å®ç°ä¸ºå‡†ï¼Œè¿™é‡Œåªæè¿°ä½¿ç”¨æ–¹å‘ï¼š
    - å…ˆé€šè¿‡ `liuNianPillar(now)` è·å–æœ¬å¹´å¹²æ”¯ï¼ˆå¾—åˆ° `yearStem`ï¼‰
    - å†é€šè¿‡ `liuYuePillar(now, yearStem)` è·å–å½“å‰æœˆå¹²æ”¯

### 1.3 èŠå¤©æ¥å£ä¸ Prompt æ¶æ„

- **èŠå¤©å…¥å£**ï¼š`POST /api/v1/chat/conversations/:id/messages`
- **Prompt æ„å»ºå‡½æ•°**ï¼š
  - `buildGeneralPrompt`ï¼šé€šç”¨èŠå¤©æ¨¡å¼
  - `buildLuckRhythmPrompt`ï¼šè¡Œè¿èŠ‚å¥ä¸“ç”¨
  - `buildOverviewPrompt`ï¼šå¡ç‰‡è§£è¯»æ¨¡å¼
- **æ”¯æŒé€šè¿‡ `context.type` é€‰æ‹©ä¸åŒçš„è§£è¯»æ¨¡å¼**ï¼ˆå¦‚ï¼šå‘½å±€æ€»è§ˆã€è¡Œè¿ç›¸å…³ï¼‰

### 1.4 å‰ç«¯é¦–é¡µç»“æ„

- **é¦–é¡µ Tab**ï¼š`ChartOverviewTab`ï¼ˆå‘½ç›¤ç¸½è¦½ Tabï¼‰
- **å¡ç‰‡ç»„ä»¶**ï¼š`OverviewCard` / `StructureCard` / `LuckRhythmCard` ç­‰
- **æ•°æ®æ¥æº**ï¼šç»Ÿä¸€è°ƒç”¨ `GET /api/v1/bazi/charts/:chartId`ï¼Œä» `analysis` ä¸­æ‹†åˆ†ç»™å„å¡ç‰‡

---

## äºŒã€éœ€æ±‚ä¸ç°çŠ¶å·®è·åˆ†æ

### 2.1 ç›®æ ‡åŠŸèƒ½

æ—¶é—´åæ ‡å¡ç‰‡è¦å±•ç¤º **3 è¡Œ + 1 ä¸ªæŒ‰é’®**ï¼š

- **å½“å‰å¤§è¿**ï¼šå¹²æ”¯ + åç¥ + å¹´é¾„æ®µ + é˜¶æ®µæ ‡ç­¾ï¼ˆåŠ é€Ÿ/è°ƒæ•´/å¹³ç¨³ï¼‰
- **å½“å‰æµå¹´**ï¼šå¹²æ”¯ + å¹´ä»½ + åç¥ + ç®€çŸ­è¯„è¯­ & é£é™©æç¤º
- **å½“å‰æµæœˆ**ï¼šå¹²æ”¯ + åç¥ + ä¸€å¥æœˆåº¦æç¤º
- **CTA**ï¼šä¸€é”®è·³è½¬åˆ°ã€Œä»Šå¹´æ•´ä½“èŠ‚å¥ã€çš„èŠå¤©

### 2.2 å¯¹ç…§ç°æœ‰ç³»ç»Ÿ

#### å¤§è¿

- âœ… **å·²æœ‰**ï¼š`analysis.luckRhythm.currentLuck`ï¼Œå«å¹²æ”¯ã€åç¥ã€å¹´é¾„æ®µ
- â›” **ç¼ºå°‘**ï¼š
  - `phaseTag`ï¼ˆåŠ é€Ÿ/è°ƒæ•´/å¹³ç¨³ï¼‰ï¼šéœ€è¦ä» `stage` æ˜ å°„è½¬æ¢
  - `favourLevel`ï¼ˆgood/neutral/tenseï¼‰ï¼šéœ€è¦ä» `favourLevel`ï¼ˆç”¨ç¥/ä¸­æ€§/å¿Œç¥ï¼‰æ˜ å°„ï¼Œç”¨äºå‰ç«¯é…è‰²
  - `ageRange` æ•°å­—æ ¼å¼ï¼šç°æœ‰æ˜¯å­—ç¬¦ä¸²"çº¦ 31 å²åˆ° 41 å²"ï¼Œéœ€è¦è§£æä¸º `[31, 41]`

#### æµå¹´

- âœ… **å·²æœ‰**ï¼š`fortune.liuNianPillar(year)` å¯å¾—æµå¹´å¹²æ”¯ã€åç¥
- â›” **ç¼ºå°‘**ï¼š
  - ç»¼åˆå‰å‡¶è¯„åˆ† `score`ï¼ˆ-100 ~ +100ï¼‰
  - ç®€çŸ­å€¾å‘ `shortTag`ï¼ˆå¦‚"æœºé‡å¤š"ï¼‰
  - é£é™©æç¤º `riskTag`ï¼ˆå¦‚"éœ€è¦ç¨³ä½é£é™©"ï¼‰

#### æµæœˆ

- âœ… **å·²æœ‰**ï¼š`fortune.liuYuePillar(dateUTC, yearStem)` å¯å¾—æµæœˆå¹²æ”¯ï¼ˆéœ€å…ˆè·å–å¹´å¹²ï¼‰
- â›” **ç¼ºå°‘**ï¼š
  - å¯¹æ—¥ä¸»åç¥å…³ç³»ï¼ˆéœ€è¦è®¡ç®—ï¼‰
  - æœˆåº¦å€¾å‘è¯´æ˜ `shortTip`ï¼ˆå¦‚"é€‚åˆæ”¶å°¾ï¼Œä¸å®œå†²åŠ¨å˜åŠ¨"ï¼‰

#### èŠå¤©è”åŠ¨

- âœ… **å·²æœ‰**ï¼šè¡Œè¿ç›¸å…³çš„ promptï¼ˆå¦‚ `buildLuckRhythmPrompt`ï¼‰
- â›” **ç¼ºå°‘**ï¼šä¸“é—¨é’ˆå¯¹ã€Œä»Šå¹´æ•´ä½“èŠ‚å¥ã€çš„èŠå¤©æ¨¡å¼å’Œä¸Šä¸‹æ–‡å‚æ•°

---

## ä¸‰ã€æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ï¼ˆReact Nativeï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ChartOverviewTab (å‘½ç›¤ç¸½è¦½ Tab)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TimeCoordinateCard (æ—¶é—´åæ ‡å¡ç‰‡) â† æ–°å¢              â”‚  â”‚
â”‚  â”‚  - å½“å‰å¤§è¿ï¼šå¤ç”¨ luckRhythm.currentLuck               â”‚  â”‚
â”‚  â”‚  - å½“å‰æµå¹´ï¼šè°ƒç”¨åç«¯ timeCoordinate.currentLiuNian   â”‚  â”‚
â”‚  â”‚  - å½“å‰æµæœˆï¼šè°ƒç”¨åç«¯ timeCoordinate.currentLiuYue     â”‚  â”‚
â”‚  â”‚  - CTAæŒ‰é’®ï¼šè·³è½¬èŠå¤©é¡µ + é¢„å¡«é—®é¢˜                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å…¶ä»–å¡ç‰‡ï¼ˆå‘½æ ¼ç¸½è©•ã€ç”¨ç¥æ ¼å±€ã€èƒ½é‡æµé€šç­‰ï¼‰              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ API è°ƒç”¨
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯ API (Core Service)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GET /api/v1/bazi/charts/:chartId                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  baziService.getChartDetail()                         â”‚  â”‚
â”‚  â”‚  â””â”€> è¿”å› BaziChartDto                                â”‚  â”‚
â”‚  â”‚      â””â”€> result.analysis.timeCoordinate â† æ–°å¢        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ æ•°æ®è®¡ç®—
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…«å­—å¼•æ“ (BaziEngine)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BaziEngine.compute()                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  buildTimeCoordinateMetrics() â† æ–°å¢å‡½æ•°              â”‚  â”‚
â”‚  â”‚  â”œâ”€> buildCurrentDaYunFromLuckRhythm()              â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€> å¤ç”¨ luckRhythm.currentLuck                  â”‚  â”‚
â”‚  â”‚  â”œâ”€> analyzeLiuNianCore() â† æ–°å¢å‡½æ•°                 â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€> è°ƒç”¨ fortune.liuNianPillar()                â”‚  â”‚
â”‚  â”‚  â”œâ”€> summarizeLiuNianForCard() â† LLM æç‚¼            â”‚  â”‚
â”‚  â”‚  â”œâ”€> analyzeLiuYueCore() â† æ–°å¢å‡½æ•°                   â”‚  â”‚
â”‚  â”‚  â”‚   â””â”€> è°ƒç”¨ fortune.liuYuePillar()                 â”‚  â”‚
â”‚  â”‚  â””â”€> summarizeLiuYueTip() â† LLM æç‚¼                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ èŠå¤©è”åŠ¨
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   èŠå¤©æ¥å£ (Chat API)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POST /api/v1/chat/conversations/:id/messages                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  context.type === 'year_rhythm'                       â”‚  â”‚
â”‚  â”‚  â””â”€> buildYearRhythmPrompt() â† æ–°å¢ Prompt æ¨¡æ¿       â”‚  â”‚
â”‚  â”‚      â””â”€> ä½¿ç”¨ timeCoordinate æ„å»ºä¸Šä¸‹æ–‡               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€äº§å“è®¾è®¡

### 4.1 å¡ç‰‡å®šä½

- **ä½ç½®**ï¼š`ChartOverviewTab`ï¼ˆå‘½ç›¤ç¸½è¦½ Tabï¼‰æœ€é¡¶éƒ¨ç¬¬ä¸€å¼ å¡ç‰‡
- **ç›®æ ‡**ï¼šä¸€å¥è¯å›ç­”ã€Œæˆ‘ç°åœ¨åœ¨å“ªä¸€è¿ã€å“ªä¸€å¹´ã€å“ªä¸€æœˆï¼Ÿã€
- **äº¤äº’**ï¼šæä¾›ã€Œä¸€é”®é—®ä»Šå¹´ã€CTA æŒ‰é’®ï¼Œå¼•å¯¼ç”¨æˆ·è¿›å…¥èŠå¤©

### 4.2 UI ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä½ ç°åœ¨çš„æ—¶é—´åæ ‡                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰å¤§è¿   ç”²å­ Â· åè´¢  ï¼ˆ31â€“41 å²ï¼‰    åŠ é€ŸæœŸ      â”‚
â”‚  å½“å‰æµå¹´   ä¹™å·³ï¼ˆ2025ï¼‰ Â· æ­£è´¢           æœºé‡å¤š      â”‚
â”‚  å½“å‰æµæœˆ   ä¸äº¥ Â· åå®˜                  é€‚åˆæ”¶å°¾    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              [è®©å°ä½©è®²è®²æˆ‘ä»Šå¹´æ•´ä½“çš„èŠ‚å¥]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**UI è§„èŒƒ**ï¼š
- æ ‡é¢˜ï¼šã€Œä½ ç°åœ¨çš„æ—¶é—´åæ ‡ã€
- ä¸‰è¡Œä¿¡æ¯ï¼šæ¯è¡Œå·¦ä¾§æ ‡ç­¾ + ä¸»ä½“å†…å®¹ + å³ä¾§å°æ ‡ç­¾
- CTA æŒ‰é’®ï¼šå³ä¸‹è§’ï¼Œæ–‡æ¡ˆã€Œè®©å°ä½©è®²è®²æˆ‘ä»Šå¹´æ•´ä½“çš„èŠ‚å¥ã€

### 4.3 æ•°æ®æ¥æºæ˜ å°„

| UI å­—æ®µ | æ•°æ®æ¥æº | è¯´æ˜ |
|---------|---------|------|
| å½“å‰å¤§è¿ Â· å¹²æ”¯ | `luckRhythm.currentLuck.stem + luckRhythm.currentLuck.branch` | å¤ç”¨ç°æœ‰ |
| å½“å‰å¤§è¿ Â· åç¥ | `luckRhythm.currentLuck.tenGod` | å¤ç”¨ç°æœ‰ |
| å½“å‰å¤§è¿ Â· å¹´é¾„åŒºé—´ | `luckRhythm.currentLuck.ageRange` | å¤ç”¨ç°æœ‰ï¼ˆéœ€è§£æä¸ºæ•°å­—åŒºé—´ï¼‰ |
| å½“å‰å¤§è¿ Â· é˜¶æ®µæ ‡ç­¾ | `luckRhythm.currentLuck.stage` | å¤ç”¨ç°æœ‰ï¼Œæ˜ å°„ä¸ºã€ŒåŠ é€ŸæœŸ/è°ƒæ•´æœŸ/å¹³ç¨³æœŸã€ |
| å½“å‰æµå¹´ Â· å¹²æ”¯ | `timeCoordinate.currentLiuNian.stemBranch` | æ–°å¢è®¡ç®— |
| å½“å‰æµå¹´ Â· å¹´ä»½ | `timeCoordinate.currentLiuNian.year` | æ–°å¢è®¡ç®— |
| å½“å‰æµå¹´ Â· åç¥ | `timeCoordinate.currentLiuNian.tenGod` | æ–°å¢è®¡ç®— |
| å½“å‰æµå¹´ Â· ç®€è¯„ | `timeCoordinate.currentLiuNian.shortTag` | LLM ç”Ÿæˆ |
| å½“å‰æµæœˆ Â· å¹²æ”¯ | `timeCoordinate.currentLiuYue.stemBranch` | æ–°å¢è®¡ç®— |
| å½“å‰æµæœˆ Â· åç¥ | `timeCoordinate.currentLiuYue.tenGod` | æ–°å¢è®¡ç®— |
| å½“å‰æµæœˆ Â· æç¤º | `timeCoordinate.currentLiuYue.shortTip` | LLM ç”Ÿæˆ |

---

## äº”ã€æ•°æ®ç»“æ„

### 5.1 æšä¸¾ç±»å‹å®šä¹‰

**ä½ç½®**ï¼š`app/src/types/chart` æ–°å¢æšä¸¾ç±»å‹

```typescript
/**
 * å¤§è¿é˜¶æ®µæ ‡ç­¾ï¼ˆç”¨äºå‰ç«¯é¢œè‰²/å›¾æ ‡ï¼‰
 */
export type PhaseTag = 'accelerate' | 'adjust' | 'stable';

/**
 * å¤§è¿é˜¶æ®µæ–‡æœ¬ï¼ˆç”¨äºç”¨æˆ·å±•ç¤ºï¼‰
 */
export type PhaseText = 'åŠ é€ŸæœŸ' | 'è°ƒæ•´æœŸ' | 'å¹³ç¨³æœŸ';

/**
 * å–œå¿Œç­‰çº§ï¼ˆç”¨äºå‰ç«¯é…è‰²ï¼‰
 */
export type FavourLevel = 'good' | 'neutral' | 'tense';

/**
 * èŠå¤©ä¸Šä¸‹æ–‡ç±»å‹
 */
export type ChatContextType = 'year_rhythm' | 'luck_rhythm_detail' | 'da_yun_card';
```

### 5.2 åç«¯æ•°æ®ç»“æ„ï¼ˆTypeScript æ¥å£ - DTOï¼‰

**ä½ç½®**ï¼š`app/src/types/chart` çš„ `BaziChartDto.result.analysis` ä¸‹æ–°å¢

**å‘½åçº¦å®š**ï¼šåç«¯è¿”å›ç»™å‰ç«¯çš„æ•°æ®ç»“æ„ç»Ÿä¸€å‘½åä¸º `TimeCoordinateDto`ï¼ˆData Transfer Objectï¼‰

```typescript
/**
 * æ—¶é—´åæ ‡ DTOï¼ˆåç«¯ -> å‰ç«¯ï¼‰
 */
interface TimeCoordinateDto {
  currentDaYun: {
    stemBranch: string;           // "ç”²å­"
    tenGod: string;                // "åè´¢"
    ageRange: [number, number];    // [31, 41]
    startYear?: number;            // 2025ï¼ˆå¯é€‰ï¼Œç”¨äºè®¡ç®—ï¼‰
    endYear?: number;              // 2034ï¼ˆå¯é€‰ï¼Œç”¨äºè®¡ç®—ï¼‰
    phaseTag: PhaseTag;            // 'accelerate' | 'adjust' | 'stable'ï¼ˆå¿…éœ€ï¼‰
    phaseText: PhaseText;          // 'åŠ é€ŸæœŸ' | 'è°ƒæ•´æœŸ' | 'å¹³ç¨³æœŸ'ï¼ˆå¿…éœ€ï¼Œç»™ç”¨æˆ·çœ‹çš„ï¼‰
    favourLevel?: FavourLevel;     // 'good' | 'neutral' | 'tense'ï¼ˆå¯é€‰ï¼Œç”¨äºè°ƒè‰²ï¼‰
  };
  currentLiuNian?: {
    stemBranch: string;            // "ä¹™å·³"
    year: number;                  // 2025
    tenGod: string;                // "æ­£è´¢"
    shortTag?: string;             // "æœºé‡å¤š"ï¼ˆLLM ç”Ÿæˆï¼Œå¯é€‰ï¼‰
    riskTag?: string;              // "éœ€è¦ç¨³ä½é£é™©"ï¼ˆLLM ç”Ÿæˆï¼Œå¯é€‰ï¼‰
  };
  currentLiuYue?: {
    stemBranch: string;            // "ä¸äº¥"
    year: number;                  // 2025
    monthIndex?: number;           // 1-12ï¼ˆå¯é€‰ï¼‰
    tenGod: string;                // "åå®˜"
    shortTip?: string;             // "é€‚åˆæ”¶å°¾"ï¼ˆLLM ç”Ÿæˆï¼Œå¯é€‰ï¼‰
  };
}
```

**è¯´æ˜**ï¼š
- `currentLiuNian` å’Œ `currentLiuYue` è®¾ä¸ºå¯é€‰ï¼Œå› ä¸ºå¦‚æœè®¡ç®—å¤±è´¥ï¼Œå‰ç«¯å¯ä»¥ä¸æ˜¾ç¤ºå¯¹åº”è¡Œ
- `phaseTag` å’Œ `phaseText` åˆ†ç¦»ï¼šå‰ç«¯ç”¨ `phaseTag` åšé€»è¾‘åˆ¤æ–­å’Œé¢œè‰²æ˜ å°„ï¼Œ`phaseText` ç”¨äºå±•ç¤º
- `favourLevel` ä½¿ç”¨ `'tense'` æ›¿ä»£ `'bad'`ï¼Œæ›´ç¬¦åˆä¸­æ€§è¡¨è¾¾
- **åç«¯ -> å‰ç«¯**ï¼š`TimeCoordinateDto` ä¼šåŸæ ·å¡è¿› `chart.result.analysis.timeCoordinate`ï¼Œå‰ç«¯ç”¨ä¸€ä¸ªè½»é‡ `mapTimeCoordinateDtoToVm()` åšä¸€å±‚è½¬æ¢ï¼ˆå¦‚æœéœ€è¦ï¼‰

### 5.3 å‰ç«¯æ•°æ®ç»“æ„ï¼ˆTypeScript æ¥å£ - ViewModelï¼‰

**ä½ç½®**ï¼š`app/src/components/bazi/TimeCoordinateCard` æˆ–ç‹¬ç«‹ç±»å‹æ–‡ä»¶

**å‘½åçº¦å®š**ï¼šå‰ç«¯ç»„ä»¶ä½¿ç”¨çš„æ•°æ®ç»“æ„ç»Ÿä¸€å‘½åä¸º `TimeCoordinateVM`ï¼ˆViewModelï¼‰

```typescript
/**
 * æ—¶é—´åæ ‡ ViewModelï¼ˆå‰ç«¯ç»„ä»¶ä½¿ç”¨ï¼‰
 * 
 * æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å¤§è¿æ•°æ®ï¼Œæ•´å¡ä¸æ˜¾ç¤ºï¼Œæ‰€ä»¥ currentDaYun åœ¨ç»„ä»¶å†…éƒ¨è§†ä¸ºå¿…éœ€
 */
export type TimeCoordinateVM = {
  currentDaYun: {
    stemBranch: string;
    tenGod: string;
    ageRange: [number, number];
    startYear?: number;
    endYear?: number;
    phaseText: string;     // ç»™ç”¨æˆ·çœ‹çš„ï¼ˆ'åŠ é€ŸæœŸ' | 'è°ƒæ•´æœŸ' | 'å¹³ç¨³æœŸ'ï¼‰
    phaseTag?: 'accelerate' | 'adjust' | 'stable';  // ç”¨äºé€»è¾‘åˆ¤æ–­å’Œé¢œè‰²æ˜ å°„
    favourLevel?: 'good' | 'neutral' | 'tense';    // ç”¨äºé…è‰²
  };
  currentLiuNian?: {
    stemBranch: string;
    year: number;
    tenGod: string;
    shortTag?: string;
    riskTag?: string;
  };
  currentLiuYue?: {
    stemBranch: string;
    year: number;
    monthIndex?: number;
    tenGod: string;
    shortTip?: string;
  };
};
```

**è¯´æ˜**ï¼š
- DTO å’Œ VM ç»“æ„åŸºæœ¬ä¸€è‡´ï¼Œä½†å‘½ååˆ†ç¦»ï¼Œä¾¿äºæœªæ¥æ‰©å±•
- å¦‚æœåç«¯ DTO ç»“æ„å˜æ›´ï¼Œåªéœ€ä¿®æ”¹ `mapTimeCoordinateDtoToVm()` è½¬æ¢å‡½æ•°

**é›†æˆä½ç½®**ï¼š

```typescript
// app/src/types/chart
export interface BaziChartDto {
  // ... existing fields ...
  result: {
    // ... existing fields ...
    analysis: {
      // ... existing fields ...
      luckRhythm?: LuckRhythm;        // ç°æœ‰å­—æ®µ
      timeCoordinate?: TimeCoordinateDto; // âœ… æ–°å¢å­—æ®µ
      // ... existing fields ...
    };
  };
}
```

### 5.4 åç«¯è®¡ç®—å‡½æ•°è¿”å›ç»“æ„ï¼ˆJavaScriptï¼‰

**ä½ç½®**ï¼š`core/engine/index` çš„ `BaziEngine` ç±»ä¸­æ–°å¢æ–¹æ³•

**é‡è¦çº¦å®š**ï¼š
1. **æ—¶é—´æ¥æºç»Ÿä¸€**ï¼šæ‰€æœ‰æ—¶é—´ç›¸å…³è®¡ç®—ç»Ÿä¸€ä½¿ç”¨ `options.now`ï¼Œä¸å†…éƒ¨ `new Date()`
2. **è§„åˆ™å±‚ä¸æ–‡æ¡ˆå±‚åˆ†ç¦»**ï¼šè§„åˆ™å±‚ï¼ˆçº¯ç®—æ³•ï¼‰å’Œæ–‡æ¡ˆå±‚ï¼ˆLLM è°ƒç”¨ï¼‰ä¸¥æ ¼åˆ†ç¦»
3. **é”™è¯¯å…œåº•ç­–ç•¥**ï¼šéµå¾ªã€Œèƒ½å±•ç¤ºå¤šå°‘å±•ç¤ºå¤šå°‘ã€åŸåˆ™ï¼Œå¤§è¿ä¼˜å…ˆï¼Œæµå¹´æ¬¡ä¹‹ï¼Œæµæœˆæœ€å

```javascript
/**
 * ç»„è£…ã€Œæ—¶é—´åæ ‡ã€æ•°æ®
 * 
 * @param {Object} luckRhythm - è¡Œè¿èŠ‚å¥æ•°æ®ï¼ˆå·²è®¡ç®—ï¼‰
 * @param {Object} baziChart - å…«å­—å‘½ç›˜å¯¹è±¡ï¼ˆåŒ…å«å››æŸ±ï¼‰
 * @param {Object} birthJson - å‡ºç”Ÿä¿¡æ¯
 * @param {Object} options - é€‰é¡¹
 * @param {Date} options.now - å½“å‰æ—¶é—´ï¼ˆç»Ÿä¸€æ—¶é—´æºï¼Œé»˜è®¤ new Date()ï¼‰
 * @returns {Object} TimeCoordinateDto å¯¹è±¡
 */
async buildTimeCoordinateMetrics(luckRhythm, baziChart, birthJson, { now } = {}) {
  // âœ… ç»Ÿä¸€æ—¶é—´æºï¼šä»å‚æ•°è§£æ„ï¼Œé»˜è®¤ undefinedï¼Œå†…éƒ¨å†åˆ¤æ–­
  const currentTime = now || new Date();
  
  // æ³¨æ„ï¼šå‡½æ•°å†…éƒ¨æ‰€æœ‰æ—¶é—´ç›¸å…³è®¡ç®—éƒ½ä½¿ç”¨ currentTimeï¼Œä¸å†è°ƒç”¨ new Date()
  const logger = require('../../utils/logger');
  
  // 1. å½“å‰å¤§è¿ï¼šä» luckRhythm.currentLuck æå–ï¼ˆå¿…éœ€ï¼Œå¤±è´¥åˆ™æ•´å¡éšè—ï¼‰
  let currentDaYun = null;
  try {
    currentDaYun = this.buildCurrentDaYunFromLuckRhythm(luckRhythm);
    if (!currentDaYun) {
      logger.warn('TimeCoordinate: luckRhythm.currentLuck missing', { chartId: baziChart.chartId });
      return null; // å¤§è¿ç¼ºå¤±ï¼Œæ•´å¡ä¸æ˜¾ç¤º
    }
  } catch (e) {
    logger.error('TimeCoordinate: failed to build currentDaYun', { error: e.message, chartId: baziChart.chartId });
    return null;
  }
  
  // 2. å½“å‰æµå¹´ï¼šè§„åˆ™å±‚è®¡ç®— + LLM æ–‡æ¡ˆå±‚ï¼ˆå¯é€‰ï¼‰
  let currentLiuNian = null;
  try {
    const liuNianCore = this.analyzeLiuNianCore(baziChart, birthJson, currentTime);
    // LLM æ–‡æ¡ˆå±‚ï¼ˆå¤±è´¥ä¸å½±å“è§„åˆ™å±‚ç»“æœï¼‰
    let shortTag = null;
    let riskTag = null;
    try {
      const summary = await this.summarizeLiuNianForCard(liuNianCore, baziChart);
      shortTag = summary.shortTag;
      riskTag = summary.riskTag;
    } catch (e) {
      logger.warn('TimeCoordinate: LLM summary failed for liuNian', { error: e.message, chartId: baziChart.chartId });
      // ä½¿ç”¨è§„åˆ™ç”Ÿæˆçš„å ä½æ–‡æœ¬
      shortTag = this.generateDefaultShortTag(liuNianCore);
    }
    
    currentLiuNian = {
      stemBranch: `${liuNianCore.stem}${liuNianCore.branch}`,
      year: liuNianCore.year,
      tenGod: liuNianCore.tenGodToDayMaster,
      shortTag,
      riskTag,
    };
  } catch (e) {
    logger.warn('TimeCoordinate: failed to build currentLiuNian', { error: e.message, chartId: baziChart.chartId });
    // æµå¹´å¤±è´¥ä¸å½±å“å¤§è¿æ˜¾ç¤ºï¼ŒcurrentLiuNian ä¿æŒä¸º null
  }
  
  // 3. å½“å‰æµæœˆï¼šè§„åˆ™å±‚è®¡ç®— + LLM æ–‡æ¡ˆå±‚ï¼ˆå¯é€‰ï¼‰
  let currentLiuYue = null;
  try {
    const liuYueCore = this.analyzeLiuYueCore(baziChart, birthJson, currentTime);
    // LLM æ–‡æ¡ˆå±‚ï¼ˆå¤±è´¥ä¸å½±å“è§„åˆ™å±‚ç»“æœï¼‰
    let shortTip = null;
    try {
      shortTip = await this.summarizeLiuYueTip(liuYueCore, baziChart);
    } catch (e) {
      logger.warn('TimeCoordinate: LLM summary failed for liuYue', { error: e.message, chartId: baziChart.chartId });
      shortTip = 'å¹³ç¨³'; // é»˜è®¤å ä½æ–‡æœ¬
    }
    
    currentLiuYue = {
      stemBranch: `${liuYueCore.stem}${liuYueCore.branch}`,
      year: liuYueCore.year,
      monthIndex: liuYueCore.monthIndex,
      tenGod: liuYueCore.tenGodToDayMaster,
      shortTip,
    };
  } catch (e) {
    logger.warn('TimeCoordinate: failed to build currentLiuYue', { error: e.message, chartId: baziChart.chartId });
    // æµæœˆå¤±è´¥ä¸å½±å“å¤§è¿å’Œæµå¹´æ˜¾ç¤ºï¼ŒcurrentLiuYue ä¿æŒä¸º null
  }
  
  return {
    currentDaYun,
    currentLiuNian,
    currentLiuYue,
  };
}
```

### 5.5 æ•°æ®æµ

```
BaziEngine.compute(options)
  â””â”€> buildLuckRhythmMetrics()  // ç°æœ‰å‡½æ•°
      â””â”€> luckRhythm.currentLuck  // è¾“å‡º
  â””â”€> buildTimeCoordinateMetrics()  // âœ… æ–°å¢å‡½æ•°
      â”œâ”€> buildCurrentDaYunFromLuckRhythm(luckRhythm)  // è§„åˆ™å±‚
      â”œâ”€> analyzeLiuNianCore(baziChart, birthJson, now)  // è§„åˆ™å±‚
      â”‚   â””â”€> è°ƒç”¨ fortune.liuNianPillar()
      â”œâ”€> summarizeLiuNianForCard()  // æ–‡æ¡ˆå±‚ï¼ˆLLM è°ƒç”¨ï¼‰
      â”œâ”€> analyzeLiuYueCore(baziChart, birthJson, now)  // è§„åˆ™å±‚
      â”‚   â””â”€> è°ƒç”¨ fortune.liuYuePillar()
      â””â”€> summarizeLiuYueTip()  // æ–‡æ¡ˆå±‚ï¼ˆLLM è°ƒç”¨ï¼‰
  â””â”€> analysis.timeCoordinate  // è¾“å‡ºåˆ°æœ€ç»ˆç»“æœ
```

**è§„åˆ™å±‚ä¸æ–‡æ¡ˆå±‚åˆ†ç¦»åŸåˆ™**ï¼š
- **è§„åˆ™å±‚**ï¼ˆ`engine/fortune/metrics/timeCoordinateCore`ï¼‰ï¼š
  - çº¯ç®—æ³•ï¼Œä¸è°ƒç”¨ LLM
  - è¾“å‡ºç»“æ„åŒ–æ•°æ®ï¼ˆå¹²æ”¯ã€åç¥ã€è¯„åˆ†ã€æ ‡ç­¾æ•°ç»„ç­‰ï¼‰
  - å¯ä»¥å•æµ‹ï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡
- **æ–‡æ¡ˆå±‚**ï¼ˆ`engine/explainers/timeCoordinate`ï¼‰ï¼š
  - åªè´Ÿè´£æŠŠè§„åˆ™å±‚çš„ç»“æ„åŒ–æ•°æ®è½¬æ¢æˆç”¨æˆ·å‹å¥½çš„çŸ­æ ‡ç­¾
  - è°ƒç”¨ LLMï¼Œä½†å¤±è´¥æ—¶æœ‰å…œåº•é€»è¾‘
  - å³ä½¿ LLM æŒ‚äº†ï¼Œè§„åˆ™å±‚ç»“æœä»å¯ç”¨

---

## å…­ã€åç«¯è®¡ç®—é€»è¾‘

### 6.1 æ—¶é—´æ¥æºç»Ÿä¸€

**é—®é¢˜**ï¼šå¦‚æœæ¯ä¸ªå‡½æ•°å†…éƒ¨è‡ªå·± `new Date()`ï¼Œä¹‹åè¦åšã€Œæ—¶åŒºç»Ÿä¸€ / çœ‹æŒ‡å®šå¹´ä»½ã€éƒ½ä¼šå¾ˆç—›è‹¦ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

åœ¨ `BaziEngine.compute()` çš„å‚æ•°é‡Œï¼Œå¢åŠ å¯é€‰ `options`ï¼š

```javascript
async compute(birthJson, options = {}) {
  const now = options.now || new Date();  // ç»Ÿä¸€æ—¶é—´æº
  
  // ... ç°æœ‰è®¡ç®—é€»è¾‘ ...
  
  // åœ¨è°ƒç”¨ buildTimeCoordinateMetrics æ—¶ï¼ŒæŠŠ now é€ä¼ 
  const timeCoordinate = await this.buildTimeCoordinateMetrics(
    luckRhythmMetrics,
    {
      pillars,
      analysis: {
        gods: {
          favorable: favoredAvoid.favored,
          unfavorable: favoredAvoid.avoid,
        },
      },
    },
    birthJson,
    { now }  // âœ… ç»Ÿä¸€æ—¶é—´æº
  );
  
  // ...
}
```

**å¥½å¤„**ï¼š
- ä»¥åè¦æ”¯æŒã€ŒæŸ¥çœ‹ 2027 å¹´çš„æ—¶é—´åæ ‡ã€ä¹Ÿç®€å•ï¼Œåªè¦ä¼  `options.now = new Date('2027-01-01')`
- æµ‹è¯•æ—¶å¯ä»¥å›ºå®šæ—¶é—´ï¼Œä¿è¯ç»“æœå¯å¤ç°
- æ—¶åŒºå¤„ç†ç»Ÿä¸€åœ¨ä¸€å¤„

### 6.4 å½“å‰å¤§è¿ï¼ˆå¤ç”¨ç°æœ‰æ•°æ®ï¼‰

**å‡½æ•°**ï¼š`buildCurrentDaYunFromLuckRhythm(luckRhythm)`

**è¾“å…¥**ï¼š`luckRhythm`ï¼ˆå·²ç”± `buildLuckRhythmMetrics` è®¡ç®—ï¼‰

**é€»è¾‘**ï¼š

```javascript
buildCurrentDaYunFromLuckRhythm(luckRhythm) {
  const currentLuck = luckRhythm.currentLuck;
  
  // è§£æå¹´é¾„åŒºé—´å­—ç¬¦ä¸²ä¸ºæ•°å­—æ•°ç»„
  // ä¾‹å¦‚ï¼š"çº¦ 31 å²åˆ° 41 å²" -> [31, 41]
  const ageRangeMatch = currentLuck.ageRange.match(/(\d+).*?(\d+)/);
  const ageRange = ageRangeMatch 
    ? [parseInt(ageRangeMatch[1]), parseInt(ageRangeMatch[2])]
    : [0, 0];
  
  // âœ… æ˜ å°„ stage ä¸º phaseTag å’Œ phaseTextï¼ˆåŒæ—¶è¿”å›æšä¸¾å€¼å’Œæ–‡æœ¬ï¼‰
  // æ³¨æ„ï¼šstage -> phase çš„æ˜ å°„å±äºäº§å“/å‘½ç†ç­–ç•¥ï¼Œå¦‚éœ€è°ƒæ•´è¯·åœ¨æ­¤å¤„ç»Ÿä¸€ä¿®æ”¹
  // å¦‚æœæœªæ¥åœ¨å…¶ä»–å¡ç‰‡ä¸­ä¹Ÿç”¨åˆ° phaseTagï¼Œè¯·å¤ç”¨æ­¤æ˜ å°„é€»è¾‘ï¼Œé¿å…å¤šå¤„ä¿®æ”¹
  const stageToPhase = {
    'æ‰“åŸºç¡€æœŸ':      { tag: 'adjust',    text: 'è°ƒæ•´æœŸ' },
    'æ‹“å±•å†²åˆºæœŸ':    { tag: 'accelerate', text: 'åŠ é€ŸæœŸ' },
    'è°ƒæ•´è½¬æŠ˜æœŸ':    { tag: 'adjust',    text: 'è°ƒæ•´æœŸ' },
    'æ²‰æ·€æ”¶è·æœŸ':    { tag: 'stable',    text: 'å¹³ç¨³æœŸ' },
  };
  
  // âœ… æ˜ å°„ favourLevel ä¸º FavourLevel æšä¸¾ï¼ˆä½¿ç”¨ 'tense' è€Œé 'bad'ï¼‰
  const favourLevelMap = {
    'ç”¨ç¥': 'good',
    'ä¸­æ€§': 'neutral',
    'å¿Œç¥': 'tense',  // âœ… ä½¿ç”¨ 'tense' è€Œé 'bad'
  };
  
  const stage = stageToPhase[currentLuck.stage] || { tag: 'stable', text: 'å¹³ç¨³æœŸ' };
  
  return {
    stemBranch: `${currentLuck.stem}${currentLuck.branch}`,
    tenGod: currentLuck.tenGod,
    ageRange,
    startYear: null,  // å¯é€‰ï¼šä»èµ·è¿å¹´é¾„ + å¤§è¿ç´¢å¼•è®¡ç®—
    endYear: null,     // å¯é€‰ï¼šä»èµ·è¿å¹´é¾„ + å¤§è¿ç´¢å¼•è®¡ç®—
    phaseTag: stage.tag,      // âœ… 'accelerate' | 'adjust' | 'stable'
    phaseText: stage.text,    // âœ… 'åŠ é€ŸæœŸ' | 'è°ƒæ•´æœŸ' | 'å¹³ç¨³æœŸ'
    favourLevel: favourLevelMap[currentLuck.favourLevel] || 'neutral',
  };
}
```

**å‚æ•°å¯¹é½**ï¼š
- âœ… å¤ç”¨ `luckRhythm.currentLuck` çš„æ‰€æœ‰å­—æ®µ
- âœ… ä¸æ–°å¢è®¡ç®—ï¼Œåªåšæ•°æ®æ˜ å°„å’Œæ ¼å¼è½¬æ¢

### 6.2 å½“å‰æµå¹´ï¼ˆè§„åˆ™å±‚è®¡ç®—ï¼‰

**å‡½æ•°ä½ç½®**ï¼š`core/engine/fortune/metrics/timeCoordinateCore`ï¼ˆæ–°å»ºæ–‡ä»¶ï¼Œè§„åˆ™å±‚ç»Ÿä¸€ç®¡ç†ï¼‰

**è·¯å¾„å‘½åè§„èŒƒ**ï¼šæ–‡æ¡£ä¸­ç»Ÿä¸€ä¸å†™æ–‡ä»¶åç¼€ï¼Œå®é™…æ–‡ä»¶ç±»å‹ä»¥é¡¹ç›®è§„èŒƒä¸ºå‡†ï¼ˆTS ç”¨ `.ts`ï¼ŒNode ç”¨ `.js`ï¼‰

**å‡½æ•°ç­¾å**ï¼š`analyzeLiuNianCore(baziChart, birthJson, now)`

**è¾“å…¥**ï¼š
- `baziChart`: å…«å­—å‘½ç›˜å¯¹è±¡ï¼ˆåŒ…å«å››æŸ±ï¼‰
- `birthJson`: å‡ºç”Ÿä¿¡æ¯
- `now`: å½“å‰æ—¶é—´ï¼ˆDate å¯¹è±¡ï¼Œç»Ÿä¸€æ—¶é—´æºï¼‰

**è¿”å›ç»“æ„**ï¼ˆè§„åˆ™å±‚è¾“å‡ºï¼Œçº¯ç»“æ„åŒ–æ•°æ®ï¼‰ï¼š

```typescript
interface LiuNianCoreResult {
  year: number;                    // 2025
  stem: string;                    // "ä¹™"
  branch: string;                  // "å·³"
  tenGodToDayMaster: string;       // "æ­£è´¢"
  score: number;                   // -100 ~ +100ï¼ˆç»¼åˆå‰å‡¶è¯„åˆ†ï¼‰
  tags: string[];                  // ["è´¢è¿", "å‹åŠ›"]ï¼ˆç»“æ„åŒ–æ ‡ç­¾ï¼‰
  riskFactors: string[];            // ["æŠ•èµ„æ³¢åŠ¨", "å·¥ä½œå˜åŠ¨"]ï¼ˆé£é™©å› å­ï¼‰
  favourLevel: 'ç”¨ç¥' | 'ä¸­æ€§' | 'å¿Œç¥';
  clashHarmPunish: string[];       // ["å¹´æŸ±å†²", "æœˆæŸ±å†²"]
}
```

**å®ç°é€»è¾‘**ï¼š

```javascript
analyzeLiuNianCore(baziChart, birthJson, now) {
  // 1. è°ƒç”¨ç°æœ‰æµå¹´è®¡ç®—å‡½æ•°
  const { liuNianPillar } = require('../index');
  const yearInfo = liuNianPillar(now);
  
  // 2. è®¡ç®—æµå¹´ä¸æ—¥ä¸»çš„åç¥å…³ç³»
  const dayMasterStem = baziChart.pillars.day.stem;
  const tenGodToDayMaster = this.calculateTenGod(
    yearInfo.stem,
    dayMasterStem
  );
  
  // 3. è®¡ç®—æµå¹´ä¸å‘½ç›˜çš„åˆ‘å†²åˆå®³ï¼ˆç®€åŒ–ç‰ˆï¼‰
  const clashHarmPunish = this.analyzeClashHarmPunish(
    { stem: yearInfo.stem, branch: yearInfo.branch },
    baziChart.pillars
  );
  
  // 4. è®¡ç®—æµå¹´äº”è¡Œä¸ç”¨ç¥çš„å…³ç³»
  const yearElement = this.getElementFromPillar({
    stem: yearInfo.stem,
    branch: yearInfo.branch,
  });
  const favourLevel = this.determineFavourLevel(
    yearElement,
    baziChart.analysis.gods?.favorable || [],
    baziChart.analysis.gods?.unfavorable || []
  );
  
  // 5. è®¡ç®—ç»¼åˆè¯„åˆ†ï¼ˆ-100 ~ +100ï¼‰
  const score = this.calculateLiuNianScore({
    tenGod: tenGodToDayMaster,
    favourLevel,
    clashHarmPunish,
  });
  
  // 6. ç”Ÿæˆç»“æ„åŒ–æ ‡ç­¾ï¼ˆè§„åˆ™å±‚ï¼Œä¸ä¾èµ– LLMï¼‰
  const tags = this.generateTagsFromScore(score, tenGodToDayMaster);
  const riskFactors = this.extractRiskFactors(clashHarmPunish, favourLevel);
  
  return {
    year: yearInfo.year,
    stem: yearInfo.stem,
    branch: yearInfo.branch,
    tenGodToDayMaster,
    score,
    tags,
    riskFactors,
    favourLevel,
    clashHarmPunish,
  };
}
```

**å‚æ•°å¯¹é½**ï¼š
- âœ… å¤ç”¨ `fortune.liuNianPillar()` å‡½æ•°
- âœ… å¤ç”¨ `getElementFromPillar()` å‡½æ•°
- âœ… å¤ç”¨ `determineFavourLevel()` å‡½æ•°
- âœ… å¤ç”¨ `analyzeClashHarmPunish()` å‡½æ•°
- âœ… **è§„åˆ™å±‚æ°¸è¿œå¯ä»¥å•æµ‹**ï¼Œä¸ä¾èµ–å¤–éƒ¨æœåŠ¡

### 6.3 å½“å‰æµå¹´ï¼ˆLLM æ–‡æ¡ˆå±‚ï¼‰

**å‡½æ•°ä½ç½®**ï¼š`core/engine/explainers/timeCoordinate`ï¼ˆæ–°å»ºæ–‡ä»¶ï¼Œæ–‡æ¡ˆå±‚ç»Ÿä¸€ç®¡ç†ï¼‰

**å‡½æ•°ç­¾å**ï¼š`summarizeLiuNianForCard(liuNianCore, baziChart)`

**è¾“å…¥**ï¼š
- `liuNianCore`: è§„åˆ™å±‚è®¡ç®—ç»“æœï¼ˆ`LiuNianCoreResult`ï¼‰
- `baziChart`: å…«å­—å‘½ç›˜å¯¹è±¡

**è¿”å›ç»“æ„**ï¼ˆæ–‡æ¡ˆå±‚è¾“å‡ºï¼‰ï¼š

```typescript
interface LiuNianSummary {
  shortTag: string;      // "æœºé‡å¤š"ï¼ˆ3~6 å­—ï¼‰
  riskTag?: string;     // "éœ€è¦ç¨³ä½é£é™©"ï¼ˆ5~10 å­—ï¼Œå¯é€‰ï¼‰
}
```

**å®ç°é€»è¾‘**ï¼š

```javascript
async summarizeLiuNianForCard(liuNianCore, baziChart) {
  const logger = require('../../utils/logger');
  
  // æ„å»º LLM Prompt
  const prompt = `
æ ¹æ®ä»¥ä¸‹æµå¹´åˆ†æä¿¡æ¯ï¼Œæç‚¼ 2 ä¸ªçŸ­æ ‡ç­¾ï¼š

ã€æµå¹´ä¿¡æ¯ã€‘
- æµå¹´å¹²æ”¯ï¼š${liuNianCore.stem}${liuNianCore.branch}ï¼ˆ${liuNianCore.year}å¹´ï¼‰
- ä¸æ—¥ä¸»åç¥ï¼š${liuNianCore.tenGodToDayMaster}
- å–œå¿Œï¼š${liuNianCore.favourLevel}
- ç»¼åˆè¯„åˆ†ï¼š${liuNianCore.score}ï¼ˆ-100 ~ +100ï¼‰
- æ ‡ç­¾ï¼š${liuNianCore.tags.join('ã€')}
- é£é™©å› å­ï¼š${liuNianCore.riskFactors.join('ã€')}

ã€è¦æ±‚ã€‘
1. shortTagï¼šç”¨ 3~6 ä¸ªå­—å½¢å®¹è¿™ä¸€å¹´çš„æ•´ä½“èŠ‚å¥å€¾å‘ï¼ˆå¦‚"æœºé‡å¤š"ã€"å‹åŠ›è¾ƒå¤§"ã€"éœ€è¦ç¨³ä½é£é™©"ï¼‰
2. riskTagï¼šç”¨ 5~10 ä¸ªå­—ç‚¹å‡ºä»Šå¹´éœ€è¦æ³¨æ„çš„ä¸€ä¸ªé£é™©ç‚¹ï¼ˆå¦‚æœé£é™©ä¸æ˜æ˜¾ï¼Œå¯ä»¥ä¸ºç©ºï¼‰

ã€è¾“å‡ºæ ¼å¼ã€‘
JSON æ ¼å¼ï¼š
{
  "shortTag": "æœºé‡å¤š",
  "riskTag": "éœ€è¦ç¨³ä½é£é™©"
}

è¦æ±‚å£å»ä¸­æ€§ç†æ€§ï¼Œä¸å“äººã€‚
`;

  try {
    // è°ƒç”¨ LLMï¼ˆä½¿ç”¨ç°æœ‰ aiServiceï¼‰
    const { aiService } = require('../../modules/ai/aiService');  // è·¯å¾„ä»¥å®é™…é¡¹ç›®ç»“æ„ä¸ºå‡†
    const response = await aiService.callLLM({
      messages: [
        { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‘½ç†åˆ†æåŠ©æ‰‹ã€‚' },
        { role: 'user', content: prompt },
      ],
      model: 'deepseek', // ä½¿ç”¨é»˜è®¤æ¨¡å‹
    });
    
    // è§£æ JSON å“åº”
    const result = JSON.parse(response.content);
    return {
      shortTag: result.shortTag || 'å¹³ç¨³',
      riskTag: result.riskTag || null,
    };
  } catch (e) {
    // å…œåº•ï¼šå¦‚æœ LLM è°ƒç”¨å¤±è´¥æˆ–è¿”å›é JSONï¼Œä½¿ç”¨è§„åˆ™ç”Ÿæˆ
    logger.warn('TimeCoordinate: LLM summary failed, using fallback', { 
      error: e.message,
      chartId: baziChart.chartId 
    });
    return {
      shortTag: this.generateDefaultShortTag(liuNianCore),
      riskTag: this.generateDefaultRiskTag(liuNianCore),
    };
  }
}

/**
 * è§„åˆ™å±‚å…œåº•ï¼šæ ¹æ®è¯„åˆ†å’Œæ ‡ç­¾ç”Ÿæˆé»˜è®¤ shortTag
 */
generateDefaultShortTag(liuNianCore) {
  if (liuNianCore.score > 50) return 'æœºé‡å¤š';
  if (liuNianCore.score < -50) return 'å‹åŠ›è¾ƒå¤§';
  return 'å¹³ç¨³';
}

/**
 * è§„åˆ™å±‚å…œåº•ï¼šæ ¹æ®é£é™©å› å­ç”Ÿæˆé»˜è®¤ riskTag
 */
generateDefaultRiskTag(liuNianCore) {
  if (liuNianCore.riskFactors.length > 0) {
    return `æ³¨æ„${liuNianCore.riskFactors[0]}`;
  }
  return null;
}
```

**å‚æ•°å¯¹é½**ï¼š
- âœ… ä½¿ç”¨ç°æœ‰ `aiService.callLLM()` æ¥å£
- âœ… éµå¾ªç°æœ‰ LLM è°ƒç”¨è§„èŒƒ
- âœ… **LLM å¤±è´¥ä¸å½±å“è§„åˆ™å±‚ç»“æœ**ï¼Œæœ‰å…œåº•é€»è¾‘

### 6.5 å½“å‰æµæœˆï¼ˆè§„åˆ™å±‚è®¡ç®—ï¼‰

**å‡½æ•°**ï¼š`analyzeLiuYueCore(baziChart, birthJson, now)`

**è¾“å…¥**ï¼š
- `baziChart`: å…«å­—å‘½ç›˜å¯¹è±¡
- `birthJson`: å‡ºç”Ÿä¿¡æ¯
- `now`: å½“å‰æ—¶é—´ï¼ˆDate å¯¹è±¡ï¼‰

**é€»è¾‘**ï¼š

```javascript
analyzeLiuYueCore(baziChart, birthJson, now) {
  // 1. è°ƒç”¨ç°æœ‰æµæœˆè®¡ç®—å‡½æ•°
  // âœ… å…ˆè·å–å¹´å¹²ï¼Œå†è·å–æœˆå¹²æ”¯ï¼ˆå…·ä½“ç­¾åä»¥ fortune/index.js å®é™…å®ç°ä¸ºå‡†ï¼‰
  const { liuNianPillar, liuYuePillar } = require('./fortune/index');  // è·¯å¾„ä»¥å®é™…é¡¹ç›®ç»“æ„ä¸ºå‡†
  const yearInfo = liuNianPillar(now);
  const monthInfo = liuYuePillar(now, yearInfo.stem);  // ä¼ å…¥ dateUTC å’Œ yearStem
  
  // 2. è®¡ç®—æµæœˆä¸æ—¥ä¸»çš„åç¥å…³ç³»
  const dayMasterStem = baziChart.pillars.day.stem;
  const tenGodToDayMaster = this.calculateTenGod(
    monthInfo.stem,
    dayMasterStem
  );
  
  // 3. è®¡ç®—æµæœˆä¸å‘½ç›˜çš„åˆ‘å†²åˆå®³ï¼ˆç®€åŒ–ç‰ˆï¼‰
  const clashHarmPunish = this.analyzeClashHarmPunish(
    { stem: monthInfo.stem, branch: monthInfo.branch },
    baziChart.pillars
  );
  
  // 4. è®¡ç®—æœˆä»½ç´¢å¼•ï¼ˆ1-12ï¼‰
  const monthIndex = this.getMonthIndexFromBranch(monthInfo.branch);
  
  return {
    year: yearInfo.year,
    stem: monthInfo.stem,
    branch: monthInfo.branch,
    monthIndex,
    tenGodToDayMaster,
    clashHarmPunish,
  };
}
```

**å‚æ•°å¯¹é½**ï¼š
- âœ… å¤ç”¨ `fortune.liuNianPillar()` å‡½æ•°
- âœ… å¤ç”¨ `fortune.liuYuePillar()` å‡½æ•°
- âœ… å¤ç”¨ `calculateTenGod()` å‡½æ•°
- âœ… å¤ç”¨ `analyzeClashHarmPunish()` å‡½æ•°

### 6.6 å½“å‰æµæœˆï¼ˆLLM æç‚¼ï¼‰

**å‡½æ•°**ï¼š`summarizeLiuYueTip(liuYueCore, baziChart)`

**é€»è¾‘**ï¼šä¸ `summarizeLiuNianForCard` ç±»ä¼¼ï¼Œä½†è¾“å‡ºä¸ºå•è¡Œæç¤ºæ–‡æœ¬ã€‚

```javascript
async summarizeLiuYueTip(liuYueCore, baziChart) {
  const prompt = `
æ ¹æ®ä»¥ä¸‹æµæœˆåˆ†æä¿¡æ¯ï¼Œæç‚¼ä¸€å¥è¯æç¤ºï¼ˆ5~10 å­—ï¼‰ï¼š

ã€æµæœˆä¿¡æ¯ã€‘
- æµæœˆå¹²æ”¯ï¼š${liuYueCore.stem}${liuYueCore.branch}
- ä¸æ—¥ä¸»åç¥ï¼š${liuYueCore.tenGodToDayMaster}

ã€è¦æ±‚ã€‘
ç”¨ä¸€å¥è¯æç¤ºè¿™ä¸ªæœˆçš„èŠ‚å¥å€¾å‘ï¼ˆå¦‚"é€‚åˆæ”¶å°¾"ã€"ä¸å®œå†²åŠ¨å˜åŠ¨"ã€"é€‚åˆå¼€æ‹“"ï¼‰ã€‚

ã€è¾“å‡ºæ ¼å¼ã€‘
ç›´æ¥è¿”å›æ–‡æœ¬ï¼Œä¸è¦ JSONã€‚
`;

  const { aiService } = require('../../modules/ai/aiService');
  const response = await aiService.callLLM({
    messages: [
      { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‘½ç†åˆ†æåŠ©æ‰‹ã€‚' },
      { role: 'user', content: prompt },
    ],
    model: 'deepseek',
  });
  
  return response.content.trim() || 'å¹³ç¨³';
}
```

### 6.7 é›†æˆåˆ° BaziEngine.compute()

**ä½ç½®**ï¼š`core/engine/index` çš„ `BaziEngine.compute()` æ–¹æ³•

**ä¿®æ”¹ç‚¹**ï¼š

```javascript
async compute(birthJson, options = {}) {
  const now = options.now || new Date();  // âœ… ç»Ÿä¸€æ—¶é—´æº
  
  // ... ç°æœ‰è®¡ç®—é€»è¾‘ ...
  
  // åœ¨ analysis å¯¹è±¡ç»„è£…æ—¶ï¼Œæ·»åŠ  timeCoordinate
  const analysis = {
    // ... ç°æœ‰å­—æ®µ ...
    luckRhythm: luckRhythmMetrics,  // ç°æœ‰
    timeCoordinate: await this.buildTimeCoordinateMetrics(
      luckRhythmMetrics,
      {
        pillars,
        analysis: {
          gods: {
            favorable: favoredAvoid.favored,
            unfavorable: favoredAvoid.avoid,
          },
        },
      },
      birthJson,
      { now }  // âœ… ç»Ÿä¸€æ—¶é—´æºï¼Œä¸å†™æ­» new Date()
    ),  // âœ… æ–°å¢
    // ... ç°æœ‰å­—æ®µ ...
  };
  
  return {
    // ... ç°æœ‰è¿”å›ç»“æ„ ...
    analysis,
  };
}
```

**é‡è¦**ï¼š`buildTimeCoordinateMetrics` çš„ç­¾åå¿…é¡»ç»Ÿä¸€ä¸ºï¼š

```javascript
async buildTimeCoordinateMetrics(luckRhythm, baziChart, birthJson, { now } = {}) {
  // now ä»å‚æ•°è§£æ„ï¼Œé»˜è®¤ undefinedï¼Œå†…éƒ¨å†åˆ¤æ–­
  const currentTime = now || new Date();
  // ...
}
```

è¿™æ ·ä»¥åè¦æ”¯æŒã€ŒæŸ¥çœ‹ 2027 å¹´çš„æ—¶é—´åæ ‡ã€æ—¶ï¼Œåªéœ€ä¼  `options.now = new Date('2027-01-01')`ã€‚

---

## ä¸ƒã€å‰ç«¯å®ç°

### 7.1 Props è®¾è®¡ï¼ˆç»Ÿä¸€é£æ ¼ï¼‰

**æ–‡ä»¶**ï¼š`app/src/components/bazi/TimeCoordinateCard`ï¼ˆæ–°å»ºï¼‰

**è·¯å¾„å‘½åè§„èŒƒ**ï¼šæ–‡æ¡£ä¸­ç»Ÿä¸€ä¸å†™æ–‡ä»¶åç¼€ï¼Œå®é™…æ–‡ä»¶ç±»å‹ä»¥é¡¹ç›®è§„èŒƒä¸ºå‡†

**ç±»å‹å®šä¹‰**ï¼ˆç‹¬ç«‹äºåç«¯å®Œæ•´å“åº”ç»“æ„ï¼‰ï¼š

```typescript
/**
 * æ—¶é—´åæ ‡ ViewModelï¼ˆå‰ç«¯ä¸“ç”¨ï¼Œä¸ç›´æ¥ä¾èµ–åç«¯å®Œæ•´å“åº”ï¼‰
 * 
 * æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å¤§è¿æ•°æ®ï¼Œæ•´å¡ä¸æ˜¾ç¤ºï¼Œæ‰€ä»¥ currentDaYun åœ¨ç»„ä»¶å†…éƒ¨è§†ä¸ºå¿…éœ€
 */
export type TimeCoordinateVM = {
  currentDaYun: {
    stemBranch: string;
    tenGod: string;
    ageRange: [number, number];
    startYear?: number;
    endYear?: number;
    phaseText: string;     // ç»™ç”¨æˆ·çœ‹çš„ï¼ˆ'åŠ é€ŸæœŸ' | 'è°ƒæ•´æœŸ' | 'å¹³ç¨³æœŸ'ï¼‰
    phaseTag?: 'accelerate' | 'adjust' | 'stable';  // ç”¨äºé€»è¾‘åˆ¤æ–­å’Œé¢œè‰²æ˜ å°„
    favourLevel?: 'good' | 'neutral' | 'tense';    // ç”¨äºé…è‰²
  };
  currentLiuNian?: {
    stemBranch: string;
    year: number;
    tenGod: string;
    shortTag?: string;
    riskTag?: string;
  };
  currentLiuYue?: {
    stemBranch: string;
    year: number;
    monthIndex?: number;
    tenGod: string;
    shortTip?: string;
  };
};

interface TimeCoordinateCardProps {
  timeCoordinate: TimeCoordinateVM | null;  // âœ… ä½¿ç”¨ ViewModel ç±»å‹
  loading?: boolean;
  chartId: string;
  chartProfileId: string;
}
```

### 7.2 ç»„ä»¶ç»“æ„ï¼ˆå« Loading çŠ¶æ€ï¼‰

```typescript
import React from 'react';
import { View, Text, TouchableOpacity, StyleSheet, ActivityIndicator } from 'react-native';
import { useNavigation } from '@react-navigation/native';
import { RootStackParamList } from '@/types/navigation';
import { colors, fontSizes, fontWeights, spacing, radius } from '@/theme';
import { TimeCoordinateVM } from './types';

export const TimeCoordinateCard: React.FC<TimeCoordinateCardProps> = ({ 
  timeCoordinate, 
  loading = false,
  chartId,
  chartProfileId,
}) => {
  const navigation = useNavigation();
  
  // Loading çŠ¶æ€ï¼šæ˜¾ç¤ºéª¨æ¶å±
  if (loading) {
    return <TimeCoordinateCardSkeleton />;
  }
  
  // æ•°æ®ç¼ºå¤±ï¼šæ•´å¡éšè—
  if (!timeCoordinate || !timeCoordinate.currentDaYun) {
    return null;
  }
  
  const { currentDaYun, currentLiuNian, currentLiuYue } = timeCoordinate;
  
  // å¤„ç† CTA æŒ‰é’®ç‚¹å‡»ï¼ˆå‚æ•°è§„èŒƒï¼‰
  // âœ… ç»Ÿä¸€å‘½åï¼šå‰ç«¯å¯¼èˆªå‚æ•°ä½¿ç”¨ presetQuestionï¼Œåç«¯ API ä½¿ç”¨ message
  const handlePressYearChat = () => {
    navigation.navigate('Chat', {
      conversationId: 'new',
      presetQuestion: 'å°ä½©ï¼Œå¸®æˆ‘è®²è®²æˆ‘ä»Šå¹´æ•´ä½“çš„è¡Œè¿èŠ‚å¥å’Œæœºä¼šé£é™©ã€‚',  // âœ… å‰ç«¯å¯¼èˆªå‚æ•°
      context: {
        type: 'year_rhythm',
        chartId,
        source: 'time_coordinate_card',
        timeCoordinateSnapshot: timeCoordinate,  // âœ… ä¼ é€’å¿«ç…§ï¼Œåç«¯å¯ç›´æ¥ç”¨
      },
      masterId: chartProfileId,
    });
  };
  
  // æ³¨æ„ï¼šåœ¨ ChatScreen å†…éƒ¨ï¼Œä¼šå°† presetQuestion è½¬æ¢ä¸º message å‘é€åˆ°åç«¯ï¼š
  // api.post(`/conversations/${id}/messages`, {
  //   message: presetQuestion || inputValue,  // âœ… åç«¯ API ä½¿ç”¨ message
  //   context,
  // });
  
  return (
    <View style={styles.card}>
      <Text style={styles.title}>ä½ ç°åœ¨çš„æ—¶é—´åæ ‡</Text>
      
      {/* å½“å‰å¤§è¿ï¼ˆå¿…éœ€ï¼Œä¸€å®šæ˜¾ç¤ºï¼‰ */}
      <TimeRow
        label="å½“å‰å¤§è¿"
        main={`${currentDaYun.stemBranch} Â· ${currentDaYun.tenGod}`}
        sub={`ï¼ˆ${currentDaYun.ageRange[0]}â€“${currentDaYun.ageRange[1]} å²ï¼‰`}
        tag={currentDaYun.phaseText}
        tagColor={getPhaseTagColor(currentDaYun.phaseTag)}
      />
      
      {/* å½“å‰æµå¹´ï¼ˆå¯é€‰ï¼Œç¼ºå¤±æ—¶ä¸æ˜¾ç¤ºï¼‰ */}
      {currentLiuNian && (
        <TimeRow
          label="å½“å‰æµå¹´"
          main={`${currentLiuNian.stemBranch}ï¼ˆ${currentLiuNian.year}ï¼‰ Â· ${currentLiuNian.tenGod}`}
          tag={currentLiuNian.shortTag || 'æ•°æ®ç”Ÿæˆä¸­'}
        />
      )}
      
      {/* å½“å‰æµæœˆï¼ˆå¯é€‰ï¼Œç¼ºå¤±æ—¶ä¸æ˜¾ç¤ºï¼‰ */}
      {currentLiuYue && (
        <TimeRow
          label="å½“å‰æµæœˆ"
          main={`${currentLiuYue.stemBranch} Â· ${currentLiuYue.tenGod}`}
          tag={currentLiuYue.shortTip || 'æ•°æ®ç”Ÿæˆä¸­'}
        />
      )}
      
      {/* CTA æŒ‰é’® */}
      <TouchableOpacity
        style={styles.ctaButton}
        onPress={handlePressYearChat}
        activeOpacity={0.7}
      >
        <Text style={styles.ctaText}>è®©å°ä½©è®²è®²æˆ‘ä»Šå¹´æ•´ä½“çš„èŠ‚å¥</Text>
      </TouchableOpacity>
    </View>
  );
};

/**
 * éª¨æ¶å±ç»„ä»¶ï¼ˆLoading çŠ¶æ€ï¼‰
 */
const TimeCoordinateCardSkeleton: React.FC = () => {
  return (
    <View style={styles.card}>
      <View style={styles.skeletonTitle} />
      <View style={styles.skeletonRow} />
      <View style={styles.skeletonRow} />
      <View style={styles.skeletonRow} />
      <View style={styles.skeletonButton} />
    </View>
  );
};

/**
 * æ ¹æ® phaseTag è¿”å›é¢œè‰²
 */
function getPhaseTagColor(phaseTag?: string): string {
  switch (phaseTag) {
    case 'accelerate':
      return colors.green;  // åŠ é€ŸæœŸ â†’ æ·±ç»¿
    case 'adjust':
      return colors.orange; // è°ƒæ•´æœŸ â†’ æ©™è‰²
    case 'stable':
      return colors.textSecondary; // å¹³ç¨³æœŸ â†’ ä¸­æ€§ç°
    default:
      return colors.textSecondary;
  }
}

// æ—¶é—´è¡Œç»„ä»¶
interface TimeRowProps {
  label: string;
  main: string;
  sub?: string;
  tag?: string;
}

const TimeRow: React.FC<TimeRowProps> = ({ label, main, sub, tag }) => {
  return (
    <View style={styles.row}>
      <Text style={styles.rowLabel}>{label}</Text>
      <View style={styles.rowMain}>
        <Text style={styles.rowMainText}>
          {main}
          {sub && <Text style={styles.rowSubText}>{sub}</Text>}
        </Text>
      </View>
      {tag && (
        <View style={styles.tag}>
          <Text style={styles.tagText}>{tag}</Text>
        </View>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  card: {
    backgroundColor: '#ffffff',
    paddingHorizontal: spacing.lg,
    paddingVertical: spacing.lg,
    marginBottom: spacing.md,
  },
  title: {
    fontSize: fontSizes.lg,
    fontWeight: fontWeights.bold,
    color: colors.ink,
    marginBottom: spacing.md,
  },
  row: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: spacing.sm,
  },
  rowLabel: {
    fontSize: fontSizes.sm,
    color: colors.textSecondary,
    minWidth: 80,
  },
  rowMain: {
    flex: 1,
    marginLeft: spacing.sm,
  },
  rowMainText: {
    fontSize: fontSizes.base,
    fontWeight: fontWeights.semibold,
    color: colors.ink,
  },
  rowSubText: {
    fontSize: fontSizes.sm,
    color: colors.textSecondary,
  },
  tag: {
    paddingHorizontal: spacing.xs,
    paddingVertical: 2,
    borderRadius: radius.xs,
    backgroundColor: colors.border,
  },
  tagText: {
    fontSize: fontSizes.xs,
    color: colors.textSecondary,
  },
  ctaButton: {
    marginTop: spacing.md,
    paddingVertical: spacing.sm,
    paddingHorizontal: spacing.md,
    borderRadius: radius.md,
    backgroundColor: colors.primary,
    alignItems: 'center',
  },
  ctaText: {
    fontSize: fontSizes.base,
    fontWeight: fontWeights.semibold,
    color: '#ffffff',
  },
});
```

### 7.3 é›†æˆåˆ° ChartOverviewTab

**æ–‡ä»¶**ï¼š`app/src/screens/ChartDetail/ChartOverviewTab`

**ä¿®æ”¹ç‚¹**ï¼š

```typescript
import { TimeCoordinateCard } from '@/components/bazi/TimeCoordinateCard';
import { TimeCoordinateDto, TimeCoordinateVM } from '@/types/chart';

// âœ… DTO -> VM æ˜ å°„å‡½æ•°ï¼ˆè½»é‡è½¬æ¢å±‚ï¼Œé¢„ç•™æ‰©å±•ï¼‰
function mapTimeCoordinateDtoToVm(dto?: TimeCoordinateDto | null): TimeCoordinateVM | null {
  if (!dto) return null;
  // ç›®å‰ç»“æ„ä¸€è‡´ï¼Œç›´æ¥è¿”å›ï¼ˆé¢„ç•™è¿™å±‚æ–¹ä¾¿ä»¥åæ‰©å±•ï¼‰
  return dto as TimeCoordinateVM;
}

export const ChartOverviewTab: React.FC<ChartOverviewTabProps> = ({ chartData }) => {
  // ... ç°æœ‰ä»£ç  ...
  
  // âœ… 1. ä» chartData ä¸­æå– timeCoordinate DTO
  const timeCoordinateDto = chartData.result?.analysis?.timeCoordinate;
  
  // âœ… 2. æ˜ å°„ DTO -> VM
  const timeCoordinateVM = mapTimeCoordinateDtoToVm(timeCoordinateDto);
  
  return (
    <View style={styles.container}>
      <ScrollView 
        style={styles.scrollView}
        contentContainerStyle={styles.contentContainer}
        showsVerticalScrollIndicator={false}
      >
        {/* âœ… æ–°å¢ï¼šæ—¶é—´åæ ‡å¡ç‰‡ï¼ˆæœ€é¡¶éƒ¨ï¼‰ */}
        <TimeCoordinateCard
          timeCoordinate={timeCoordinateVM}
          loading={false}  // æˆ–ä»çŠ¶æ€ç®¡ç†è·å– loading çŠ¶æ€
          chartId={chartData.result.chartId}
          chartProfileId={chartData.profile.chartProfileId}
        />
        
        {/* å››æŸ±æ€»è¡¨ */}
        <View style={styles.card}>
          {/* ... ç°æœ‰ä»£ç  ... */}
        </View>
        
        {/* å…¶ä»–å¡ç‰‡ ... */}
      </ScrollView>
    </View>
  );
};
```

### 7.4 æ•°æ®è·å–

**è¯´æ˜**ï¼šæ—¶é—´åæ ‡æ•°æ®å·²åŒ…å«åœ¨ `chartService.getChartDetail(chartId)` çš„å“åº”ä¸­ï¼Œæ— éœ€é¢å¤– API è°ƒç”¨ã€‚

**æ•°æ®è·¯å¾„**ï¼š
```
chartData.result.analysis.timeCoordinate
```

---

## å…«ã€èŠå¤©è”åŠ¨

### 8.1 å‰ç«¯ä¼ å‚ï¼ˆç»Ÿä¸€å‘½åè§„èŒƒï¼‰

**ä½ç½®**ï¼š`TimeCoordinateCard.tsx` çš„ `handlePressYearChat()` æ–¹æ³•

**å‚æ•°ç»“æ„**ï¼š

```typescript
// âœ… ç»Ÿä¸€å‘½åè§„åˆ™ï¼š
// - å‰ç«¯å¯¼èˆªå‚æ•°ï¼šä½¿ç”¨ presetQuestion
// - ChatScreen å†…éƒ¨ï¼šå°† presetQuestion è½¬æ¢ä¸º message å‘é€åˆ°åç«¯
// - åç«¯ APIï¼šæ¥æ”¶ message å­—æ®µ

navigation.navigate('Chat', {
  conversationId: 'new',
  presetQuestion: 'å°ä½©ï¼Œå¸®æˆ‘è®²è®²æˆ‘ä»Šå¹´æ•´ä½“çš„è¡Œè¿èŠ‚å¥å’Œæœºä¼šé£é™©ã€‚',  // âœ… å‰ç«¯å¯¼èˆªå‚æ•°
  masterId: chartData.profile.chartProfileId,
  source: 'time_coordinate_card',
  context: {
    type: 'year_rhythm',
    chartId: chartData.result.chartId,
    timeCoordinateSnapshot: timeCoordinate,  // âœ… ä¼ é€’å¿«ç…§ï¼Œåç«¯å¯ç›´æ¥ç”¨
  },
});

// åœ¨ ChatScreen å†…éƒ¨ï¼ˆç¤ºä¾‹ï¼‰ï¼š
// const { presetQuestion } = route.params;
// api.post(`/conversations/${id}/messages`, {
//   message: presetQuestion || inputValue,  // âœ… åç«¯ API ä½¿ç”¨ message
//   context,
// });
```

### 8.2 åç«¯æ¥æ”¶ä¸å¤„ç†ï¼ˆç»Ÿä¸€å‘½åè§„èŒƒï¼‰

**ä½ç½®**ï¼š`core/src/routes/conversation` çš„ `POST /:conversationId/messages` è·¯ç”±

**ä¿®æ”¹ç‚¹**ï¼š

```typescript
router.post('/:conversationId/messages', createRateLimitMiddleware('chat'), async (req: Request, res: Response, next: NextFunction) => {
  // ... ç°æœ‰ä»£ç  ...
  
  // âœ… ç»Ÿä¸€å‘½åï¼šåç«¯ API æ¥æ”¶ message å­—æ®µï¼ˆå‰ç«¯ ChatScreen ä¼šå°† presetQuestion è½¬æ¢ä¸º messageï¼‰
  const { message, sectionKey, shenShaCode, context } = req.body;
  
  // ... ç°æœ‰ä»£ç  ...
  
  // âœ… æ–°å¢ï¼šå¤„ç† year_rhythm ç±»å‹çš„ context
  if (context?.type === 'year_rhythm' && context.timeCoordinate) {
    // ä½¿ç”¨ä¸“é—¨çš„ year_rhythm prompt
    userPrompt = promptTemplates.buildYearRhythmPrompt({
      userQuestion: message,
      baziData: chartResult,
      timeCoordinate: context.timeCoordinate,
    });
    systemPrompt = promptTemplates.XIAOPEI_SYSTEM_PROMPT;
  } else if (sectionKey || shenShaCode) {
    // ç°æœ‰å¡ç‰‡æ¨¡å¼é€»è¾‘
    // ...
  } else {
    // ç°æœ‰èŠå¤©æ¨¡å¼é€»è¾‘
    // ...
  }
  
  // ... ç°æœ‰ä»£ç  ...
});
```

### 8.3 Prompt æ¨¡æ¿ï¼ˆæ¨¡å—åŒ–ç»“æ„ï¼‰

**ä½ç½®**ï¼š`core/src/modules/prompt/promptTemplates` æ–°å¢å‡½æ•°

**çº¦å®š**ï¼š
- ä¼˜å…ˆä½¿ç”¨ `timeCoordinate` ä¸­ä¼ æ¥çš„å¿«ç…§ï¼ˆä¿è¯å‰åç«¯è§†å›¾ä¸€è‡´ï¼‰
- è‹¥æœªä¼  `timeCoordinate`ï¼Œåˆ™å†…éƒ¨æŒ‰å½“å‰æ—¶é—´é‡æ–°è®¡ç®—ä¸€éï¼ˆå…œåº•ï¼‰

```typescript
/**
 * å¹´åº¦è¡Œè¿èŠ‚å¥ Promptï¼ˆä»æ—¶é—´åæ ‡å¡ç‰‡è¿›å…¥ï¼‰
 * 
 * @param params.userQuestion - ç”¨æˆ·é—®é¢˜
 * @param params.baziData - å‘½ç›˜æ•°æ®
 * @param params.timeCoordinate - æ—¶é—´åæ ‡å¿«ç…§ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼Œä¿è¯å‰åç«¯ä¸€è‡´ï¼‰
 */
export function buildYearRhythmPrompt(params: {
  userQuestion: string;
  baziData: any;
  timeCoordinate?: TimeCoordinateDto;
}): string {
  const { userQuestion, baziData, timeCoordinate } = params;
  
  // ===== æ¨¡å— 1ï¼šç”¨æˆ·åŸºç¡€ä¿¡æ¯ =====
  const chartSummary = buildChartSummary(baziData);
  
  // ===== æ¨¡å— 2ï¼šå½“å‰æ—¶é—´åæ ‡ =====
  const timeBlock = timeCoordinate
    ? buildTimeCoordinateBlock(timeCoordinate)
    : buildTimeCoordinateBlockFromBaziData(baziData);  // å…œåº•ï¼šé‡æ–°è®¡ç®—
  
  // ===== æ¨¡å— 3ï¼šè¡Œè¿èŠ‚å¥æ•°æ®ï¼ˆè¡¥å……ï¼‰ =====
  const luckRhythmBlock = baziData?.analysis?.luckRhythm
    ? buildLuckRhythmBlock(baziData.analysis.luckRhythm)
    : '';
  
  // ===== æ¨¡å— 4ï¼šè§£è¯»ç›®æ ‡ =====
  const interpretationGuide = `
ã€è§£è¯»ç›®æ ‡ã€‘

ç”¨æˆ·æƒ³äº†è§£çš„æ˜¯ã€Œä»Šå¹´æ•´ä½“çš„è¡Œè¿èŠ‚å¥ã€ï¼Œè¯·ä½ é‡ç‚¹ä»ä¸‰ä¸ªå±‚é¢æ¥è®²ï¼š

1ï¼‰å¤§è¿é˜¶æ®µåœ¨ç»ƒä»€ä¹ˆ
   - å½“å‰å¤§è¿çš„ä¸»é¢˜ä¸è®­ç»ƒæ–¹å‘
   - è¿™ä¸ªé˜¶æ®µå¯¹ç”¨æˆ·äººç”Ÿçš„æ„ä¹‰

2ï¼‰ä»Šå¹´çš„é‡ç‚¹æœºä¼šå’Œéœ€è¦æ³¨æ„çš„å‘
   - ç»“åˆæµå¹´å¹²æ”¯ã€åç¥ã€å–œå¿Œï¼Œåˆ†æä»Šå¹´çš„ä¸»è¦æœºä¼šé¢†åŸŸ
   - æŒ‡å‡ºä»Šå¹´éœ€è¦ç‰¹åˆ«æ³¨æ„çš„é£é™©ç‚¹

3ï¼‰å¦‚æœä»Šå¹´æŠŠæ¡å¾—å¥½ï¼Œå¯¹æœªæ¥ 2~3 å¹´æœ‰ä½•é“ºå«
   - ä»Šå¹´ä¸æœªæ¥å¤§è¿çš„è¡”æ¥å…³ç³»
   - ä»Šå¹´æ‰“å¥½åŸºç¡€å¯¹æœªæ¥å‘å±•çš„å½±å“

è¦æ±‚è¯­æ°”ï¼šç†æ€§ã€ä¸­æ€§ï¼Œä¸è¿‡åº¦åˆ¶é€ ç„¦è™‘ã€‚
`;
  
  // ===== ç»„è£…æœ€ç»ˆ Prompt =====
  return `
${chartSummary}

${timeBlock}

${luckRhythmBlock}

ã€ç”¨æˆ·é—®é¢˜ã€‘

${userQuestion}

${interpretationGuide}

${XIAOPEI_OUTPUT_STYLE}
`;
}

/**
 * æ„å»ºæ—¶é—´åæ ‡å—ï¼ˆä»å¿«ç…§ï¼‰
 */
function buildTimeCoordinateBlock(timeCoordinate: TimeCoordinateDto): string {
  const { currentDaYun, currentLiuNian, currentLiuYue } = timeCoordinate;
  
  let block = `
ã€å½“å‰æ—¶é—´åæ ‡ã€‘

- å½“å‰å¤§è¿ï¼š${currentDaYun.stemBranch}ï¼ˆ${currentDaYun.tenGod}ï¼‰ï¼Œ${currentDaYun.ageRange[0]}â€“${currentDaYun.ageRange[1]}å²ï¼Œé˜¶æ®µï¼š${currentDaYun.phaseText}
`;
  
  if (currentLiuNian) {
    block += `
- å½“å‰æµå¹´ï¼š${currentLiuNian.stemBranch}ï¼ˆ${currentLiuNian.year}å¹´ï¼Œ${currentLiuNian.tenGod}ï¼‰ï¼Œæ ‡ç­¾ï¼š${currentLiuNian.shortTag || ''}${currentLiuNian.riskTag ? ' / ' + currentLiuNian.riskTag : ''}
`;
  }
  
  if (currentLiuYue) {
    block += `
- å½“å‰æµæœˆï¼š${currentLiuYue.stemBranch}ï¼ˆ${currentLiuYue.tenGod}ï¼‰ï¼Œæç¤ºï¼š${currentLiuYue.shortTip || 'å¹³ç¨³'}
`;
  }
  
  return block;
}

/**
 * æ„å»ºæ—¶é—´åæ ‡å—ï¼ˆä»å‘½ç›˜æ•°æ®é‡æ–°è®¡ç®—ï¼Œå…œåº•ç”¨ï¼‰
 */
function buildTimeCoordinateBlockFromBaziData(baziData: any): string {
  // å¦‚æœå‰ç«¯æ²¡ä¼  timeCoordinateï¼Œåç«¯é‡æ–°è®¡ç®—ï¼ˆå…œåº•é€»è¾‘ï¼‰
  // è¿™é‡Œå¯ä»¥è°ƒç”¨ buildTimeCoordinateMetrics é‡æ–°è®¡ç®—
  // ä¸ºäº†ç®€åŒ–ï¼Œè¿™é‡Œè¿”å›åŸºç¡€ä¿¡æ¯
  return `
ã€å½“å‰æ—¶é—´åæ ‡ã€‘

ï¼ˆæ—¶é—´åæ ‡æ•°æ®ç¼ºå¤±ï¼Œè¯·åŸºäºå‘½ç›˜æ•°æ®è‡ªè¡Œåˆ†æå½“å‰å¤§è¿ã€æµå¹´ã€æµæœˆï¼‰
`;
}

/**
 * æ„å»ºè¡Œè¿èŠ‚å¥æ•°æ®å—
 */
function buildLuckRhythmBlock(luckRhythm: any): string {
  return `
ã€è¡Œè¿èŠ‚å¥æ•°æ®ã€‘

${JSON.stringify({
  startAge: luckRhythm.startAge,
  luckDirection: luckRhythm.luckDirection,
  currentAge: luckRhythm.currentAge,
  currentLuck: {
    label: luckRhythm.currentLuck?.label,
    ageRange: luckRhythm.currentLuck?.ageRange,
    tenGod: luckRhythm.currentLuck?.tenGod,
    stage: luckRhythm.currentLuck?.stage,
  },
  comingYearsTrend: luckRhythm.comingYearsTrend,
}, null, 2)}

`;
}
```

**å‚æ•°å¯¹é½**ï¼š
- âœ… å¤ç”¨ `buildChartSummary()` å‡½æ•°
- âœ… å¤ç”¨ `XIAOPEI_OUTPUT_STYLE` å¸¸é‡
- âœ… éµå¾ªç°æœ‰ Prompt æ¨¡æ¿è§„èŒƒ

---

## ä¹ã€æ¸è¿›å¼ä¸Šçº¿ä¸è°ƒè¯•å»ºè®®

### 9.1 Phase 1ï¼šåªåšã€Œè§„åˆ™ + UIã€ï¼Œä¸æ¥ LLM æ–‡æ¡ˆ

**ç›®æ ‡**ï¼šå…ˆè®©å¡ç‰‡èƒ½æ˜¾ç¤ºï¼Œæ•°æ®å‡†ç¡®ï¼Œä½†ä¸ä¾èµ– LLMã€‚

**åç«¯ä»»åŠ¡**ï¼š
- âœ… å®ç° `buildCurrentDaYunFromLuckRhythm()`ï¼ˆå¤ç”¨ç°æœ‰æ•°æ®ï¼‰
- âœ… å®ç° `analyzeLiuNianCore()`ï¼ˆè§„åˆ™å±‚è®¡ç®—ï¼‰
- âœ… å®ç° `analyzeLiuYueCore()`ï¼ˆè§„åˆ™å±‚è®¡ç®—ï¼‰
- âš ï¸ `shortTag` å’Œ `shortTip` å…ˆç”¨è§„åˆ™ç”Ÿæˆå ä½æ–‡æœ¬ï¼š
  ```javascript
  generateDefaultShortTag(liuNianCore) {
    if (liuNianCore.score > 50) return 'æœºé‡å¤š';
    if (liuNianCore.score < -50) return 'å‹åŠ›è¾ƒå¤§';
    return 'å¹³ç¨³';
  }
  ```

**å‰ç«¯ä»»åŠ¡**ï¼š
- âœ… åˆ›å»º `TimeCoordinateCard` ç»„ä»¶ï¼ˆä¸å« LLM æ–‡æ¡ˆå­—æ®µï¼‰
- âœ… é›†æˆåˆ° `ChartOverviewTab`
- âœ… å®ç°åŸºç¡€ UI å’Œ CTA æŒ‰é’®ï¼ˆèŠå¤©è”åŠ¨å…ˆä¸æ¥ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- å¡ç‰‡èƒ½æ­£å¸¸æ˜¾ç¤ºå¤§è¿ã€æµå¹´ã€æµæœˆçš„åŸºç¡€ä¿¡æ¯ï¼ˆå¹²æ”¯ã€åç¥ï¼‰
- æ ‡ç­¾ä½ç½®æ˜¾ç¤ºè§„åˆ™ç”Ÿæˆçš„å ä½æ–‡æœ¬æˆ–ã€Œæ•°æ®å¼€å‘ä¸­ã€

### 9.2 Phase 2ï¼šæ¥å…¥ LLM æ–‡æ¡ˆï¼Œä½†åŠ å¼ºç›‘æ§

**ç›®æ ‡**ï¼šæ¥å…¥ LLM ç”Ÿæˆæ–‡æ¡ˆï¼Œä½†ç¡®ä¿å¤±è´¥ä¸å½±å“åŸºç¡€åŠŸèƒ½ã€‚

**åç«¯ä»»åŠ¡**ï¼š
- âœ… å®ç° `summarizeLiuNianForCard()`ï¼ˆLLM è°ƒç”¨ï¼‰
- âœ… å®ç° `summarizeLiuYueTip()`ï¼ˆLLM è°ƒç”¨ï¼‰
- âœ… æ·»åŠ  LLM è°ƒç”¨å¤±è´¥æ—¶çš„å…œåº•é€»è¾‘
- âœ… **åŠ åŸ‹ç‚¹**ï¼š
  ```javascript
  // åŸ‹ç‚¹ï¼šLLM è°ƒç”¨æ¬¡æ•°ã€è¶…æ—¶æ¬¡æ•°ã€å¤±è´¥æ¬¡æ•°
  logger.info('TimeCoordinate: LLM call', {
    type: 'liuNian' | 'liuYue',
    chartId,
    success: boolean,
    duration: number,
    error?: string,
  });
  ```

**å‰ç«¯ä»»åŠ¡**ï¼š
- âœ… æ›´æ–°ç»„ä»¶ï¼Œæ”¯æŒæ˜¾ç¤º LLM ç”Ÿæˆçš„ `shortTag` / `shortTip`
- âœ… å¦‚æœ LLM æ–‡æ¡ˆç¼ºå¤±ï¼Œæ˜¾ç¤ºè§„åˆ™ç”Ÿæˆçš„å ä½æ–‡æœ¬

**éªŒæ”¶æ ‡å‡†**ï¼š
- LLM æ­£å¸¸æ—¶ï¼Œæ˜¾ç¤º LLM ç”Ÿæˆçš„æ–‡æ¡ˆ
- LLM å¤±è´¥æ—¶ï¼Œä¸å½±å“è§„åˆ™å±‚ç»“æœï¼Œç»§ç»­æ˜¾ç¤ºå ä½æ–‡æœ¬
- åŸ‹ç‚¹æ•°æ®æ­£å¸¸ä¸ŠæŠ¥

### 9.3 Phase 3ï¼šæ‰“ç£¨ä½“éªŒï¼ˆæ–‡æ¡ˆ/é¢œè‰²/åŸ‹ç‚¹ï¼‰

**ç›®æ ‡**ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œç»Ÿä¸€è§†è§‰é£æ ¼ã€‚

**æ–‡æ¡ˆä¼˜åŒ–**ï¼š
- æ ¹æ®åŸ‹ç‚¹æ•°æ®ï¼Œè°ƒæ•´ `shortTag` è¯åº“ï¼ˆè¿‡äºå“äººçš„è¯ç»Ÿä¸€æ›¿æ¢ï¼‰
- ä¸è®¾è®¡ç»Ÿä¸€ï¼š
  - åŠ é€ŸæœŸ â†’ ç”¨æ·±ç»¿ï¼ˆ`colors.green`ï¼‰
  - è°ƒæ•´æœŸ â†’ æ©™è‰²ï¼ˆ`colors.orange`ï¼‰
  - å¹³ç¨³æœŸ â†’ ä¸­æ€§ç°ï¼ˆ`colors.textSecondary`ï¼‰

**èŠå¤©è”åŠ¨**ï¼š
- âœ… å®ç° `buildYearRhythmPrompt()` Prompt æ¨¡æ¿
- âœ… åç«¯æ¥æ”¶ `context.type === 'year_rhythm'` å¹¶å¤„ç†
- âœ… æµ‹è¯•ä»æ—¶é—´åæ ‡å¡è¿›å…¥èŠå¤©çš„å®Œæ•´æµç¨‹

**åŸ‹ç‚¹å®Œå–„**ï¼š
- ç»Ÿè®¡ä»æ—¶é—´åæ ‡å¡è¿›å…¥èŠå¤©çš„è½¬åŒ–ç‡
- ç»Ÿè®¡ LLM æ–‡æ¡ˆçš„ç”Ÿæˆè´¨é‡å’Œç”¨æˆ·åé¦ˆ

### 9.4 å®¹é”™å¤„ç†ï¼ˆè¯¦ç»†ç­–ç•¥ï¼‰

**æ—¶é—´åæ ‡å¡ç‰‡éµå¾ªã€Œèƒ½å±•ç¤ºå¤šå°‘å±•ç¤ºå¤šå°‘ã€åŸåˆ™**ï¼š

1. **å¤§è¿ä¼˜å…ˆ**ï¼š
   - å¦‚æœ `luckRhythm.currentLuck` ä¸å­˜åœ¨ â†’ æ•´å¡éšè—ï¼ˆè‡´å‘½ç¼ºå¤±ï¼‰
   - å¦‚æœå¤§è¿æ•°æ®è§£æå¤±è´¥ â†’ æ•´å¡éšè—ï¼Œè®°å½•é”™è¯¯æ—¥å¿—

2. **æµå¹´æ¬¡ä¹‹**ï¼š
   - å¦‚æœæµå¹´è®¡ç®—å¤±è´¥ â†’ å¤§è¿ç…§å¸¸æ˜¾ç¤ºï¼Œæµå¹´é‚£ä¸€è¡Œæ˜¾ç¤ºã€Œæ•°æ®ç”Ÿæˆä¸­ã€
   - å¦‚æœ LLM æ–‡æ¡ˆå¤±è´¥ â†’ æ˜¾ç¤ºè§„åˆ™ç”Ÿæˆçš„å ä½æ–‡æœ¬ï¼ˆå¦‚"å¹³ç¨³"ï¼‰

3. **æµæœˆæœ€å**ï¼š
   - å¦‚æœæµæœˆè®¡ç®—å¤±è´¥ â†’ æµæœˆè¿™ä¸€è¡Œå¯ä»¥ç›´æ¥çœç•¥ï¼Œæˆ–å±•ç¤ºã€Œæœ¬æœˆæ•°æ®ç”Ÿæˆä¸­ã€
   - å¦‚æœ LLM æ–‡æ¡ˆå¤±è´¥ â†’ æ˜¾ç¤ºè§„åˆ™ç”Ÿæˆçš„å ä½æ–‡æœ¬ï¼ˆå¦‚"å¹³ç¨³"ï¼‰

**æ—¥å¿—è®°å½•**ï¼š
```javascript
// è®°å½•æ‰€æœ‰å¤±è´¥æƒ…å†µï¼Œæ–¹ä¾¿æ’æŸ¥
logger.warn('TimeCoordinate: failed to build liuNianSummary', { 
  chartId, 
  year,
  error: e.message 
});
```

**å‰ç«¯å®¹é”™**ï¼š
- å¦‚æœ `timeCoordinate` ä¸å­˜åœ¨ â†’ ä¸æ¸²æŸ“å¡ç‰‡ï¼ˆæˆ–æ˜¾ç¤ºåŠ è½½ä¸­éª¨æ¶å±ï¼‰
- å¦‚æœæŸä¸ªå­—æ®µç¼ºå¤± â†’ å¯¹åº”è¡Œä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå ä½æ–‡æœ¬
- å¦‚æœèŠå¤©è·³è½¬å¤±è´¥ â†’ æ˜¾ç¤ºé”™è¯¯æç¤ºï¼ˆToastï¼‰

### 9.5 æ€§èƒ½ä¼˜åŒ–

**LLM è°ƒç”¨ä¼˜åŒ–**ï¼š
- æµå¹´/æµæœˆçš„ LLM è°ƒç”¨å¯ä»¥å¹¶è¡Œæ‰§è¡Œ
- è€ƒè™‘ç¼“å­˜ï¼šåŒä¸€å‘½ç›˜çš„æµå¹´/æµæœˆæ•°æ®å¯ä»¥ç¼“å­˜ 1 å¤©ï¼ˆå› ä¸ºæ¯å¤©éƒ½ä¼šå˜åŒ–ï¼‰

**å‰ç«¯ä¼˜åŒ–**ï¼š
- å¡ç‰‡æ•°æ®åœ¨ `chartService.getChartDetail()` ä¸­ä¸€æ¬¡æ€§è·å–ï¼Œæ— éœ€é¢å¤–è¯·æ±‚

---

## åã€ä¸ç°æœ‰ç³»ç»Ÿå‚æ•°å¯¹é½æ£€æŸ¥

### 10.1 æ•°æ®ç»“æ„å¯¹é½

| å­—æ®µ | æ¥æº | å¯¹é½çŠ¶æ€ |
|------|------|---------|
| `currentDaYun.stemBranch` | `luckRhythm.currentLuck.stem + branch` | âœ… å¤ç”¨ç°æœ‰ |
| `currentDaYun.tenGod` | `luckRhythm.currentLuck.tenGod` | âœ… å¤ç”¨ç°æœ‰ |
| `currentDaYun.ageRange` | `luckRhythm.currentLuck.ageRange` | âœ… å¤ç”¨ç°æœ‰ï¼ˆéœ€è§£æï¼‰ |
| `currentDaYun.phaseTag` | `luckRhythm.currentLuck.stage` | âœ… æ˜ å°„è½¬æ¢ |
| `currentLiuNian.stemBranch` | `fortune.liuNianPillar()` | âœ… å¤ç”¨ç°æœ‰å‡½æ•° |
| `currentLiuNian.tenGod` | `calculateTenGod()` | âœ… å¤ç”¨ç°æœ‰å‡½æ•° |
| `currentLiuYue.stemBranch` | `fortune.liuYuePillar()` | âœ… å¤ç”¨ç°æœ‰å‡½æ•° |
| `currentLiuYue.tenGod` | `calculateTenGod()` | âœ… å¤ç”¨ç°æœ‰å‡½æ•° |

### 10.2 API æ¥å£å¯¹é½

- âœ… ä¸æ–°å¢ API æ¥å£ï¼Œæ•°æ®é€šè¿‡ç°æœ‰ `GET /api/v1/bazi/charts/:chartId` è¿”å›
- âœ… èŠå¤©æ¥å£å¤ç”¨ç°æœ‰ `POST /api/v1/chat/conversations/:id/messages`ï¼Œé€šè¿‡ `context` å‚æ•°ä¼ é€’ç‰¹æ®Šç±»å‹

### 10.3 UI è§„èŒƒå¯¹é½

- âœ… å¡ç‰‡æ ·å¼éµå¾ª `ChartOverviewTab` ä¸­å…¶ä»–å¡ç‰‡çš„æ ·å¼è§„èŒƒ
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„ `colors`ã€`fontSizes`ã€`spacing`ã€`radius` ä¸»é¢˜å˜é‡
- âœ… CTA æŒ‰é’®æ ·å¼ä¸å…¶ä»–å¡ç‰‡çš„ã€Œä¸€é”®è§£è¯»ã€æŒ‰é’®ä¿æŒä¸€è‡´

### 10.4 èŠå¤©è”åŠ¨å¯¹é½

- âœ… å¤ç”¨ç°æœ‰èŠå¤©å¯¼èˆªé€»è¾‘ï¼ˆ`navigation.navigate('Chat', {...})`ï¼‰
- âœ… å¤ç”¨ç°æœ‰ Prompt æ¨¡æ¿ç»“æ„ï¼ˆ`buildYearRhythmPrompt` éµå¾ªç°æœ‰æ¨¡æ¿è§„èŒƒï¼‰
- âœ… å¤ç”¨ç°æœ‰ LLM è°ƒç”¨æ¥å£ï¼ˆ`aiService.callLLM()`ï¼‰

---

## åä¸€ã€æ€»ç»“

### 11.1 æ ¸å¿ƒè¦ç‚¹

1. **æ•°æ®å¤ç”¨**ï¼šå½“å‰å¤§è¿å®Œå…¨å¤ç”¨ `luckRhythm.currentLuck`ï¼Œä¸é‡å¤è®¡ç®—
2. **å‡½æ•°å¤ç”¨**ï¼šæµå¹´æµæœˆè®¡ç®—å¤ç”¨ `fortune.liuNianPillar()` å’Œ `fortune.liuYuePillar()`
3. **æ¥å£å¤ç”¨**ï¼šä¸æ–°å¢ API æ¥å£ï¼Œæ•°æ®é€šè¿‡ç°æœ‰æ¥å£è¿”å›
4. **UI è§„èŒƒ**ï¼šéµå¾ªç°æœ‰å¡ç‰‡æ ·å¼å’Œäº¤äº’è§„èŒƒ
5. **èŠå¤©è”åŠ¨**ï¼šé€šè¿‡ `context` å‚æ•°ä¼ é€’ç‰¹æ®Šç±»å‹ï¼Œå¤ç”¨ç°æœ‰èŠå¤©æ¥å£

### 11.2 å®æ–½é£é™©

- **ä½é£é™©**ï¼šå½“å‰å¤§è¿ï¼ˆå®Œå…¨å¤ç”¨ç°æœ‰æ•°æ®ï¼‰
- **ä¸­é£é™©**ï¼šæµå¹´æµæœˆè§„åˆ™å±‚è®¡ç®—ï¼ˆéœ€ç¡®ä¿å‡½æ•°è°ƒç”¨æ­£ç¡®ï¼‰
- **ä¸­é£é™©**ï¼šLLM æ–‡æ¡ˆç”Ÿæˆï¼ˆéœ€å¤„ç†è°ƒç”¨å¤±è´¥å’Œæ ¼å¼è§£æï¼‰
- **ä½é£é™©**ï¼šå‰ç«¯é›†æˆï¼ˆæ ‡å‡† React Native ç»„ä»¶å¼€å‘ï¼‰

### 11.3 åç»­ä¼˜åŒ–æ–¹å‘

1. **ç¼“å­˜æœºåˆ¶**ï¼šæµå¹´æµæœˆæ•°æ®å¯ä»¥æŒ‰å¤©ç¼“å­˜
2. **ä¸ªæ€§åŒ–**ï¼šæ ¹æ®ç”¨æˆ·åå¥½è°ƒæ•´ LLM ç”Ÿæˆæ–‡æ¡ˆçš„é£æ ¼
3. **æ‰©å±•æ€§**ï¼šæœªæ¥å¯ä»¥å¢åŠ ã€Œå½“å‰æµæ—¥ã€ã€Œå½“å‰æµæ—¶ã€ç­‰æ›´ç»†ç²’åº¦çš„æ—¶é—´åæ ‡

---

---

## åäºŒã€æ–‡æ¡£ä¿®æ­£è®°å½•

### 12.1 ç±»å‹ä¸å€¼å¯¹é½ä¿®æ­£

**é—®é¢˜**ï¼š`PhaseTag` / `PhaseText` / `FavourLevel` ç±»å‹å®šä¹‰ä¸å®é™…ä»£ç ä¸ä¸€è‡´

**ä¿®æ­£**ï¼š
- âœ… `buildCurrentDaYunFromLuckRhythm()` ä¸­åŒæ—¶è¿”å› `phaseTag`ï¼ˆæšä¸¾å€¼ï¼‰å’Œ `phaseText`ï¼ˆæ–‡æœ¬ï¼‰
- âœ… `favourLevel` æ˜ å°„ä½¿ç”¨ `'tense'` è€Œé `'bad'`
- âœ… æ‰€æœ‰ç±»å‹æ˜ å°„ç»Ÿä¸€ä½¿ç”¨æšä¸¾å€¼ï¼Œä¸å†æ··ç”¨ä¸­æ–‡

### 12.2 æ—¶é—´æºç»Ÿä¸€ä¿®æ­£

**é—®é¢˜**ï¼š`compute()` å‡½æ•°ä¸­æ—¶é—´æ¥æºå‰åä¸ä¸€è‡´

**ä¿®æ­£**ï¼š
- âœ… `BaziEngine.compute()` ç»Ÿä¸€ä½¿ç”¨ `options.now` ä½œä¸ºæ—¶é—´æº
- âœ… `buildTimeCoordinateMetrics()` ç­¾åæ”¹ä¸º `{ now } = {}`ï¼Œç»Ÿä¸€ä»å‚æ•°è§£æ„
- âœ… å‡½æ•°å†…éƒ¨æ‰€æœ‰æ—¶é—´è®¡ç®—éƒ½ä½¿ç”¨ä¼ å…¥çš„ `now`ï¼Œä¸å†è°ƒç”¨ `new Date()`

### 12.3 æ•°æ®ç»“æ„å‘½åç»Ÿä¸€ä¿®æ­£

**é—®é¢˜**ï¼š`TimeCoordinate` å®šä¹‰æœ‰ä¸¤å¥—ï¼Œå­—æ®µä¸å®Œå…¨ä¸€è‡´

**ä¿®æ­£**ï¼š
- âœ… åç«¯æ•°æ®ç»“æ„ç»Ÿä¸€å‘½åä¸º `TimeCoordinateDto`ï¼ˆData Transfer Objectï¼‰
- âœ… å‰ç«¯ ViewModel ç»Ÿä¸€å‘½åä¸º `TimeCoordinateVM`ï¼ˆViewModelï¼‰
- âœ… æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ DTO å’Œ VM çš„è½¬æ¢å…³ç³»

### 12.4 Chat å‚æ•°å‘½åç»Ÿä¸€ä¿®æ­£

**é—®é¢˜**ï¼š`question` / `message` / `presetQuestion` æ··ç”¨

**ä¿®æ­£**ï¼š
- âœ… å‰ç«¯å¯¼èˆªå‚æ•°ç»Ÿä¸€ä½¿ç”¨ `presetQuestion`
- âœ… åç«¯ API ç»Ÿä¸€ä½¿ç”¨ `message`
- âœ… æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ ChatScreen å†…éƒ¨çš„è½¬æ¢é€»è¾‘

### 12.5 å‡½æ•°ç­¾åæè¿°ç»Ÿä¸€ä¿®æ­£

**é—®é¢˜**ï¼š`liuYuePillar` ç­¾åæè¿°ä¸ä¸€è‡´

**ä¿®æ­£**ï¼š
- âœ… ç»Ÿä¸€æè¿°ä¸º `liuYuePillar(dateUTC, yearStem)`
- âœ… æ˜ç¡®è¯´æ˜éœ€è¦å…ˆé€šè¿‡ `liuNianPillar` è·å–å¹´å¹²
- âœ… æ ‡æ³¨"å…·ä½“ç­¾åä»¥å®é™…å®ç°ä¸ºå‡†"

### 12.6 è·¯å¾„å‘½åç»Ÿä¸€ä¿®æ­£

**é—®é¢˜**ï¼šæ–‡æ¡£ä¸­è·¯å¾„å‘½åä¸ä¸€è‡´ï¼ˆæœ‰çš„å†™åç¼€ï¼Œæœ‰çš„ä¸å†™ï¼‰

**ä¿®æ­£**ï¼š
- âœ… ç»Ÿä¸€ä¸å†™æ–‡ä»¶åç¼€ï¼ˆ`.ts`ã€`.js`ã€`.tsx`ï¼‰
- âœ… åœ¨æ–‡æ¡£å¼€å¤´è¯´æ˜è·¯å¾„å‘½åè§„èŒƒ
- âœ… æ ‡æ³¨"å®é™…æ–‡ä»¶ç±»å‹ä»¥é¡¹ç›®è§„èŒƒä¸ºå‡†"

### 12.7 ç« èŠ‚ç¼–å·ä¿®æ­£

**é—®é¢˜**ï¼šæ ‡é¢˜ç¼–å·æ··ä¹±ï¼Œæœ‰é‡å¤ç« èŠ‚

**ä¿®æ­£**ï¼š
- âœ… ç»Ÿä¸€ç« èŠ‚ç¼–å·ï¼šä¸€ã€äºŒã€ä¸‰ã€å››ã€äº”ã€å…­ã€ä¸ƒã€å…«ã€ä¹ã€åã€åä¸€
- âœ… å­ç« èŠ‚ç¼–å·è·Ÿéšä¸»ç« èŠ‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.1  
**åˆ›å»ºæ—¶é—´**ï¼š2025-01-XX  
**æœ€åæ›´æ–°**ï¼š2025-01-XXï¼ˆä¿®æ­£ç±»å‹å¯¹é½ã€å‘½åç»Ÿä¸€ã€æ—¶é—´æºç»Ÿä¸€ç­‰é—®é¢˜ï¼‰


# 我的-二级-内容查看页面设计文档

## 页面概述

本文档包含「我的」模块下的内容查看类二级页面设计，包括：

- 我的解读
- 聊天记录

---

## 一、我的解读页面

### 1.1 页面概述

**页面名称**: 我的解读 / My Reading / 解读归档

**页面定位**:
- **页面类型**: 二级页面
- **用户类型**: 所有用户
- **页面层级**: 从「我的」主页进入
- **访问条件**: 用户登录后可见

**页面目的**: 集中展示用户所有的命理分析卡和重要解读，方便随时回看。

---

### 1.2 页面设计

#### 1.2.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色。从上到下依次包含：

1. 页面标题和说明
2. 解读列表（按时间倒序）
3. 筛选功能（可选）

#### 1.2.2 详细区块设计

**页面标题和说明**:

**位置**: 页面最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`，顶部 `spacing.lg`
- 底部间距: `spacing.md`

**标题**:
- 文案: 「解读归档」
- 字体大小: `fontSizes.lg`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.xs`

**说明文字**:
- 文案: 「这里会集中展示你所有的命理分析卡和重要解读，方便随时回看。」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 行高: `lineHeights.normal`

**解读卡片样式**:

```
┌─────────────────────────────────────────┐
│  财富分析卡                             │
│  「未来三年的财运重点」                 │
│  生成时间：2025-11-11                   │
└─────────────────────────────────────────┘
```

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.lg`
- 卡片之间间距: `spacing.md`
- 点击反馈: `activeOpacity: 0.7`

**卡片内容**:

1. **主题标签**:
   - 文案: 「财富分析卡」（或其他主题）
   - 字体大小: `fontSizes.xs`
   - 文字颜色: `colors.textSecondary`
   - 底部间距: `spacing.xs`

2. **标题**:
   - 文案: 「未来三年的财运重点」
   - 字体大小: `fontSizes.base`
   - 字体粗细: `fontWeights.medium`
   - 文字颜色: `colors.ink`
   - 底部间距: `spacing.xs`

3. **生成时间**:
   - 文案: 「生成时间：2025-11-11」
   - 字体大小: `fontSizes.xs`
   - 文字颜色: `colors.textSecondary`

**点击行为**:
- 点击解读卡片 → 跳转到解读详情页面
- 路由: `/reading/:readingId` 或 `navigation.navigate('ReadingDetail', { readingId })`

**筛选功能**（可选）:

**位置**: 标题和说明下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.sm`

**筛选选项**:
- 按主题筛选: 财富 / 情感 / 事业 / 健康等
- 使用 Chip 组件展示
- 支持多选或单选
- Chip 样式:
  - 背景: `colors.blueSoftBg`（选中）或 `colors.disabledBg`（未选中）
  - 文字颜色: `colors.ink`（选中）或 `colors.textSecondary`（未选中）
  - 圆角: `radius.pill`
  - 内边距: 左右 `spacing.md`，上下 `spacing.xs`
  - Chip 之间间距: `spacing.sm`

**空状态**:
- 如果没有解读记录，显示空状态提示
- 文案: 「还没有解读记录，快去和小佩聊天生成你的专属解读吧」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 居中显示
- 顶部间距: `spacing.xl`

---

### 1.3 数据需求

#### 1.3.1 获取解读列表

**接口**: `GET /api/reading/list`

**请求参数**:
```typescript
interface GetReadingListRequest {
  page?: number;        // 页码，默认 1
  page_size?: number;   // 每页数量，默认 20
  theme?: string;       // 主题筛选（可选）
  chart_id?: string;    // 命主 ID（可选，默认当前默认命主）
}
```

**响应**:
```typescript
interface GetReadingListResponse {
  readings: ReadingItem[];
  total: number;
  page: number;
  page_size: number;
}

interface ReadingItem {
  reading_id: string;
  title: string;        // 解读标题
  theme: string;        // 主题（wealth / career / marriage / health）
  summary: string;      // 摘要
  chart_id: string;     // 关联的命主 ID
  chart_name: string;   // 命主名称
  created_at: string;   // 生成时间（ISO 8601 格式）
  is_favorite: boolean; // 是否收藏
}
```

#### 1.3.2 主题映射

**主题显示文案**:
- `wealth` → 「财富分析卡」
- `career` → 「事业分析卡」
- `marriage` → 「情感分析卡」
- `health` → 「健康分析卡」
- `general` → 「综合解读」

---

### 1.4 交互流程

#### 1.4.1 用户操作流程

1. **进入页面**
   - 用户从「我的」主页点击「我的解读」
   - 页面加载解读列表并展示

2. **查看解读**
   - 点击解读卡片
   - 跳转到解读详情页面

3. **筛选解读**（可选）
   - 点击主题筛选 Chip
   - 列表根据筛选条件更新

4. **加载更多**（可选）
   - 滚动到底部自动加载更多
   - 或点击「加载更多」按钮

---

## 二、聊天记录页面

### 2.1 页面概述

**页面名称**: 聊天记录 / Chat History / 对话历史

**页面定位**:
- **页面类型**: 二级页面
- **用户类型**: 所有用户
- **页面层级**: 从「我的」主页进入
- **访问条件**: 用户登录后可见

**页面目的**: 集中管理与小佩的所有对话历史，支持查看、删除历史对话。这是历史对话的**集中管理入口**，采用集中管理方案（方案 A）。

**重要说明**:
- **历史对话集中管理**: 所有历史对话列表统一在此页面管理
- **第一期实现**: 支持查看和删除历史对话
- **与 ChatPage 的关系**: 点击历史对话跳转到 ChatPage，加载对应会话

---

### 2.2 页面设计

#### 2.2.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色。从上到下依次包含：

1. 页面标题和说明
2. 对话列表（按日期分组）
3. 筛选功能（可选）

#### 2.2.2 详细区块设计

**页面标题和说明**:

**位置**: 页面最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`，顶部 `spacing.lg`
- 底部间距: `spacing.md`

**标题**:
- 文案: 「与小佩的对话」
- 字体大小: `fontSizes.lg`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.xs`

**说明文字**:
- 文案: 「这里会展示你与小佩的所有对话历史，方便你回顾之前聊过的话题。」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 行高: `lineHeights.normal`

**对话卡片样式**:

```
┌─────────────────────────────────────────┐
│  今天                                   │
│  Q：我最近适合换工作吗？                │
│  A：从你的当前大运和流年来看，今年确实有│
│     「动」的信号，不过在实际行动前...   │
│  旭 · 本人                              │
└─────────────────────────────────────────┘
```

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 卡片之间间距: `spacing.sm`
- 左右边距: `spacing.md`
- 点击反馈: `activeOpacity: 0.7`
- 支持左滑删除（iOS 风格）或长按删除

**卡片内容**:

1. **日期标签**:
   - 文案: 「今天」「昨天」「2025-11-10」等
   - 字体大小: `fontSizes.xs`
   - 文字颜色: `colors.textSecondary`
   - 底部间距: `spacing.xs`

2. **问题（Q）**:
   - 文案: 用户问题
   - 字体大小: `fontSizes.sm`
   - 字体粗细: `fontWeights.medium`
   - 文字颜色: `colors.ink`
   - 底部间距: `spacing.xs`

3. **回答（A）**:
   - 文案: 小佩的回答（截取前 2 行）
   - 字体大小: `fontSizes.sm`
   - 文字颜色: `colors.textSecondary`
   - 行数限制: 2 行（`numberOfLines: 2`）
   - 超出部分显示省略号
   - 底部间距: `spacing.xs`

4. **命主信息**（可选）:
   - 文案: 命主名称（如「旭 · 本人」）
   - 字体大小: `fontSizes.xs`
   - 文字颜色: `colors.textSecondary`
   - 布局: 右对齐
   - 图标: 可选，显示命主头像或首字母

**点击行为**:
- 点击对话卡片 → 跳转到聊天页面（ChatPage），加载对应会话
- 路由: `navigation.navigate('Chat', { conversationId, masterId, topic, source: 'history' })`
- ChatPage 根据 `conversationId` 加载历史消息

**删除行为**:
- **左滑删除**（iOS 风格，推荐）:
  - 向左滑动卡片，显示删除按钮
  - 删除按钮背景: `colors.error`（红色）
  - 删除按钮文字: 「删除」（白色）
  - 点击删除按钮 → 显示删除确认弹窗
- **长按删除**（Android 风格，备选）:
  - 长按卡片 → 弹出操作菜单
  - 菜单选项: 「删除」
  - 点击删除 → 显示删除确认弹窗

**筛选功能**（可选）:

**位置**: 标题和说明下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.sm`

**筛选选项**:
- **按命主筛选**:
  - 显示所有命主列表
  - 使用 Chip 组件展示
  - 支持多选
  - 默认: 全部命主
- **按日期筛选**:
  - 选项: 今天 / 昨天 / 本周 / 本月 / 更早
  - 使用 Chip 组件展示
  - 单选
  - 默认: 全部

**Chip 样式**:
- 背景: `colors.blueSoftBg`（选中）或 `colors.disabledBg`（未选中）
- 文字颜色: `colors.ink`（选中）或 `colors.textSecondary`（未选中）
- 圆角: `radius.pill`
- 内边距: 左右 `spacing.md`，上下 `spacing.xs`
- Chip 之间间距: `spacing.sm`

**空状态**:
- 如果没有对话记录，显示空状态提示
- **插畫**（可选）:
  - 使用占位图或简单图标
  - 尺寸: `120 x 120dp`
  - 颜色: `colors.textSecondary`（浅色）
  - 底部间距: `spacing.lg`
- **标题**: 「還沒有對話記錄」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.sm`
- **說明**: 「快去和小佩聊天，開始你的命理探索之旅吧」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 行高: `lineHeights.normal`
  - 文本对齐: 居中
  - 顶部间距: `spacing.xl`

---

### 2.3 数据需求

#### 2.3.1 获取聊天记录列表

**接口**: `GET /api/chat/history`

**请求参数**:
```typescript
interface GetChatHistoryRequest {
  page?: number;        // 页码，默认 1
  page_size?: number;   // 每页数量，默认 20
  master_ids?: string[]; // 命主 ID 列表（可选，多选筛选）
  date_filter?: 'today' | 'yesterday' | 'this_week' | 'this_month' | 'earlier';  // 日期筛选
}
```

**响应**:
```typescript
interface GetChatHistoryResponse {
  conversations: ConversationItem[];
  total: number;
  page: number;
  page_size: number;
}

interface ConversationItem {
  conversationId: string;      // 会话 ID
  masterId: string;            // 关联的命主 ID
  masterName: string;          // 命主名称
  topic: TopicKey | null;      // 话题（可选）
  firstQuestion: string;       // 首条用户问题
  lastMessagePreview: string;  // 最后一条消息预览（小佩的回答，前 200 字）
  messageCount: number;        // 消息总数
  createdAt: string;           // 创建时间（ISO 8601 格式）
  updatedAt: string;           // 最后更新时间（ISO 8601 格式）
  dateLabel: string;           // 日期标签（今天/昨天/具体日期，前端生成）
}
```

#### 2.3.2 删除历史对话

**接口**: `DELETE /api/chat/history/:conversationId`

**请求参数**: 无（通过 URL 参数传递 `conversationId`）

**响应**:
```typescript
interface DeleteConversationResponse {
  success: boolean;
}
```

#### 2.3.3 日期标签生成

**前端逻辑**:
```typescript
const getDateLabel = (date: string): string => {
  const today = new Date();
  const conversationDate = new Date(date);
  const diffDays = Math.floor((today.getTime() - conversationDate.getTime()) / (1000 * 60 * 60 * 24));
  
  if (diffDays === 0) return '今天';
  if (diffDays === 1) return '昨天';
  if (diffDays <= 7) return '本周';
  if (diffDays <= 30) return '本月';
  return format(conversationDate, 'yyyy-MM-dd');
};
```

---

### 2.4 交互流程

#### 2.4.1 用户操作流程

1. **进入页面**
   - 用户从「我的」主页点击「聊天记录」
   - 页面加载对话列表并展示

2. **查看对话**
   - 点击对话卡片
   - 跳转到聊天页面（ChatPage）
   - 传递参数: `conversationId`, `masterId`, `topic`, `source: 'history'`
   - ChatPage 根据 `conversationId` 加载历史消息

3. **删除对话**
   - **方式一（推荐）**: 左滑卡片 → 显示删除按钮 → 点击删除 → 确认删除
   - **方式二（备选）**: 长按卡片 → 弹出操作菜单 → 点击删除 → 确认删除
   - 删除确认弹窗:
     - 标题: 「刪除這條對話記錄？」
     - 說明: 「刪除後將無法恢復，但不會影響已生成的解讀內容。」
     - 按鈕: 「取消」「確認刪除」
   - 删除成功后，从列表中移除该卡片

4. **筛选对话**
   - 点击命主筛选 Chip（多选）
   - 点击日期筛选 Chip（单选）
   - 列表根据筛选条件更新
   - 重置筛选: 点击「全部」或清空筛选条件

5. **加载更多**
   - 滚动到底部自动加载更多
   - 或点击「加载更多」按钮
   - 显示加载状态（Loading 指示器）

---

## 技术实现

### 3.1 技术要点

- 列表展示（FlatList 或 ScrollView）
- 日期分组显示
- 筛选功能实现
- 路由跳转
- 数据加载和错误处理
- 空状态处理
- 分页加载

### 3.2 相关文件结构

```
src/
├── screens/
│   └── Me/
│       ├── MyReadingScreen.tsx        # 我的解读页面
│       ├── ChatHistoryScreen.tsx      # 聊天记录页面
│       └── components/
│           ├── ReadingCard.tsx        # 解读卡片组件
│           ├── ConversationCard.tsx   # 对话卡片组件（支持左滑删除）
│           ├── FilterChips.tsx        # 筛选 Chip 组件
│           ├── EmptyState.tsx         # 空状态组件
│           └── DeleteConfirmModal.tsx # 删除确认弹窗组件
├── services/
│   └── api/
│       ├── readingService.ts          # 解读 API
│       └── chatService.ts             # 聊天 API（包含历史对话相关接口）
└── types/
    ├── reading.ts                     # 解读类型定义
    └── chat.ts                        # 聊天类型定义
```

### 3.3 与 ChatPage 的对接

**跳转到 ChatPage**:
```typescript
// 在 ChatHistoryScreen 中
const handleConversationPress = (conversation: ConversationItem) => {
  navigation.navigate('Chat', {
    conversationId: conversation.conversationId,
    masterId: conversation.masterId,
    topic: conversation.topic,
    source: 'history',
  });
};
```

**返回处理**:
- 从 ChatPage 返回后，保持列表滚动位置
- 可选: 高亮刚才打开的对话卡片

---

## 设计规范

### 4.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 卡片使用圆角、边框、阴影区分层级
- 保持充足的留白

### 4.2 交互设计

- 列表滚动流畅
- 卡片点击反馈明确
- 跳转动画平滑
- 筛选交互清晰

### 4.3 响应式设计

- 适配不同屏幕尺寸
- 列表在小屏设备上可正常滚动
- 卡片内容自适应宽度

---

## 待确认事项

- [x] 页面布局和区块设计（已确认）
- [x] 历史对话管理方案（已确认：采用集中管理，第一期实现查看和删除）
- [x] 删除功能实现方式（已确认：支持左滑删除和长按删除）
- [ ] 是否需要支持收藏功能（后续扩展）
- [ ] 是否需要支持分享功能（后续扩展）
- [ ] 筛选功能的具体实现方式（本地筛选 vs 后端筛选）
- [ ] 分页加载的具体实现方式（自动加载 vs 手动加载）
- [ ] 左滑删除的交互细节（iOS 风格 vs Android 风格）

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.1.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - v1.0.0: 初始版本，包含我的解读和聊天记录页面设计
  - v1.1.0: 完善聊天记录页面设计，明确历史对话集中管理方案，添加删除功能（左滑删除/长按删除），完善数据结构和API接口，明确与ChatPage的对接约定，更新UI设计遵循UI_SPEC.md规范
- **维护者**: 开发团队


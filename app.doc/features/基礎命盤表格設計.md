# 八字詳解-基础命盘表格设计文档

## 页面概述

### 页面名称
八字詳解 / Bazi Detail / 基础命盘表格

### 页面定位
- **页面类型**: 命盤详情页的子页面
- **用户类型**: 所有用户
- **页面层级**: 命盤总览页的一部分
- **访问条件**: 用户完成排盤后可见

### 页面目的
展示完整的四柱（年柱/月柱/日柱/时柱）基础命盘表格，包含主星、天干、地支、藏干、副星、納音、星運、自坐、空亡、神煞等详细信息。风格偏克制、工具化。

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 四柱表格展示
- 显示完整的四柱表格（年月日时）
- 包含所有命盘字段（主星、天干、地支、藏干、副星、納音、星運、自坐、空亡、神煞）

#### 2.1.2 天干地支强调
- 天干和地支行特殊渲染
- 显示五行标记

#### 2.1.3 神煞展示
- 显示各柱的神煞列表
- 部分神煞可点击（跳转到神煞解读弹窗）

---

## 页面设计

### 3.1 整体布局

**整体风格**:
- 背景色: 纯白 `colors.bg`（#ffffff）
- 高度: `min-height: 100vh`（占满屏幕高度）
- 水平居中，内容最大宽度约 375-414px（手机屏幕宽度）
- 风格: 克制、工具化，不再视觉上拆成上下两个大区块

---

### 3.2 顶部区域（Header）

**位置**: 页面最顶部

**背景**: 纯白色（与页面背景一致）

**包含内容**:

#### 3.2.1 导航行

**位置**: Header 最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`，顶部 `spacing.lg`，底部 `spacing.sm`
- 高度: 48px

**左侧：返回按钮**:
- 图标: 「<」（ArrowLeft）
- 样式: 简单图标按钮
- 尺寸: 24x24px
- 颜色: `colors.ink`
- 点击行为: 返回上一页

**中间：标题区域**:
- 标题: 「案例 1」（或命主名称）
  - 字体大小: `fontSizes.base`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
- 右侧胶囊: 「預覽」
  - 背景: `colors.blueSoftBg`（浅蓝色）
  - 文字颜色: `colors.brandBlue`
  - 圆角: `radius.pill`
  - 内边距: 左右 `spacing.xs`，上下 `spacing.xs / 2`
  - 字体大小: `fontSizes.xs`
  - 左侧间距: `spacing.xs`

**右侧：更多按钮**:
- 图标: 三点图标（More）
- 尺寸: 24x24px
- 颜色: `colors.ink`
- 点击行为: 显示更多操作菜单

#### 3.2.2 Tab 区域

**位置**: 导航行下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`
- 高度: 48px

**Tab 列表**:
- Tab 1: 「基本信息」
- Tab 2: 「命盤總覽」（当前页，高亮）
- Tab 3: 「大運流年」

**Tab 样式**:
- 选中 Tab:
  - 文字颜色: `colors.ink`
  - 底部高亮条: 品牌色下划线（`colors.brandOrange` 或 `colors.brandBlue`）
  - 高亮条高度: 2px
  - 字体粗细: `fontWeights.medium`
- 未选中 Tab:
  - 文字颜色: `colors.textSecondary`
  - 字体粗细: `fontWeights.regular`
- Tab 之间间距: `spacing.md`
- 字体大小: `fontSizes.base`

#### 3.2.3 性别 + 时间信息

**位置**: Tab 区域下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`
- 布局: 水平排列

**左侧：性别标签**:
- 形状: 圆形
- 直径: 36px
- 背景: `colors.ink`（深色实心圆）
- 文字: 「男」或「女」
- 文字颜色: 白色
- 字体大小: `fontSizes.sm`
- 字体粗细: `fontWeights.medium`
- 右侧间距: `spacing.md`

**右侧：时间信息**:
- 三行文字:
  - 行 1: 「公曆：1988 年 09 月 02 日 02:13」
  - 行 2: 「農曆：1988 年 七月 十二 丑時」
  - 行 3: 「真太陽時：1988 年 09 月 02 日 02:04」
- 字体大小: `fontSizes.xs`（11px）
- 文字颜色: `colors.textSecondary`（中灰色）
- 行高: `lineHeights.tight`（略紧）
- 行间距: `spacing.xs`

---

### 3.3 基础命盘表格

**位置**: 顶部区域下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 上下间距: `spacing.lg`

#### 3.3.1 表头

**表格结构**: 5 列

- 第 1 列: 列标签（左对齐）
- 后 4 列: 年柱、月柱、日柱、时柱（居中）

**表头行**:

| 列 1 | 列 2 | 列 3 | 列 4 | 列 5 |
|------|------|------|------|------|
| 日期  | 年柱  | 月柱  | 日柱  | 时柱  |

**表头样式**:
- 背景: 淡黄色块（`#FFFBEB` 或 `colors.orangeSoftBg`）
- 文字颜色: `colors.ink`（深灰或近黑）
- 字体大小: `fontSizes.sm`
- 字体粗细: `fontWeights.semibold`
- 内边距: `spacing.sm`
- 对齐方式: 第 1 列左对齐，其余居中
- 边框: 底部 `colors.border`（1px）

#### 3.3.2 行结构定义

**Row 类型**:

```typescript
type RowKind = 'single' | 'multi';

interface TableRow {
  label: string;              // 行标签（如「主星」「天干」）
  kind: RowKind;              // 单行或多行
  cells: string[4] | string[4][]; // 单元格数据
}
```

**说明**:
- `kind = "single"`: 每一柱只有一行文本，`cells` 为 `string[4]`
- `kind = "multi"`: 每一柱对应多行，`cells` 为 `string[4][n]`，每一柱是若干行字符串数组（垂直排列）

#### 3.3.3 表格行详细设计

**1. 主星（十神主星）**:

| 行标签 | 年柱 | 月柱 | 日柱 | 时柱 |
|--------|------|------|------|------|
| 主星   | 偏印 | 比肩 | 元男 | 正官 |

- `kind`: `"single"`
- 日柱显示: 「元男」（= 日元 / 元男）

**2. 天干（加强显示）**:

| 行标签 | 年柱 | 月柱 | 日柱 | 时柱 |
|--------|------|------|------|------|
| 天干   | 戊   | 庚   | 庚   | 丁   |

- `kind`: `"single"`
- 特殊渲染: 字体放大、加粗，下方显示五行标记

**3. 地支（加强显示）**:

| 行标签 | 年柱 | 月柱 | 日柱 | 时柱 |
|--------|------|------|------|------|
| 地支   | 辰   | 申   | 申   | 丑   |

- `kind`: `"single"`
- 特殊渲染: 字体放大、加粗，下方显示五行标记

**4. 藏干（多行）**:

| 行标签 | 年柱 | 月柱 | 日柱 | 时柱 |
|--------|------|------|------|------|
| 藏干   | 戊土 | 庚金 | 庚金 | 己土 |
|        | 乙木 | 壬水 | 壬水 | 癸水 |
|        | 癸水 | 戊土 | 戊土 | 辛金 |

- `kind`: `"multi"`
- 每一柱三行，垂直排列

**5. 副星（藏干对应的十神，多行）**:

| 行标签 | 年柱 | 月柱 | 日柱 | 时柱 |
|--------|------|------|------|------|
| 副星   | 偏印 | 比肩 | 比肩 | 正印 |
|        | 正財 | 食神 | 食神 | 傷官 |
|        | 傷官 | 偏印 | 偏印 | 劫財 |

- `kind`: `"multi"`
- 与藏干一一对应

**6. 其他单行字段**:

- **納音**: 大林木 / 石榴木 / 石榴木 / 澗下水
- **星運**: 養 / 臨官 / 臨官 / 墓
- **自坐**: 冠帶 / 臨官 / 臨官 / 墓
- **空亡**: 戌亥 / 子丑 / 子丑 / 申酉

- `kind`: `"single"`

**单元格样式**:
- 背景: `colors.cardBg`（白色）
- 边框: `colors.border`（1px）
- 内边距: `spacing.sm`
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.ink`
- 对齐方式: 第 1 列左对齐，其余居中
- 行高: `lineHeights.normal`

---

### 3.4 天干/地支视觉强调规则

#### 3.4.1 渲染规则

对「天干」「地支」这两行做特殊渲染：

**1. 主文字**:
- 字体大小: `fontSizes.base`（14px，略大于其他行的 11px）
- 字体粗细: `fontWeights.bold`
- 文字颜色: `colors.ink`（深灰或接近黑）

**2. 五行标记**:
- 位置: 主文字下方
- 字体大小: `fontSizes.xs`（9px，非常小）
- 文字颜色: `colors.textSecondary`（浅灰色）
- 显示方式: 小字显示五行

#### 3.4.2 五行对应表

**天干 → 五行**:
- 甲/乙：木
- 丙/丁：火
- 戊/己：土
- 庚/辛：金
- 壬/癸：水

**地支 → 五行**:
- 子/亥：水
- 寅/卯：木
- 巳/午：火
- 辰/戌/丑/未：土
- 申/酉：金

**显示示例**:

```
天干
 戊
 (土)

地支
 辰
 (土)
```

---

### 3.5 神煞行设计

**位置**: 表格最后一行

**结构**: 与表格其他行一致

- 第 1 列: 行标签「神煞」（左对齐）
- 后 4 列: 分别对应年柱/月柱/日柱/时柱的神煞列表

#### 3.5.1 数据结构

```typescript
interface ShenShaItem {
  label: string;  // 神煞名称
  key?: string;   // 可点击神煞的 key（用于弹窗）
}

interface ShenShaRow {
  label: '神煞';
  kind: 'multi';
  cells: ShenShaItem[][];  // 每一柱是神煞数组
}
```

**示例数据**:

```typescript
const shenshaRow: ShenShaRow = {
  label: '神煞',
  kind: 'multi',
  cells: [
    // 年柱神煞列表
    [
      { label: '華蓋' },
      { label: '太極' },
      { label: '德秀' },
      { label: '國印' },
      { label: '龍德' },
      { label: '天德合' },
      { label: '流霞' },
      { label: '月血刃' },
      { label: '天乙', key: 'tianyi_year' }, // 可点击
    ],
    // 月柱
    [
      { label: '建祿神' },
      { label: '文昌' },
      { label: '詞館' },
      { label: '天廚' },
      { label: '亡神', key: 'wang_shen_month' },
    ],
    // 日柱
    [
      { label: '專祿神' },
      { label: '文昌' },
      { label: '詞館' },
      { label: '天廚' },
      { label: '八專' },
      { label: '紅鸞', key: 'hong_luan_day' },
    ],
    // 时柱
    [
      { label: '天乙' },
      { label: '太極' },
      { label: '國印' },
      { label: '月德合' },
      { label: '寡宿' },
      { label: '日空亡' },
      { label: '勾絞煞' },
      { label: '披麻' },
      { label: '破碎' },
    ],
  ],
};
```

#### 3.5.2 显示规则

**普通神煞**:
- 显示方式: 灰色小字，一行一个
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 背景: 无
- 布局: 垂直排列

**可点击神煞**:
- 显示方式: 彩色胶囊按钮（圆角 pill）
- 字体大小: `fontSizes.xs`
- 圆角: `radius.pill`
- 内边距: 左右 `spacing.xs`，上下 `spacing.xs / 2`
- 点击反馈: `activeOpacity: 0.7`
- 颜色根据神煞类型区分:
  - **吉神**: `colors.greenSoftBg`（绿系轻量底）+ `colors.brandGreen`（深绿字）
  - **凶神**: `colors.orangeSoftBg`（偏橙/黄系底）+ `colors.ink`（深色字，但不做血红吓人）
  - **中性/桃花**: `colors.blueSoftBg`（蓝系轻量底）+ `colors.brandBlue`（深蓝字）

**布局**:
- 每一列垂直排列
- 神煞项之间间距: `spacing.xs`
- 可点击神煞和普通神煞混排

---

## 数据需求

### 4.1 表格数据接口

#### 4.1.1 获取基础命盘表格数据

**接口**: `GET /api/bazi/chart/:chartId`

**请求参数**:
```typescript
interface GetBaziChartRequest {
  chart_id: string;  // 命盘 ID
}
```

**响应**:
```typescript
interface GetBaziChartResponse {
  chart_id: string;
  chart_name: string;  // 命主名称
  gender: 'male' | 'female';
  gregorian: string;   // 公历
  lunar: string;       // 农历
  true_solar?: string; // 真太阳时
  pillars: {
    year: PillarData;
    month: PillarData;
    day: PillarData;
    hour: PillarData;
  };
}

interface PillarData {
  main_star: string;        // 主星
  heavenly_stem: string;    // 天干
  earthly_branch: string;   // 地支
  hidden_stems: string[];   // 藏干数组
  auxiliary_stars: string[]; // 副星数组
  na_yin: string;           // 納音
  star_luck: string;        // 星運
  self_sitting: string;     // 自坐
  emptiness: string;        // 空亡
  shen_sha: ShenShaItem[];  // 神煞数组
}
```

---

## 交互流程

### 5.1 用户操作流程

1. **进入页面**
   - 用户从命盤总览页进入
   - 页面加载命盘数据并展示表格

2. **查看表格**
   - 用户滚动查看完整的四柱表格
   - 查看天干地支的五行标记

3. **点击神煞**
   - 点击可点击的神煞胶囊
   - 弹出神煞解读 Bottom Sheet

---

## 技术实现

### 6.1 技术要点

- 表格组件实现（支持单行和多行）
- 天干地支特殊渲染
- 五行标记显示
- 神煞点击交互
- 数据加载和错误处理

### 6.2 相关文件结构

```
src/
├── screens/
│   └── Bazi/
│       └── BaziDetailScreen.tsx    # 八字詳解页面
├── components/
│   └── BaziChart/
│       ├── BaseChartTable.tsx      # 基础命盘表格组件
│       ├── TableRow.tsx            # 表格行组件
│       ├── HeavenlyStemCell.tsx    # 天干单元格组件
│       ├── EarthlyBranchCell.tsx   # 地支单元格组件
│       └── ShenShaCell.tsx         # 神煞单元格组件
├── services/
│   └── api/
│       └── baziService.ts          # 八字 API
└── types/
    └── bazi.ts                     # 八字类型定义
```

---

## 设计规范

### 7.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 表格使用边框和背景色区分层级
- 保持充足的留白
- 风格: 克制、工具化

### 7.2 交互设计

- 表格滚动流畅
- 神煞点击反馈明确
- 天干地支强调清晰

### 7.3 响应式设计

- 适配不同屏幕尺寸
- 表格在小屏设备上支持横向滚动（如需要）
- 单元格内容自适应

---

## 待确认事项

- [x] 页面布局和表格设计（已确认）
- [x] 天干地支强调规则（已确认）
- [x] 神煞显示规则（已确认）
- [ ] 表格是否需要支持横向滚动
- [ ] 是否需要支持表格导出功能

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 包含完整的基础命盘表格设计
- **维护者**: 开发团队
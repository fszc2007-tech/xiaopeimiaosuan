# 我的-二级-意见反馈和客服设计文档

## 页面概述

本文档包含「我的」模块下的意见反馈和联系客服功能设计，包括：

- 意见反馈
- 联系客服（弹窗）

---

## 一、意见反馈页面

### 1.1 页面概述

**页面名称**: 意见反馈 / Feedback

**页面定位**:
- **页面类型**: 二级页面
- **用户类型**: 所有用户
- **页面层级**: 从「我的」主页进入
- **访问条件**: 用户登录后可见

**页面目的**: 收集用户的使用建议和问题反馈。

---

### 1.2 页面设计

#### 1.2.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色。从上到下依次包含：

1. Tab 切换（使用建议 / 遇到问题）
2. 说明文字
3. 文本输入框
4. 联系方式输入
5. 开关选项
6. 底部按钮（取消 / 提交）

#### 1.2.2 详细区块设计

**Tab 切换**:

```
┌─────────────────────────────────────────┐
│  [使用建议]  [遇到问题]                 │
└─────────────────────────────────────────┘
```

**位置**: 页面最顶部

**样式**:
- 背景: `colors.disabledBg`（浅灰色）
- 圆角: `radius.pill`
- 内边距: `spacing.xs`
- 布局: 两个 Tab 水平排列
- 内边距: 左右 `spacing.lg`，顶部 `spacing.lg`
- 底部间距: `spacing.md`

**Tab 样式**:
- 选中 Tab:
  - 背景: `colors.bg`（白色）
  - 文字颜色: `colors.ink`
  - 阴影: `shadows.card`
  - 圆角: `radius.pill`
- 未选中 Tab:
  - 背景: 透明
  - 文字颜色: `colors.textSecondary`
- 字体大小: `fontSizes.sm`
- 内边距: `spacing.sm`
- 宽度: 各占 50%

**说明文字**:

**位置**: Tab 切换下方

**样式**:
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`

**文案**:
- 使用建议: 「有什么让你觉得还可以更好的地方，都可以告诉小佩。」
- 遇到问题: 「如果出现卡顿、打不开、支付异常等情况，请尽量描述清楚发生在什么页面、做了什么操作。」

**样式**:
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 对齐方式: 居中
- 行高: `lineHeights.normal`

**文本输入框**:

**位置**: 说明文字下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`

**输入框**:
- 类型: 多行文本输入（TextArea）
- Placeholder: 根据 Tab 显示不同文案
  - 使用建议: 「如果有想加的功能、觉得哪里可以更顺手，都可以写在这里…」
  - 遇到问题: 「请尽量描述问题发生的页面、操作步骤和提示信息，方便我们排查…」
- 最大长度: 500 字
- 字数统计: 显示在右下角（「{{count}} / 500」）
  - 字体大小: `fontSizes.xs`
  - 文字颜色: `colors.textSecondary`
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.ink`
- 行数: 5-6 行（自适应）

**联系方式输入**:

**位置**: 文本输入框下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`

**标题**:
- 文案: 「微信 / 手机（必填）」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**输入框**:
- 类型: 单行文本输入
- Placeholder: 「方便我们联系你，尽快解决问题」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.ink`
- 边框: `colors.border`（1px）
- 圆角: `radius.md`
- 内边距: `spacing.sm`
- 宽度: 100%

**开关选项**:

**位置**: 联系方式输入下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.md`

**开关列表**:

1. **愿意接受小佩团队联系**（公共开关）:
   - 标题: 「愿意接受小佩团队联系」
   - 开关: Toggle 组件
   - 默认值: `true`
   - 布局: 水平排列，左侧标题，右侧开关
   - 底部间距: `spacing.md`

2. **允许上传诊断日志**（仅在「遇到问题」Tab 显示）:
   - 标题: 「允许上传诊断日志」
   - 描述: 「仅用于定位问题，不会对外公开」
   - 开关: Toggle 组件
   - 默认值: `true`
   - 布局: 水平排列，左侧标题和描述，右侧开关

**Toggle 组件样式**:
- 宽度: 40px
- 高度: 24px
- 圆角: `radius.pill`
- 开启背景: `colors.brandGreen`
- 关闭背景: `colors.disabledBg`
- 滑块: 白色圆形，20x20px
- 过渡动画: 平滑过渡

**底部按钮**:

**位置**: 开关选项下方

**样式**:
- 布局: 两个按钮水平排列
- 内边距: 左右 `spacing.lg`
- 顶部间距: `spacing.lg`
- 底部间距: `spacing.xl`
- 按钮间距: `spacing.md`

**取消按钮**:
- 按钮类型: `SecondaryButton`
- 文案: 「取消」
- 背景: `colors.bg`（白色）
- 边框: `colors.border`（1px）
- 文字颜色: `colors.textSecondary`
- 圆角: `radius.pill`
- 高度: 44px
- 宽度: 50%（flex: 1）

**提交按钮**:
- 按钮类型: `PrimaryButton`
- 文案: 「提交」
- 背景色: `colors.brandBlue`
- 文字颜色: 白色
- 圆角: `radius.pill`
- 高度: 44px
- 宽度: 50%（flex: 1）

**提交成功后的感谢页**:

```
┌─────────────────────────────────────────┐
│              ✨                          │
│          谢谢你的反馈                    │
│  你写下的每一句话，小佩都会认真看。      │
│          [好的]                         │
└─────────────────────────────────────────┘
```

**样式**:
- 位置: 全屏居中显示
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.xl`
- 最大宽度: 320px
- 对齐方式: 居中

**内容**:
- 图标: ✨（emoji 或图标）
  - 字体大小: `fontSizes['3xl']`
  - 底部间距: `spacing.md`
- 标题: 「谢谢你的反馈」
  - 字体大小: `fontSizes.base`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.sm`
- 描述: 「你写下的每一句话，小佩都会认真看。」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 行高: `lineHeights.relaxed`
  - 底部间距: `spacing.lg`
- 按钮: 「好的」
  - 按钮类型: `PrimaryButton`
  - 背景色: `colors.brandBlue`
  - 文字颜色: 白色
  - 圆角: `radius.pill`
  - 宽度: 100%
  - 高度: 44px
  - 点击行为: 返回「我的」主页

---

### 1.3 数据需求

#### 1.3.1 提交反馈

**接口**: `POST /api/feedback`

**请求参数**:
```typescript
interface SubmitFeedbackRequest {
  type: 'suggest' | 'problem';  // 反馈类型
  content: string;               // 反馈内容（0-500 字）
  contact: string;               // 联系方式（必填）
  allow_contact: boolean;        // 愿意接受小佩团队联系
  allow_log_upload?: boolean;    // 允许上传诊断日志（仅在遇到问题时）
}
```

**响应**:
```typescript
interface SubmitFeedbackResponse {
  success: boolean;
  message: string;
  feedback_id?: string;  // 反馈 ID（可选）
}
```

#### 1.3.2 表单验证

**前端验证规则**:
- 反馈内容: 必填，1-500 字
- 联系方式: 必填，不能为空
- 提交前进行二次验证

---

### 1.4 交互流程

#### 1.4.1 用户操作流程

1. **进入页面**
   - 用户从「我的」主页点击「意见反馈」
   - 页面默认显示「使用建议」Tab

2. **切换 Tab**
   - 点击「使用建议」或「遇到问题」Tab
   - Tab 切换，说明文字和 Placeholder 更新
   - 「允许上传诊断日志」开关根据 Tab 显示/隐藏

3. **填写反馈**
   - 输入反馈内容
   - 输入联系方式
   - 设置开关选项

4. **提交反馈**
   - 点击「提交」按钮
   - 进行表单验证
   - 调用 API 提交反馈
   - 显示感谢页

5. **返回**
   - 点击「好的」按钮或「取消」按钮
   - 返回「我的」主页

---

## 二、联系客服（弹窗）

### 2.1 功能概述

**功能名称**: 联系客服 / Contact Customer Service

**功能定位**:
- **功能类型**: 弹窗组件
- **用户类型**: 所有用户
- **触发方式**: 从「我的」主页点击「联系客服」
- **访问条件**: 用户登录后可见

**功能目的**: 提供微信客服联系方式，支持复制微信号和跳转微信。

---

### 2.2 弹窗设计

#### 2.2.1 整体布局

弹窗采用 Bottom Sheet 样式，从底部滑出。包含：

1. 拖拽指示器
2. 标题
3. 微信号显示
4. 服务时间说明
5. 操作按钮

#### 2.2.2 详细区块设计

**弹窗样式**:

```
┌─────────────────────────────────────────┐
│  [遮罩层]                               │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │  ──── (拖拽指示器)                │ │
│  │                                   │ │
│  │  添加小佩客服微信                 │ │
│  │                                   │ │
│  │  微信号：xiaopei_service          │ │
│  │                                   │ │
│  │  服务时间：10:00–22:00，如有支付 │ │
│  │  或使用问题都可以联系我。         │ │
│  │                                   │ │
│  │  [复制微信号]  [已复制，去微信]  │ │
│  │                                   │ │
│  │  [取消]                           │ │
│  └───────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

**遮罩层**:
- 背景: 半透明黑色（`rgba(0, 0, 0, 0.4)`）
- 点击行为: 关闭弹窗

**弹窗容器**:
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`（16px），底部 0
- 内边距: `spacing.lg`
- 最大高度: 屏幕高度的 60%
- 位置: 底部对齐

**拖拽指示器**:
- 样式: 水平横条
- 宽度: 40px
- 高度: 4px
- 背景: `colors.disabledBg`（浅灰色）
- 圆角: `radius.pill`
- 居中显示
- 底部间距: `spacing.md`

**标题**:
- 文案: 「添加小佩客服微信」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 对齐方式: 居中
- 底部间距: `spacing.md`

**微信号显示**:
- 标签: 「微信号：」
- 微信号: `xiaopei_service`
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.ink`
- 对齐方式: 居中
- 微信号使用等宽字体: `fontFamily.mono`
- 底部间距: `spacing.xs`

**服务时间说明**:
- 文案: 「服务时间：10:00–22:00，如有支付或使用问题都可以联系我。」
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 对齐方式: 居中
- 行高: `lineHeights.normal`
- 底部间距: `spacing.lg`

**操作按钮区域**:

**布局**: 两个按钮水平排列

**按钮 1：复制微信号**:
- 按钮类型: `SecondaryButton`
- 文案: 「复制微信号」
- 背景: `colors.bg`（白色）
- 边框: `colors.border`（1px）
- 文字颜色: `colors.textSecondary`
- 圆角: `radius.pill`
- 高度: 44px
- 宽度: 50%（flex: 1）
- 点击行为: 复制微信号到剪贴板，显示 Toast 提示

**按钮 2：已复制，去微信**:
- 按钮类型: `PrimaryButton`
- 文案: 「已复制，去微信」
- 背景色: `colors.brandBlue`
- 文字颜色: 白色
- 圆角: `radius.pill`
- 高度: 44px
- 宽度: 50%（flex: 1）
- 点击行为: 先复制微信号，再尝试打开微信（`weixin://`）

**取消按钮**:
- 按钮类型: `GhostButton`（文字按钮）
- 文案: 「取消」
- 文字颜色: `colors.textSecondary`
- 圆角: `radius.pill`
- 高度: 36px
- 宽度: 100%
- 顶部间距: `spacing.md`
- 点击行为: 关闭弹窗

---

### 2.3 数据需求

#### 2.3.1 客服信息

**数据来源**: 前端配置（不需要 API）

**配置**:
```typescript
const customerService = {
  wechat_id: 'xiaopei_service',
  service_hours: '10:00–22:00',
  service_description: '如有支付或使用问题都可以联系我。',
};
```

#### 2.3.2 复制微信号

**前端实现**:
- 使用 `Clipboard` API 复制微信号
- 显示 Toast 提示: 「已复制微信号：{{wechat_id}}」

#### 2.3.3 跳转微信

**前端实现**:
- iOS: 尝试打开 `weixin://`
- Android: 尝试打开微信应用
- 如果微信未安装，显示提示

---

### 2.4 交互流程

#### 2.4.1 用户操作流程

1. **打开弹窗**
   - 用户从「我的」主页点击「联系客服」
   - 弹窗从底部滑出

2. **复制微信号**
   - 点击「复制微信号」按钮
   - 微信号复制到剪贴板
   - 显示 Toast 提示

3. **跳转微信**
   - 点击「已复制，去微信」按钮
   - 先复制微信号
   - 尝试打开微信应用
   - 如果微信未安装，显示提示

4. **关闭弹窗**
   - 点击「取消」按钮
   - 点击遮罩层
   - 向下拖拽弹窗（Bottom Sheet 手势）

---

## 技术实现

### 3.1 技术要点

- 表单输入和验证
- Tab 切换
- Toggle 开关组件
- 弹窗组件（Modal / Bottom Sheet）
- 剪贴板操作
- 应用跳转（微信）
- Toast 提示

### 3.2 相关文件结构

```
src/
├── screens/
│   └── Me/
│       ├── FeedbackScreen.tsx         # 意见反馈页面
│       └── components/
│           ├── FeedbackForm.tsx       # 反馈表单组件
│           ├── ThankYouModal.tsx      # 感谢页组件
│           └── CustomerServiceModal.tsx # 客服弹窗组件
├── services/
│   └── api/
│       └── feedbackService.ts         # 反馈 API
└── types/
    └── feedback.ts                    # 反馈类型定义
```

---

## 设计规范

### 4.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 弹窗使用圆角、阴影区分层级
- 保持充足的留白

### 4.2 交互设计

- 表单验证实时反馈
- Tab 切换流畅
- 弹窗动画平滑（从底部滑出）
- 按钮点击反馈明确

### 4.3 响应式设计

- 适配不同屏幕尺寸
- 弹窗在小屏设备上自适应高度

---

## 待确认事项

- [x] 页面布局和区块设计（已确认）
- [ ] 诊断日志上传的具体实现方式
- [ ] 微信跳转的具体实现方式（iOS / Android）
- [ ] 反馈提交后的处理流程

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 包含意见反馈和联系客服功能设计
- **维护者**: 开发团队


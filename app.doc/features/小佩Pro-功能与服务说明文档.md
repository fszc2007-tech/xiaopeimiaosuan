# 小佩 Pro-功能与服务说明文档

## 文档概述

### 文档名称
小佩 Pro 功能与服务说明 / Pro Features & Services

### 文档定位
- **文档类型**: 功能说明文档
- **用户类型**: 所有用户（免费和付费用户）
- **使用场景**: 了解 Pro 功能、权益、FAQ 等

### 文档目的
详细说明小佩 Pro 的功能特性、服务内容、权益说明和常见问题，供开发和产品参考。

---

## 一、Pro 功能特性

### 1.1 核心功能

#### 1.1.1 深度解读功能
- **大運解讀**: 完整的大運周期解读
- **流年解讀**: 详细的流年分析
- **流月解讀**: 精细的流月解读
- **流日解讀**: 更细粒度的流日分析（可选）

#### 1.1.2 专题分析
- **財運分析**: 针对财富的专题分析
- **感情分析**: 针对情感的专题分析
- **事業分析**: 针对事业的专题分析
- **健康分析**: 针对健康的专题分析

#### 1.1.3 聊天功能增强
- **无限提问**: 不受次数限制的提问
- **持续追问**: 针对同一张命盘可以持续追问
- **对话记录**: 完整的对话历史和回看功能
- **重点标注**: 可以标注和收藏重要对话

#### 1.1.4 命盘管理
- **多命主支持**: 可为自己和家人建立多个命盘档案
- **命盘对比**: 支持多个命盘的对比分析（可选）
- **档案库**: 稳定的命盘档案库管理

#### 1.1.5 高级功能
- **真太阳时**: 真太阳时计算开关
- **人元司令**: 人元司令等进阶规则
- **未来功能**: 后续新增的高级功能优先解锁

---

### 1.2 免费功能对比

#### 1.2.1 免费用户可用功能
- 基础排盤
- 简要分析
- 每日少量聊天（有次数限制）
- 基础命盘查看

#### 1.2.2 Pro 用户额外功能
- 完整的大運/流年/流月深度解读
- 专题分析（财富/感情/事业/健康）
- 无限提问和持续追问
- 多命主管理
- 高级命理规则开关
- 未来功能优先解锁

---

## 二、订阅方案说明

### 2.1 方案类型

#### 2.1.1 年度会员（推荐）

**方案 ID**: `yearly`

**特点**:
- 长期陪伴，性价比更高
- 适合长期使用小佩的用户

**权益**:
1. 在未來 12 個月內，完整使用大運 / 流年 / 流月等深度解讀功能。
2. 一年內和小佩針對同一張命盤反覆追問，所有重點問題都能慢慢展開。
3. 年度期間可持續累積紀錄與標註，方便回顧這一年走過的關鍵節點。

**价格**: ¥*** / 年（折算約 ¥** / 月）

**标签**: 「推薦」

---

#### 2.1.2 月度会员

**方案 ID**: `monthly`

**特点**:
- 适合想先体验一段时间
- 可以随时取消

**权益**:
1. 在這一個計費週期內，解鎖完整的大運 / 流年 / 流月深度解讀。
2. 期間內可暢聊當前最在意的主題，享受與年度方案相同的 Pro 權益。
3. 適合短期試用，或在當下階段集中處理一件重要的事情。

**价格**: ¥*** / 月

**标签**: 「先試一試」

---

#### 2.1.3 终身会员

**方案 ID**: `lifetime`

**特点**:
- 一次开通，长期使用
- 适合已非常认同小佩的用户

**权益**:
1. 一次開通後，長期享有小佩 Pro 的所有核心功能與後續升級。
2. 人生不同階段（轉職、結婚、生子等）都可以回到同一張命盤持續追問。
3. 為自己與家人建立穩定的命盤檔案庫，之後新增的高級能力也會優先開啟。

**价格**: ¥*** 一次性

**标签**: 「深度用戶」

---

### 2.2 权益映射表

```typescript
const planBenefitsMap = {
  yearly: [
    '在未來 12 個月內，完整使用大運 / 流年 / 流月等深度解讀功能。',
    '一年內和小佩針對同一張命盤反覆追問，所有重點問題都能慢慢展開。',
    '年度期間可持續累積紀錄與標註，方便回顧這一年走過的關鍵節點。',
  ],
  monthly: [
    '在這一個計費週期內，解鎖完整的大運 / 流年 / 流月深度解讀。',
    '期間內可暢聊當前最在意的主題，享受與年度方案相同的 Pro 權益。',
    '適合短期試用，或在當下階段集中處理一件重要的事情。',
  ],
  lifetime: [
    '一次開通後，長期享有小佩 Pro 的所有核心功能與後續升級。',
    '人生不同階段（轉職、結婚、生子等）都可以回到同一張命盤持續追問。',
    '為自己與家人建立穩定的命盤檔案庫，之後新增的高級能力也會優先開啟。',
  ],
  default: [
    '完整大運 / 流年 / 流月深度解讀',
    '針對財運 / 感情 / 事業的專題分析',
    '和小佩長聊、多聊，追問不再受次數限制',
    '可為自己與家人建立多個命盤檔案',
    '未來新增的大部分高級功能優先解鎖',
  ],
};
```

---

## 三、Pro 理念说明

### 3.1 核心理念

#### 3.1.1 按照自己的节奏使用
- **理念**: 先專心處理你眼前的事情，想看得更完整時，再回來慢慢展開就好。
- **图标**: Shield（保护、安全感）
- **说明**: Pro 不是强制性的，用户可以根据自己的需要随时使用

#### 3.1.2 更长久、更完整的对话
- **理念**: 對同一張命盤，可以持續追問、記錄與回看，不再被次數打斷。
- **图标**: MessageCircle（对话、交流）
- **说明**: Pro 让用户可以与小佩进行更深入的对话，不受限制

### 3.2 价值主张

**主标题**: 「升級小佩 Pro」

**说明文案**:
> 不改變你現在的使用方式，只是在你需要更深入解讀的時候，小佩可以走得更遠一點，陪你看懂大運、流年，以及你正在經歷的關鍵階段。

**小标签**: 「命理師級別陪伴」

---

## 四、FAQ 常见问题

### 4.1 功能相关问题

#### Q1: 不開通 Pro，我還能用什麼？

**A**: 你依然可以使用基礎排盤、查看簡要分析，並每天和小佩聊幾句。Pro 只是讓解讀更深入、陪伴更持久。

**说明**:
- 免费用户仍然可以使用基础功能
- Pro 是在免费功能基础上的增强
- 不会因为不开通 Pro 而失去现有功能

---

#### Q2: Pro 和免费版本有什么区别？

**A**: 主要区别在于：
- **深度解读**: Pro 提供完整的大運/流年/流月解读，免费版只有简要分析
- **提问次数**: Pro 无限提问，免费版有次数限制
- **专题分析**: Pro 提供财富/感情/事业等专题分析
- **多命主**: Pro 支持多个命主管理
- **高级功能**: Pro 可以使用真太阳时、人元司令等进阶规则

---

### 4.2 订阅相关问题

#### Q3: 訂閱會自動續費嗎？可以隨時取消嗎？

**A**: 如果你是在應用商店開通訂閱，續費與取消都在對應的「訂閱管理」中操作，小佩不會私自扣款。

**说明**:
- 订阅通过应用商店管理
- 用户可以随时在应用商店取消续费
- 小佩不会私自扣款
- 已支付的周期内，权益不会被中断

---

#### Q4: 換手機、換設備後會員還在嗎？

**A**: 只要你使用同一個賬號登入，小佩會自動同步你的訂閱狀態，無需重複購買。

**说明**:
- 订阅状态与账号绑定
- 同一账号在不同设备上登录，订阅状态同步
- 不需要重复购买

---

#### Q5: 可以退款吗？

**A**: 虚拟服务不支持退款。如果你在支付后遇到问题，可以联系客服解决。

**说明**:
- 虚拟服务一般不支持退款
- 如有支付问题，可以联系客服
- 支付成功但没解锁的情况，客服会协助解决

---

### 4.3 使用相关问题

#### Q6: Pro 功能在哪里使用？

**A**: Pro 功能集成在应用的各个页面中：
- **命盤總覽**: 可以看到更详细的解读
- **聊天頁面**: 可以无限提问和持续追问
- **大運流年**: 可以查看完整的大運/流年/流月解读
- **設置**: 可以开启高级命理规则

---

#### Q7: 开通 Pro 后，之前的对话记录还在吗？

**A**: 是的，所有对话记录都会保留。开通 Pro 后，你可以回看所有历史对话，包括免费期间的对话。

---

## 五、数据与隐私说明

### 5.1 数据安全

- **命盤數據**: 小佩不會以任何形式出售或外泄你的命盤與聊天內容
- **隱私保護**: 所有数据加密存储，仅用于提供服务
- **數據導出**: 用户可以导出自己的数据（可选功能）

### 5.2 订阅管理

- **訂閱狀態**: 订阅状态存储在服务器，与账号绑定
- **自動續費**: 通过应用商店管理，小佩不直接处理支付
- **取消續費**: 在应用商店的「订阅管理」中操作

---

## 六、技术实现说明

### 6.1 功能权限控制

#### 6.1.1 权限检查

```typescript
interface ProPermission {
  canUseDeepReading: boolean;      // 是否可以使用深度解读
  canUseThemeAnalysis: boolean;     // 是否可以使用专题分析
  canUnlimitedChat: boolean;        // 是否可以无限提问
  canUseAdvancedRules: boolean;     // 是否可以使用高级规则
  canManageMultipleCharts: boolean; // 是否可以管理多个命主
}

// 检查用户是否有 Pro 权限
const checkProPermission = (feature: keyof ProPermission): boolean => {
  const user = getCurrentUser();
  if (!user.is_pro) {
    return false;
  }
  
  // 检查订阅是否过期（年度/月度）
  if (user.current_plan?.expires_at) {
    const expiresAt = new Date(user.current_plan.expires_at);
    if (expiresAt < new Date()) {
      return false;
    }
  }
  
  return true;
};
```

#### 6.1.2 功能限制提示

当免费用户尝试使用 Pro 功能时：

```typescript
const handleProFeatureClick = (feature: string) => {
  if (!checkProPermission(feature)) {
    // 显示 Pro 提示
    showProPrompt({
      title: '此功能需要小佩 Pro',
      message: '此部分屬於小佩 Pro 內容，需要開通後查看',
      buttonText: '了解小佩 Pro',
      onButtonClick: () => {
        navigation.navigate('ProSubscription');
      },
    });
  }
};
```

---

### 6.2 订阅状态同步

#### 6.2.1 状态检查

```typescript
// 定期检查订阅状态
const checkSubscriptionStatus = async () => {
  try {
    const response = await proService.getStatus();
    if (response.is_pro) {
      // 更新本地状态
      updateUserProStatus(response);
    }
  } catch (error) {
    // 错误处理
  }
};
```

#### 6.2.2 状态更新

```typescript
// 订阅成功后更新状态
const handleSubscriptionSuccess = async (orderId: string) => {
  try {
    // 验证订单
    const result = await proService.verifyOrder(orderId);
    if (result.success) {
      // 更新用户状态
      await updateUserProStatus({
        is_pro: true,
        current_plan: result.plan,
      });
      
      // 显示成功提示
      showSuccessToast('已成功开通小佩 Pro');
      
      // 刷新相关页面
      refreshProFeatures();
    }
  } catch (error) {
    // 错误处理
  }
};
```

---

## 七、与「我的」模块的集成

### 7.1 入口说明

- **入口位置**: 「我的」→「小佩服务」→「小佩 Pro」
- **显示逻辑**:
  - 未开通: 显示「需要更深入解读时，可以了解一下」
  - 已开通: 显示「已开通 · 管理订阅与权益」

### 7.2 状态展示

在「我的」主页的顶部个人卡片中：
- 免费用户: 显示「基础版」标签
- Pro 用户: 显示「小佩 Pro」标签（粉绿色背景）

---

## 八、被动入口（使用中触发）

### 8.1 触发场景

保持"克制收费"的原则：**只在用户触发某个高阶行为时，温和弹出 Pro 提示**。

#### 8.1.1 命盘或大运流年页
- **触发条件**: 用户尝试查看「更细粒度」解读（如精细流月/流日、多个专题卡片）
- **提示内容**: 「此部分属于小佩 Pro 内容，需要开通后查看」
- **按钮**: 「了解小佩 Pro」

#### 8.1.2 聊天对话中
- **触发条件**: 用户当天提问超过免费额度
- **提示内容**: 「今天的免费提问次数用完啦，如果有更深入的问题，可以考虑开通小佩 Pro」
- **按钮**: 「了解小佩 Pro」

### 8.2 统一行为

- 点击「了解小佩 Pro」→ 跳转到 Pro 订阅中心页
- 提示样式: 温和、不打扰，使用 Toast 或轻量 Modal

---

## 九、数据需求

### 9.1 订阅状态接口

#### 9.1.1 获取订阅状态

**接口**: `GET /api/pro/status`

**请求参数**: 无（从 token 中获取用户 ID）

**响应**:
```typescript
interface GetProStatusResponse {
  is_pro: boolean;
  current_plan?: {
    id: 'yearly' | 'monthly' | 'lifetime';
    label: string;
    expires_at?: string;  // 到期时间（年度/月度，ISO 8601 格式）
  };
  free_features: string[];
  pro_features: string[];
}
```

#### 9.1.2 创建订阅订单

**接口**: `POST /api/pro/subscribe`

**请求参数**:
```typescript
interface CreateSubscriptionRequest {
  plan_id: 'yearly' | 'monthly' | 'lifetime';
  payment_method: 'app_store' | 'google_play' | 'other';
}
```

**响应**:
```typescript
interface CreateSubscriptionResponse {
  order_id: string;
  payment_url?: string;
  // 其他支付相关信息
}
```

#### 9.1.3 恢复购买

**接口**: `POST /api/pro/restore`

**请求参数**: 无（从 token 中获取用户 ID）

**响应**:
```typescript
interface RestorePurchaseResponse {
  success: boolean;
  message: string;
  subscription?: {
    id: string;
    plan_id: string;
    expires_at?: string;
  };
}
```

---

## 十、待确认事项

- [x] Pro 功能列表（已确认）
- [x] 订阅方案说明（已确认）
- [x] FAQ 内容（已确认）
- [ ] 具体价格设置
- [ ] 支付流程的具体实现方式
- [ ] 订阅到期后的处理方式
- [ ] 是否需要支持试用期
- [ ] 是否需要支持家庭共享

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 包含完整的 Pro 功能和服务说明
- **维护者**: 开发团队


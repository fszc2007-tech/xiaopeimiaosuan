# 小佩主页（小佩 Tab）设计文档

> **版本**: v1.0  
> **适用范围**: 小佩 App 内底部导航中间「小佩」入口对应的主页  
> **文件类型**: 产品 / 开发说明（供 Cursor / 前后端参考）

---

## 页面概述

### 页面名称
小佩主页 / XiaoPei Home Page / 小佩页

### 页面定位
- **页面类型**: 意图选择页 + 问题入口页
- **入口**: 底部导航中间「小佩」按钮
- **用户类型**: 所有用户
- **页面层级**: 底部导航 Tab（第四个 Tab，位于「檔案」和「我的」之间）
- **访问条件**: 用户登录后可见

### 页面目的
这是一个「**意图选择页 + 问题入口页**」，不是聊天页。负责帮用户**选命主 + 选话题 + 选问题 / 输入问题**，再跳转到真正的聊天页。

### 页面角色
- ✅ **做**：
  - 展示当前命主信息
  - 提供话题入口（桃花、婚姻、事业等）
  - 提供「大家常问」示例问题
  - 提供自由输入框
  - 收集用户意图并传递给聊天页

- ❌ **不做**：
  - 不显示聊天记录
  - 不在本页调用 LLM
  - 不进行多轮对话（这些由聊天页负责）

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 命主信息展示
- 显示当前默认命主信息
- 支持切换命主（预留功能）

#### 2.1.2 话题入口
- 提供 6 个话题按钮，引导用户选择聊天方向
- 点击话题按钮生成默认问题并跳转聊天页

#### 2.1.3 大家常问
- 展示示例问题，降低提问门槛
- 点击示例问题直接跳转聊天页

#### 2.1.4 自由输入
- 提供输入框，支持用户自由输入问题
- 发送后跳转聊天页

---

## 用户场景

### 3.1 典型流程

1. **用户点击底部导航中间的「小佩」按钮**
   - 进入小佩主页
   - 看到当前命主信息卡片

2. **用户选择聊天方式**（三选一）：
   - **方式 A**：点击话题按钮（如「桃花 · 恋爱」）
     - 自动生成默认问题：「想从「桃花 · 恋爱」这个角度，先帮我整体看看好吗？」
     - 跳转到聊天页，传递话题和问题
   
   - **方式 B**：点击「大家常问」中的示例问题
     - 使用固定话题（默认「桃花 · 恋爱」）
     - 跳转到聊天页，传递话题和问题文本
   
   - **方式 C**：在底部输入框输入问题
     - 用户自由输入自然语言问题
     - 点击「发送」后跳转聊天页，传递问题文本（话题为 null，由后端识别）

3. **进入聊天页**
   - 聊天页接收命主信息 + 话题 + 问题
   - 聊天页负责首轮 LLM 调用和多轮对话

---

## 页面设计

### 4.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色 `colors.bg`。从上到下依次包含：

1. 顶部栏
2. 命主信息卡片
3. 话题入口区
4. 「大家常问」区
5. 自由输入区
6. 底部导航（由底部导航组件统一管理）

---

### 4.2 详细区块设计

#### 4.2.1 顶部栏

**位置**: 页面最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 高度: 约 `56dp`（包含安全区域）
- 内边距: 左右 `spacing.lg`，上下 `spacing.md`

**内容布局**:
- **左侧**: 标题「小佩」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.bold`
  - 文字颜色: `colors.ink`
- **右侧**: 副标题（灰色小字）
  - 文案: 「基于你的八字，陪你聊聊当下的事」
  - 字体大小: `fontSizes.xs`
  - 文字颜色: `colors.textSecondary`

**行为**:
- 当前版本顶部栏不包含返回按钮或配置入口
- 返回操作由系统「左滑返回」或聊天页左上角完成（本页是导航主 Tab 的"根页"）

---

#### 4.2.2 命主信息卡片（CurrentMasterCard）

**位置**: 顶部栏下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 边框: `colors.border`（1px，可选）
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 上下间距: `spacing.md`
- 左右边距: `spacing.lg`

**内容布局**:

```
┌─────────────────────────────────────────┐
│  [头像]  旭 · 本人        [切换命主]    │
│          [命主]                         │
│          公历 1995-01-31 · 12:00 · 乾造 │
└─────────────────────────────────────────┘
```

**左侧区域**:
- **头像**: 
  - 圆形背景，直径 `48dp`
  - 背景色: `colors.ink`（深色）
  - 文字: 命主昵称首字（如「旭」）
  - 文字颜色: 白色
  - 字体大小: `fontSizes.base`
- **文本区**:
  - **主标题**: 「旭 · 本人」
    - 字体大小: `fontSizes.base`
    - 字体粗细: `fontWeights.semibold`
    - 文字颜色: `colors.ink`
  - **Tag**: 「命主」
    - 背景: `colors.blueSoftBg`
    - 文字颜色: `colors.brandBlue`
    - 圆角: `radius.pill`
    - 内边距: 左右 `spacing.xs`，上下 `spacing.xs / 2`
    - 字体大小: `fontSizes.xs`
  - **副标题**: 「公历 1995-01-31 · 12:00 · 乾造」
    - 字体大小: `fontSizes.xs`
    - 文字颜色: `colors.textSecondary`
    - 顶部间距: `spacing.xs`

**右侧区域**:
- **切换命主按钮**:
  - 图标: `User`（lucide-react 或自定义图标）
  - 图标大小: `20 x 20dp`
  - 图标颜色: `colors.textSecondary`
  - 文案: 「切换命主」
  - 字体大小: `fontSizes.xs`
  - 文字颜色: `colors.textSecondary`
  - 布局: 水平排列，图标在左，文字在右
  - 点击反馈: `activeOpacity: 0.7`

**数据接口**:
```typescript
interface CurrentMasterCardData {
  masterId: string;           // 命主 ID
  name: string;               // 命主昵称
  relation: 'self' | 'partner' | 'child' | 'parent' | 'sibling' | 'friend' | 'other';
  relationLabel: string;      // 关系标签（本人/伴侣/小孩等）
  birthDate: string;          // 公历日期，格式：YYYY-MM-DD
  birthTime: string;          // 时间，格式：HH:mm
  gender: 'male' | 'female';  // 性别
  genderLabel: string;        // 性别标签（乾造/坤造）
  isDefault: boolean;         // 是否为默认命主
}
```

**行为**:
- 点击「切换命主」按钮：
  - 当前版本可以先 `console.log`，留给后续实现
  - 后续版本：弹出命主选择列表或跳转到命主管理页

---

#### 4.2.3 话题入口区（Topic Buttons）

**位置**: 命主信息卡片下方

**标题**:
- 文案: 「想从哪里开始聊？」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 顶部间距: `spacing.lg`
- 左右边距: `spacing.lg`
- 底部间距: `spacing.md`

**布局**:
- 三列网格布局（`grid-cols-3`），共 6 个话题按钮
- 列间距: `spacing.md`
- 行间距: `spacing.md`
- 左右边距: `spacing.lg`

**话题按钮样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.md`
- 边框: `colors.border`（1px）
- 阴影: `shadows.card`（轻微）
- 内边距: `spacing.md`
- 高度: 约 `100dp`（自适应内容）
- 点击反馈: `activeOpacity: 0.8`

**话题按钮内容**:
- **图标区域**:
  - 圆形背景，直径 `40dp`
  - 背景色: `colors.greenSoftBg`
  - 图标颜色: `colors.brandGreen`
  - 图标大小: `24 x 24dp`
  - 居中显示
  - 底部间距: `spacing.sm`
- **标题**:
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.xs`
  - 文本对齐: 居中
- **描述**:
  - 字体大小: `fontSizes.xs`
  - 文字颜色: `colors.textSecondary`
  - 行数: 最多 2 行，超出省略
  - 文本对齐: 居中

**话题枚举**:
```typescript
type TopicKey =
  | 'peach'      // 桃花 · 恋爱
  | 'marriage'   // 婚姻 · 关系经营
  | 'career'     // 事业与选择
  | 'wealth'     // 财富与钱路
  | 'family'     // 家庭与亲子
  | 'rhythm';    // 节奏与运势
```

**话题配置**:
```typescript
interface TopicConfig {
  label: string;              // 话题标题
  desc: string;               // 话题描述
  icon: React.ComponentType;  // 图标组件
  defaultQuestion: string;    // 默认问题模板
}

const TOPICS: Record<TopicKey, TopicConfig> = {
  peach: {
    label: '桃花 · 恋爱',
    desc: '结婚前的心动、暧昧、约会',
    icon: Sparkles, // 或自定义图标
    defaultQuestion: '想从「桃花 · 恋爱」这个角度，先帮我整体看看好吗？',
  },
  marriage: {
    label: '婚姻 · 关系经营',
    desc: '结婚后、长期关系怎么走',
    icon: HeartHandshake,
    defaultQuestion: '想从「婚姻 · 关系经营」这个角度，先帮我整体看看好吗？',
  },
  career: {
    label: '事业与选择',
    desc: '方向、变动、合作',
    icon: BriefcaseBusiness,
    defaultQuestion: '想从「事业与选择」这个角度，先帮我整体看看好吗？',
  },
  wealth: {
    label: '财富与钱路',
    desc: '赚钱机会、破财',
    icon: Wallet,
    defaultQuestion: '想从「财富与钱路」这个角度，先帮我整体看看好吗？',
  },
  family: {
    label: '家庭与亲子',
    desc: '家人相处、亲子',
    icon: Home,
    defaultQuestion: '想从「家庭与亲子」这个角度，先帮我整体看看好吗？',
  },
  rhythm: {
    label: '节奏与运势',
    desc: '流年节奏、关键点',
    icon: CalendarClock,
    defaultQuestion: '想从「节奏与运势」这个角度，先帮我整体看看好吗？',
  },
};
```

**交互**:
- 点击话题按钮：
  - 获取该话题的配置
  - 使用 `defaultQuestion` 作为问题文本
  - 调用 `onStartChat` 回调，传递：
    - `topic`: 话题 Key
    - `question`: 默认问题文本
    - `source`: `'topic_button'`

---

#### 4.2.4 「大家常问」区

**位置**: 话题入口区下方

**标题**:
- 文案: 「大家常问」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 顶部间距: `spacing.lg`
- 左右边距: `spacing.lg`
- 底部间距: `spacing.md`

**说明文案**（可选）:
- 文案: 「不知道问什么？看看大家常问的问题」
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 顶部间距: `spacing.xs`
- 左右边距: `spacing.lg`
- 底部间距: `spacing.sm`

**问题列表**:
- 布局: 垂直列表
- 问题项样式:
  - 背景: `colors.blueSoftBg`
  - 圆角: `radius.md`
  - 内边距: 左右 `spacing.md`，上下 `spacing.sm`
  - 左右边距: `spacing.lg`
  - 底部间距: `spacing.sm`
  - 点击反馈: `activeOpacity: 0.7`
- 问题文本:
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.ink`
  - 行高: `lineHeights.normal`
  - 文本对齐: 左对齐
  - 最多显示 2 行，超出省略

**问题配置**:
```typescript
const COMMON_QUESTIONS: Record<TopicKey, string[]> = {
  peach: [
    '最近桃花运怎么样，会不会有新的暧昧？',
    '我适合怎样的恋爱节奏，慢热还是一见钟情？',
    '这一两年适合多社交、多玩一点吗？',
  ],
  marriage: [
    '我和伴侣的关系未来会如何发展？',
    '如何改善我们的沟通方式？',
    '这段关系需要注意什么？',
  ],
  career: [
    '我适合什么样的工作方向？',
    '最近适合换工作吗？',
    '事业发展有什么需要注意的？',
  ],
  wealth: [
    '最近财运如何，有没有赚钱机会？',
    '投资理财需要注意什么？',
    '什么时候容易破财？',
  ],
  family: [
    '和家人相处需要注意什么？',
    '亲子关系如何改善？',
    '家庭氛围会如何变化？',
  ],
  rhythm: [
    '最近几年的运势节奏如何？',
    '什么时候是关键转折点？',
    '需要注意哪些时间节点？',
  ],
};
```

**默认话题**:
- 当前版本默认话题: `defaultTopic = 'peach'`（桃花 · 恋爱）
- 显示该话题下的「大家常问」问题列表

**交互**:
- 点击问题项：
  - 使用固定话题：`defaultTopic`（当前为 `'peach'`）
  - 问题文本 = 该条文案
  - 调用 `onStartChat` 回调，传递：
    - `topic`: `defaultTopic`
    - `question`: 问题文本
    - `source`: `'common_question'`

---

#### 4.2.5 自由输入区（自然语言问题）

**位置**: 「大家常问」区下方

**提示文案**:
- 文案: 「也可以直接把你现在最在意的事告诉小佩」
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 顶部间距: `spacing.lg`
- 左右边距: `spacing.lg`
- 底部间距: `spacing.sm`

**输入区域**:
- 布局: 水平排列，输入框在左，发送按钮在右
- 左右边距: `spacing.lg`
- 底部间距: `spacing.lg`（距离底部导航）

**输入框样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.pill`
- 边框: `colors.border`（1px）
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- 高度: 约 `44dp`
- 左侧图标:
  - 图标: `MessageCircle`（lucide-react 或自定义图标）
  - 图标大小: `20 x 20dp`
  - 图标颜色: `colors.textSecondary`
  - 左侧间距: `spacing.sm`
- 输入文本:
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.ink`
  - 占位符颜色: `colors.textSecondary`
  - 占位符文案: 「比如：最近感情很乱，不知道该怎么办」
  - 多行支持: 最多 3 行，超出滚动

**发送按钮样式**:
- 背景: `colors.brandBlue`
- 文字颜色: 白色
- 圆角: `radius.pill`
- 内边距: 左右 `spacing.lg`，上下 `spacing.sm`
- 高度: 约 `44dp`（与输入框同高）
- 字体大小: `fontSizes.sm`
- 字体粗细: `fontWeights.semibold`
- 左侧间距: `spacing.sm`
- 点击反馈: `activeOpacity: 0.8`
- 禁用状态:
  - 背景: `colors.disabledBg`
  - 文字颜色: `colors.disabledText`

**交互**:
- 输入框聚焦：
  - 边框颜色变为 `colors.brandBlue`
  - 键盘弹出
- 输入文本变化：
  - 实时更新状态
  - 当文本为空时，发送按钮禁用
- 点击发送按钮：
  - 校验：文本不能为空
  - 调用 `onStartChat` 回调，传递：
    - `topic`: `null`（由后端/LLM 识别意图）
    - `question`: 用户输入文本
    - `source`: `'free_input'`
  - 清空输入框
  - 收起键盘

---

### 4.3 底部导航

**说明**: 底部导航由底部导航组件统一管理，本页作为底部导航的一个 Tab，底部导航始终显示。

**当前 Tab 状态**:
- 「小佩」Tab 显示为激活状态
- 激活样式：
  - 文字颜色: `colors.ink`
  - 图标颜色: `colors.brandGreen`（小佩按钮背景色）
  - 顶部高亮条: `colors.brandGreen`

**行为**:
- 点击其他 Tab（排盤、檔案、我的）：
  - 切换到对应页面
  - 本页保持在导航栈中
- 点击「小佩」Tab：
  - 如果已在其他页面，返回本页
  - 如果已在本页，无操作

---

## 数据需求

### 5.1 命主信息

**数据来源**: 用户当前默认命主

**接口**: `GET /api/user/default-master` 或从用户信息中获取

**数据结构**:
```typescript
interface MasterInfo {
  masterId: string;
  name: string;
  relation: 'self' | 'partner' | 'child' | 'parent' | 'sibling' | 'friend' | 'other';
  relationLabel: string;
  birthDate: string;        // YYYY-MM-DD
  birthTime: string;        // HH:mm
  gender: 'male' | 'female';
  genderLabel: string;      // 乾造/坤造
  isDefault: boolean;
}
```

---

### 5.2 话题配置

**数据来源**: 前端配置（静态数据）

**数据结构**: 见 4.2.3 节「话题配置」

---

### 5.3 大家常问问题

**数据来源**: 前端配置（静态数据），后续可改为从后端获取

**数据结构**: 见 4.2.4 节「问题配置」

**后续扩展**:
- 根据用户历史提问，动态调整「大家常问」内容
- 根据当前命主的命盘特点，推荐相关问题
- 支持按话题切换「大家常问」列表

---

## 交互流程

### 6.1 页面加载流程

1. **用户进入页面**
   - 从底部导航点击「小佩」Tab
   - 或从其他页面返回

2. **数据加载**
   - 获取当前默认命主信息
   - 加载话题配置（静态数据）
   - 加载「大家常问」问题列表（静态数据，默认话题为 `'peach'`）

3. **页面渲染**
   - 显示命主信息卡片
   - 显示话题入口区（6 个话题按钮）
   - 显示「大家常问」区（默认话题的问题列表）
   - 显示自由输入区

---

### 6.2 话题按钮点击流程

1. **用户点击话题按钮**（如「桃花 · 恋爱」）
2. **获取话题配置**
   - 从 `TOPICS` 中获取该话题的配置
   - 获取 `defaultQuestion` 作为问题文本
3. **调用回调**
   - 调用 `onStartChat`，传递：
     - `topic`: `'peach'`
     - `question`: 「想从「桃花 · 恋爱」这个角度，先帮我整体看看好吗？」
     - `source`: `'topic_button'`
     - `masterId`: 当前命主 ID
4. **跳转聊天页**
   - 导航到聊天页（`Chat`）
   - 传递参数给聊天页

---

### 6.3 大家常问点击流程

1. **用户点击「大家常问」中的问题**（如「最近桃花运怎么样，会不会有新的暧昧？」）
2. **获取问题信息**
   - 问题文本 = 点击的问题文案
   - 话题 = `defaultTopic`（当前为 `'peach'`）
3. **调用回调**
   - 调用 `onStartChat`，传递：
     - `topic`: `'peach'`
     - `question`: 「最近桃花运怎么样，会不会有新的暧昧？」
     - `source`: `'common_question'`
     - `masterId`: 当前命主 ID
4. **跳转聊天页**
   - 导航到聊天页（`Chat`）
   - 传递参数给聊天页

---

### 6.4 自由输入发送流程

1. **用户输入问题**（如「最近感情很乱，不知道该怎么办」）
2. **用户点击「发送」按钮**
3. **校验输入**
   - 检查文本是否为空
   - 如果为空，不执行任何操作
4. **调用回调**
   - 调用 `onStartChat`，传递：
     - `topic`: `null`（由后端/LLM 识别意图）
     - `question`: 「最近感情很乱，不知道该怎么办」
     - `source`: `'free_input'`
     - `masterId`: 当前命主 ID
5. **跳转聊天页**
   - 导航到聊天页（`Chat`）
   - 传递参数给聊天页
6. **清空输入框**
   - 重置输入框状态
   - 收起键盘

---

### 6.5 切换命主流程（预留）

1. **用户点击「切换命主」按钮**
2. **显示命主选择列表**（弹窗或跳转页面）
3. **用户选择命主**
4. **更新当前命主**
   - 调用 API 设置新的默认命主
   - 更新命主信息卡片
   - 刷新页面数据（如果需要）

---

## 技术实现

### 7.1 组件结构

```
src/
  screens/
    XiaoPeiHome/
      index.tsx                    # 主组件
      XiaoPeiHomeScreen.tsx        # 页面组件
      components/
        CurrentMasterCard.tsx      # 命主信息卡片
        TopicButton.tsx            # 话题按钮
        CommonQuestions.tsx        # 大家常问组件
        FreeInput.tsx              # 自由输入组件
      hooks/
        useMasterInfo.ts           # 命主信息 Hook
        useStartChat.ts            # 开始聊天 Hook
      constants/
        topics.ts                  # 话题配置
        commonQuestions.ts         # 大家常问配置
      types.ts                     # 类型定义
```

---

### 7.2 组件接口

#### 7.2.1 主组件接口

```typescript
interface XiaoPeiHomeScreenProps {
  navigation: NavigationProp<RootStackParamList>;
  route: RouteProp<RootStackParamList, 'XiaoPeiHome'>;
}

interface StartChatPayload {
  topic: TopicKey | null;          // 入口话题，null 表示通用
  question: string;                // 用户问题原文
  source: 'topic_button' | 'common_question' | 'free_input';  // 入口来源
  masterId: string;                // 当前命主 ID
}
```

#### 7.2.2 回调接口

```typescript
type OnStartChat = (payload: StartChatPayload) => void;
```

**实现位置**: 在路由层或 App 层注入，负责：
1. 导航到聊天页（`Chat`）
2. 传递参数给聊天页
3. 埋点记录（可选）

---

### 7.3 路由配置

**路由名称**: `XiaoPeiHome`（驼峰命名，与现有文档一致）

**路由参数**:
```typescript
type RootStackParamList = {
  // ... 其他路由
  XiaoPeiHome: undefined;  // 无参数
  Chat: {
    topic?: TopicKey | null;
    question: string;
    source: 'topic_button' | 'common_question' | 'free_input';
    masterId: string;
  };
  // ... 其他路由
};
```

**导航示例**:
```typescript
// 在 XiaoPeiHomeScreen 中
const handleStartChat = (payload: StartChatPayload) => {
  navigation.navigate('Chat', {
    topic: payload.topic,
    question: payload.question,
    source: payload.source,
    masterId: payload.masterId,
  });
};
```

---

### 7.4 状态管理

**本地状态**:
- `currentMaster`: 当前命主信息
- `freeQuestion`: 自由输入框文本
- `isLoading`: 加载状态

**全局状态**（可选）:
- 如果需要在多个页面共享命主信息，可以使用 Zustand 或 Context

---

### 7.5 API 接口

#### 7.5.1 获取当前默认命主

**接口**: `GET /api/user/default-master`

**请求参数**: 无（从用户 token 中获取用户信息）

**响应**:
```typescript
interface GetDefaultMasterResponse {
  masterId: string;
  name: string;
  relation: 'self' | 'partner' | 'child' | 'parent' | 'sibling' | 'friend' | 'other';
  relationLabel: string;
  birthDate: string;
  birthTime: string;
  gender: 'male' | 'female';
  genderLabel: string;
  isDefault: boolean;
}
```

---

## 设计规范

### 8.1 遵循 UI 设计系统

本页面严格遵循 `UI_SPEC.md` 中定义的设计规范：

- **颜色**: 使用 `colors` Design Tokens
- **字体**: 使用 `typography` Design Tokens
- **间距**: 使用 `layout.spacing` Design Tokens
- **圆角**: 使用 `layout.radius` Design Tokens
- **阴影**: 使用 `layout.shadows` Design Tokens

---

### 8.2 响应式设计

- **小屏幕**（< 375px）: 适当减小内边距和字体大小
- **大屏幕**（> 414px）: 限制最大宽度，居中显示
- **横屏模式**: 调整布局，确保内容可读

---

### 8.3 无障碍支持

- **语义化标签**: 使用 `accessibilityLabel` 描述组件
- **焦点管理**: 输入框聚焦时，键盘正常弹出
- **屏幕阅读器**: 提供完整的文本描述

---

## 与聊天页的对接约定

### 9.1 参数传递

小佩主页通过路由参数将信息传递给聊天页：

```typescript
navigation.navigate('Chat', {
  topic: TopicKey | null,        // 话题 Key，null 表示通用
  question: string,              // 用户问题原文
  source: 'topic_button' | 'common_question' | 'free_input',  // 入口来源
  masterId: string,              // 当前命主 ID
});
```

---

### 9.2 聊天页接收参数

聊天页需要接收并处理这些参数：

```typescript
// 在 ChatScreen 中
useEffect(() => {
  const { topic, question, source, masterId } = route.params || {};
  
  if (question) {
    // 自动填充问题到输入框
    setInputText(question);
    
    // 可选：自动发送（根据产品需求）
    // handleSendMessage(question, { topic, source, masterId });
  }
}, [route.params]);
```

---

### 9.3 埋点记录（可选）

在 `onStartChat` 回调中，可以记录埋点：

```typescript
const handleStartChat = (payload: StartChatPayload) => {
  // 埋点：记录用户选择的入口
  analytics.track('xiaopei_home_start_chat', {
    topic: payload.topic,
    source: payload.source,
    masterId: payload.masterId,
  });
  
  // 导航到聊天页
  navigation.navigate('Chat', {
    topic: payload.topic,
    question: payload.question,
    source: payload.source,
    masterId: payload.masterId,
  });
};
```

---

## 后续扩展点（预留）

### 10.1 命主卡片扩展

- **接入真实命主数据**: 从 API 获取命主信息，支持多个命主
- **支持切换命主**: 实现命主选择弹窗或跳转页面
- **显示命主头像**: 支持自定义头像或使用默认头像

---

### 10.2 动态话题默认值

- **根据入口调整**: 如果用户从某个专题页进入，可以预设对应的话题
- **根据命盘特点**: 根据当前命主的命盘特点，推荐相关话题
- **个性化推荐**: 根据用户历史提问，推荐感兴趣的话题

---

### 10.3 大家常问优化

- **动态问题列表**: 从后端获取「大家常问」问题，支持按话题切换
- **个性化推荐**: 根据用户历史提问，推荐相关问题
- **热门问题**: 显示当前最热门的问题

---

### 10.4 埋点与统计

- **话题点击统计**: 记录哪个话题入口点击更多
- **问题选择统计**: 记录哪类问题被选择最多
- **输入行为统计**: 记录用户自由输入的问题类型
- **用于优化**: 根据统计数据优化「大家常问」文案和话题排序

---

### 10.5 A/B 试验

- **按钮文案试验**: 测试不同表述方式的按钮文案对点击率的影响
- **话题排序试验**: 测试不同话题排序对用户选择的影响
- **问题推荐试验**: 测试不同问题推荐策略对用户参与度的影响

---

## 与底部导航的关系

### 11.1 路由关系

**重要说明**: 本页面与底部导航设计文档的关系需要明确：

- **方案 A（推荐）**: 小佩主页作为底部导航的一个 Tab
  - 底部导航包含 4 个 Tab：排盤、檔案、**小佩**、我的
  - 点击「小佩」Tab 进入本页
  - 本页显示底部导航
  - 从本页点击话题/问题后，跳转到聊天页（全屏，不显示底部导航）

- **方案 B**: 小佩主页独立于底部导航
  - 底部导航中间「小佩」按钮直接跳转到聊天页（如底部导航设计文档所述）
  - 本页作为独立的意图选择页，通过其他入口进入

**当前文档采用方案 A**，如果采用方案 B，需要更新底部导航设计文档。

---

### 11.2 与聊天页的关系

- **小佩主页**: 意图选择页，负责收集用户意图
- **聊天页**: 对话页，负责 LLM 调用和多轮对话
- **关系**: 小佩主页 → 聊天页（单向跳转）

---

## 待确认事项

- [ ] 底部导航是否包含「小佩」Tab（方案 A）还是「小佩」按钮直接跳转聊天页（方案 B）
- [ ] 话题配置是否需要从后端获取
- [ ] 「大家常问」问题是否需要从后端获取
- [ ] 默认话题是否固定为「桃花 · 恋爱」
- [ ] 是否需要支持话题切换（在「大家常问」区切换不同话题的问题列表）
- [ ] 切换命主功能的实现方式（弹窗 or 跳转页面）
- [ ] 是否需要埋点记录
- [ ] 是否需要支持分享功能

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 完成小佩主页的完整设计
  - 包含页面结构、交互流程、技术实现等全部内容
  - 明确与底部导航和聊天页的关系
- **维护者**: 开发团队


# 出生信息輸入 - 手動排盤页面设计文档

## 页面概述

### 页面名称
手動排盤 · 填写出生信息 / Manual Bazi - Birth Info Input

### 页面定位
- **页面类型**: 表单填写/信息收集页面
- **用户类型**: 习惯手动填写的用户
- **页面层级**: 从首页「方式二」进入
- **访问条件**: 用户点击首页「進入手動排盤」按钮

### 页面目的
给习惯自己填写的用户使用，信息更精确。必须收集 6 个核心字段：**年、月、日、時間、性別、曆法（公曆 / 農曆）**。支持進階選項：**出生城市、真太陽時、案例名稱、與命主的關係、分析主題**。填寫完成後，點擊「開始排盤」，生成八字命盤並進入對應主題的分析。

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 必填字段收集
- 性别选择（男/女）
- 曆法选择（公曆/農曆）
- 出生日期选择（年、月、日）
- 出生时间选择（时、分）

#### 2.1.2 可选字段收集
- 出生城市选择
- 真太陽時显示（自动计算）
- 案例名称输入
- 关系选择
- 分析主题选择

#### 2.1.3 表单验证
- 必填字段完整性验证
- 按钮启用/禁用状态控制
- 提交前二次验证

#### 2.1.4 数据提交
- 收集所有字段数据
- 提交到后端进行排盘
- 跳转到分析结果页面

---

## 页面设计

### 3.1 整体布局

页面采用表单布局，从上到下依次包含：

1. 顶部栏（固定）
2. 区块一：基本出生信息（必填）- 卡片
3. 区块二：更多选项（可选）- 折叠卡片
4. 区块三：选择分析主题 - 卡片
5. 区块四：主行为按钮 - 底部固定

整体背景为纯白色，内容区域支持垂直滚动。

---

### 3.2 详细模块设计

#### 3.2.1 顶部栏

**位置**: 页面最顶部（固定）

**样式**:
- 背景: `colors.bg`（白色）
- 高度: 约 56px
- 底部边框: `colors.border`（1px 细线）

**内容**:
- **返回按钮**（左侧）
  - 图标: 左箭头
  - 点击行为: 返回上一页
  - 尺寸: 44x44px（最小可点击区域）

- **标题**（居中）
  - 文案: 「手動排盤 · 填寫出生信息」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`

- **副标题**（标题下方）
  - 文案: 「適合習慣自己填寫的用戶，信息會更精確。」
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.regular`
  - 文字颜色: `colors.textSecondary`

- **说明文字**（副标题下方，可选）
  - 文案: 「八字排盤 · 專業版（支持公曆 / 農曆、真太陽時等進階選項）」
  - 字体大小: `fontSizes.xs`
  - 字体粗细: `fontWeights.regular`
  - 文字颜色: `colors.textSecondary`
  - 对齐方式: 居中
  - 顶部间距: `spacing.xs`

**布局**:
- 返回按钮左侧留白: `spacing.md`
- 标题和副标题垂直居中
- 副标题与标题间距: `spacing.xs`
- 说明文字与副标题间距: `spacing.xs`

---

#### 3.2.2 区块一：基本出生信息（必填）

**位置**: 顶部栏下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 边框: `colors.border`（细线）
- 阴影: `shadows.card`
- 内边距: `spacing.lg`
- 上下间距: `spacing.lg`
- 左右内边距: `spacing.lg`

**标题**:
- 文案: 「基本出生信息（必填）」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.md`
- 对齐方式: 左对齐

**内容结构**:

##### 3.2.2.1 性别选择

**标签**:
- 文案: 「性別」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**选项 Chip**:
- 包含 2 个选项：`男`、`女`（二选一，必选）
- Chip 样式:
  - **选中状态**:
    - 背景: `colors.brandBlue`
    - 文字颜色: 白色
    - 边框: 无
  - **未选中状态**:
    - 背景: `colors.bg` 或 `colors.disabledBg`
    - 文字颜色: `colors.ink`
    - 边框: `colors.border`（1px）
  - 圆角: `radius.pill`
  - 内边距: 左右 `spacing.md`，上下 `spacing.sm`
  - 字体大小: `fontSizes.base`
  - Chip 之间间距: `spacing.sm`
  - 水平排列

**交互**:
- 点击切换高亮
- 内部映射到 `gender: "male" | "female"`
- `男` → `"male"`，`女` → `"female"`

**布局**:
- 标签和选项之间间距: `spacing.sm`
- 底部间距: `spacing.lg`

##### 3.2.2.2 曆法选择

**标签**:
- 文案: 「曆法」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**选项 Chip**:
- 包含 2 个选项：`公曆`、`農曆`（二选一，必选）
- Chip 样式: 与性别选择相同
- **选中状态**: `colors.brandBlue` 背景，白色文字
- **未选中状态**: 白色背景，`colors.border` 边框，`colors.ink` 文字

**交互**:
- 点击切换高亮
- 内部映射到 `calendar_type: "solar" | "lunar"`
- `公曆` → `"solar"`，`農曆` → `"lunar"`
- 切换时不改变已选日期，只改变解读方式（具体换算在后端处理）

**布局**:
- 标签和选项之间间距: `spacing.sm`
- 底部间距: `spacing.lg`

##### 3.2.2.3 出生日期 & 时间选择

**标签**:
- 文案: 「出生日期 & 時間」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**输入框样式**:
- 背景: `colors.cardBg`（白色）
- 边框: `colors.border`，圆角 `radius.md`
- 聚焦时边框色: `colors.brandBlue`
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- 高度: 约 44px
- 只读状态: 用户不能直接打字，只能点击弹出选择器

**输入框内容**:

1. **出生日期输入框**:
   - 标签: 「出生日期：」
   - 显示格式: `1995 年 01 月 31 日`
   - 未选择时显示: `請選擇出生日期`
   - 占位文字颜色: `colors.textSecondary`
   - 已选择文字颜色: `colors.ink`
   - 字体大小: `fontSizes.base`
   - 底部间距: `spacing.md`

2. **出生時間输入框**:
   - 标签: 「出生時間：」
   - 显示格式: `12:00`
   - 未选择时显示: `請選擇出生時間`
   - 占位文字颜色: `colors.textSecondary`
   - 已选择文字颜色: `colors.ink`
   - 字体大小: `fontSizes.base`

**日期+时间选择交互（Bottom Sheet）**:

**触发方式**:
- 用户点击「出生日期」或「出生時間」任一输入框
- 从底部弹出 Bottom Sheet 型选择面板

**面板样式**:
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`（16px）
- 最大高度: 屏幕高度的 60%
- 内边距: `spacing.lg`

**面板内容**:

1. **顶部说明**:
   - 文案: 「請選擇出生日期和時間（曆法：公曆/農曆）」
   - `公曆/農曆` 动态显示为当前 `calendar_type`
   - 字体大小: `fontSizes.base`
   - 字体粗细: `fontWeights.medium`
   - 文字颜色: `colors.ink`
   - 底部间距: `spacing.md`
   - 对齐方式: 居中

2. **日期选择区域**（上半部）:
   - 三个滚轮或系统 DatePicker：年 / 月 / 日
   - 年份范围: 1900 - 当前年份
   - 月份: 1-12
   - 日期: 根据年月动态调整（1-28/29/30/31）
   - 字体大小: `fontSizes.base`
   - 选中项颜色: `colors.brandBlue`

3. **时间选择区域**（下半部）:
   - 两个滚轮：小时 (0–23)、分钟
   - 分钟建议只允许 `00` / `30`
   - 字体大小: `fontSizes.base`
   - 选中项颜色: `colors.brandBlue`
   - 顶部间距: `spacing.lg`

4. **操作按钮区域**:
   - 水平排列，底部固定
   - **取消按钮**（左侧）:
     - 文案: 「取消」
     - 文字颜色: `colors.textSecondary`
     - 字体大小: `fontSizes.base`
     - 点击行为: 关闭面板，不修改现有值
   
   - **完成按钮**（右侧）:
     - 文案: 「完成」
     - 按钮类型: `PrimaryButton`
     - 背景: `colors.brandBlue`
     - 文字颜色: 白色
     - 圆角: `radius.lg`
     - 高度: 48px
     - 点击行为: 关闭面板，将选择结果同时回填到两个输入框

**数据保存**:
- `birth_year`: 选择的年份
- `birth_month`: 选择的月份
- `birth_day`: 选择的日期
- `birth_time`: 选择的时间（格式: `"HH:mm"`）

**验证规则**:
- 只有当年、月、日、时间都选过之后，这 4 个字段才视为「已填写」

**布局**:
- 日期和时间输入框之间间距: `spacing.md`
- 整体底部间距: `spacing.lg`

---

#### 3.2.3 区块二：更多选项（可选）

**位置**: 区块一下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 边框: `colors.border`（细线）
- 阴影: `shadows.card`
- 内边距: `spacing.lg`
- 上下间距: `spacing.lg`
- 左右内边距: `spacing.lg`
- **折叠功能**: 支持折叠/展开（默认打开或半折叠均可）

**标题**:
- 文案: 「更多選項（可選）」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 右侧显示折叠/展开图标
- 底部间距: `spacing.md`（展开时）

**内容结构**:

##### 3.2.3.1 出生城市

**标签**:
- 文案: 「出生城市」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**输入框**:
- 背景: `colors.cardBg`（白色）
- 边框: `colors.border`，圆角 `radius.md`
- 聚焦时边框色: `colors.brandBlue`
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- 高度: 约 44px
- 右侧显示搜索图标
- 占位文案: 「選擇出生城市（用於計算真太陽時，可不填）」
- 占位文字颜色: `colors.textSecondary`
- 输入文字颜色: `colors.ink`
- 字体大小: `fontSizes.base`

**交互**:
- 点击输入框 → 跳转或弹出城市搜索面板（列表 / 搜索框皆可）
- 选中后回填城市名
- 保存 `birth_city_name` + `birth_city_id`

**布局**:
- 底部间距: `spacing.lg`

##### 3.2.3.2 真太陽時

**标签**:
- 文案: 「真太陽時」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**显示规则**:

**已计算状态**（当「年月日 + 时间 + 城市」已齐全且后端已计算）:
- 显示格式: `1995-01-31 12:00:00`
- 文字颜色: `colors.ink`
- 字体大小: `fontSizes.base`
- 右侧显示小开关或刷新图标
- 开关开启状态说明: 「根據城市自動換算真太陽時」
- 说明文字颜色: `colors.textSecondary`
- 字体大小: `fontSizes.sm`

**未计算状态**（当条件不齐全或未计算）:
- 显示文案: 「填寫上面的日期、時間和城市後，我會自動換算真太陽時」
- 文字颜色: `colors.textSecondary`
- 字体大小: `fontSizes.sm`
- 字体样式: 斜体（可选）

**交互**:
- 前端只展示，不允许手动修改
- 值来源于后端计算
- 当城市、日期、时间都填写后，自动触发后端计算

**布局**:
- 底部间距: `spacing.lg`

##### 3.2.3.3 案例名称

**标签**:
- 文案: 「案例名稱」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**输入框**:
- 背景: `colors.cardBg`（白色）
- 边框: `colors.border`，圆角 `radius.md`
- 聚焦时边框色: `colors.brandBlue`
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- 高度: 约 44px
- 默认值: `命主`
- 输入文字颜色: `colors.ink`
- 字体大小: `fontSizes.base`

**交互**:
- 用户可改为：`自己名字`、`女兒` 等
- 只是便于后续列表显示
- 保存到 `case_name` 字段

**布局**:
- 底部间距: `spacing.lg`

##### 3.2.3.4 关系

**标签**:
- 文案: 「關係」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.sm`

**选项 Chip**:
- 包含 5 个选项：`本人`、`伴侶`、`家人`、`朋友`、`其他`
- Chip 样式: 与性别选择相同
- **选中状态**: `colors.brandBlue` 背景，白色文字
- **未选中状态**: 白色背景，`colors.border` 边框，`colors.ink` 文字
- 默认选中: `本人`

**映射关系**:
- `本人` → `"self"`
- `伴侶` → `"partner"`
- `家人` → `"family"`
- `朋友` → `"friend"`
- `其他` → `"other"`

**布局**:
- Chip 之间间距: `spacing.sm`
- 水平排列，可换行
- 底部间距: `spacing.lg`（最后一个字段）

---

#### 3.2.4 区块三：选择分析主题

**位置**: 区块二下方

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 边框: `colors.border`（细线）
- 阴影: `shadows.card`
- 内边距: `spacing.lg`
- 上下间距: `spacing.lg`
- 左右内边距: `spacing.lg`

**标题**:
- 文案: 「想先讓小佩幫你看哪一個方向？」
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.md`
- 对齐方式: 左对齐

**主题卡片区域**:
- 4 个横向卡片（两行布局，每行 2 个）
- 卡片之间间距: `spacing.md`
- 卡片样式:
  - 背景: `colors.cardBg`（白色）
  - 边框: `colors.border`（1px）
  - 圆角: `radius.lg`
  - 内边距: `spacing.md`
  - 最小高度: 约 100px
  - **选中状态**:
    - 边框: `colors.brandBlue`（2px，加粗）
    - 背景: `colors.blueSoftBg`（浅蓝色背景）
  - **未选中状态**:
    - 边框: `colors.border`（1px）
    - 背景: `colors.cardBg`（白色）

**主题卡片内容**:

1. **整體運勢**:
   - Icon: 主题相关图标（可选）
   - 主标题: 「整體運勢」
     - 字体大小: `fontSizes.base`
     - 字体粗细: `fontWeights.semibold`
     - 文字颜色: `colors.ink`
   - 副标题: 「先大致看看這一生的節奏」
     - 字体大小: `fontSizes.sm`
     - 字体粗细: `fontWeights.regular`
     - 文字颜色: `colors.textSecondary`
   - topic 值: `"general"`
   - 默认选中: ✅

2. **財運 & 工作**:
   - Icon: 主题相关图标（可选）
   - 主标题: 「財運 & 工作」
   - 副标题: 「錢、事業和機會怎麼走」
   - topic 值: `"wealth"`

3. **婚姻 & 伴侶**:
   - Icon: 主题相关图标（可选）
   - 主标题: 「婚姻 & 伴侶」
   - 副标题: 「正緣、婚後相處和感情節奏」
   - topic 值: `"marriage"`

4. **桃花 & 人緣**:
   - Icon: 主题相关图标（可选）
   - 主标题: 「桃花 & 人緣」
   - 副标题: 「桃花指數、人氣與可能的爛桃花」
   - topic 值: `"romance"`

**交互**:
- 点击卡片后，高亮表示选中
- 预设选中「整體運勢」
- 只能选择一个主题

**布局**:
- 卡片采用 Grid 布局，2 列
- 卡片内部垂直排列：Icon（可选）→ 主标题 → 副标题
- Icon 和标题之间间距: `spacing.sm`
- 主标题和副标题之间间距: `spacing.xs`

---

#### 3.2.5 区块四：主行为按钮

**位置**: 页面最底部（固定或跟随内容）

**样式**:
- 背景: `colors.bg`（白色）
- 顶部边框: `colors.border`（1px 细线，可选）
- 内边距: 上下 `spacing.lg`，左右 `spacing.lg`
- 使用 `SafeAreaView` 处理底部安全区域

**按钮样式**:

**启用状态**:
- 按钮类型: `PrimaryButton`
- 背景: `colors.brandBlue`
- 文字颜色: 白色
- 圆角: `radius.lg`
- 高度: 48px
- 宽度: 100%（填满容器宽度）
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 点击行为: `handleStartBazi()`

**禁用状态**:
- 背景: `colors.disabledBg`
- 文字颜色: `colors.disabledText`
- 禁止点击

**按钮文案**:
- 主文案: 「開始排盤」
- 可选小字（按钮上方）:
  - 文案: 「本次優先解讀：財運 & 工作」（根据选中的主题动态显示）
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.regular`
  - 文字颜色: `colors.textSecondary`
  - 对齐方式: 居中
  - 底部间距: `spacing.xs`

**布局**:
- 按钮水平居中
- 小字（如有）与按钮之间间距: `spacing.xs`

---

### 3.3 整体风格要求

#### 3.3.1 背景与布局
- **整体背景**: 纯白色（`colors.bg`）
- **内容区域**: 使用 `ScrollView` 包裹，支持垂直滚动
- **安全区域**: 使用 `SafeAreaView` 包裹，避免底部遮挡
- **页面内边距**: 左右 `spacing.lg`

#### 3.3.2 卡片样式
- **背景**: 白色（`colors.cardBg`）
- **圆角**: `radius.lg`（12px）
- **边框**: `colors.border`（细线，1px）
- **阴影**: `shadows.card`（轻微阴影）
- **内边距**: `spacing.lg`（24px）
- **卡片间距**: `spacing.lg`（24px）

#### 3.3.3 输入框样式
- **背景**: `colors.cardBg`（白色）
- **边框**: `colors.border`，圆角 `radius.md`
- **聚焦时边框色**: `colors.brandBlue`
- **占位文字颜色**: `colors.textSecondary`
- **输入文字颜色**: `colors.ink`

#### 3.3.4 Chip 样式
- **选中状态**: `colors.brandBlue` 背景，白色文字
- **未选中状态**: 白色背景，`colors.border` 边框，`colors.ink` 文字
- **圆角**: `radius.pill`（9999px）
- **内边距**: 左右 `spacing.md`，上下 `spacing.sm`

#### 3.3.5 文字颜色
- **主文字**: `colors.ink`（#32343a）
- **次要文字**: `colors.textSecondary`（#6b7280）
- **标签文字**: `colors.ink`，`fontWeights.medium`

#### 3.3.6 按钮样式
- **主按钮**（启用）: `colors.brandBlue` 背景，白色文字
- **主按钮**（禁用）: `colors.disabledBg` 背景，`colors.disabledText` 文字

---

## 数据需求

### 4.1 字段定义

#### 4.1.1 必填字段

1. **`gender`**: `"male" | "female"`
   - 来源: 性别选择 Chip
   - 验证: 必须选择

2. **`calendar_type`**: `"solar" | "lunar"`
   - 来源: 曆法选择 Chip
   - 验证: 必须选择
   - 说明: 公曆 / 農曆

3. **`birth_year`**: number (YYYY)
   - 来源: 日期选择器
   - 验证: 必须选择，范围 1900 - 当前年份

4. **`birth_month`**: number (1–12)
   - 来源: 日期选择器
   - 验证: 必须选择

5. **`birth_day`**: number (1–31)
   - 来源: 日期选择器
   - 验证: 必须选择，根据年月动态调整范围

6. **`birth_time`**: string, `"HH:mm"` 24 小时制
   - 来源: 时间选择器
   - 验证: 必须选择
   - 格式: `"12:00"`、`"08:30"`

#### 4.1.2 可选字段

1. **`birth_city_name`**: string
   - 来源: 城市选择输入框
   - 默认值: `null`

2. **`birth_city_id`**: string | null
   - 来源: 城市选择（匹配城市库）
   - 默认值: `null`

3. **`true_solar_time`**: string `"YYYY-MM-DD HH:mm:ss"` | null
   - 来源: 后端自动计算
   - 默认值: `null`
   - 说明: 真太陽時，若未计算可为 null

4. **`case_name`**: string
   - 来源: 案例名称输入框
   - 默认值: `"命主"`

5. **`relationship`**: `"self" | "partner" | "family" | "friend" | "other"`
   - 来源: 关系选择 Chip
   - 默认值: `"self"`

6. **`topic`**: `"general" | "wealth" | "marriage" | "romance"`
   - 来源: 分析主题选择卡片
   - 默认值: `"general"`

---

### 4.2 数据提交

#### 4.2.1 提交 Payload 示例

```json
{
  "gender": "female",
  "calendar_type": "solar",
  "birth_year": 1995,
  "birth_month": 1,
  "birth_day": 31,
  "birth_time": "12:00",
  "birth_city_name": "廣州",
  "birth_city_id": "CITY_XXX",
  "true_solar_time": "1995-01-31 11:47:00",
  "case_name": "命主",
  "relationship": "self",
  "topic": "wealth"
}
```

#### 4.2.2 数据验证规则

**必填字段验证**:
- `gender`: 必须为 `"male"` 或 `"female"`
- `calendar_type`: 必须为 `"solar"` 或 `"lunar"`
- `birth_year`: 必须为数字，范围 1900 - 当前年份
- `birth_month`: 必须为数字，范围 1-12
- `birth_day`: 必须为数字，范围根据年月动态调整
- `birth_time`: 必须为字符串，格式 `"HH:mm"`

**可选字段默认值**:
- `case_name`: 如果为空，默认为 `"命主"`
- `relationship`: 如果未选择，默认为 `"self"`
- `topic`: 如果未选择，默认为 `"general"`

---

## 校验与状态

### 5.1 按钮启用条件

#### 5.1.1 启用规则
只有当下述字段都已填写时，主按钮才可点击：

- ✅ `gender`（性别）
- ✅ `calendar_type`（曆法）
- ✅ `birth_year`（出生年份）
- ✅ `birth_month`（出生月份）
- ✅ `birth_day`（出生日期）
- ✅ `birth_time`（出生时间）

#### 5.1.2 按钮状态

**启用状态**:
- 背景: `colors.brandBlue`
- 文字颜色: 白色
- 可点击

**禁用状态**:
- 背景: `colors.disabledBg`
- 文字颜色: `colors.disabledText`
- 禁止点击
- 视觉上明显区别于启用状态

---

### 5.2 提交校验

#### 5.2.1 提交前校验
点击「開始排盤」时进行二次校验：

**必填字段不完整**（理论上按钮已禁用，不会触发；双重保险）:
- 显示 Toast 提示: 「請先填寫完整的性別、曆法、出生日期和時間。」
- Toast 样式:
  - 背景: `colors.error` 或深色半透明背景
  - 文字颜色: 白色
  - 圆角: `radius.md`
  - 内边距: `spacing.md`
  - 持续时间: 2-3 秒

**可选字段处理**:
- `topic` 若未选，默认设为 `"general"`
- 其他可选字段允许为空

#### 5.2.2 提交成功
- 显示加载状态（可选）
- 提交数据到后端
- 跳转到排盘结果/分析页面

#### 5.2.3 提交失败
- 显示错误提示 Toast
- 保持当前页面，允许用户修改后重试

---

## 交互流程

### 6.1 用户操作流程

1. **进入页面**
   - 从首页「方式二」点击「進入手動排盤」进入
   - 显示所有表单区块

2. **填写必填字段**
   - 选择性别（男/女）
   - 选择曆法（公曆/農曆）
   - 点击日期/时间输入框，弹出选择器
   - 选择出生日期和时间
   - 点击「完成」确认

3. **填写可选字段**（可选）
   - 展开「更多选项」区块
   - 选择出生城市（可选）
   - 查看真太陽時（自动计算）
   - 修改案例名称（可选）
   - 选择关系（默认「本人」）

4. **选择分析主题**
   - 查看 4 个主题卡片
   - 点击选择感兴趣的主题（默认「整體運勢」）

5. **提交表单**
   - 所有必填字段填写完成后，按钮变为可点击状态
   - 点击「開始排盤」按钮
   - 系统校验并提交数据
   - 跳转到分析结果页面

### 6.2 交互细节

#### 6.2.1 日期时间选择
- 点击任一输入框弹出 Bottom Sheet
- 在面板中同时选择日期和时间
- 点击「完成」后同时更新两个输入框
- 点击「取消」不修改现有值

#### 6.2.2 Chip 选择
- 点击 Chip 切换选中状态
- 选中状态有明显的视觉反馈
- 性别和曆法为单选（二选一）
- 关系为单选（五选一）

#### 6.2.3 主题卡片选择
- 点击卡片切换选中状态
- 选中状态有边框高亮和背景色变化
- 只能选择一个主题
- 默认选中「整體運勢」

#### 6.2.4 折叠卡片
- 点击标题区域折叠/展开
- 折叠时隐藏内容，只显示标题
- 展开时显示所有内容

---

## 技术实现（预留）

### 7.1 技术要点

- 表单状态管理（React Hook Form 或自定义）
- 日期时间选择器实现（Bottom Sheet + Picker）
- 城市搜索和选择功能
- 真太陽時自动计算（后端 API）
- 表单验证逻辑
- 按钮启用/禁用状态控制
- 数据提交和错误处理

### 7.2 相关文件结构

```
src/
├── screens/
│   └── ManualBazi/
│       ├── ManualBaziScreen.tsx           # 主页面组件
│       ├── ManualBaziScreen.styles.ts     # 页面样式
│       └── components/
│           ├── BasicInfoCard.tsx          # 基本出生信息卡片
│           ├── AdvancedOptionsCard.tsx    # 更多选项卡片
│           ├── TopicSelectionCard.tsx     # 分析主题选择卡片
│           ├── DateTimePicker.tsx         # 日期时间选择器组件
│           ├── CitySelector.tsx           # 城市选择组件
│           └── SelectionChip.tsx          # 选择 Chip 组件
├── services/
│   └── api/
│       ├── baziService.ts                 # 排盘 API
│       └── cityService.ts                 # 城市搜索 API
└── types/
    └── birthInfo.ts                       # 出生信息类型定义
```

### 7.3 API 接口设计（预留）

```typescript
// 计算真太陽時接口
interface CalculateTrueSolarTimeRequest {
  birth_year: number;
  birth_month: number;
  birth_day: number;
  birth_time: string; // HH:mm
  birth_city_id: string;
}

interface CalculateTrueSolarTimeResponse {
  true_solar_time: string; // YYYY-MM-DD HH:mm:ss
}

// 提交排盘接口
interface SubmitBaziRequest {
  gender: "male" | "female";
  calendar_type: "solar" | "lunar";
  birth_year: number;
  birth_month: number;
  birth_day: number;
  birth_time: string;
  birth_city_name?: string;
  birth_city_id?: string;
  true_solar_time?: string;
  case_name?: string;
  relationship?: "self" | "partner" | "family" | "friend" | "other";
  topic?: "general" | "wealth" | "marriage" | "romance";
}
```

---

## 设计规范

### 8.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 卡片使用圆角、边框、阴影区分层级
- 保持充足的留白

### 8.2 交互设计

- 表单输入有明确的聚焦状态
- Chip 选择有视觉反馈
- 按钮点击有反馈动画
- 页面滚动流畅
- 折叠卡片有平滑的展开/收起动画

### 8.3 响应式设计

- 适配不同屏幕尺寸
- 内容在小屏设备上可正常滚动
- 保持按钮和输入框的最小可点击区域（44x44px）
- 主题卡片在小屏上可考虑单列布局

---

## 待确认事项

- [x] 页面布局和模块设计（已确认）
- [x] 必填字段和可选字段定义（已确认）
- [x] 日期时间选择交互方式（已确认）
- [x] 按钮启用条件（已确认）
- [ ] Bottom Sheet 选择器的具体实现方式（原生 Picker 或自定义）
- [ ] 城市搜索面板的具体设计
- [ ] 真太陽時计算的触发时机（实时计算或提交时计算）
- [ ] 主题卡片的 Icon 设计
- [ ] 是否需要保存草稿功能
- [ ] 是否需要表单数据本地缓存

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **维护者**: 开发团队


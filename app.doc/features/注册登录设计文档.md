# 注册/登录设计文档

## 页面概述

### 页面名称
登录 / 注册 / Auth / Login & Register

### 页面定位
- **页面类型**: 认证页面
- **用户类型**: 所有用户（新用户和现有用户）
- **页面层级**: 应用入口页面
- **访问条件**: 用户未登录时显示

### 页面目的
提供统一的登录和注册入口，支持手机号和邮箱两种登录方式，支持验证码和密码两种验证方式。**登录和注册共用同一页面和同一套逻辑**，首次登录即自动注册。

### 核心原则
- **用户心智上**：区分「登录」「注册」
- **系统实现上**：都是同一个接口、同一套验证逻辑，手机号/邮箱首次登录即自动注册
- **页面策略**：登录和注册共用一个页面 / 一个组件树，首次登录、二次登录都是同一页面

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 登录方式
- 手机号登录（国内版默认）
- 邮箱登录（海外版默认）
- 支持验证码和密码两种验证方式

#### 2.1.2 注册功能
- 首次登录即自动注册
- 显式的「注册新账号」入口
- 注册提示和引导

#### 2.1.3 忘记密码
- 显式的「忘记密码」入口
- 重置密码流程

#### 2.1.4 第三方登录
- 国内版：微信、支付宝
- 海外版：Google 登录

#### 2.1.5 多语言支持
- 国内版：简体中文（zh-CN）
- 海外版：繁体中文（zh-HK）
- 语言由 app_region 决定，不可手动切换

---

## 版本与语言绑定

### 3.1 app_region 设置

**规则**:
- 中国大陆商店 → `app_region = 'CN'`
- 香港 / 其他地区商店 → `app_region = 'HK'`

**语言绑定**:
- `app_region = 'CN'` → 简体中文（zh-CN）
- `app_region = 'HK'` → 繁体中文（zh-HK）

**实现方式**:
```typescript
// 伪代码
const app_region: 'CN' | 'HK' = getRegionFromChannel(); 
const locale = app_region === 'CN' ? 'zh-CN' : 'zh-HK';
```

**限制**:
- 不提供用户手动切换地区
- 不提供语言切换，只读

**关于页面显示**:
- 国内版：当前版本：小佩 · 中国大陆版（简体）
- 海外版：目前版本：小佩・香港/海外版（繁体）

---

## 页面设计

### 4.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色。从上到下依次包含：

1. 顶部品牌区
2. 登录方式 Tabs
3. 表单区域
4. 辅助操作区
5. 第三方登录区
6. 协议区

---

### 4.2 详细区块设计

#### 4.2.1 顶部品牌区

**位置**: 页面最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 顶部 `spacing['2xl']`，左右 `spacing.lg`
- 底部间距: `spacing.xl`

**内容**:

1. **Logo**:
   - 使用官方 Logo
   - 尺寸: 80x80px（或根据设计调整）
   - 居中显示
   - 底部间距: `spacing.md`

2. **标题**:
   - 国内版（CN）: 「欢迎来到小佩」
   - 海外版（HK）: 「歡迎來到小佩」
   - 字体大小: `fontSizes['3xl']`
   - 字体粗细: `fontWeights.bold`
   - 文字颜色: `colors.ink`
   - 居中显示
   - 底部间距: `spacing.xs`

3. **副标题**:
   - 国内版（CN）: 「用命理，帮你看清当下和未来」
   - 海外版（HK）: 「用命理，幫你看清當下和未來」
   - 字体大小: `fontSizes.base`
   - 字体粗细: `fontWeights.regular`
   - 文字颜色: `colors.textSecondary`
   - 居中显示
   - 行高: `lineHeights.normal`

---

#### 4.2.2 登录方式 Tabs

**位置**: 顶部品牌区下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 底部间距: `spacing.lg`

**Tab 配置**:

**国内版（CN）**:
- Tab 1: 「手机号登录」（默认选中）
- Tab 2: 「邮箱登录」

**海外版（HK）**:
- Tab 1: 「電郵登入」（默认选中）
- Tab 2: 「手機號登入」

**Tab 样式**:
- 使用品牌色下划线或胶囊样式（遵循 UI_SPEC.md）
- 选中 Tab:
  - 文字颜色: `colors.brandBlue`
  - 底部高亮条: `colors.brandBlue`，高度 2px
- 未选中 Tab:
  - 文字颜色: `colors.textSecondary`
- Tab 之间间距: `spacing.md`
- Tab 高度: 48px
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.medium`

---

#### 4.2.3 表单区域

**位置**: 登录方式 Tabs 下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 上下间距: `spacing.lg`

**表单内容**（根据 Tab 和验证方式动态变化）:

**国内版 - 手机号登录 - 验证码模式（默认）**:

```
┌─────────────────────────────────────────┐
│  +86  [请输入手机号]                    │
│                                         │
│  [请输入短信验证码]  [获取验证码]      │
│                                         │
│  [使用密码登录]                         │
│                                         │
│  [登录 / 注册]                          │
└─────────────────────────────────────────┘
```

**输入框 1：手机号**:
- 左侧: 固定区号「+86」
  - 字体大小: `fontSizes.base`
  - 文字颜色: `colors.ink`
  - 宽度: 48px
- 右侧: 手机号输入框
  - Placeholder: 「请输入手机号」
  - 字体大小: `fontSizes.base`
  - 文字颜色: `colors.ink`
  - 键盘类型: 数字键盘
  - 最大长度: 11 位
  - 底部间距: `spacing.md`

**输入框 2：验证码**:
- 左侧: 验证码输入框
  - Placeholder: 「请输入短信验证码」
  - 字体大小: `fontSizes.base`
  - 文字颜色: `colors.ink`
  - 键盘类型: 数字键盘
  - 最大长度: 6 位
- 右侧: 「获取验证码」按钮
  - 按钮类型: `GhostButton`（文字按钮）
  - 文字颜色: `colors.brandBlue`
  - 字体大小: `fontSizes.sm`
  - 倒计时状态: 显示「60s后重发」，文字颜色 `colors.textSecondary`，按钮禁用
  - 底部间距: `spacing.sm`

**切换链接**:
- 文案: 「使用密码登录」
- 按钮类型: `GhostButton`（文字按钮）
- 文字颜色: `colors.brandBlue`
- 字体大小: `fontSizes.sm`
- 对齐方式: 右对齐
- 底部间距: `spacing.md`

**主按钮**:
- 文案: 「登录 / 注册」
- 按钮类型: `PrimaryButton`
- 背景色: `colors.brandBlue`
- 文字颜色: 白色
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 圆角: `radius.md`
- 高度: 48px
- 宽度: 100%
- 底部间距: `spacing.md`

**国内版 - 手机号登录 - 密码模式**:

```
┌─────────────────────────────────────────┐
│  [请输入手机号]                         │
│                                         │
│  [请输入密码]  [👁]                    │
│                                         │
│  [使用验证码登录]                       │
│                                         │
│  [登录]                                 │
└─────────────────────────────────────────┘
```

**输入框 1：手机号**:
- Placeholder: 「请输入手机号」
- 其他样式同上

**输入框 2：密码**:
- Placeholder: 「请输入密码」
- 字体大小: `fontSizes.base`
- 文字颜色: `colors.ink`
- 键盘类型: 默认键盘
- 右侧: 显示/隐藏密码图标（👁）
  - 点击切换密码可见性
  - 图标颜色: `colors.textSecondary`
- 底部间距: `spacing.sm`

**切换链接**:
- 文案: 「使用验证码登录」
- 其他样式同上

**主按钮**:
- 文案: 「登录」
- 其他样式同上

**国内版 - 邮箱登录**:
- 输入框 1: 邮箱输入框
  - Placeholder: 「请输入邮箱」
  - 键盘类型: 邮箱键盘
- 其余逻辑同手机号登录

**海外版 - 电邮登入（默认）**:

```
┌─────────────────────────────────────────┐
│  [請輸入電郵地址]                       │
│                                         │
│  [請輸入驗證碼]  [發送驗證碼]          │
│                                         │
│  [使用密碼登入]                         │
│                                         │
│  [登入 / 註冊]                          │
└─────────────────────────────────────────┘
```

**输入框样式**:
- Placeholder 使用繁体中文
- 其余样式同国内版

**海外版 - 手機號登入**:

```
┌─────────────────────────────────────────┐
│  [🇭🇰 +852 ▼]  [請輸入手機號]         │
│                                         │
│  [請輸入驗證碼]  [發送驗證碼]          │
│                                         │
│  [使用密碼登入]                         │
│                                         │
│  [登入 / 註冊]                          │
└─────────────────────────────────────────┘
```

**输入框 1：手机号（国际区号）**:
- 左侧: 区号选择器
  - 显示: 国旗图标 + 区号（如「+852」）
  - 右侧下拉箭头
  - 点击弹出区号选择器（Modal 或 Bottom Sheet）
  - 宽度: 约 100px
- 右侧: 手机号输入框
  - Placeholder: 「請輸入手機號」
  - 其他样式同上

**区号选择器**:
- 显示方式: Bottom Sheet 或 Modal
- 列表项: 国旗图标 + 国家/地区名称 + 区号
- 搜索功能: 支持搜索国家/地区名称
- 常用区号置顶: +852（香港）、+886（台湾）、+1（美国）等

---

#### 4.2.4 辅助操作区

**位置**: 主按钮下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 上下间距: `spacing.md`
- 布局: 两端对齐（flex: space-between）

**内容**:

**左侧：忘记密码**:
- 国内版（CN）: 「忘记密码？」
- 海外版（HK）: 「忘記密碼？」
- 按钮类型: `GhostButton`（文字按钮）
- 文字颜色: `colors.brandBlue`
- 字体大小: `fontSizes.sm`
- 点击行为: 跳转到重置密码页面

**右侧：注册入口**:
- 国内版（CN）: 「注册新账号」
- 海外版（HK）: 「註冊新帳號」
- 按钮类型: `GhostButton`（文字按钮）
- 文字颜色: `colors.brandBlue`
- 字体大小: `fontSizes.sm`
- 点击行为: 
  - 如果当前是密码模式 → 自动切到验证码模式
  - 显示注册提示
  - 设置 `auth_intent = 'register'`

**注册提示**（点击「注册新账号」后显示）:
- 位置: 表单顶部或主按钮附近
- 样式: 提示文字
- 国内版（CN）: 「新用户请填写手机号/邮箱，获取验证码完成注册」
- 海外版（HK）: 「新用戶請填寫手機號／電郵，獲取驗證碼完成註冊」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 背景: `colors.greenSoftBg`（浅绿色背景，可选）
- 内边距: `spacing.sm`
- 圆角: `radius.md`

---

#### 4.2.5 第三方登录区

**位置**: 辅助操作区下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 上下间距: `spacing.xl`

**标题**:
- 国内版（CN）: 「其他登录方式」
- 海外版（HK）: 「其他登入方式」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 对齐方式: 居中
- 底部间距: `spacing.md`
- 位置: 标题上方和下方各有一条分割线（可选）

**按钮列表**:

**国内版（CN）**:
- 微信登录按钮
- 支付宝登录按钮

**海外版（HK）**:
- Google 登录按钮

**按钮样式**:
- 按钮类型: `SecondaryButton`（次要按钮）
- 背景: `colors.cardBg`（白色）
- 边框: `colors.border`（1px）
- 圆角: `radius.md`
- 高度: 48px
- 宽度: 100%
- 按钮之间间距: `spacing.sm`
- 内容: 图标（左侧）+ 文字（居中）
- 图标尺寸: 24x24px
- 文字颜色: `colors.ink`
- 字体大小: `fontSizes.base`

---

#### 4.2.6 协议区

**位置**: 页面最底部

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.lg`
- 上下间距: `spacing.lg`
- 底部间距: `spacing.xl`

**内容**:
- 国内版（CN）: 「登录即代表你已阅读并同意《用户协议》和《隐私政策》」
- 海外版（HK）: 「登入即代表你已閱讀並同意《用戶協議》和《私隱政策》」
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 对齐方式: 居中
- 行高: `lineHeights.relaxed`

**链接样式**:
- 《用户协议》和《隐私政策》为可点击链接
- 文字颜色: `colors.brandBlue`
- 点击行为: 跳转到对应协议页面

---

## 交互流程

### 5.1 登录 = 注册的统一逻辑

#### 5.1.1 核心原则
- **用户心智上**：区分「登录」「注册」
- **系统实现上**：都是同一个接口、同一套验证逻辑
- **首次登录即自动注册**：手机号/邮箱首次登录时，系统自动创建账号

#### 5.1.2 「注册新账号」按钮交互

**场景**: 用户点击「注册新账号 / 註冊新帳號」链接

**交互流程**:

1. **如果当前是密码模式**:
   - 自动切到验证码模式（因为注册更适合走验证码）
   - 显示注册提示

2. **显示注册提示**:
   - 在表单顶部或主按钮附近显示提示文字
   - 国内版（CN）: 「新用户请填写手机号/邮箱，获取验证码完成注册」
   - 海外版（HK）: 「新用戶請填寫手機號／電郵，獲取驗證碼完成註冊」

3. **设置前端状态**:
   - `auth_intent = 'register'`（用于埋点和轻微文案调整）

4. **用户输入并提交**:
   - 用户输入手机号/邮箱 + 验证码
   - 点击「登录 / 注册」按钮

5. **后端处理**:
   - 后端检查该手机号/邮箱是否已存在
   - **不存在** → 创建账号 → 返回 token
   - **存在** → 直接登录 → 返回 token

6. **老用户点击「注册新账号」**:
   - 行为上仍然是登录（因为手机号已经有账号）
   - 产品层面不强行分裂账号，避免一个人多个账号

#### 5.1.3 首次登录 vs 二次登录

**UI 完全相同，不区分**:
- 首次登录（系统没有这个账号） → 走自动注册
- 二次登录（账号存在） → 走登录

**区分仅在行为和提示文案**（可选）:
- 首次登录成功时返回时多一个字段 `first_login = true`
- 前端可根据此决定是否弹个「欢迎使用」的小气泡
- 与登录页面无关

---

### 5.2 验证码流程

#### 5.2.1 获取验证码

**点击「获取验证码」按钮**:
1. 验证手机号/邮箱格式
2. 调用 API 发送验证码
3. 按钮进入倒计时状态（60 秒）
4. 显示提示: 「验证码已发送，请在 10 分钟内完成验证」

#### 5.2.2 验证码策略

**有效期**: 10 分钟（短信 & 邮箱统一）

**长度**: 6 位数字

**频率限制**:
- 同一手机号/邮箱：60 秒内只可发送 1 次
- 单个手机号/邮箱每天最多 10 次

**错误次数限制**:
- 单次验证码有效期内输错 ≥ 5 次 → 验证码失效，需重新获取

**提示文案**:

**国内版（CN）**:
- 成功: 「验证码已发送，请在 10 分钟内完成验证」
- 错误: 「验证码不正确或已过期」
- 频率限制: 「验证码发送过于频繁，请稍后再试」
- 每日限制: 「今日验证码发送次数已达上限，请明天再试」

**海外版（HK）**:
- 成功: 「驗證碼已發送，請在 10 分鐘內完成驗證」
- 错误: 「驗證碼不正確或已過期」
- 频率限制: 「驗證碼發送過於頻繁，請稍後再試」
- 每日限制: 「今日驗證碼發送次數已達上限，請明天再試」

---

### 5.3 忘记密码流程

#### 5.3.1 入口

**位置**: 登录页面底部辅助操作左侧「忘记密码？」

**点击行为**: 跳转到重置密码页面

#### 5.3.2 重置密码页面

**页面标题**:
- 国内版（CN）: 「重置密码」
- 海外版（HK）: 「重設密碼」

**页面结构**:

1. **选择方式**（可选，由入口决定）:
   - 如果从手机号登录入口进入 → 默认手机号
   - 如果从邮箱登录入口进入 → 默认邮箱

2. **输入手机号/邮箱**:
   - 输入框样式同登录页面
   - 底部间距: `spacing.md`

3. **获取验证码**:
   - 按钮样式同登录页面
   - 验证码策略同上（10 分钟有效）
   - 底部间距: `spacing.md`

4. **输入验证码**:
   - 输入框样式同登录页面
   - 最大长度: 6 位
   - 底部间距: `spacing.md`

5. **输入新密码**:
   - Placeholder: 国内版「请输入新密码」/ 海外版「請輸入新密碼」
   - 显示/隐藏密码图标
   - 密码强度提示（可选）
   - 底部间距: `spacing.sm`

6. **确认新密码**:
   - Placeholder: 国内版「请再次输入新密码」/ 海外版「請再次輸入新密碼」
   - 显示/隐藏密码图标
   - 密码一致性验证
   - 底部间距: `spacing.md`

7. **确认重置按钮**:
   - 文案: 国内版「确认重置」/ 海外版「確認重設」
   - 按钮类型: `PrimaryButton`
   - 样式同登录页面主按钮

**成功提示**:
- 国内版（CN）: 「密码已重置，你可以使用新密码登录」
- 海外版（HK）: 「密碼已重設，你可以使用新密碼登入」
- 显示方式: Toast 或 Modal
- 可选: 自动跳回登录页面或直接登录

---

### 5.4 第三方登录流程

#### 5.4.1 国内版 - 微信登录

1. 点击「微信登录」按钮
2. 调起微信授权
3. 用户确认授权
4. 获取微信用户信息
5. 后端绑定微信账号（如果已有账号）或创建新账号
6. 返回 token，登录成功

#### 5.4.2 国内版 - 支付宝登录

1. 点击「支付宝登录」按钮
2. 调起支付宝授权
3. 用户确认授权
4. 获取支付宝用户信息
5. 后端绑定支付宝账号（如果已有账号）或创建新账号
6. 返回 token，登录成功

#### 5.4.3 海外版 - Google 登录

1. 点击「Google 登录」按钮
2. 调起 Google 授权
3. 用户选择 Google 账号
4. 用户确认授权
5. 获取 Google 用户信息
6. 后端绑定 Google 账号（如果已有账号）或创建新账号
7. 返回 token，登录成功

---

## 状态机设计

### 6.1 状态定义

```typescript
type AuthState =
  | 'INIT'                    // 初始状态
  | 'CN_PHONE_CODE'          // 国内版 - 手机号 - 验证码模式
  | 'CN_PHONE_PASSWORD'      // 国内版 - 手机号 - 密码模式
  | 'CN_EMAIL_CODE'          // 国内版 - 邮箱 - 验证码模式
  | 'CN_EMAIL_PASSWORD'      // 国内版 - 邮箱 - 密码模式
  | 'HK_EMAIL_CODE'          // 海外版 - 电邮 - 验证码模式
  | 'HK_EMAIL_PASSWORD'      // 海外版 - 电邮 - 密码模式
  | 'HK_PHONE_CODE'          // 海外版 - 手机号 - 验证码模式
  | 'HK_PHONE_PASSWORD'      // 海外版 - 手机号 - 密码模式
  | 'RESET_PASSWORD'         // 重置密码
  | 'BIND_PHONE'             // 绑定手机号（第三方登录后）
  | 'THIRD_PARTY_PROCESS'    // 第三方登录处理中
  | 'SUCCESS'                // 登录成功
  | 'ERROR';                 // 错误状态

type AuthIntent = 'login' | 'register'; // 前端内部状态，不影响接口
```

### 6.2 默认状态

**国内版（CN）**:
- 默认状态: `CN_PHONE_CODE`
- 默认意图: `auth_intent = 'login'`

**海外版（HK）**:
- 默认状态: `HK_EMAIL_CODE`
- 默认意图: `auth_intent = 'login'`

### 6.3 状态转换

#### 6.3.1 切换登录方式 Tab

**国内版**:
- `CN_PHONE_CODE` ↔ `CN_EMAIL_CODE`
- `CN_PHONE_PASSWORD` ↔ `CN_EMAIL_PASSWORD`

**海外版**:
- `HK_EMAIL_CODE` ↔ `HK_PHONE_CODE`
- `HK_EMAIL_PASSWORD` ↔ `HK_PHONE_PASSWORD`

#### 6.3.2 切换验证方式

**国内版 - 手机号**:
- `CN_PHONE_CODE` ↔ `CN_PHONE_PASSWORD`

**国内版 - 邮箱**:
- `CN_EMAIL_CODE` ↔ `CN_EMAIL_PASSWORD`

**海外版 - 电邮**:
- `HK_EMAIL_CODE` ↔ `HK_EMAIL_PASSWORD`

**海外版 - 手机号**:
- `HK_PHONE_CODE` ↔ `HK_PHONE_PASSWORD`

#### 6.3.3 点击「注册新账号」

**行为**:
- 不改变 `AuthState`
- 只把 `auth_intent = 'register'`
- 若当前是密码模式，则先切回对应的 `*_CODE` 模式，再设 `auth_intent = 'register'`

**示例**:
- `CN_PHONE_PASSWORD` + 点击「注册新账号」→ `CN_PHONE_CODE` + `auth_intent = 'register'`
- `CN_PHONE_CODE` + 点击「注册新账号」→ `CN_PHONE_CODE` + `auth_intent = 'register'`

#### 6.3.4 点击「忘记密码」

**行为**:
- 状态切为 `RESET_PASSWORD`

#### 6.3.5 第三方登录

**行为**:
- 状态切为 `THIRD_PARTY_PROCESS`
- 处理完成后:
  - 如果已有账号 → `SUCCESS`
  - 如果需要绑定手机号 → `BIND_PHONE`
  - 如果创建新账号 → `SUCCESS`

#### 6.3.6 登录成功

**行为**:
- 状态切为 `SUCCESS`
- 跳转到应用主页面
- 保存 token 到本地存储

---

## 数据需求

### 7.1 API 接口

#### 7.1.1 验证码登录/注册

**接口**: `POST /auth/login_by_code`

**请求参数**:
```typescript
interface LoginByCodeRequest {
  phone?: string;        // 手机号（带区号，如 +8613800138000）
  email?: string;        // 邮箱
  code: string;          // 验证码（6 位数字）
  app_region: 'CN' | 'HK'; // 应用地区
}
```

**响应**:
```typescript
interface LoginByCodeResponse {
  token: string;         // 访问令牌
  user_id: string;       // 用户 ID
  first_login?: boolean; // 是否首次登录（可选）
  user_info: {
    phone?: string;
    email?: string;
    nickname?: string;
    avatar?: string;
  };
}
```

**逻辑**:
- 后端检查该手机号/邮箱是否已存在
- **不存在** → 创建账号 → 返回 token
- **存在** → 直接登录 → 返回 token

#### 7.1.2 密码登录

**接口**: `POST /auth/login_by_password`

**请求参数**:
```typescript
interface LoginByPasswordRequest {
  phone?: string;        // 手机号（带区号）
  email?: string;        // 邮箱
  password: string;      // 密码
  app_region: 'CN' | 'HK';
}
```

**响应**:
```typescript
interface LoginByPasswordResponse {
  token: string;
  user_id: string;
  user_info: {
    phone?: string;
    email?: string;
    nickname?: string;
    avatar?: string;
  };
}
```

#### 7.1.3 发送验证码

**接口**: `POST /auth/send_code`

**请求参数**:
```typescript
interface SendCodeRequest {
  phone?: string;        // 手机号（带区号）
  email?: string;        // 邮箱
  type: 'login' | 'reset_password'; // 验证码类型
  app_region: 'CN' | 'HK';
}
```

**响应**:
```typescript
interface SendCodeResponse {
  success: boolean;
  message: string;       // 提示信息
  expires_in: number;    // 过期时间（秒）
}
```

#### 7.1.4 重置密码

**接口**: `POST /auth/reset_password`

**请求参数**:
```typescript
interface ResetPasswordRequest {
  phone?: string;        // 手机号（带区号）
  email?: string;        // 邮箱
  code: string;          // 验证码
  new_password: string;  // 新密码
  app_region: 'CN' | 'HK';
}
```

**响应**:
```typescript
interface ResetPasswordResponse {
  success: boolean;
  message: string;
}
```

#### 7.1.5 第三方登录

**接口**: `POST /auth/third_party_login`

**请求参数**:
```typescript
interface ThirdPartyLoginRequest {
  provider: 'wechat' | 'alipay' | 'google';
  access_token: string;  // 第三方 access_token
  app_region: 'CN' | 'HK';
}
```

**响应**:
```typescript
interface ThirdPartyLoginResponse {
  token: string;
  user_id: string;
  need_bind_phone?: boolean; // 是否需要绑定手机号
  user_info: {
    phone?: string;
    email?: string;
    nickname?: string;
    avatar?: string;
  };
}
```

---

## 技术实现

### 8.1 技术要点

- 表单验证（手机号、邮箱、密码格式）
- 验证码倒计时
- 状态机管理
- 多语言支持（i18n）
- 第三方登录 SDK 集成
- Token 存储和管理
- 错误处理和提示

### 8.2 相关文件结构

```
src/
├── screens/
│   └── Auth/
│       ├── LoginScreen.tsx           # 登录/注册页面
│       ├── ResetPasswordScreen.tsx   # 重置密码页面
│       └── components/
│           ├── LoginForm.tsx         # 登录表单组件
│           ├── PhoneInput.tsx        # 手机号输入组件
│           ├── EmailInput.tsx        # 邮箱输入组件
│           ├── CodeInput.tsx         # 验证码输入组件
│           ├── PasswordInput.tsx     # 密码输入组件
│           ├── CodeButton.tsx        # 获取验证码按钮
│           └── ThirdPartyButtons.tsx # 第三方登录按钮
├── services/
│   └── api/
│       └── authService.ts            # 认证 API
├── hooks/
│   ├── useAuth.ts                    # 认证状态管理
│   └── useAuthState.ts               # 状态机 Hook
├── utils/
│   ├── validation.ts                 # 表单验证工具
│   └── i18n.ts                       # 国际化工具
└── types/
    └── auth.ts                       # 认证类型定义
```

---

## 设计规范

### 9.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 输入框使用统一的样式规范
- 按钮使用统一的按钮样式规范
- 保持充足的留白

### 9.2 交互设计

- 表单验证实时反馈
- 错误提示清晰明确
- 加载状态明确显示
- 操作反馈及时

### 9.3 响应式设计

- 适配不同屏幕尺寸
- 键盘弹出时页面自动调整
- 输入框聚焦时自动滚动到可视区域

---

## 待确认事项

- [x] 页面布局和区块设计（已确认）
- [x] 登录=注册的统一逻辑（已确认）
- [x] 状态机设计（已确认）
- [ ] 第三方登录的具体实现方式
- [ ] 密码强度要求
- [ ] 是否需要记住登录状态
- [ ] 是否需要支持自动登录

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.2.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 包含语言绑定和注册交互的详细说明
  - 登录=注册的统一逻辑
  - 状态机设计
- **维护者**: 开发团队


# 檔案－命盤列表設計文檔

> **版本**: v1.0  
> **适用范围**: 小佩 App 底部导航「檔案」Tab 对应的命盤列表页面  
> **文件类型**: 产品 / 开发说明（供 Cursor / 前后端参考）

---

## 页面概述

### 页面名称
檔案－命盤列表 / Cases / Chart List / Profile List

### 页面定位
- **页面类型**: 底部导航主 Tab 页面
- **用户类型**: 所有用户
- **页面层级**: 底部导航「檔案」Tab 对应的主页面
- **访问条件**: 用户登录后可见

### 页面目的
「檔案－命盤列表」是小佩 App 中所有已排好八字命盤的**總入口**，也是切換「當前命主」與管理命主檔案的地方。

**核心功能**:
- 展示自己、家人、伴侶、孩子等所有命盤檔案
- 快速切換要分析的那個人（當前命主）
- 管理命盤檔案：改名字、調整關係標籤、刪除等

**设计理念**: 保持小佩人設——**克制、不打擾、像一位安靜整理好卷宗的命理師助理**。

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 命盤列表展示
- 展示所有命盤檔案
- 区分「正在查看」（當前命主）和「全部命盤」
- 支持按关系分组或排序展示

#### 2.1.2 當前命主管理
- 显示当前命主信息
- 支持切换当前命主
- 标识当前命主状态

#### 2.1.3 命盤卡片操作
- 点击卡片进入命盤詳情頁
- 长按或点击「…」打开操作菜单
- 支持编辑、删除等操作

#### 2.1.4 搜索与筛选
- 支持搜索姓名、暱稱、關係
- 支持按关系筛选
- 支持排序（最近查看 / 建立時間 / 關係）

#### 2.1.5 新增命盤
- 提供「新增命盤」入口
- 复用「手動排盤」页面组件
- 支持为不同关系的人建立命盤

---

## 信息架构与路由

### 3.1 路由结构

**路由名称**: `Cases`（驼峰命名，与现有文档一致）

**路由位置**: 底部导航「檔案」Tab

**路由关系**:
```
MainTabs
├── Cases (檔案－命盤列表) ← 本页面
├── XiaoPeiHome (小佩主页)
└── Me (我的)

RootStack
├── MainTabs
├── ManualBazi (手動排盤頁，全屏)
├── ChartDetail (命盤詳情頁，全屏)
└── Chat (聊天頁，全屏)
```

### 3.2 页面关系

#### 3.2.1 进入本页
- **从底部导航**: 点击「檔案」Tab → 进入本页
- **从命盤詳情頁返回**: 点击左上返回 → 回到本页（如果上一页是檔案列表）

#### 3.2.2 从本页跳转
- **点击命盤卡片**: 跳转到「命盤詳情頁」（`ChartDetail`）
  - 传递参数: `chartId`, `masterId`
  - 同时将该命盤设为「當前命主」
- **点击「新增命盤」**: 跳转到「手動排盤頁」（`ManualBazi`）
  - 传递参数: `from: 'cases'`, `relation?: RelationType`

---

## 页面设计

### 4.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色 `colors.bg`。从上到下依次包含：

1. 顶部栏（Header）
2. 轻量提示行（可选）
3. 搜索 & 筛选区
4. 命盤列表
5. 底部留白

---

### 4.2 详细区块设计

#### 4.2.1 顶部栏（Header）

**位置**: 页面最顶部

**样式**:
- 背景: `colors.bg`（白色）
- 高度: 约 `56dp`（包含安全区域）
- 底部边框: `colors.border`（1px）
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`

**内容布局**:
```
┌─────────────────────────────────────────┐
│  檔案                    [+ 新增命盤]   │
└─────────────────────────────────────────┘
```

**左侧区域**:
- **标题**:
  - 文案: 「檔案」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.bold`
  - 文字颜色: `colors.ink`

**右侧区域**:
- **新增命盤按钮**:
  - 布局: 图标 + 文字
  - 图标: `Plus`（lucide-react）
  - 图标大小: `20 x 20dp`
  - 图标颜色: `colors.brandBlue`
  - 文字: 「新增命盤」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.brandBlue`
  - 点击反馈: `activeOpacity: 0.7`
  - 行为: 点击后弹出选择 Bottom Sheet（见 4.2.5）

---

#### 4.2.2 轻量提示行（可选）

**位置**: 顶部栏下方

**展示条件**: 当存在「當前命主」时显示

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.md`，上下 `spacing.xs`
- 底部间距: `spacing.sm`

**内容**:
- 文案: 「當前命主：{{當前命主名稱}} · 小佩會優先根據這一盤回答你。」
- 字体大小: `fontSizes.xs`
- 文字颜色: `colors.textSecondary`
- 行高: `lineHeights.normal`

---

#### 4.2.3 搜索 & 筛选区

**位置**: 轻量提示行下方

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- 底部间距: `spacing.sm`

**搜索框**:
- 布局: 水平排列，搜索框在左，筛选图标在右
- **搜索框样式**:
  - 背景: `colors.cardBg`（白色）
  - 圆角: `radius.pill`
  - 边框: `colors.border`（1px）
  - 内边距: 左右 `spacing.md`，上下 `spacing.sm`
  - 占位符: 「搜尋姓名、暱稱或關係…」
  - 占位符颜色: `colors.textSecondary`
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.ink`
  - 图标: `Search`（左侧，lucide-react）
  - 图标大小: `16 x 16dp`
  - 图标颜色: `colors.textSecondary`
  - 右侧间距: `spacing.sm`
- **筛选图标**:
  - 图标: `Filter` 或 `SlidersHorizontal`（lucide-react）
  - 图标大小: `20 x 20dp`
  - 图标颜色: `colors.brandBlue`
  - 点击反馈: `activeOpacity: 0.7`
  - 行为: 点击后弹出筛选 Bottom Sheet（见 4.2.4）

**搜索行为**:
- 支持模糊搜索：姓名 / 暱稱 / 關係標籤
- 输入时即时筛选列表（建议本地筛选，性能更好）
- 清空搜索时恢复完整列表

---

#### 4.2.4 筛选 Bottom Sheet

**触发**: 点击搜索框右侧筛选图标

**内容**:

**1. 排序选项**:
- 标题: 「排序方式」
- 选项（单选）:
  - 最近查看（默认）
  - 建立時間
  - 關係（自己優先）
- 样式: 使用 Radio 或 Checkbox 组件

**2. 關係篩選**:
- 标题: 「關係篩選」
- 选项（多选）:
  - 全部（默认）
  - 自己
  - 伴侶
  - 家人
  - 朋友
  - 其他
- 样式: 使用 Chip 组件

**3. 操作按钮**:
- 「重置」按钮（文本样式）
- 「確定」按钮（主按钮样式）

**样式**:
- 遵循 Bottom Sheet 设计规范
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`
- 内边距: `spacing.lg`

---

#### 4.2.5 新增命盤 Bottom Sheet

**触发**: 点击顶部栏「新增命盤」按钮

**内容**:
- 选项列表:
  1. 「為自己建一張命盤」
     - 图标: `User`（lucide-react）
     - 点击行为: 跳转到 `ManualBazi`，传递 `from: 'cases'`, `relation: 'self'`
  2. 「為家人或伴侶建一張命盤」
     - 图标: `Users` 或 `Heart`（lucide-react）
     - 点击行为: 跳转到 `ManualBazi`，传递 `from: 'cases'`，在排盤页面选择关系

**样式**:
- 遵循 Bottom Sheet 设计规范
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`
- 内边距: `spacing.lg`
- 选项样式: 列表项样式，图标 + 文字，点击反馈

---

#### 4.2.6 命盤列表

**位置**: 搜索 & 筛选区下方

**布局**: 垂直滚动列表

**分區展示**:

**1. 「正在查看」區**（如果存在當前命主）:
- **區塊標題**:
  - 文案: 「正在查看」
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- **命盤卡片**: 显示当前命主卡片 1 张
  - 卡片样式略微高亮（淡色底或細線描邊）
  - 右上角小標籤：「當前命主」

**2. 「全部命盤」區**:
- **區塊標題**:
  - 文案: 「全部命盤」
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 内边距: 左右 `spacing.md`，上下 `spacing.sm`
- **命盤卡片列表**: 按排序规则展示所有命盤（排除當前命主）

> **小佩人設**: 像是桌上打開的一份卷宗，其他檔案整齊疊在旁邊。

---

#### 4.2.7 命盤卡片設計

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: `spacing.md`
- 卡片之间间距: `spacing.sm`
- 左右边距: `spacing.md`
- 点击反馈: `activeOpacity: 0.7`

**「正在查看」區的卡片特殊样式**:
- 背景: `colors.blueSoftBg`（浅蓝色背景，轻微高亮）
- 或边框: `colors.brandBlue`（2px 边框）

**卡片布局**:
```
┌─────────────────────────────────────────┐
│  [Avatar]  主標題（第一行）      [標籤] │
│           第二行：關係 · 出生信息        │
│           第三行：體質標籤        [...] │
└─────────────────────────────────────────┘
```

**左侧 Avatar 區**:
- **圆形 Avatar**:
  - 直径: `48dp`
  - 背景: `colors.blueSoftBg`（默认）或用户自定义
  - 文字: 首字母（大写）
  - 字体大小: `fontSizes.base`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.brandBlue`
  - 圆角: `radius.pill`
  - 右侧间距: `spacing.md`
  - 预留: 未来支持 Emoji / 自定义图标

**中部主信息區**:
- **主標題（第一行）**:
  - 文案: 命主姓名 / 暱稱
  - 如果是本人，可显示：「我」作为补充小字，如 `阿嵐（我）`
  - 字体大小: `fontSizes.base`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.xs`
- **第二行：關係 + 出生信息摘要**:
  - 格式: `關係標籤 · 1993-08-16 14:30 · 上海`
  - 日期显示公曆，时间 24 小时制
  - 若開啟真太陽時，增加小圖標或文案: `· 已用真太陽時`
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 底部间距: `spacing.xs`
- **第三行（可選）：體質標籤**:
  - 文案: 从命盤引擎已有字段抽取的简短描述
  - 示例: `偏弱金命 · 心思細膩，行事謹慎`
  - 注意: 这是**已存好的字段**，不是即时调用 LLM
  - 字体大小: `fontSizes.xs`
  - 文字颜色: `colors.textSecondary`
  - 行数限制: 1 行（`numberOfLines: 1`）

**右側狀態區**:
- **小標籤 / 膠囊**:
  - `當前命主`（如果是正在查看的那一個）
    - 背景: `colors.brandBlue`
    - 文字颜色: 白色
    - 圆角: `radius.pill`
    - 内边距: 左右 `spacing.xs`，上下 `spacing.xs / 2`
    - 字体大小: `fontSizes.xs`
  - `聊天中`（如果當前聊天窗正在使用這一盤，可選）
    - 背景: `colors.greenSoftBg`
    - 文字颜色: `colors.ink`
    - 样式同上
- **「…」更多操作圖標**:
  - 图标: `MoreHorizontal`（lucide-react）
  - 图标大小: `20 x 20dp`
  - 图标颜色: `colors.textSecondary`
  - 点击反馈: `activeOpacity: 0.7`
  - 行为: 点击后打开操作菜单（见 4.2.8）

**卡片交互**:
- **点击整張卡片**: 进入「命盤詳情頁」，同时将此命盤设为「當前命主」
- **長按卡片 或 點擊右側「…」**: 打开操作菜单（Bottom Sheet）

---

#### 4.2.8 命盤操作菜单（Bottom Sheet）

**触发**: 长按卡片或点击右侧「…」图标

**内容**:
- 选项列表:
  1. **設為當前命主**（如果非當前）
     - 图标: `Star`（lucide-react）
     - 行为: 更新当前命主，移动卡片到「正在查看」區
  2. **編輯命主**
     - 图标: `Edit`（lucide-react）
     - 行为: 打开编辑表单（见 4.2.9）
  3. **查看 / 編輯備註**
     - 图标: `FileText`（lucide-react）
     - 行为: 打开备注编辑 Bottom Sheet
  4. **刪除命盤**
     - 图标: `Trash2`（lucide-react）
     - 图标颜色: `colors.error`（红色）
     - 行为: 显示删除确认弹窗（见 4.2.10）

**样式**:
- 遵循 Bottom Sheet 设计规范
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`
- 内边距: `spacing.lg`
- 选项样式: 列表项样式，图标 + 文字，点击反馈
- 删除选项: 文字颜色使用 `colors.error`

---

#### 4.2.9 編輯命主表单（Bottom Sheet）

**触发**: 点击操作菜单「編輯命主」

**内容**:
- 表单字段:
  1. **姓名 / 暱稱**:
     - 输入框类型: TextInput
     - 占位符: 「请输入姓名或暱稱」
     - 必填: 是
  2. **關係**:
     - 输入框类型: Picker 或 Select
     - 选项: 自己 / 伴侶 / 父母 / 孩子 / 朋友 / 其他
     - 必填: 是
  3. **備註**:
     - 输入框类型: TextArea（多行）
     - 占位符: 「可以添加一些备注信息…」
     - 必填: 否

**操作按钮**:
- 「取消」按钮（文本样式）
- 「保存」按钮（主按钮样式）

**样式**:
- 遵循 Bottom Sheet 设计规范
- 背景: `colors.bg`（白色）
- 圆角: 顶部 `radius.xl`
- 内边距: `spacing.lg`

---

#### 4.2.10 刪除確認弹窗（Modal）

**触发**: 点击操作菜单「刪除命盤」

**内容**:
- **标题**: 「刪除這張命盤？」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
- **說明**: 「刪除後，小佩就無法再基於這張命盤幫你解讀了。這個操作無法恢復。」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 行高: `lineHeights.normal`
- **操作按钮**:
  - 「取消」按钮（次要按钮样式）
  - 「確認刪除」按钮（文本样式，文字颜色 `colors.error`）

**样式**:
- 遵循 Modal 设计规范
- 背景: `colors.bg`（白色）
- 圆角: `radius.lg`
- 内边距: `spacing.lg`
- 阴影: `shadows.card`（更明显）

> **设计原则**: 不做「一鍵清空全部」這種高風險操作，保持克制。

---

#### 4.2.11 空狀態

**触发场景**: 新用户首次进入「檔案」頁，尚未排盤

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: `spacing.lg`
- 顶部间距: `spacing['2xl']`
- 内容居中

**内容**:
- **插畫**（可选）:
  - 使用占位图或简单图标
  - 尺寸: `120 x 120dp`
  - 颜色: `colors.textSecondary`（浅色）
  - 底部间距: `spacing.lg`
- **标题**: 「還沒有任何命盤檔案」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.sm`
- **說明**: 「可以先為自己建一張命盤，再慢慢幫重要的人也建一份。」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 行高: `lineHeights.normal`
  - 文本对齐: 居中
  - 底部间距: `spacing.lg`
- **操作按钮**:
  - **主按鈕**: 「為自己建立命盤」
    - 背景: `colors.brandBlue`
    - 文字颜色: 白色
    - 圆角: `radius.pill`
    - 内边距: 左右 `spacing.lg`，上下 `spacing.md`
    - 字体大小: `fontSizes.base`
    - 字体粗细: `fontWeights.semibold`
    - 点击行为: 跳转到 `ManualBazi`，传递 `from: 'cases'`, `relation: 'self'`
  - **次按鈕**（可选）: 「為家人或伴侶建立命盤」
    - 背景: 透明
    - 文字颜色: `colors.brandBlue`
    - 字体大小: `fontSizes.sm`
    - 顶部间距: `spacing.md`
    - 点击行为: 跳转到 `ManualBazi`，传递 `from: 'cases'`

> **文案原则**: 保持溫和，不提「必須填」「需要完成」之類壓力字眼。

---

#### 4.2.12 無結果狀態

**触发场景**: 有命盤但搜索为空

**样式**:
- 背景: `colors.bg`（白色）
- 内边距: `spacing.lg`
- 顶部间距: `spacing.xl`
- 内容居中

**内容**:
- **标题**: 「沒有找到對應的檔案」
  - 字体大小: `fontSizes.lg`
  - 字体粗细: `fontWeights.semibold`
  - 文字颜色: `colors.ink`
  - 底部间距: `spacing.sm`
- **說明**: 「可以試試只輸入名字的一部分，或用關係來搜，比如「媽媽」。」
  - 字体大小: `fontSizes.sm`
  - 文字颜色: `colors.textSecondary`
  - 行高: `lineHeights.normal`
  - 文本对齐: 居中
  - 底部间距: `spacing.lg`
- **操作链接**: 「去新增一張命盤」
  - 文字颜色: `colors.brandBlue`
  - 字体大小: `fontSizes.sm`
  - 字体粗细: `fontWeights.medium`
  - 点击行为: 跳转到 `ManualBazi`，传递 `from: 'cases'`

---

## 交互流程

### 5.1 进入本页

1. 用户在 App 内任意页面，点击底部导航「檔案」Tab
2. 打开「檔案－命盤列表」頁
3. 如果已有「當前命主」，在顶部提示行显示其名称
4. 加载命盤列表数据

---

### 5.2 点击命盤卡片 → 进入命盤詳情頁

**流程**:
1. 用户点击某張命盤卡片
2. 系统:
   - 将该命盤标记为「當前命主」（更新全局状态）
   - 跳转至「命盤詳情頁」（`ChartDetail`）
   - 传递参数: `chartId`, `masterId`
3. 「命盤詳情頁」:
   - 顶部显示命主名称 + Tab:
     - 基本信息
     - 命盤總覽
     - 大運流年
   - 默认打开「基本信息」Tab（或使用上次停留的 Tab，开发时二选一）

**返回行为**:
- 从「命盤詳情頁」点击左上返回箭头:
  - 回到上一页（通常是「檔案－命盤列表」）
  - 保持列表滚动位置
  - 高亮刚才打开的卡片（例如淡色描邊或背景色）

---

### 5.3 設為當前命主

**情境**: 用户可能在別處更改「當前命主」，这里需要手动切换

**操作方式**:
1. 在命盤卡片右側點擊「…」，選擇「設為當前命主」
2. 或在卡片長按彈出菜單，選擇「設為當前命主」

**效果**:
- 更新全局「當前命主」状态
- 更新顶部提示行：「當前命主：{{名稱}}」
- 移动该卡片到「正在查看」區，并高亮
- 其他卡片移除「當前命主」标签

> **设计原则**: 此操作不強制跳轉到命盤詳情頁，只是靜默切換，保持克制。

---

### 5.4 編輯 / 刪除命盤

**操作入口**: 卡片右側「…」或長按卡片

**編輯流程**:
1. 点击「編輯命主」
2. 打开编辑表单 Bottom Sheet
3. 修改姓名、關係、備註
4. 点击「保存」
5. 更新命盤信息
6. 刷新列表

**刪除流程**:
1. 点击「刪除命盤」
2. 显示删除确认弹窗
3. 用户确认删除
4. 调用删除 API
5. 从列表中移除该卡片
6. 如果删除的是「當前命主」，需要重新选择新的当前命主（或清空）

---

### 5.5 新增命盤入口

**操作方式**:
1. 点击顶部栏「+ 新增命盤」按钮
2. 弹出选择 Bottom Sheet:
   - 「為自己建一張命盤」
   - 「為家人或伴侶建一張命盤」
3. 选择后进入「手動排盤頁」（`ManualBazi`）
4. 传递参数: `from: 'cases'`, `relation?: RelationType`

**排盤完成後**:
- 返回「檔案－命盤列表」頁
- 自动刷新列表
- 新命盤显示在列表顶部（如果按「建立時間」排序）

---

### 5.6 搜索与筛选

**搜索流程**:
1. 用户在搜索框输入关键词
2. 实时筛选列表（本地筛选或调用 API）
3. 显示筛选结果
4. 如果没有结果，显示「無結果狀態」

**筛选流程**:
1. 用户点击筛选图标
2. 打开筛选 Bottom Sheet
3. 选择排序方式和關係篩選
4. 点击「確定」
5. 更新列表排序和筛选
6. 关闭 Bottom Sheet

---

## 数据与状态

### 6.1 命盤檔案核心字段

```typescript
interface ChartProfile {
  profileId: string;              // 命主檔案 ID
  userId: string;                 // 當前 App 用戶 ID
  name: string;                   // 命主姓名 / 暱稱
  relationType: RelationType;     // 關係枚舉
  birthday: string;               // 出生日期（公曆，格式: YYYY-MM-DD）
  birthTime?: string;             // 出生時間（格式: HH:mm，可空）
  timeAccuracy?: 'exact' | 'approx' | 'unknown';  // 時間精度
  location?: string;              // 出生地城市
  timezone?: string;              // 時區
  useTrueSolarTime?: boolean;     // 是否使用真太陽時
  baziChartId: string;            // 對應八字排盤結果 ID（指向 engine 的存儲）
  oneLineSummary?: string;        // 一句話體質標籤（可選）
  isCurrent: boolean;             // 是否為當前命主
  isSelf: boolean;                // 是否為本人命盤
  notes?: string;                 // 備註（可選）
  createdAt: string;              // 建立時間（ISO 8601）
  updatedAt: string;              // 更新時間（ISO 8601）
  lastViewedAt: string;           // 最後查看時間（ISO 8601）
}

type RelationType = 'self' | 'partner' | 'parent' | 'child' | 'friend' | 'other';
```

---

### 6.2 状态管理

#### 6.2.1 本地状态

```typescript
interface CasesState {
  profiles: ChartProfile[];       // 命盤列表
  currentProfile: ChartProfile | null;  // 當前命主
  searchQuery: string;            // 搜索关键词
  sortBy: 'recent' | 'created' | 'relation';  // 排序方式
  filterRelations: RelationType[];  // 關係篩選
  isLoading: boolean;             // 加载状态
  error: string | null;           // 错误信息
}
```

#### 6.2.2 全局状态（可选）

- 當前命主信息（`currentProfile`）可能需要全局状态管理
- 建议使用 Zustand 或 Redux Toolkit 管理

---

### 6.3 API 接口

#### 6.3.1 获取命盤列表

**接口**: `GET /api/charts/profiles`

**请求参数**:
```typescript
interface GetProfilesRequest {
  page?: number;                  // 页码，默认 1
  page_size?: number;             // 每页数量，默认 50
  search?: string;                // 搜索关键词（可选）
  relation?: RelationType[];      // 關係篩選（可选）
  sort_by?: 'recent' | 'created' | 'relation';  // 排序方式
}
```

**响应**:
```typescript
interface GetProfilesResponse {
  profiles: ChartProfile[];
  total: number;
  page: number;
  page_size: number;
  current_profile_id?: string;    // 當前命主 ID
}
```

#### 6.3.2 设置當前命主

**接口**: `PUT /api/charts/profiles/:profileId/set-current`

**请求参数**: 无（通过 URL 参数传递 `profileId`）

**响应**:
```typescript
interface SetCurrentProfileResponse {
  success: boolean;
  current_profile_id: string;
}
```

#### 6.3.3 更新命盤信息

**接口**: `PUT /api/charts/profiles/:profileId`

**请求参数**:
```typescript
interface UpdateProfileRequest {
  name?: string;
  relationType?: RelationType;
  notes?: string;
}
```

**响应**:
```typescript
interface UpdateProfileResponse {
  profile: ChartProfile;
}
```

#### 6.3.4 删除命盤

**接口**: `DELETE /api/charts/profiles/:profileId`

**请求参数**: 无（通过 URL 参数传递 `profileId`）

**响应**:
```typescript
interface DeleteProfileResponse {
  success: boolean;
}
```

---

## 技术实现

### 7.1 组件结构

```
src/
  screens/
    Cases/
      index.tsx                    # 主组件导出
      CasesScreen.tsx              # 檔案列表主组件
      components/
        CasesHeader.tsx            # 顶部栏组件
        CurrentProfileHint.tsx     # 當前命主提示行
        SearchAndFilter.tsx        # 搜索和筛选组件
        ProfileCard.tsx            # 命盤卡片组件
        ProfileList.tsx            # 命盤列表组件
        EmptyState.tsx             # 空状态组件
        NoResultsState.tsx         # 無結果狀態组件
        FilterBottomSheet.tsx      # 筛选 Bottom Sheet
        AddProfileBottomSheet.tsx  # 新增命盤 Bottom Sheet
        ProfileMenuBottomSheet.tsx # 命盤操作菜单
        EditProfileBottomSheet.tsx # 編輯命主表单
        DeleteConfirmModal.tsx     # 刪除確認弹窗
      hooks/
        useProfiles.ts             # 命盤列表管理 Hook
        useCurrentProfile.ts       # 當前命主管理 Hook
        useSearchAndFilter.ts      # 搜索和筛选 Hook
      constants/
        relationTypes.ts           # 關係类型常量
      types.ts                     # 类型定义
```

---

### 7.2 路由配置

**路由名称**: `Cases`（驼峰命名，与现有文档一致）

**路由参数**: 无（本页面不需要路由参数）

**导航示例**:
```typescript
// 从底部导航进入（自动）
// 在 MainTabs 中配置

// 从命盤詳情頁返回
navigation.goBack();

// 跳转到命盤詳情頁
navigation.navigate('ChartDetail', {
  chartId: profile.baziChartId,
  masterId: profile.profileId,
});

// 跳转到手動排盤頁
navigation.navigate('ManualBazi', {
  from: 'cases',
  relation: 'self',  // 可选
});
```

---

### 7.3 与命盤詳情頁的对接

**命盤詳情頁路由参数**:
```typescript
interface ChartDetailRouteParams {
  chartId: string;                // 八字排盤結果 ID
  masterId: string;               // 命主檔案 ID
  initialTab?: 'basic' | 'overview' | 'fortune';  // 初始 Tab（可选）
}
```

**命盤詳情頁返回后的处理**:
- 保持列表滚动位置（使用 `useFocusEffect` 或 `useLayoutEffect`）
- 高亮刚才打开的卡片（通过 `masterId` 匹配）

---

## 设计规范

### 8.1 遵循 UI 设计系统

本页面严格遵循 `UI_SPEC.md` 中定义的设计规范：

- **颜色**: 使用 `colors` Design Tokens
- **字体**: 使用 `typography` Design Tokens
- **间距**: 使用 `layout.spacing` Design Tokens
- **圆角**: 使用 `layout.radius` Design Tokens
- **阴影**: 使用 `layout.shadows` Design Tokens

---

### 8.2 文案与语气

#### 8.2.1 关键文案

- 页面标题: 「檔案」
- 提示行: 「當前命主：{{名稱}} · 小佩會優先根據這一盤回答你。」
- 空状态:
  - 标题: 「還沒有任何命盤檔案」
  - 说明: 「可以先為自己建一張命盤，再慢慢幫重要的人也建一份。」
  - 主按钮: 「為自己建立命盤」
- 無結果:
  - 标题: 「沒有找到對應的檔案」
  - 说明: 「可以試試只輸入名字的一部分，或用關係來搜，比如「媽媽」。」
- 刪除確認:
  - 标题: 「刪除這張命盤？」
  - 说明: 「刪除後，小佩就無法再基於這張命盤幫你解讀了。這個操作無法恢復。」

#### 8.2.2 人設要求

- **不使用**:
  - 「結緣」「收費」「會員」「VIP」等詞
- **整體語氣**:
  - 溫和、不命令、不催促
  - 多用「可以」「如果你想」「再慢慢…」這類輕鬆語氣
- **小佩在這個頁面不「說話」**: 只是把資料整理得很整齊，隱性陪伴。

---

## 交互事件（埋点）

### 9.1 页面事件

- `view_cases_list`: 查看檔案列表
- `click_profile_card`: 点击命盤卡片
- `set_current_profile`: 設置當前命主
- `create_profile`: 創建命盤
- `delete_profile`: 刪除命盤
- `edit_profile`: 編輯命盤
- `search_profile`: 搜索命盤
- `filter_profile`: 篩選命盤

### 9.2 事件参数

```typescript
interface CasesEventParams {
  profile_id?: string;
  relation_type?: RelationType;
  search_query?: string;
  sort_by?: string;
  filter_relations?: RelationType[];
}
```

---

## 待确认事项

- [ ] 命盤詳情頁的默认 Tab 策略（固定「基本信息」vs 保留上次停留的 Tab）
- [ ] 搜索实现方式（本地筛选 vs 后端 API）
- [ ] 是否支持按关系分组展示（首版建议单列表 + 關係標籤）
- [ ] 是否支持批量操作（批量删除等，首版不建议）
- [ ] Avatar 是否支持自定义（首版建议仅首字母）
- [ ] 是否显示「聊天中」标签（需要与聊天页状态同步）
- [ ] 空状态插畫设计（是否需要专门设计）

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 完成檔案－命盤列表的完整设计
  - 包含搜索、筛选、编辑、删除等全部功能
  - 明确与命盤詳情頁、手動排盤頁的对接约定
  - 遵循 UI 设计规范，使用 Design Tokens
- **维护者**: 开发团队


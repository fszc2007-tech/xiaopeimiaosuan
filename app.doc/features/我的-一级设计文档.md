# 我的-一级设计文档

## 页面概述

### 页面名称
我的 / Mine Home / 个人中心

### 页面定位
- **页面类型**: 个人中心主页
- **用户类型**: 所有用户
- **页面层级**: 底部导航 Tab（第三个 Tab）
- **访问条件**: 用户登录后可见

### 页面目的
提供个人中心入口，展示用户信息、命理相关功能、小佩服务和工具帮助等。作为「安全区」，以「我 & 命主 & 小佩服务」为主，不强推订阅。

---

## 功能需求

### 2.1 核心功能

#### 2.1.1 个人资料展示
- 头像、昵称、使用天数
- 身份标识（基础版 / 小佩 Pro）

#### 2.1.2 我的命理入口
- 我的命盘
- 我的解读
- 聊天记录

#### 2.1.3 小佩服务入口
- 小佩 Pro（收费入口）
- 时运提醒
- 小佩学堂

#### 2.1.4 工具与帮助入口
- 邀请好友
- 意见反馈
- 帮助中心
- 联系客服
- 设置

---

## 页面设计

### 3.1 整体布局

页面采用垂直滚动布局（ScrollView），整体背景为纯白色。从上到下依次包含：

1. 顶部个人卡片
2. 分组一：我的命理
3. 分组二：小佩服务
4. 分组三：工具与帮助

---

### 3.2 详细区块设计

#### 3.2.1 顶部个人卡片

**位置**: 页面最顶部

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 边框: `colors.border`（细线，可选）
- 阴影: `shadows.card`
- 内边距: `spacing.lg`
- 上下间距: `spacing.lg`
- 点击区域: 整张卡片可点击

**内容布局**:

```
┌─────────────────────────────────────────┐
│  [头像]  昵称                    [身份] │
│         使用小佩第 X 天                 │
└─────────────────────────────────────────┘
```

**头像**:
- 尺寸: 48x48px（圆形）
- 默认: 使用生肖图标或小佩形象
- 支持: 用户自定义头像
- 圆角: `radius.full`
- 右侧间距: `spacing.md`

**昵称**:
- 显示: `userName`（用户昵称）
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.semibold`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.xs`

**使用天数**:
- 文案: 「使用小佩第 X 天」
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 计算方式: 从注册日期到当前日期的天数

**身份 Tag**（右侧）:
- 免费用户: 「基础版」
  - 背景: `colors.disabledBg`（浅灰色）
  - 文字颜色: `colors.textSecondary`
- 付费用户: 「小佩 Pro」
  - 背景: `colors.brandGreen`（粉绿色）
  - 文字颜色: 白色
- 圆角: `radius.pill`
- 内边距: 左右 `spacing.sm`，上下 `spacing.xs`
- 字体大小: `fontSizes.xs`

**点击行为**:
- 点击整张卡片 → 进入个人资料页
- 路由: `/profile` 或 `navigation.navigate('Profile')`
- 个人资料页可编辑:
  - 昵称
  - 性别
  - 手机号
  - 默认命主（从命主列表中选择）

**数据结构**:
```typescript
interface UserProfile {
  user_id: string;
  nickname: string;
  avatar?: string;
  gender?: 'male' | 'female';
  phone?: string;
  email?: string;
  is_pro: boolean;           // 是否为 Pro 用户
  register_date: string;     // 注册日期（用于计算使用天数）
  default_chart_id?: string; // 默认命主 ID
}
```

**API 接口**:
```typescript
// 获取用户信息
GET /api/user/profile

// 响应
interface GetUserProfileResponse {
  user_id: string;
  nickname: string;
  avatar?: string;
  gender?: 'male' | 'female';
  phone?: string;
  email?: string;
  is_pro: boolean;
  register_date: string;
  default_chart_id?: string;
  usage_days: number;        // 使用天数（后端计算）
}
```

---

#### 3.2.2 分组一：我的命理

**位置**: 顶部个人卡片下方

**分组标题**:
- 文案: 「我的命理」
- 字体大小: `fontSizes.xs`
- 字体粗细: `fontWeights.medium`
- 文字颜色: `colors.textSecondary`
- 内边距: 左右 `spacing.xs`，底部 `spacing.xs`

**卡片样式**:
- 背景: `colors.cardBg`（白色）
- 圆角: `radius.lg`
- 阴影: `shadows.card`
- 内边距: 0（Cell 内部有内边距）

**Cell 列表**（三个 Cell，每个一行）:

**1. 我的命盘**:
- 标题: 「我的命盘」
- 副文案: 「管理命主，进入命盘总览」
- 点击行为: 路由 `myCharts`（命主列表页）
- 路由: `/my/charts` 或 `navigation.navigate('MyCharts')`

**2. 我的解读**:
- 标题: 「我的解读」
- 副文案: 「查看报告和历史分析」
- 点击行为: 路由 `myReading`（解读归档页）
- 路由: `/my/reading` 或 `navigation.navigate('MyReading')`

**3. 聊天记录**:
- 标题: 「聊天记录」
- 副文案: 「与小佩的对话历史」
- 点击行为: 路由 `chatHistory`（对话列表/归档页）
- 路由: `/chat/history` 或 `navigation.navigate('ChatHistory')`

**Cell 样式**:
- 高度: 64px（最小）
- 内边距: 左右 `spacing.lg`，上下 `spacing.md`
- 边框: 底部 `colors.border`（1px），最后一个无边框
- 点击反馈: `activeOpacity: 0.7`

**Cell 内容布局**:
- 左侧: 标题和副文案
- 右侧: 箭头图标（➔）
  - 颜色: `colors.textSecondary`
  - 字体大小: `fontSizes.sm`

**标题样式**:
- 字体大小: `fontSizes.base`
- 字体粗细: `fontWeights.regular`
- 文字颜色: `colors.ink`
- 底部间距: `spacing.xs`

**副文案样式**:
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 行高: `lineHeights.normal`

---

#### 3.2.3 分组二：小佩服务

**位置**: 分组一下方

**分组标题**:
- 文案: 「小佩服务」
- 样式同「我的命理」

**卡片样式**:
- 同「我的命理」卡片样式

**Cell 列表**（三个 Cell）:

**1. 小佩 Pro**:
- 标题: 「小佩 Pro」
- 副文案:
  - 未开通: 「需要更深入解读时，可以了解一下」
  - 已开通: 「已开通 · 管理订阅与权益」
- 点击行为: 进入 Pro 订阅中心
- 路由: `/pro/center` 或 `navigation.navigate('ProCenter')`
- 样式: 克制展示，不强推

**2. 时运提醒**:
- 标题: 「时运提醒」
- 副文案: 「为关键年份和月份设置提醒」
- 点击行为: 进入时运提醒设置页
- 路由: `/notifications/luck-reminder` 或 `navigation.navigate('LuckReminder')`

**3. 小佩学堂**:
- 标题: 「小佩学堂」
- 副文案: 「命理基础与实用指南」
- 点击行为: 进入内容中心（文章/卡片）
- 路由: `/academy` 或 `navigation.navigate('Academy')`

**Cell 样式**: 同「我的命理」Cell 样式

---

#### 3.2.4 分组三：工具与帮助

**位置**: 分组二下方

**分组标题**:
- 文案: 「工具与帮助」
- 样式同「我的命理」

**卡片样式**:
- 同「我的命理」卡片样式

**Cell 列表**（五个 Cell）:

**1. 邀请好友**:
- 标题: 「邀请好友」
- 副文案: 「把小佩介绍给朋友」
- 点击行为: 路由 `inviteFriends` 页面
- 路由: `/invite/friends` 或 `navigation.navigate('InviteFriends')`

**2. 意见反馈**:
- 标题: 「意见反馈」
- 副文案: 「你的想法对小佩很重要」
- 点击行为: 路由 `feedback` 页面
- 路由: `/feedback` 或 `navigation.navigate('Feedback')`

**3. 帮助中心**:
- 标题: 「帮助中心」
- 副文案: 「常见问题与使用说明」
- 点击行为: 进入 FAQ 页
- 路由: `/help-center` 或 `navigation.navigate('HelpCenter')`

**4. 联系客服**:
- 标题: 「联系客服」
- 副文案: 「微信一对一客服」
- 点击行为: 弹出微信客服弹窗
- 行为: `onOpenWeChat()` 函数

**5. 设置**:
- 标题: 「设置」
- 右侧文字: 版本号（如「v1.0.0」）
- 点击行为: 路由 `settings` 页面
- 路由: `/settings` 或 `navigation.navigate('Settings')`

**Cell 样式**: 同「我的命理」Cell 样式

**版本号样式**:
- 字体大小: `fontSizes.sm`
- 文字颜色: `colors.textSecondary`
- 位置: 箭头图标左侧

---

### 3.3 整体风格要求

#### 3.3.1 背景与布局
- **整体背景**: 纯白色（`colors.bg`）
- **内容区域**: 使用 `ScrollView` 包裹，支持垂直滚动
- **安全区域**: 使用 `SafeAreaView` 包裹，避免顶部遮挡
- **页面内边距**: 左右 `spacing.lg`

#### 3.3.2 卡片样式
- **背景**: 白色（`colors.cardBg`）
- **圆角**: `radius.lg`（12px）
- **阴影**: `shadows.card`（轻微阴影）
- **卡片间距**: `spacing.lg`（24px）

#### 3.3.3 分组标题样式
- **字体大小**: `fontSizes.xs`（12px）
- **字体粗细**: `fontWeights.medium`
- **文字颜色**: `colors.textSecondary`
- **内边距**: 左右 `spacing.xs`，底部 `spacing.xs`

#### 3.3.4 Cell 样式
- **高度**: 64px（最小）
- **内边距**: 左右 `spacing.lg`，上下 `spacing.md`
- **边框**: 底部 `colors.border`（1px），最后一个无边框
- **点击反馈**: `activeOpacity: 0.7`

---

## 数据需求

### 4.1 用户信息接口

#### 4.1.1 获取用户信息

**接口**: `GET /api/user/profile`

**请求参数**: 无（从 token 中获取用户 ID）

**响应**:
```typescript
interface GetUserProfileResponse {
  user_id: string;
  nickname: string;
  avatar?: string;
  gender?: 'male' | 'female';
  phone?: string;
  email?: string;
  is_pro: boolean;
  register_date: string;        // ISO 8601 格式
  default_chart_id?: string;
  usage_days: number;           // 使用天数（后端计算）
}
```

#### 4.1.2 计算使用天数

**逻辑**:
- 后端计算: `usage_days = (当前日期 - register_date) + 1`
- 前端显示: 「使用小佩第 {{usage_days}} 天」

---

## 交互流程

### 5.1 用户操作流程

1. **进入页面**
   - 用户点击底部导航「我的」Tab
   - 页面加载用户信息并展示

2. **查看个人信息**
   - 点击顶部个人卡片
   - 跳转到个人资料页

3. **进入功能页面**
   - 点击各个 Cell
   - 跳转到对应的二级页面

4. **联系客服**
   - 点击「联系客服」Cell
   - 弹出微信客服弹窗

### 5.2 数据加载

- 页面进入时调用 `GET /api/user/profile` 获取用户信息
- 显示加载状态（可选）
- 数据加载失败时显示错误提示

---

## 技术实现

### 6.1 技术要点

- 页面滚动实现（ScrollView）
- 用户信息获取和展示
- 路由跳转
- 弹窗组件（微信客服）
- 数据加载和错误处理

### 6.2 相关文件结构

```
src/
├── screens/
│   └── Me/
│       ├── MineHomeScreen.tsx        # 我的主页
│       └── components/
│           ├── UserProfileCard.tsx   # 顶部个人卡片
│           ├── Section.tsx           # 分组组件
│           └── Cell.tsx              # Cell 组件
├── services/
│   └── api/
│       └── userService.ts            # 用户 API
└── types/
    └── user.ts                       # 用户类型定义
```

---

## 设计规范

### 7.1 视觉设计

- **遵循 UI_SPEC.md 中的设计规范**
- 使用 Design Tokens（colors, typography, layout）
- 整体背景为纯白色
- 卡片使用圆角、边框、阴影区分层级
- 保持充足的留白

### 7.2 交互设计

- 页面滚动流畅
- Cell 点击反馈明确
- 跳转动画平滑

### 7.3 响应式设计

- 适配不同屏幕尺寸
- 内容在小屏设备上可正常滚动

---

## 待确认事项

- [x] 页面布局和区块设计（已确认）
- [x] 用户信息展示（已确认）
- [ ] 个人资料页的具体设计
- [ ] Pro 订阅中心的具体设计
- [ ] 时运提醒设置页的具体设计
- [ ] 小佩学堂的具体设计

---

## 更新记录

- **创建日期**: 2024年11月
- **文档版本**: v1.0.0
- **最后更新**: 2024年11月
- **更新内容**: 
  - 初始版本
  - 包含完整的个人中心主页设计
- **维护者**: 开发团队


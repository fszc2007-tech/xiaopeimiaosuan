# 文档关系与一致性分析

## 一、文档概览

### 1.1 文档列表（共 18 个）

**核心架构文档（2个）：**
1. `APP开发文档.md` - 技术架构、项目结构、开发流程
2. `UI_SPEC.md` - UI 设计规范、Design Tokens

**导航与入口（2个）：**
3. `用户引导页设计文档.md` - 开屏/首页
4. `底部导航设计文档.md` - 底部导航栏

**功能页面（8个）：**
5. `出生信息輸入-聊天.md` - 聊天方式输入出生信息
6. `出生信息輸入-手動排盤.md` - 手动排盘表单
7. `基本信息设计文档.md` - 命盘基本信息 Tab
8. `命盤總覽设计文档.md` - 命盘总览 Tab
9. `基礎命盤表格設計.md` - 基础命盘表格
10. `神煞解讀彈窗設計.md` - 神煞解读弹窗
11. `注册登录设计文档.md` - 登录/注册页面
12. `小佩Pro-订阅页面设计文档.md` - Pro 订阅页

**个人中心（5个）：**
13. `我的-一级设计文档.md` - 个人中心主页
14. `我的-二级-命盘相关设计文档.md` - 我的命盘、添加命主
15. `我的-二级-内容查看页面设计文档.md` - 我的解读、聊天记录
16. `我的-二级-意见反馈和客服设计文档.md` - 意见反馈、客服
17. `我的-二级-邀请好友和设置设计文档.md` - 邀请好友、设置
18. `小佩Pro-功能与服务说明文档.md` - Pro 功能说明

---

## 二、文档关系图

```
APP开发文档.md (技术架构)
    ↓
UI_SPEC.md (设计规范)
    ↓
┌─────────────────────────────────────────┐
│  用户引导页设计文档.md (首页入口)        │
│    ├─→ 出生信息輸入-聊天.md              │
│    └─→ 出生信息輸入-手動排盤.md          │
└─────────────────────────────────────────┘
    ↓
底部导航设计文档.md
    ├─→ 排盤 Tab → 出生信息輸入-手動排盤.md
    ├─→ 檔案 Tab → (命盘列表，待确认)
    └─→ 我的 Tab → 我的-一级设计文档.md
                    ├─→ 我的-二级-命盘相关设计文档.md
                    │   └─→ 命盤總覽设计文档.md
                    │       ├─→ 基本信息设计文档.md
                    │       ├─→ 基礎命盤表格設計.md
                    │       └─→ 神煞解讀彈窗設計.md
                    ├─→ 我的-二级-内容查看页面设计文档.md
                    ├─→ 我的-二级-意见反馈和客服设计文档.md
                    ├─→ 我的-二级-邀请好友和设置设计文档.md
                    └─→ 小佩Pro-订阅页面设计文档.md
                        └─→ 小佩Pro-功能与服务说明文档.md
```

---

## 三、耦合度分析

### 3.1 高耦合文档（需要特别注意一致性）

#### 3.1.1 导航相关
- **底部导航设计文档.md** ↔ **用户引导页设计文档.md**
  - 耦合点：首页如何进入底部导航
  - 问题：用户引导页完成后，应该进入哪个页面？是直接进入底部导航的某个 Tab，还是先进入某个中间页？

- **底部导航设计文档.md** ↔ **出生信息輸入-手動排盤.md**
  - 耦合点：「排盤」Tab 点击跳转到手动排盘页
  - 状态：✅ 已明确

- **底部导航设计文档.md** ↔ **我的-一级设计文档.md**
  - 耦合点：「我的」Tab 对应个人中心
  - 状态：✅ 已明确

#### 3.1.2 命盘相关（强耦合）
- **命盤總覽设计文档.md** ↔ **基本信息设计文档.md**
  - 耦合点：两个 Tab 的关系、数据区分
  - 状态：✅ 已明确区分（基本信息=统计，命盘总览=结构细节）

- **命盤總覽设计文档.md** ↔ **基礎命盤表格設計.md**
  - 耦合点：命盘总览中包含基础命盘表格
  - 状态：✅ 已明确（命盘总览引用基础命盘表格）

- **基礎命盤表格設計.md** ↔ **神煞解讀彈窗設計.md**
  - 耦合点：基础命盘表格中的神煞可点击，弹出解读弹窗
  - 状态：✅ 已明确

- **我的-二级-命盘相关设计文档.md** ↔ **出生信息輸入-手動排盤.md**
  - 耦合点：添加命主复用手动排盘表单
  - 状态：✅ 已明确（通过 `from=account` 参数区分）

- **我的-二级-命盘相关设计文档.md** ↔ **命盤總覽设计文档.md**
  - 耦合点：从命主列表跳转到命盘总览
  - 状态：✅ 已明确（路由 `/chart/:chartId/overview`）

#### 3.1.3 聊天相关
- **出生信息輸入-聊天.md** ↔ **底部导航设计文档.md**
  - 耦合点：聊天页全屏，不显示底部导航
  - 状态：✅ 已明确

- **命盤總覽设计文档.md** ↔ **聊天页（未单独文档）**
  - 耦合点：点击卡片跳转聊天，传递参数
  - 状态：⚠️ 聊天页没有独立设计文档，参数传递逻辑分散在多个文档中

- **神煞解讀彈窗設計.md** ↔ **聊天页（未单独文档）**
  - 耦合点：点击推荐提问跳转聊天
  - 状态：⚠️ 同上

#### 3.1.4 Pro 相关
- **小佩Pro-订阅页面设计文档.md** ↔ **小佩Pro-功能与服务说明文档.md**
  - 耦合点：订阅页和功能说明的关系
  - 状态：✅ 已明确

- **我的-一级设计文档.md** ↔ **小佩Pro-订阅页面设计文档.md**
  - 耦合点：从「我的」进入 Pro 订阅页
  - 状态：✅ 已明确

---

### 3.2 中等耦合文档

#### 3.2.1 个人中心内部
- **我的-一级设计文档.md** ↔ **我的-二级-* 系列文档**
  - 耦合点：一级页面到二级页面的跳转
  - 状态：✅ 路由已明确

#### 3.2.2 登录注册
- **注册登录设计文档.md** ↔ **用户引导页设计文档.md**
  - 耦合点：新用户首次进入是否需要登录
  - 状态：⚠️ 未明确：用户引导页是否在登录前？还是登录后才看到？

---

### 3.3 低耦合文档（相对独立）

- **注册登录设计文档.md** - 相对独立，但需要明确与首页的关系
- **我的-二级-意见反馈和客服设计文档.md** - 相对独立
- **我的-二级-邀请好友和设置设计文档.md** - 相对独立

---

## 四、一致性问题检查

### 4.1 路由命名不一致 ⚠️

**问题 1：路由命名风格不统一**

| 文档 | 路由命名方式 | 示例 |
|------|------------|------|
| 底部导航设计文档.md | 驼峰命名 | `ManualBaziScreen`, `ChatScreen` |
| 我的-一级设计文档.md | 路径风格 | `/my/charts`, `/pro/center` |
| 我的-二级-命盘相关设计文档.md | 混合 | `navigation.navigate('ChartOverview', { chartId })` |
| 命盤總覽设计文档.md | 驼峰命名 | `navigation.navigate('Chat', params)` |

**建议统一为：**
- React Navigation 使用驼峰命名：`ManualBazi`, `Chat`, `ChartOverview`
- URL 路径使用 kebab-case：`/my/charts`, `/pro/center`（仅用于 Web 或深度链接）

---

### 4.2 参数命名不一致 ⚠️

**问题 2：命盘 ID 参数命名不统一**

| 文档 | 参数名 | 类型 |
|------|--------|------|
| 我的-一级设计文档.md | `default_chart_id` | snake_case |
| 我的-二级-命盘相关设计文档.md | `chartId` | camelCase |
| 神煞解讀彈窗設計.md | `chart_id` / `chartId` | 混用 |
| 基礎命盤表格設計.md | `chart_id` | snake_case |
| 命盤總覽设计文档.md | `chartId` | camelCase |

**建议统一为：**
- **前端代码**：使用 `camelCase`（`chartId`）
- **API 接口**：使用 `snake_case`（`chart_id`）
- **文档中**：明确区分前端参数和 API 参数

---

### 4.3 页面层级关系不明确 ⚠️

**问题 3：底部导航的「檔案」Tab 缺少设计文档**

- 底部导航设计文档中定义了「檔案」Tab
- 但没有对应的设计文档说明「檔案」页面应该显示什么
- 推测应该是「命主列表」或「命盘列表」，但未明确

**建议：**
- 创建「檔案」页面设计文档，或
- 在底部导航文档中明确说明「檔案」Tab 的功能

---

### 4.4 聊天页缺少独立设计文档 ⚠️

**问题 4：聊天页功能分散在多个文档中**

- 聊天页是核心功能，但缺少独立的设计文档
- 聊天相关逻辑分散在：
  - 出生信息輸入-聊天.md（输入出生信息场景）
  - 命盤總覽设计文档.md（一键解读跳转）
  - 神煞解讀彈窗設計.md（神煞解读跳转）
  - 我的-二级-内容查看页面设计文档.md（聊天记录）

**建议：**
- 创建独立的「聊天页设计文档.md」
- 统一聊天页的参数传递、状态管理、UI 规范

---

### 4.5 用户流程不完整 ⚠️

**问题 5：新用户首次进入流程不明确**

- 用户引导页设计文档.md：新用户进入的第一个页面
- 注册登录设计文档.md：登录/注册页面
- **缺失**：新用户是否需要先登录才能看到用户引导页？还是引导页完成后才登录？

**建议明确流程：**
```
方案 A：先登录后引导
登录页 → 用户引导页 → 首页（底部导航）

方案 B：先引导后登录
用户引导页 → 登录页（如果需要） → 首页（底部导航）

方案 C：引导页内嵌登录
用户引导页（包含登录入口） → 首页（底部导航）
```

---

## 五、硬编码问题检查

### 5.1 硬编码的路由名称 ⚠️

**问题 1：路由名称硬编码在多个文档中**

多处文档中直接写死了路由名称，如：
- `navigation.navigate('ManualBazi')`
- `navigation.navigate('Chat')`
- `navigation.navigate('ChartOverview')`

**建议：**
- 在 `APP开发文档.md` 或创建 `路由配置文档.md` 中统一定义所有路由常量
- 各文档引用路由常量，而不是直接写死字符串

**示例：**
```typescript
// routes.ts
export const ROUTES = {
  HOME: 'Home',
  CHAT: 'Chat',
  MANUAL_BAZI: 'ManualBazi',
  CHART_OVERVIEW: 'ChartOverview',
  MY_CHARTS: 'MyCharts',
  // ...
} as const;
```

---

### 5.2 硬编码的 API 路径 ⚠️

**问题 2：API 路径硬编码**

多处文档中直接写死了 API 路径，如：
- `GET /api/bazi/chart/:chartId`
- `GET /api/bazi/shensha/:code`
- `POST /auth/login_by_code`

**建议：**
- 在 `APP开发文档.md` 中统一定义 API 基础路径和端点
- 使用环境变量管理 API 基础 URL
- 创建 API 接口文档，统一管理所有接口定义

---

### 5.3 硬编码的 UI 数值 ⚠️

**问题 3：部分 UI 数值未使用 Design Tokens**

虽然大部分文档遵循了 `UI_SPEC.md` 的 Design Tokens，但仍有部分硬编码：

**示例：**
- 底部导航设计文档.md：`56dp`、`24 x 24dp` 等数值
- 神煞解讀彈窗設計.md：`80%`（弹窗最大高度）

**建议：**
- 所有数值都应该引用 `UI_SPEC.md` 中定义的 Design Tokens
- 如果 Design Tokens 中缺少某些值，应该先补充到 `UI_SPEC.md`

---

### 5.4 硬编码的业务逻辑 ⚠️

**问题 4：业务规则硬编码在文档中**

**示例 1：验证码策略**
- 注册登录设计文档.md 中硬编码了验证码规则：
  - 有效期：10 分钟
  - 长度：6 位
  - 频率限制：60 秒内 1 次
  - 每天最多 10 次

**建议：**
- 将这些业务规则提取到配置文件中
- 在文档中说明这些是可配置的参数，而不是硬编码的值

**示例 2：大运流年计算规则**
- 命盤總覽设计文档.md 中提到了大运流年的计算，但规则未明确
- 应该引用 `engine/八字引擎字段汇总文档.md` 中的计算规则

**建议：**
- 业务规则应该集中在业务规则文档中
- 各功能文档引用业务规则，而不是重复定义

---

### 5.5 硬编码的文案内容 ⚠️

**问题 5：文案内容硬编码**

多处文档中直接写死了文案，如：
- 「使用小佩第 X 天」
- 「和小佩聊聊「{{shenShaName}}」對我的影響」
- 「實際接入時會攜帶 chart_id / shen_sha / pillar / question 進入聊天意圖」

**建议：**
- 创建「文案规范文档.md」或在国际化文件中统一管理
- 文档中应该说明这些文案是可配置的，并提供文案 key

---

## 六、改进建议

### 6.1 立即修复的问题（高优先级）

1. **统一路由命名规范**
   - 创建 `路由配置文档.md`，定义所有路由常量
   - 更新所有文档，使用路由常量而不是硬编码字符串

2. **统一参数命名规范**
   - 明确前端使用 `camelCase`，API 使用 `snake_case`
   - 更新所有文档，统一参数命名

3. **补充缺失的设计文档**
   - 创建「聊天页设计文档.md」
   - 创建或明确「檔案」Tab 的设计文档
   - 明确新用户首次进入流程

4. **提取硬编码的业务规则**
   - 创建「业务规则配置文档.md」
   - 将验证码策略、大运计算规则等提取到配置文档

---

### 6.2 中期优化（中优先级）

1. **创建 API 接口文档**
   - 统一管理所有 API 接口定义
   - 明确请求/响应格式、错误码等

2. **完善 Design Tokens**
   - 检查所有文档中的硬编码数值
   - 补充缺失的 Design Tokens 到 `UI_SPEC.md`

3. **创建文案规范文档**
   - 统一管理所有文案内容
   - 支持多语言配置

---

### 6.3 长期优化（低优先级）

1. **建立文档索引**
   - 创建文档关系图（可视化）
   - 建立文档之间的交叉引用

2. **建立文档版本管理**
   - 记录文档变更历史
   - 建立文档审查流程

3. **建立文档一致性检查工具**
   - 自动化检查路由命名、参数命名等
   - 检查硬编码问题

---

## 七、文档依赖关系总结

### 7.1 核心依赖（必须遵循）

```
所有文档 → UI_SPEC.md (设计规范)
所有功能文档 → APP开发文档.md (技术架构)
所有路由相关 → 路由配置文档.md (待创建)
所有 API 相关 → API接口文档.md (待创建)
```

### 7.2 功能依赖

```
命盤總覽设计文档.md → 基本信息设计文档.md (Tab 关系)
基礎命盤表格設計.md → 神煞解讀彈窗設計.md (点击交互)
我的-二级-命盘相关设计文档.md → 出生信息輸入-手動排盤.md (组件复用)
所有跳转聊天 → 聊天页设计文档.md (待创建)
```

### 7.3 数据依赖

```
所有命盘相关 → engine/八字引擎字段汇总文档.md (数据字段)
所有 API 调用 → API接口文档.md (待创建)
```

---

## 八、检查清单

### 8.1 一致性检查

- [ ] 路由命名统一（使用路由常量）
- [ ] 参数命名统一（前端 camelCase，API snake_case）
- [ ] 页面层级关系明确
- [ ] 用户流程完整
- [ ] 所有数值使用 Design Tokens

### 8.2 硬编码检查

- [ ] 路由名称提取为常量
- [ ] API 路径提取为配置
- [ ] 业务规则提取为配置
- [ ] 文案内容提取为配置
- [ ] UI 数值使用 Design Tokens

### 8.3 文档完整性检查

- [ ] 聊天页设计文档
- [ ] 檔案 Tab 设计文档
- [ ] 路由配置文档
- [ ] API 接口文档
- [ ] 业务规则配置文档
- [ ] 文案规范文档

---

## 九、总结

### 9.1 文档质量评估

**优点：**
- ✅ 文档结构清晰，模块化程度高
- ✅ 大部分文档遵循了 UI 设计规范
- ✅ 功能划分合理，耦合度适中

**需要改进：**
- ⚠️ 路由和参数命名不统一
- ⚠️ 存在硬编码的业务逻辑和配置
- ⚠️ 缺少部分核心功能的设计文档
- ⚠️ 用户流程不够明确

### 9.2 建议优先级

1. **P0（立即修复）**：统一路由和参数命名、补充聊天页文档
2. **P1（本周完成）**：提取硬编码配置、明确用户流程
3. **P2（本月完成）**：创建 API 文档、完善 Design Tokens
4. **P3（持续优化）**：建立文档索引、版本管理、自动化检查

---

**文档版本**: v1.0.0  
**创建日期**: 2024年11月  
**最后更新**: 2024年11月  
**维护者**: 开发团队


# Pull Request

## 📋 任务描述

<!-- 简要描述本 PR 要完成的任务 -->

**关联 Issue/需求**: #

**功能模块**: [ ] 认证 / [ ] 命盘 / [ ] 解读 / [ ] 对话 / [ ] Pro / [ ] Admin / [ ] 其他: ___

---

## ✅ 开发前检查（Must Do）

### 文档阅读
- [ ] 已阅读相关功能设计文档
  - 文档路径: `app.doc/features/___.md`
- [ ] 已阅读 `app.doc/API接口统一规范.md`
- [ ] 已阅读相关数据库设计文档（如涉及）
  - 文档路径: `core.doc/数据库与API设计方案.md`

### 设计对齐
- [ ] API 路径与规范一致（`/api/v1/...`）
- [ ] 参数命名与设计文档一致（camelCase）
- [ ] 响应格式与规范一致（`{ success, data | error }`）

---

## ✅ 开发中检查（Must Do）

### 代码规范
- [ ] 所有对外字段使用 `camelCase`（禁止 `snake_case`）
- [ ] 所有 API 响应使用 `FieldMapper`（禁止手搓映射）
  ```typescript
  // ✅ 正确
  return FieldMapper.mapUser(userRow);
  
  // ❌ 错误
  return { userId: row.user_id, ... };
  ```
- [ ] 所有日期使用 ISO 8601 格式（`YYYY-MM-DDTHH:mm:ss.sssZ`）
- [ ] 所有 API 都注册了文档（`registerApi({...})`）

### 类型安全
- [ ] 使用了 `types/dto.ts` 中定义的 DTO 类型
- [ ] 使用了 `types/database.ts` 中定义的数据库行类型
- [ ] 避免使用 `any`（确实需要时使用 `unknown` 并显式类型转换）

### 配置优先
- [ ] 业务规则使用配置文件（如 `config/auth.ts`），未写死在代码中
- [ ] 敏感信息使用环境变量（`XIAOPEI_*`）

### 安全性
- [ ] 所有需要认证的接口使用了 `authMiddleware`
- [ ] 所有用户操作都验证了权限（`user_id` 匹配）
- [ ] 不在响应中暴露敏感信息（密码、API Key 等）

---

## ✅ 开发后检查（Must Do）

### 文档与测试
- [ ] 已运行 `npm run docs:generate` 生成 API 文档
- [ ] 已对照设计文档逐项检查所有功能
- [ ] 已补充单元测试（如涉及关键业务逻辑）
- [ ] 已手动测试所有 API 接口

### 代码质量
- [ ] 通过 ESLint 检查（`npm run lint`）
- [ ] 通过 TypeScript 类型检查（`npm run type-check`）
- [ ] 代码注释清晰，标注了参考文档

### 数据库变更（如涉及）
- [ ] 提供了迁移脚本（SQL）
- [ ] 更新了 `types/database.ts` 中的类型定义
- [ ] 更新了 `FieldMapper` 中的映射逻辑

---

## 📝 变更说明

### 新增功能
<!-- 列出本 PR 新增的功能 -->

-

### 修改功能
<!-- 列出本 PR 修改的功能 -->

-

### 破坏性变更（Breaking Changes）
<!-- ⚠️ 如有破坏性变更，必须详细说明 -->

- [ ] 无破坏性变更
- [ ] 有破坏性变更：
  - 旧版本 API/字段：___
  - 新版本 API/字段：___
  - 前端需要适配：___

---

## 🧪 测试说明

### 手动测试
<!-- 列出手动测试的场景和结果 -->

- [ ] 场景 1：___
- [ ] 场景 2：___
- [ ] 场景 3：___

### 单元测试
<!-- 列出新增或修改的测试用例 -->

- [ ] 测试文件：`__tests__/___.test.ts`
- [ ] 覆盖率：__%

---

## 📸 截图/录屏（可选）

<!-- 如涉及 UI 变更，请提供截图或录屏 -->

---

## 📚 参考文档

<!-- 列出本 PR 参考的所有设计文档 -->

- `app.doc/features/___.md`
- `app.doc/API接口统一规范.md`
- `core.doc/数据库与API设计方案.md`

---

## 🎯 Reviewer 关注点

<!-- 提醒 Reviewer 重点关注的地方 -->

- [ ] 字段命名是否使用 `camelCase`
- [ ] 是否使用 `FieldMapper` 而非手搓映射
- [ ] API 响应格式是否统一
- [ ] 是否有硬编码的业务规则（应该在配置文件中）

---

## 📌 额外说明

<!-- 其他需要说明的内容 -->

---

**提交前最后检查**:
- [ ] 我已完成上述所有检查项
- [ ] 我已测试所有变更
- [ ] 我已更新相关文档
- [ ] 我确认没有遗漏任何必做项


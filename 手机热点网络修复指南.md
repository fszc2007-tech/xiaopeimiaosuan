# iOS 模拟器网络连接修复指南（手机热点环境）

## 问题诊断

您遇到的错误：`No script URL provided` 是因为：

1. **Metro bundler 绑定到 `localhost`**：默认情况下监听 `127.0.0.1:8081`
2. **网络环境特殊**：使用手机热点而非 WiFi，Expo 检测到网络异常
3. **iOS 模拟器无法连接**：bundler URL 配置不正确

## 快速修复方案

### 方案 1：使用修复脚本（推荐）

```bash
# 1. 停止当前运行的 Metro bundler
# 在终端 3 中按 Ctrl+C

# 2. 运行修复脚本
./fix-metro-network.sh
```

脚本会自动：
- 检测您的电脑 IP 地址（应该是 10.18.5.221）
- 清理缓存
- 使用 LAN 模式启动 Metro bundler

### 方案 2：手动修复

```bash
cd app

# 1. 清理缓存
rm -rf .expo .expo-shared node_modules/.cache

# 2. 获取本机 IP（手机热点分配的）
ifconfig | grep "inet " | grep -v 127.0.0.1

# 3. 设置环境变量并启动（替换为您的实际 IP）
export REACT_NATIVE_PACKAGER_HOSTNAME=10.18.5.221
npx expo start --host lan --clear
```

## 重新构建 iOS App

修复 Metro bundler 后，需要重新构建 iOS app：

### 在 Xcode 中：

1. **Clean Build Folder**
   - 快捷键：`Shift + Cmd + K`
   - 或菜单：Product → Clean Build Folder

2. **重新运行**
   - 快捷键：`Cmd + R`
   - 或点击运行按钮

### 或在终端中：

```bash
cd app
npx expo run:ios --device
```

## 验证修复

启动后应该看到：

```
✅ Metro bundler 运行在: http://10.18.5.221:8081
✅ iOS 模拟器连接成功
✅ App 正常加载
```

## 如果仍然失败

### 检查防火墙

```bash
# macOS 防火墙可能阻止连接
# 系统设置 → 网络 → 防火墙 → 关闭或添加例外
```

### 使用 Tunnel 模式（备选方案）

```bash
cd app
npx expo start --tunnel
```

Tunnel 模式会通过 Expo 服务器中转，不依赖本地网络。

### 检查端口占用

```bash
# 确保 8081 端口未被占用
lsof -i :8081

# 如果被占用，杀死进程
kill -9 <PID>
```

## 永久配置（可选）

如果经常使用手机热点，可以在 `app/.expo/settings.json` 中配置：

```json
{
  "hostType": "lan",
  "lanType": "ip",
  "devToolsPort": 19002,
  "packagerPort": 8081,
  "urlRandomness": null
}
```

## 注意事项

1. **每次更换网络环境**（WiFi ↔ 手机热点）都需要重启 Metro bundler
2. **IP 地址可能变化**：手机热点可能每次分配不同的 IP
3. **模拟器 vs 真机**：真机设备需要与电脑在同一网络下（手机热点）

## 相关文档

- Metro bundler 配置：`app/metro.config.js`
- iOS 配置：`app/ios/app/AppDelegate.swift`
- 环境变量：`app/.env`（如果存在）


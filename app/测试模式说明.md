# 测试模式说明

## 🔧 开发/测试模式功能

### 验证码跳过功能

在开发模式下（`__DEV__ === true`），登录流程已优化为测试友好模式：

#### 1. 发送验证码阶段
```typescript
// 开发模式下的行为
- ✅ 跳过实际的 API 请求
- ✅ 不会真正发送短信
- ✅ 直接进入验证码输入阶段
- ✅ 60秒倒计时正常运行
- ✅ 控制台输出：🔧 开发模式：跳过验证码发送，任意6位数字可作为验证码
```

#### 2. 登录验证阶段
```typescript
// 开发模式下的行为
- ✅ 任意6位数字都可作为有效验证码
- ✅ 实际发送给后端的验证码固定为：888888
- ✅ 不需要真实的短信验证码
- ✅ 快速测试登录流程
```

### 使用方法

#### 测试登录流程
1. 输入任意有效的手机号（11位，以1开头）
2. 点击"發送驗證碼"
3. 输入任意6位数字（如：123456、888888、000000等）
4. 点击"登入"
5. 成功登录

### 代码实现

#### 发送验证码
```typescript
const handleSendOtp = async () => {
  // ...验证逻辑...
  
  try {
    // 开发环境：跳过实际发送
    if (__DEV__) {
      console.log('🔧 开发模式：跳过验证码发送，任意6位数字可作为验证码');
      setOtpSent(true);
      setCountdown(60);
      setLoading(false);
      return;
    }
    
    // 生产环境：正常发送验证码
    await authService.requestOtp({ 
      phone, 
      purpose: 'login',
      region: appRegion === 'HK' ? 'hk' : 'cn',
    });
    // ...
  }
};
```

#### 登录验证
```typescript
const handleLogin = async () => {
  // ...验证逻辑...
  
  try {
    const isDev = __DEV__;
    
    const response = await authService.loginOrRegister({
      phone,
      otp: isDev ? '888888' : otp, // 开发环境使用固定验证码
      appRegion: appRegion,
      region: appRegion === 'HK' ? 'hk' : 'cn',
    });
    // ...
  }
};
```

## 🎯 生产环境行为

### 生产模式（`__DEV__ === false`）
```typescript
- ⚠️ 必须真实发送短信验证码
- ⚠️ 必须输入正确的6位验证码
- ⚠️ 严格的验证码校验
- ⚠️ 60秒内不能重复发送
```

## 📋 测试场景

### 场景1：快速登录测试
```
1. 输入手机号：13800138000
2. 点击发送验证码
3. 输入任意验证码：123456
4. 成功登录 ✅
```

### 场景2：多次测试
```
1. 第一次：验证码 000000 ✅
2. 第二次：验证码 111111 ✅
3. 第三次：验证码 999999 ✅
所有验证码都有效！
```

### 场景3：UI 测试
```
1. 测试手机号验证
2. 测试倒计时功能
3. 测试错误提示
4. 测试按钮状态
无需等待真实短信！
```

## ⚙️ 配置说明

### 环境检测
```typescript
__DEV__: React Native 内置的开发环境标志
- true: 开发/调试模式
- false: 生产/发布模式
```

### 固定验证码
```typescript
开发环境统一使用：888888
- 任意输入都会被替换为此固定值
- 后端需要接受此验证码
- 或者后端也需要有测试模式
```

## 🔒 安全注意事项

### ⚠️ 重要提示
1. **生产环境自动禁用**
   - `__DEV__` 在打包后自动为 `false`
   - 测试模式代码不会在生产环境执行

2. **后端配合**
   - 后端也需要有测试模式
   - 或者接受固定验证码 `888888`
   - 建议：后端检查请求来源并验证

3. **发布前检查**
   - 确保正式发布使用 Release 构建
   - 测试完成后验证生产环境行为

## 🎨 小佩 Logo 更新

### Logo 组件优化
```typescript
✅ 使用小佩 AI 头像
✅ 渐变色边框效果
✅ 阴影效果
✅ 圆形/方形可切换
✅ 多尺寸支持
```

### 图片位置
```
app/assets/images/xiaopei-avatar.png
```

### 显示效果
- 登录页：120x120 大尺寸
- 渐变边框：紫蓝粉三色渐变
- 阴影效果：柔和的外发光
- 圆角设计：现代简洁

## 📱 使用示例

### 开发测试
```bash
# 启动开发服务器
cd /Users/gaoxuxu/Desktop/小佩APP/app
npx expo start

# 特点：
- ✅ 热重载
- ✅ 测试模式启用
- ✅ 控制台日志输出
- ✅ 快速测试迭代
```

### 生产构建
```bash
# iOS Release 构建
npx expo run:ios --configuration Release

# Android Release 构建  
npx expo run:android --variant release

# 特点：
- ⚠️ 测试模式自动禁用
- ⚠️ 需要真实验证码
- ⚠️ 完整的安全验证
```

## 🔍 调试信息

### 控制台输出
```
开发模式启用时会看到：
🔧 开发模式：跳过验证码发送，任意6位数字可作为验证码
```

### 网络请求
```
开发模式：
- 发送验证码：不发送真实请求
- 登录请求：发送，但使用固定验证码 888888

生产模式：
- 所有请求正常发送
- 使用用户输入的真实验证码
```

---

**版本**: v1.2  
**更新日期**: 2025-11-19  
**状态**: ✅ 测试模式已启用，小佩 Logo 已更新


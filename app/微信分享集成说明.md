# 微信分享集成说明

## ✅ 已完成的工作

1. ✅ 安装 `react-native-wechat-lib`
2. ✅ 创建微信配置文件 `src/config/wechat.ts`
3. ✅ 创建微信服务 `src/services/wechatService.ts`
4. ✅ 在 App 启动时初始化微信 SDK
5. ✅ 修改 ChatScreen 支持微信分享（会弹出选择器：微信好友/朋友圈/更多选项）
6. ✅ 配置 iOS 原生代码（Info.plist + CocoaPods）
7. ✅ 配置 Android 原生代码（AndroidManifest.xml + WXEntryActivity）

## 📝 需要你完成的配置

### 1. 获取微信 AppID

1. 访问微信开放平台：https://open.weixin.qq.com/
2. 注册/登录账号
3. 创建移动应用
4. 获取 AppID（类似：`wxabcdef1234567890`）

### 2. 配置 AppID

打开 `app/src/config/wechat.ts`，修改以下内容：

```typescript
export const WECHAT_CONFIG = {
  // 替换为你的微信 AppID
  appId: 'wx1234567890abcdef', // ⚠️ 改成你自己的 AppID
  
  // 替换为你的 Universal Link（iOS）
  universalLink: 'https://your-domain.com/app/', // ⚠️ 改成你自己的域名
  
  appName: '小佩妙算',
};
```

### 3. 配置 iOS URL Scheme

打开 `app/ios/app/Info.plist`，找到这一行：

```xml
<string>wx1234567890abcdef</string>
```

将 `wx1234567890abcdef` 替换为你的微信 AppID。

### 4. 配置 iOS Universal Links（重要）

微信分享在 iOS 上需要配置 Universal Links：

1. 在你的服务器上创建 `apple-app-site-association` 文件
2. 配置域名（需要 HTTPS）
3. 在 Xcode 中配置 Associated Domains

详细步骤：
- 打开 `app.xcworkspace` in Xcode
- 选择项目 → Signing & Capabilities
- 添加 Associated Domains
- 添加域名：`applinks:your-domain.com`

### 5. 重新构建项目

```bash
# iOS
cd app/ios
pod install
cd ..
npx expo run:ios

# Android
npx expo run:android
```

## 🎯 使用方法

用户点击聊天消息下方的"分享"按钮后：

1. **如果已安装微信**：
   - iOS: 弹出 ActionSheet，可选择"微信好友"、"微信朋友圈"、"更多选项"
   - Android: 弹出 Alert，可选择"微信好友"、"微信朋友圈"、"更多选项"

2. **如果未安装微信**：
   - 直接弹出系统分享弹窗（支持 WhatsApp、信息、邮件等）

## 📱 测试

1. **测试微信是否安装检测**：
   - 在有微信和没有微信的设备上测试
   
2. **测试分享功能**：
   - 点击分享 → 选择微信好友 → 选择联系人 → 发送
   - 点击分享 → 选择微信朋友圈 → 发布

## ⚠️ 注意事项

1. **微信 AppID**：
   - iOS 的 Info.plist 和配置文件中的 AppID 必须一致
   - AppID 格式：`wxXXXXXXXXXXXXXXXX`（wx 开头）

2. **Universal Links**：
   - iOS 必须配置才能使用微信分享
   - 需要 HTTPS 域名
   - 需要在微信开放平台配置

3. **Android 包名和签名**：
   - 在微信开放平台注册应用时，需要填写包名：`com.xiaopei.app`
   - 需要填写应用签名（MD5）

4. **开发环境测试**：
   - 微信分享功能需要在真机上测试
   - 模拟器无法测试微信分享

## 🔧 如果暂时不配置微信

如果暂时还没有微信 AppID，不影响其他功能：

- App 仍然可以正常运行
- 点击分享按钮会直接使用系统分享（不会显示微信选项）
- 可以分享到 WhatsApp、信息、邮件等

## 📚 相关文档

- 微信开放平台：https://open.weixin.qq.com/
- react-native-wechat-lib：https://github.com/little-snow-fox/react-native-wechat-lib
- Universal Links 配置：https://developer.apple.com/documentation/xcode/supporting-universal-links-in-your-app



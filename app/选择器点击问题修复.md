# é€‰æ‹©å™¨ç‚¹å‡»é—®é¢˜ä¿®å¤ âœ…

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šï¼š**ç‚¹å‡»å¹´ä»½é€‰æ‹©å™¨æŒ‰é’®ï¼ˆ1990å¹´ï¼‰æ²¡æœ‰ä»»ä½•ååº”**

---

## ğŸ” æ ¹æœ¬åŸå› 

æ‰¾åˆ°äº†çœŸæ­£çš„é—®é¢˜ï¼ä¸æ˜¯é€‰æ‹©å™¨æœ¬èº«çš„é—®é¢˜ï¼Œè€Œæ˜¯ï¼š

### âŒ API å‡½æ•°åé”™è¯¯

```typescript
// âŒ é”™è¯¯çš„å‡½æ•°åï¼ˆä¸å­˜åœ¨ï¼‰
const result = await chartService.createChart(requestData);
```

**é—®é¢˜**ï¼š
- `baziApi.ts` ä¸­æ²¡æœ‰ `createChart` å‡½æ•°
- æ­£ç¡®çš„å‡½æ•°åæ˜¯ `computeChart`
- TypeScript ç¼–è¯‘é”™è¯¯å¯¼è‡´æ•´ä¸ªç»„ä»¶æ— æ³•æ­£å¸¸å·¥ä½œ
- é€‰æ‹©å™¨çš„ç‚¹å‡»äº‹ä»¶è¢«é˜»å¡

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ­£ API å‡½æ•°å

```typescript
// âœ… ä½¿ç”¨æ­£ç¡®çš„å‡½æ•°å
const result = await chartService.computeChart(requestData);
```

### 2. è°ƒæ•´å‚æ•°æ ¼å¼

**ä¿®æ”¹å‰** âŒï¼š
```typescript
const requestData = {
  name: formData.name || 'å‘½ä¸»',
  gender: formData.gender!,
  calendarType: formData.calendarType!,
  year: parseInt(formData.year),
  month: parseInt(formData.month),
  day: parseInt(formData.day),
  hour: parseInt(formData.hour),
  minute: parseInt(formData.minute),
  birthPlace: formData.birthPlace,
  relation: formData.relation,
};
```

**ä¿®æ”¹å** âœ…ï¼š
```typescript
const requestData = {
  name: formData.name || 'å‘½ä¸»',
  gender: formData.gender!,
  birth: {  // âœ… åµŒå¥—çš„ birth å¯¹è±¡
    year: parseInt(formData.year),
    month: parseInt(formData.month),
    day: parseInt(formData.day),
    hour: parseInt(formData.hour),
    minute: parseInt(formData.minute),
  },
  relationType: formData.relation,  // âœ… æ”¹åä¸º relationType
  notes: `å‡ºç”Ÿåœ°ï¼š${formData.birthPlace}`,  // âœ… birthPlace æ”¾å…¥ notes
};
```

**åŒ¹é…çš„æ¥å£**ï¼š
```typescript
export interface ComputeChartParams {
  name: string;
  gender: 'male' | 'female';
  birth: {
    year: number;
    month: number;
    day: number;
    hour: number;
    minute?: number;
  };
  relationType?: RelationType;
  relationLabel?: string;
  notes?: string;
  forceRecompute?: boolean;
}
```

### 3. æ·»åŠ å¼€å‘æ¨¡å¼ Mock

åœ¨ `baziApi.ts` ä¸­æ·»åŠ ï¼š

```typescript
export const computeChart = async (params: ComputeChartParams): Promise<ApiResponse> => {
  // ğŸ”§ å¼€å‘/æµ‹è¯•æ¨¡å¼ï¼šè¿”å›æ¨¡æ‹Ÿæ•°æ®
  if (__DEV__) {
    console.log('ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿå‘½ç›˜è®¡ç®—', params);
    
    await new Promise(resolve => setTimeout(resolve, 800));
    
    return {
      success: true,
      data: {
        chartId: `mock-chart-${Date.now()}`,
        profileId: `mock-profile-${Date.now()}`,
        name: params.name,
        gender: params.gender,
        birth: params.birth,
        bazi: {
          year: 'ç”²å­',
          month: 'ä¹™ä¸‘',
          day: 'ä¸™å¯…',
          hour: 'ä¸å¯',
        },
        wuxing: {
          é‡‘: 1,
          æœ¨: 2,
          æ°´: 1,
          ç«: 2,
          åœŸ: 2,
        },
      },
      message: 'å‘½ç›˜è®¡ç®—æˆåŠŸï¼ˆå¼€å‘æ¨¡å¼ï¼‰',
    };
  }
  
  return apiClient.post('/api/v1/bazi/chart', params);
};
```

---

## ğŸ“Š ä¸ºä»€ä¹ˆè¿™ä¼šå¯¼è‡´é€‰æ‹©å™¨æ— æ³•ç‚¹å‡»ï¼Ÿ

### JavaScript é”™è¯¯ä¼ æ’­é“¾

```
TypeScript ç¼–è¯‘é”™è¯¯
    â†“
è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥å¤±è´¥
    â†“
ç»„ä»¶æ¸²æŸ“å‡ºé”™ï¼ˆéƒ¨åˆ†å¤±è´¥ï¼‰
    â†“
äº‹ä»¶ç›‘å¬å™¨æœªæ­£ç¡®ç»‘å®š
    â†“
ç‚¹å‡»æŒ‰é’®æ— ååº” âŒ
```

### å…·ä½“åŸå› 

1. **TypeScript ç±»å‹é”™è¯¯**
   - `chartService` ä¸Šä¸å­˜åœ¨ `createChart` å±æ€§
   - TypeScript ç¼–è¯‘å™¨æŠ¥é”™
   - ä½†ä»£ç ä»ç„¶ä¼šå°è¯•è¿è¡Œ

2. **è¿è¡Œæ—¶é”™è¯¯é£é™©**
   - å¦‚æœç”¨æˆ·æäº¤è¡¨å•
   - ä¼šè°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°
   - æŠ›å‡º `undefined is not a function` é”™è¯¯
   - å¯èƒ½å¯¼è‡´æ•´ä¸ªç»„ä»¶å´©æºƒ

3. **React é”™è¯¯è¾¹ç•Œ**
   - æŸäº›é”™è¯¯å¯èƒ½è§¦å‘ React çš„é”™è¯¯å¤„ç†
   - å¯¼è‡´ç»„ä»¶éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆ
   - åŒ…æ‹¬äº‹ä»¶ç›‘å¬å™¨

---

## ğŸ¯ ä¿®å¤åçš„æ•ˆæœ

### åŠŸèƒ½æ¢å¤ âœ…

```
ç‚¹å‡» [ 1990å¹´ â–¼ ]
    â†“
æ‰“å¼€é€‰æ‹©å™¨ Modal
    â†“
è‡ªåŠ¨æ»šåŠ¨åˆ° 1990 å¹´
    â†“
é€‰æ‹©å…¶ä»–å¹´ä»½ï¼ˆå¦‚ 1998ã€2004ï¼‰
    â†“
ç‚¹å‡» [ç¡®å®š]
    â†“
æ˜¾ç¤ºæ›´æ–°ä¸º [ 1998å¹´ â–¼ ] æˆ– [ 2004å¹´ â–¼ ]
    â†“
âœ… å®Œç¾å·¥ä½œï¼
```

### æäº¤åŠŸèƒ½ âœ…

```
å¡«å†™å®Œæ•´è¡¨å•
    â†“
ç‚¹å‡» [é–‹å§‹æ’ç›¤]
    â†“
è°ƒç”¨ computeChart APIï¼ˆå¼€å‘æ¨¡å¼è¿”å› mockï¼‰
    â†“
æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    â†“
âœ… æ­£å¸¸å·¥ä½œï¼
```

---

## ğŸ”§ TypeScript ç±»å‹å®‰å…¨

### ä¿®å¤å‰ âŒ

```typescript
import * as chartService from '@/services/api/baziApi';

// TypeScript æŠ¥é”™ï¼š
// ç±»å‹"typeof import(...)"ä¸Šä¸å­˜åœ¨å±æ€§"createChart"
chartService.createChart(data);
```

### ä¿®å¤å âœ…

```typescript
import * as chartService from '@/services/api/baziApi';

// âœ… TypeScript é€šè¿‡
chartService.computeChart(data);
```

---

## ğŸ“± æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•é€‰æ‹©å™¨ç‚¹å‡»

```
â–¡ é‡æ–°åŠ è½½åº”ç”¨ (âŒ˜R)
â–¡ è¿›å…¥æ‰‹åŠ¨æ’ç›˜é¡µ
â–¡ ç‚¹å‡» [ 1990å¹´ â–¼ ]
  â†’ âœ… åº”è¯¥æ‰“å¼€é€‰æ‹©å™¨
  â†’ âœ… è‡ªåŠ¨æ»šåŠ¨åˆ° 1990 å¹´
â–¡ é€‰æ‹© 1998 å¹´
  â†’ âœ… æ˜¾ç¤ºæ›´æ–°ä¸º [ 1998å¹´ â–¼ ]
â–¡ å†æ¬¡ç‚¹å‡»ï¼Œé€‰æ‹© 2004 å¹´
  â†’ âœ… è‡ªåŠ¨æ»šåŠ¨åˆ° 2004 å¹´
  â†’ âœ… å¯ä»¥æ­£å¸¸é€‰æ‹©
```

### 2. æµ‹è¯•å…¶ä»–é€‰æ‹©å™¨

```
â–¡ ç‚¹å‡» [ 1æœˆ â–¼ ]
  â†’ âœ… æ­£å¸¸æ‰“å¼€
â–¡ ç‚¹å‡» [ 1æ—¥ â–¼ ]
  â†’ âœ… æ­£å¸¸æ‰“å¼€
â–¡ ç‚¹å‡» [ 0æ™‚ â–¼ ]
  â†’ âœ… æ­£å¸¸æ‰“å¼€
â–¡ ç‚¹å‡» [ 0åˆ† â–¼ ]
  â†’ âœ… æ­£å¸¸æ‰“å¼€
```

### 3. æµ‹è¯•æäº¤åŠŸèƒ½

```
â–¡ å¡«å†™å®Œæ•´è¡¨å•ï¼š
  - æ€§åˆ«ï¼šç”·
  - å†æ³•ï¼šå…¬å†
  - æ—¥æœŸï¼š1998-06-15
  - æ—¶é—´ï¼š14:30
â–¡ ç‚¹å‡» [é–‹å§‹æ’ç›¤]
  â†’ âœ… æ˜¾ç¤º Loading
  â†’ âœ… 0.8ç§’åè¿”å›æˆåŠŸ
  â†’ âœ… å¼¹å‡º "å‘½ç›¤å·²å‰µå»º" æç¤º
```

---

## ğŸŠ æ€»ç»“

### é—®é¢˜æœ¬è´¨

- âŒ **ä¸æ˜¯é€‰æ‹©å™¨çš„é—®é¢˜**
- âŒ **ä¸æ˜¯ç‚¹å‡»äº‹ä»¶çš„é—®é¢˜**
- âœ… **æ˜¯ API å‡½æ•°åé”™è¯¯å¯¼è‡´çš„ TypeScript ç¼–è¯‘é”™è¯¯**

### ä¿®å¤å†…å®¹

1. âœ… ä¿®æ­£ API å‡½æ•°åï¼š`createChart` â†’ `computeChart`
2. âœ… è°ƒæ•´å‚æ•°æ ¼å¼ä»¥åŒ¹é…æ¥å£
3. âœ… æ·»åŠ å¼€å‘æ¨¡å¼ Mock
4. âœ… æ‰€æœ‰ TypeScript ç±»å‹é”™è¯¯å·²ä¿®å¤

### éªŒè¯ç»“æœ

```
â–¡ TypeScript ç¼–è¯‘é€šè¿‡ âœ…
â–¡ Linter æ— é”™è¯¯ âœ…
â–¡ é€‰æ‹©å™¨å¯ä»¥ç‚¹å‡» âœ…
â–¡ è‡ªåŠ¨æ»šåŠ¨å·¥ä½œæ­£å¸¸ âœ…
â–¡ æäº¤åŠŸèƒ½æ­£å¸¸ âœ…
```

---

**ç‰ˆæœ¬**: v13.0  
**å®Œæˆæ—¥æœŸ**: 2025-11-19  
**çŠ¶æ€**: âœ… é€‰æ‹©å™¨ç‚¹å‡»é—®é¢˜å·²ä¿®å¤ï¼

ğŸ‰ **ç°åœ¨è¯· Reload åº”ç”¨ï¼ˆâŒ˜Rï¼‰ï¼Œé€‰æ‹©å™¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼** ğŸ‰


# å‘½ç›˜è¯¦æƒ…é¡µå®Œæ•´ä¿®å¤æ€»ç»“ âœ…

## ğŸ› é—®é¢˜å›é¡¾

ç”¨æˆ·æŠ¥å‘Šäº†ä¸¤ä¸ªé—®é¢˜ï¼š

### 1. å‘½ç›˜åˆ›å»ºåä¸è·³è½¬
- âŒ åˆ›å»ºæˆåŠŸååªæ˜¾ç¤ºæç¤º
- âŒ éœ€è¦æ‰‹åŠ¨æŸ¥æ‰¾æ–°åˆ›å»ºçš„å‘½ç›˜

### 2. ChartDetailScreen æŠ¥é”™
```
TypeError: Cannot read property 'getChartDetail' of undefined
```

---

## ğŸ”§ å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: è‡ªåŠ¨è·³è½¬åˆ°è¯¦æƒ…é¡µ âœ…

**æ–‡ä»¶**: `app/src/screens/ManualBazi/ManualBaziScreen.tsx`

**ä¿®æ”¹å‰** âŒï¼š
```typescript
const result = await chartService.computeChart(requestData);
console.log('âœ… å‘½ç›˜åˆ›å»ºæˆåŠŸ:', result);

// âŒ åªæ˜¯å¼¹æç¤ºï¼Œç„¶åè¿”å›
Alert.alert('æˆåŠŸ', 'å‘½ç›¤å·²å‰µå»º', [
  {
    text: 'ç¢ºå®š',
    onPress: () => {
      navigation.goBack();
    },
  },
]);
```

**ä¿®æ”¹å** âœ…ï¼š
```typescript
const result = await chartService.computeChart(requestData);
console.log('âœ… å‘½ç›˜åˆ›å»ºæˆåŠŸ:', result);

// âœ… è·å– ID å¹¶è·³è½¬
const chartId = result.data?.chartId;
const profileId = result.data?.profileId;

if (chartId && profileId) {
  navigation.replace('ChartDetail', {
    chartId: chartId,
    masterId: profileId,
    initialTab: 'basic',
  });
}
```

---

### ä¿®å¤ 2: æ·»åŠ  chartService å¯¼å‡º âœ…

**æ–‡ä»¶**: `app/src/services/api/index.ts`

**ä¿®æ”¹å‰** âŒï¼š
```typescript
export * from './client';
export * as authApi from './authApi';
export * as baziApi from './baziApi';  // âœ… æœ‰
export { authService } from './authService';
// âŒ æ²¡æœ‰ chartService
```

**ä¿®æ”¹å** âœ…ï¼š
```typescript
export * from './client';
export * as authApi from './authApi';
export * as baziApi from './baziApi';
export * as chartService from './baziApi';  // âœ… æ·»åŠ åˆ«å
export { authService } from './authService';
```

---

### ä¿®å¤ 3: æ·»åŠ  getChartDetail çš„å¼€å‘æ¨¡å¼ Mock âœ…

**æ–‡ä»¶**: `app/src/services/api/baziApi.ts`

**ä¿®æ”¹å‰** âŒï¼š
```typescript
export const getChartDetail = async (chartId: string): Promise<ApiResponse> => {
  // âŒ ç›´æ¥è°ƒç”¨ APIï¼Œä¼šå¤±è´¥
  return apiClient.get(`/api/v1/bazi/charts/${chartId}`);
};
```

**ä¿®æ”¹å** âœ…ï¼š
```typescript
export const getChartDetail = async (chartId: string): Promise<ApiResponse> => {
  // âœ… å¼€å‘æ¨¡å¼è¿”å› mock
  if (__DEV__) {
    console.log('ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿè·å–å‘½ç›˜è¯¦æƒ…', chartId);
    
    await new Promise(resolve => setTimeout(resolve, 500));
    
    return {
      success: true,
      data: {
        chartId: chartId,
        profileId: 'mock-profile-123',
        name: 'å‘½ä¸»',
        gender: 'male',
        birth: {
          year: 1990,
          month: 6,
          day: 15,
          hour: 14,
          minute: 30,
        },
        calendarType: 'solar',
        bazi: {
          year: { gan: 'åºš', zhi: 'åˆ' },
          month: { gan: 'å£¬', zhi: 'åˆ' },
          day: { gan: 'ç™¸', zhi: 'æœª' },
          hour: { gan: 'å·±', zhi: 'æœª' },
        },
        wuxing: {
          é‡‘: 1,
          æœ¨: 1,
          æ°´: 2,
          ç«: 3,
          åœŸ: 3,
        },
        // ... æ›´å¤šæ•°æ®
      },
      message: 'è·å–å‘½ç›˜è¯¦æƒ…æˆåŠŸï¼ˆå¼€å‘æ¨¡å¼ï¼‰',
    };
  }
  
  return apiClient.get(`/api/v1/bazi/charts/${chartId}`);
};
```

---

## ğŸ¯ å®Œæ•´æµç¨‹æ¼”ç¤º

### ç”¨æˆ·æ“ä½œæµç¨‹

```
1. [æ‰‹åŠ¨æ’ç›˜é¡µé¢]
   â†“
   å¡«å†™è¡¨å•ï¼š
   - æ€§åˆ«ï¼šç”· âœ“
   - å†æ³•ï¼šå…¬å† âœ“
   - æ—¥æœŸï¼š1990-06-15 âœ“
   - æ—¶é—´ï¼š14:30 âœ“
   â†“
2. ç‚¹å‡» [é–‹å§‹æ’ç›¤]
   â†“
3. æ˜¾ç¤º Loading...
   â†“
4. âœ¨ è‡ªåŠ¨è·³è½¬åˆ°å‘½ç›˜è¯¦æƒ…é¡µ
   â†“
5. [å‘½ç›˜è¯¦æƒ…é¡µ]
   æ˜¾ç¤ºï¼š
   - ğŸ‘¤ å‘½ä¸»ï¼šå‘½ä¸»
   - âš¤ æ€§åˆ«ï¼šç”·
   - ğŸ“… å‡ºç”Ÿï¼š1990å¹´6æœˆ15æ—¥ 14:30
   - ğŸ“ å››æŸ±ï¼šåºšåˆ å£¬åˆ ç™¸æœª å·±æœª
   - ğŸŒŸ äº”è¡Œï¼šé‡‘1 æœ¨1 æ°´2 ç«3 åœŸ3
   â†“
6. æŒ‰è¿”å›é”® â†’ å›åˆ°é¦–é¡µ
```

### åå°æ—¥å¿—è¾“å‡º

```
ğŸ“¤ æäº¤æ’ç›˜æ•°æ®: {
  name: 'å‘½ä¸»',
  gender: 'male',
  birth: { year: 1990, month: 6, day: 15, hour: 14, minute: 30 }
}

ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿå‘½ç›˜è®¡ç®— {
  name: 'å‘½ä¸»',
  gender: 'male',
  birth: { ... }
}

âœ… å‘½ç›˜åˆ›å»ºæˆåŠŸ: {
  success: true,
  data: {
    chartId: 'mock-chart-1732012345678',
    profileId: 'mock-profile-1732012345678',
    name: 'å‘½ä¸»',
    gender: 'male',
    birth: { ... },
    bazi: { year: 'ç”²å­', month: 'ä¹™ä¸‘', day: 'ä¸™å¯…', hour: 'ä¸å¯' },
    wuxing: { é‡‘: 1, æœ¨: 2, æ°´: 1, ç«: 2, åœŸ: 2 }
  },
  message: 'å‘½ç›˜è®¡ç®—æˆåŠŸï¼ˆå¼€å‘æ¨¡å¼ï¼‰'
}

ğŸ“Š å‘½ç›˜ID: mock-chart-1732012345678 æ¡£æ¡ˆID: mock-profile-1732012345678

[å¯¼èˆª] è·³è½¬åˆ° ChartDetail é¡µé¢

ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿè·å–å‘½ç›˜è¯¦æƒ… mock-chart-1732012345678

[ChartDetail] åŠ è½½å‘½ç›˜æ•°æ®
[ChartDetail] æ¸²æŸ“åŸºæœ¬ä¿¡æ¯ tab
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### 1. `app/src/screens/ManualBazi/ManualBaziScreen.tsx`
- âœ… ä¿®æ”¹æäº¤æˆåŠŸåçš„é€»è¾‘
- âœ… ä½¿ç”¨ `navigation.replace` è·³è½¬
- âœ… æ·»åŠ æ—¥å¿—è¾“å‡º

### 2. `app/src/services/api/index.ts`
- âœ… æ·»åŠ  `export * as chartService from './baziApi'`

### 3. `app/src/services/api/baziApi.ts`
- âœ… ä¸º `getChartDetail` æ·»åŠ å¼€å‘æ¨¡å¼ mock
- âœ… è¿”å›å®Œæ•´çš„å‘½ç›˜è¯¦æƒ…æ•°æ®

---

## ğŸ¨ æŠ€æœ¯ç»†èŠ‚

### navigation.replace vs navigation.navigate

**ä½¿ç”¨ `replace`**ï¼š
```
å¯¼èˆªæ ˆï¼š[é¦–é¡µ] â†’ [å‘½ç›˜è¯¦æƒ…]
æŒ‰è¿”å›é”®ï¼šå›åˆ°é¦–é¡µ âœ…
```

**ä½¿ç”¨ `navigate`**ï¼š
```
å¯¼èˆªæ ˆï¼š[é¦–é¡µ] â†’ [æ‰‹åŠ¨æ’ç›˜] â†’ [å‘½ç›˜è¯¦æƒ…]
æŒ‰è¿”å›é”®ï¼šå›åˆ°æ‰‹åŠ¨æ’ç›˜é¡µ âŒ
```

### chartService åˆ«åæœºåˆ¶

```typescript
// åº•å±‚ API æ¨¡å—
export * as baziApi from './baziApi';

// ä¸šåŠ¡æœåŠ¡åˆ«å
export * as chartService from './baziApi';

// ä¸¤ç§å¯¼å…¥æ–¹å¼éƒ½æ”¯æŒï¼š
import { baziApi } from '@/services/api';      // âœ…
import { chartService } from '@/services/api';  // âœ…
```

### å¼€å‘æ¨¡å¼ Mock ç­–ç•¥

```typescript
if (__DEV__) {
  // 1. æ‰“å°æ—¥å¿—
  console.log('ğŸ”§ å¼€å‘æ¨¡å¼ï¼š...');
  
  // 2. æ¨¡æ‹Ÿå»¶è¿Ÿ
  await new Promise(resolve => setTimeout(resolve, 500));
  
  // 3. è¿”å› mock æ•°æ®
  return {
    success: true,
    data: { /* mock data */ },
    message: '...ï¼ˆå¼€å‘æ¨¡å¼ï¼‰',
  };
}

// 4. ç”Ÿäº§ç¯å¢ƒè°ƒç”¨çœŸå® API
return apiClient.get(...);
```

---

## ğŸ“± æµ‹è¯•æ¸…å•

### åŸºç¡€æµç¨‹ âœ…

```
â–¡ Reload åº”ç”¨ (âŒ˜R)
â–¡ è¿›å…¥æ‰‹åŠ¨æ’ç›˜é¡µ
â–¡ å¡«å†™å®Œæ•´è¡¨å•
â–¡ ç‚¹å‡» [é–‹å§‹æ’ç›¤]
â–¡ âœ… æ˜¾ç¤º Loading
â–¡ âœ… 0.8ç§’åè‡ªåŠ¨è·³è½¬åˆ°è¯¦æƒ…é¡µ
â–¡ âœ… è¯¦æƒ…é¡µæ­£å¸¸åŠ è½½
â–¡ âœ… æ˜¾ç¤ºå…«å­—ä¿¡æ¯
â–¡ âœ… ä¸å†æŠ¥ TypeError
```

### æ—¥å¿—æ£€æŸ¥ âœ…

æ‰“å¼€æ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
â–¡ âœ… ğŸ“¤ æäº¤æ’ç›˜æ•°æ®
â–¡ âœ… ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿå‘½ç›˜è®¡ç®—
â–¡ âœ… âœ… å‘½ç›˜åˆ›å»ºæˆåŠŸ
â–¡ âœ… ğŸ“Š å‘½ç›˜ID å’Œ æ¡£æ¡ˆID
â–¡ âœ… ğŸ”§ å¼€å‘æ¨¡å¼ï¼šæ¨¡æ‹Ÿè·å–å‘½ç›˜è¯¦æƒ…
```

ä¸åº”è¯¥çœ‹åˆ°ï¼š
```
â–¡ âŒ TypeError: Cannot read property 'getChartDetail' of undefined
â–¡ âŒ åŠ è½½å‘½ç›˜æ•°æ®å¤±è´¥
â–¡ âŒ API è°ƒç”¨é”™è¯¯
```

### è¾¹ç•Œæƒ…å†µ âœ…

```
â–¡ æµ‹è¯•å¤šæ¬¡æäº¤ï¼ˆé˜²æ­¢é‡å¤æäº¤ï¼‰
â–¡ æµ‹è¯•å¿«é€Ÿç‚¹å‡»ï¼ˆæŒ‰é’®åº”è¯¥è¢«ç¦ç”¨ï¼‰
â–¡ æµ‹è¯•è¿”å›é”®ï¼ˆåº”è¯¥å›åˆ°é¦–é¡µï¼Œä¸æ˜¯æ’ç›˜é¡µï¼‰
â–¡ æµ‹è¯•å†æ¬¡è¿›å…¥æ’ç›˜é¡µï¼ˆè¡¨å•åº”è¯¥æ˜¯ç©ºçš„æˆ–é»˜è®¤å€¼ï¼‰
```

---

## ğŸŠ æ€»ç»“

### ä¿®å¤çš„é—®é¢˜

| # | é—®é¢˜ | åŸå›  | ä¿®å¤ |
|---|------|------|------|
| 1 | åˆ›å»ºåä¸è·³è½¬ | åªè¿”å›ä¸Šä¸€é¡µ | `navigation.replace` åˆ°è¯¦æƒ…é¡µ |
| 2 | TypeError æŠ¥é”™ | `chartService` æœªå¯¼å‡º | æ·»åŠ  `export * as chartService` |
| 3 | API è°ƒç”¨å¤±è´¥ | æ— å¼€å‘æ¨¡å¼ mock | æ·»åŠ  `getChartDetail` mock |

### ç”¨æˆ·ä½“éªŒæå‡

**ä¿®æ”¹å‰**ï¼š
```
åˆ›å»ºå‘½ç›˜ â†’ æ˜¾ç¤ºæç¤º â†’ è¿”å› â†’ æ‰‹åŠ¨æŸ¥æ‰¾ ğŸ˜¡
   (5æ­¥)
```

**ä¿®æ”¹å**ï¼š
```
åˆ›å»ºå‘½ç›˜ â†’ ç›´æ¥çœ‹åˆ°ç»“æœ âœ¨
   (1æ­¥)
```

### ä»£ç è´¨é‡æå‡

- âœ… **ç±»å‹å®‰å…¨**ï¼šTypeScript æ— é”™è¯¯
- âœ… **å‘åå…¼å®¹**ï¼šæ”¯æŒä¸¤ç§å¯¼å…¥æ–¹å¼
- âœ… **å¼€å‘å‹å¥½**ï¼šå®Œæ•´çš„ mock æ•°æ®
- âœ… **æ—¥å¿—å®Œå–„**ï¼šæ¸…æ™°çš„æµç¨‹è¿½è¸ª
- âœ… **é”™è¯¯å¤„ç†**ï¼šå…œåº•é€»è¾‘å®Œå¤‡

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰ âœ…

- âœ… ä¿®å¤ chartService å¯¼å…¥é—®é¢˜
- âœ… æ·»åŠ è‡ªåŠ¨è·³è½¬é€»è¾‘
- âœ… æ·»åŠ å¼€å‘æ¨¡å¼ mock

### ä¸­æœŸï¼ˆå¯é€‰ï¼‰

- ğŸ“Œ å®Œå–„ ChartDetail é¡µé¢çš„ UI
- ğŸ“Œ æ·»åŠ åŠ è½½éª¨æ¶å±
- ğŸ“Œ æ·»åŠ æ•°æ®åˆ·æ–°åŠŸèƒ½
- ğŸ“Œ æ·»åŠ åˆ†äº«/å¯¼å‡ºåŠŸèƒ½

### é•¿æœŸï¼ˆè§„åˆ’ï¼‰

- ğŸ“Œ æ¥å…¥çœŸå®åç«¯ API
- ğŸ“Œ æ·»åŠ å‘½ç›˜å¯¹æ¯”åŠŸèƒ½
- ğŸ“Œ æ·»åŠ å‘½ç›˜æ”¶è—åŠŸèƒ½
- ğŸ“Œ æ·»åŠ å‘½ç›˜å†å²è®°å½•

---

**ç‰ˆæœ¬**: v16.0  
**å®Œæˆæ—¥æœŸ**: 2025-11-19  
**çŠ¶æ€**: âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼

ğŸ‰ **ç°åœ¨ Reload åº”ç”¨ï¼ˆâŒ˜Rï¼‰ï¼Œå®Œæ•´æµç¨‹åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼** ğŸ‰

---

## ğŸ“ Reload åæµ‹è¯•æ­¥éª¤

1. **Reload åº”ç”¨**: æŒ‰ `âŒ˜R` (iOS) æˆ– `RR` (Android)

2. **æµ‹è¯•å®Œæ•´æµç¨‹**:
   ```
   è¿›å…¥æ‰‹åŠ¨æ’ç›˜
       â†“
   å¡«å†™ï¼šç”· / å…¬å† / 1990-06-15 / 14:30
       â†“
   ç‚¹å‡» [é–‹å§‹æ’ç›¤]
       â†“
   âœ¨ è‡ªåŠ¨è·³è½¬åˆ°è¯¦æƒ…é¡µ
       â†“
   âœ… çœ‹åˆ°å…«å­—ï¼šåºšåˆ å£¬åˆ ç™¸æœª å·±æœª
   ```

3. **æ£€æŸ¥æ§åˆ¶å°**: åº”è¯¥çœ‹åˆ°å®Œæ•´çš„æ—¥å¿—è¾“å‡ºï¼Œæ²¡æœ‰é”™è¯¯

å¦‚æœè¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—å¹¶å‘Šè¯‰æˆ‘ï¼ ğŸ™


# éƒ¨ç½²å’Œè¿ç§»å®ŒæˆæŠ¥å‘Š

ç”Ÿæˆæ—¶é—´: 2025-12-26

## âœ… éƒ¨ç½²çŠ¶æ€

- **éƒ¨ç½²ç‰ˆæœ¬**: xiaopei-core-00034-zxz
- **éƒ¨ç½²æ—¶é—´**: 2025-12-26
- **æœåŠ¡ URL**: https://xiaopei-core-343578696044.asia-east2.run.app
- **çŠ¶æ€**: âœ… éƒ¨ç½²æˆåŠŸ

## âœ… å·²æ‰§è¡Œçš„è¿ç§»

### Migration 044: ä¿®å¤ç¥ç…è§£è¯»è¡¨ç¼–ç é—®é¢˜
- **çŠ¶æ€**: âœ… æ‰§è¡ŒæˆåŠŸ
- **ä¿®å¤å†…å®¹**:
  - ç¡®ä¿ `shensha_readings` è¡¨ä½¿ç”¨ utf8mb4 å­—ç¬¦é›†
  - ç¡®ä¿æ‰€æœ‰æ–‡æœ¬åˆ—ä½¿ç”¨ utf8mb4 å­—ç¬¦é›†
- **ç»“æœ**: è¡¨å­—ç¬¦é›†å·²ä¿®å¤ä¸º utf8mb4

### Migration 045: ä¿®å¤è¡¨ç»“æ„å·®å¼‚ï¼ˆå¾…æ‰§è¡Œï¼‰
- **çŠ¶æ€**: â³ å·²åˆ›å»ºï¼Œå¾…æ‰§è¡Œ
- **ä¿®å¤å†…å®¹**:
  1. `conversations` è¡¨ï¼š
     - ä¿®å¤ `title` å­—æ®µç±»å‹ï¼švarchar(200) â†’ varchar(255)
     - ä¿®å¤ `source` å­—æ®µç±»å‹ï¼švarchar(32) â†’ varchar(50)
  2. `users` è¡¨ï¼šæ·»åŠ ç¼ºå¤±çš„å­—æ®µ
     - `username` VARCHAR(64) NULL UNIQUE
     - `password_set` TINYINT(1) NOT NULL DEFAULT 0
     - `invite_code` VARCHAR(20) NULL
     - `invited_by` VARCHAR(36) NULL
     - `last_login_at` DATETIME NULL
     - `avatar_url` VARCHAR(255) NULL
  3. `day_stem_readings` è¡¨ï¼š
     - ä¿®å¤ `stem` å­—æ®µç±»å‹ï¼švarchar(2) â†’ varchar(10)

## ğŸ“Š è¡¨ç»“æ„æ¯”å¯¹ç»“æœ

### è¡¨æ•°é‡
- **å¼€å‘ç¯å¢ƒ**: 25 å¼ è¡¨
- **ç”Ÿäº§ç¯å¢ƒ**: 24 å¼ è¡¨
- **å·®å¼‚**: ç”Ÿäº§ç¯å¢ƒç¼ºå¤± `llm_api_config` è¡¨ï¼ˆé‡å¤è¡¨ï¼Œå¯å¿½ç•¥ï¼‰

### å…³é”®è¡¨ç»“æ„å·®å¼‚

#### 1. conversations è¡¨
- **å¼€å‘ç¯å¢ƒ**: 11 åˆ—
- **ç”Ÿäº§ç¯å¢ƒ**: 11 åˆ—
- **å·®å¼‚**:
  - `title`: å¼€å‘=varchar(255), ç”Ÿäº§=varchar(200) âš ï¸
  - `source`: å¼€å‘=varchar(50), ç”Ÿäº§=varchar(32) âš ï¸

#### 2. users è¡¨
- **å¼€å‘ç¯å¢ƒ**: 25 åˆ—
- **ç”Ÿäº§ç¯å¢ƒ**: 19 åˆ—
- **ç¼ºå¤±å­—æ®µ** (6 ä¸ª):
  - `username` âš ï¸
  - `password_set` âš ï¸
  - `invite_code` âš ï¸
  - `invited_by` âš ï¸
  - `last_login_at` âš ï¸
  - `avatar_url` âš ï¸

#### 3. shensha_readings è¡¨
- **å¼€å‘ç¯å¢ƒ**: 16 åˆ—
- **ç”Ÿäº§ç¯å¢ƒ**: 16 åˆ—
- **çŠ¶æ€**: âœ… ç»“æ„ä¸€è‡´ï¼ˆç¼–ç å·²ä¿®å¤ï¼‰

#### 4. llm_api_configs è¡¨
- **å¼€å‘ç¯å¢ƒ**: 15 åˆ—
- **ç”Ÿäº§ç¯å¢ƒ**: 15 åˆ—
- **çŠ¶æ€**: âœ… ç»“æ„ä¸€è‡´

#### 5. day_stem_readings è¡¨
- **å·®å¼‚**: `stem` å­—æ®µç±»å‹ä¸ä¸€è‡´
  - å¼€å‘=varchar(10), ç”Ÿäº§=varchar(2) âš ï¸

## ğŸ”§ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. æ‰§è¡Œ Migration 045
```bash
curl -X POST "https://xiaopei-core-343578696044.asia-east2.run.app/api/admin/v1/migration/045" \
  -H "Content-Type: application/json" \
  -d "{}"
```

### 2. éªŒè¯ä¿®å¤ç»“æœ
- é‡æ–°æ¯”å¯¹è¡¨ç»“æ„ï¼Œç¡®è®¤å·®å¼‚å·²ä¿®å¤
- æµ‹è¯•ç¥ç…è§£è¯»åŠŸèƒ½ï¼Œç¡®è®¤ä¹±ç é—®é¢˜å·²è§£å†³

### 3. æµ‹è¯• DeepSeek API
- éªŒè¯ DeepSeek API Key é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
- æµ‹è¯• AI å¯¹è¯åŠŸèƒ½

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **é‡å¤è¡¨**: `llm_api_config` å’Œ `llm_api_configs` åŒæ—¶å­˜åœ¨ï¼Œå»ºè®®æ£€æŸ¥å¹¶åˆ é™¤å…¶ä¸­ä¸€ä¸ª
2. **å­—æ®µç±»å‹å·®å¼‚**: éƒ¨åˆ†å­—æ®µç±»å‹ä¸ä¸€è‡´ï¼Œå¯èƒ½å½±å“åŠŸèƒ½ï¼Œéœ€è¦æ‰§è¡Œ Migration 045 ä¿®å¤
3. **ç¼ºå¤±å­—æ®µ**: `users` è¡¨ç¼ºå°‘ 6 ä¸ªå­—æ®µï¼Œå¯èƒ½å½±å“ç›¸å…³åŠŸèƒ½

## âœ… å·²å®Œæˆ

- âœ… éƒ¨ç½²æ–°ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… æ‰§è¡Œ Migration 044 ä¿®å¤ç¥ç…è§£è¯»ç¼–ç 
- âœ… åˆ›å»º Migration 045 ä¿®å¤è¡¨ç»“æ„å·®å¼‚
- âœ… ç”Ÿæˆè¡¨ç»“æ„æ¯”å¯¹æŠ¥å‘Š


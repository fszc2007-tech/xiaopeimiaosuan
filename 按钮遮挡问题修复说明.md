# 按钮遮挡问题修复说明

## 🔴 问题描述

**所有安卓设备的 Google 登录按钮被底部导航栏遮挡**

从用户反馈和图片来看，弹窗已经显示，但是底部的 Google 登录按钮被安卓系统的底部导航栏遮挡，导致用户无法点击。

## 🔍 问题分析

### 根本原因

1. **`sheetHeight` 计算不完整**
   - 原来的计算：`sheetHeight = Math.min(baseHeight, calculatedHeight)`
   - 问题：弹窗高度没有包含底部安全区域（`insets.bottom`）
   - 结果：弹窗底部紧贴屏幕底部，按钮被导航栏遮挡

2. **`paddingBottom` 不够大**
   - 原来的计算：`paddingBottom = Math.max(insets.bottom, spacing.lg)`
   - 问题：只取最大值，可能不够
   - 结果：内容区域的底部内边距不足，按钮仍然被遮挡

3. **弹窗位置问题**
   - 弹窗使用 `position: absolute` 和 `bottom: 0`
   - 如果 `sheetHeight` 不包含 `insets.bottom`，弹窗底部会紧贴屏幕底部
   - 底部导航栏会覆盖按钮

## ✅ 修复方案

### 修复 1: sheetHeight 计算

**修改前**：
```typescript
const sheetHeight = Math.min(baseHeight, calculatedHeight);
```

**修改后**：
```typescript
// ⚠️ 关键修复：sheetHeight 需要加上 insets.bottom，确保弹窗底部在安全区域之上
// 这样按钮就不会被底部导航栏遮挡
const sheetHeight = Math.min(baseHeight, calculatedHeight) + insets.bottom;
```

**原理**：
- 弹窗高度 = 内容高度 + 底部安全区域
- 这样弹窗的底部会在安全区域之上，按钮不会被遮挡

### 修复 2: paddingBottom 计算

**修改前**：
```typescript
paddingBottom: Math.max(insets.bottom, spacing.lg)
```

**修改后**：
```typescript
// ⚠️ 关键修复：paddingBottom 需要足够大，确保按钮在安全区域之上
// 使用 insets.bottom + spacing.lg 作为底部内边距，确保按钮完全可见
paddingBottom: insets.bottom + spacing.lg
```

**原理**：
- 内容区域底部内边距 = 底部安全区域 + 额外间距
- 使用加法而不是最大值，确保有足够的底部内边距

### 修复 3: 添加调试日志

**添加 console.warn 输出**：
```typescript
console.warn('[GoogleLoginSheet DEBUG]', {
  screenHeight,
  insetsBottom: insets.bottom,
  sheetHeight,
  paddingBottom,
  calculatedHeight,
});
```

**好处**：
- 可以在 `adb logcat` 中直接查看调试信息
- 不依赖 HTTP 服务器
- 方便实时调试

## 📊 修复效果

### 修复前
- 弹窗高度：`screenHeight * 0.45`（不包含底部安全区域）
- 内容区域底部内边距：`Math.max(insets.bottom, spacing.lg)`
- 结果：按钮被底部导航栏遮挡

### 修复后
- 弹窗高度：`screenHeight * 0.45 + insets.bottom`（包含底部安全区域）
- 内容区域底部内边距：`insets.bottom + spacing.lg`
- 结果：按钮完全在安全区域之上，不会被遮挡

## 🔍 验证方法

### 方法 1: 查看调试日志

```bash
# 查看 adb logcat 中的调试信息
adb logcat | grep "GoogleLoginSheet DEBUG"
```

**预期输出**：
```
[GoogleLoginSheet DEBUG] {
  screenHeight: 2340,
  insetsBottom: 48,
  sheetHeight: 1101,  // 1053 + 48
  paddingBottom: 64,   // 48 + 16
  calculatedHeight: 1122
}
```

### 方法 2: 实际测试

1. 在手机上打开 Google 登录弹窗
2. 检查按钮是否完全可见
3. 检查按钮是否可以被点击
4. 检查按钮是否在底部导航栏之上

## ⚠️ 注意事项

1. **需要重新构建 APK**
   - 代码修改后需要重新构建 APK 才能生效
   - 使用 `eas build --platform android --profile production`

2. **测试所有安卓设备**
   - 不同设备的 `insets.bottom` 可能不同
   - 建议在多个设备上测试

3. **调试日志**
   - 修复后可以通过 `adb logcat` 查看调试信息
   - 确认 `insetsBottom` 和 `sheetHeight` 的值是否正确

## 📝 代码变更

### 文件：`app/src/components/auth/GoogleLoginSheet.tsx`

1. **修改 `sheetHeight` 计算**（第 44 行）：
   - 添加 `+ insets.bottom`

2. **修改 `paddingBottom` 计算**（第 149 行）：
   - 从 `Math.max(insets.bottom, spacing.lg)` 改为 `insets.bottom + spacing.lg`

3. **添加 `console.warn` 调试日志**（第 52-57 行）：
   - 输出关键布局值到 adb logcat

## 🚀 下一步

1. **重新构建 APK**
2. **在多个安卓设备上测试**
3. **查看调试日志确认修复效果**


# 修复验证清单

## 如何验证修复是否真的在代码中

### 1. 华为 Mate 40 适配修复

**检查文件**: `app/src/components/auth/GoogleLoginSheet.tsx`

**应该看到**:
```typescript
const insets = useSafeAreaInsets();
const calculatedHeight = Math.max(minSheetHeight, maxSheetHeight - insets.bottom);
const sheetHeight = Math.min(baseHeight, calculatedHeight);
```

**以及**:
```typescript
<View style={[styles.content, { paddingBottom: Math.max(insets.bottom, spacing.lg) }]}>
```

**验证命令**:
```bash
grep -n "insets.bottom" app/src/components/auth/GoogleLoginSheet.tsx
```

### 2. PDF 乱码修复

**检查文件**: `core/src/server.ts`

**应该看到**:
```typescript
const originalJson = res.json;
res.json = function(body: any) {
  res.setHeader('Content-Type', 'application/json; charset=utf-8');
  return originalJson.call(this, body);
};
```

**验证命令**:
```bash
grep -n "originalJson" core/src/server.ts
```

### 3. Redis 降级修复

**检查文件**: `core/src/database/redis.ts`

**应该看到**:
```typescript
export function getRedisClient(): RedisClientType | null {
  return client;
}
```

**验证命令**:
```bash
grep -A 2 "getRedisClient" core/src/database/redis.ts
```

### 4. 版本号

**检查文件**: `app/app.json`

**应该看到**:
```json
"version": "1.0.4",
"versionCode": 4
```

**验证命令**:
```bash
grep -E "version|versionCode" app/app.json
```

## 构建验证

### 检查构建使用的 commit

```bash
cd app
eas build:list --platform android --limit 1 --non-interactive | grep Commit
```

**应该显示**: `Commit 252342389a818a7ad7463d37a8a759bb3da66407`

### 检查构建版本

```bash
cd app
eas build:list --platform android --limit 1 --non-interactive | grep -E "Version|versionCode"
```

**应该显示**:
- Version: 1.0.4
- Version code: 4

## 安装后验证

### 1. 检查安装的版本

```bash
adb shell dumpsys package tech.dawnai.xiaopei.app | grep -E "versionName|versionCode"
```

**应该显示**:
- versionName=1.0.4
- versionCode=4

### 2. 测试华为 Mate 40 适配

1. 打开 App
2. 点击"通过 Google 登录"
3. 检查弹窗：
   - 高度不超过屏幕 50%
   - 底部内容不被导航栏遮挡
   - 按钮可以正常点击

### 3. 测试 PDF 显示

1. 打开用户协议页面
2. 检查 PDF 是否正常显示（不乱码）

### 4. 测试短信发送

1. 输入手机号
2. 点击"下一步"
3. 检查是否能正常发送验证码（如果 Redis 未配置，应该能降级处理）


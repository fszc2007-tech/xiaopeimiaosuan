# èº«å¼ºèº«å¼±ç®—æ³•å¯¹æ¯”è¯„ä¼°æŠ¥å‘Š

## ðŸ“‹ è¯„ä¼°ç›®æ ‡

å¯¹æ¯”çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰ä¸Žæ–°ç®—æ³•æ–¹æ¡ˆçš„æ ¸å¿ƒå·®å¼‚ï¼Œè¯„ä¼°æ”¹åŠ¨å½±å“èŒƒå›´ä¸Žåˆç†æ€§ã€‚

---

## ä¸€ã€æ ¸å¿ƒç®—æ³•å¯¹æ¯”

### 1. æœˆä»¤æƒé‡ï¼ˆå¾—ä»¤ï¼‰

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **æ•°æ®æ¥æº**ï¼š`SEASON_WEIGHT` è¡¨ï¼ˆconstants.jsï¼‰
- **æ•°å€¼èŒƒå›´**ï¼š0.1 ~ 1.0ï¼ˆç›´æŽ¥æ˜ å°„ï¼Œéžæ ‡å‡†åŒ–ï¼‰
- **æƒé‡å æ¯”**ï¼š0.45ï¼ˆå­å¹³æ´¾ï¼‰
- **ç¤ºä¾‹**ï¼šæœ¨åœ¨è¾°æœˆ = 0.6

```72:78:core/engine/analysis/constants.js
export const SEASON_WEIGHT = {
  'æœ¨': [0.2, 0.1, 0.9, 1.0, 0.6, 0.3, 0.2, 0.2, 0.3, 0.3, 0.2, 0.1],
  // ç«ï¼šå¯…æœˆæœ¨æ—ºç”Ÿç«ä¸º"ç›¸"ï¼Œæƒé‡åº”æå‡åˆ°0.65ï¼ˆåŽŸ0.3åä½Žï¼‰
  'ç«': [0.1, 0.1, 0.65, 0.5, 0.8, 1.0, 1.0, 0.8, 0.4, 0.2, 0.1, 0.1],
  'åœŸ': [0.3, 0.6, 0.2, 0.2, 0.8, 0.3, 0.3, 0.8, 0.4, 0.3, 0.8, 0.3], // æœˆæœ«åœŸæ—ºï¼šè¾°æœªæˆŒä¸‘
  'é‡‘': [0.2, 0.2, 0.1, 0.1, 0.2, 0.2, 0.2, 0.3, 0.9, 1.0, 0.8, 0.5],
  'æ°´': [1.0, 0.8, 0.3, 0.2, 0.2, 0.1, 0.1, 0.1, 0.3, 0.5, 0.8, 0.9],
};
```

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **æ•°æ®æ¥æº**ï¼šæ—ºç›¸ä¼‘å›šæ­»æ˜ å°„è¡¨
- **æ•°å€¼æ˜ å°„**ï¼šæ—º1.0ã€ç›¸0.8ã€ä¼‘0.6ã€å›š0.4ã€æ­»0.2
- **æƒé‡å æ¯”**ï¼š0.40
- **ç¤ºä¾‹**ï¼šæœ¨åœ¨è¾°æœˆ = 0.3ï¼ˆæ˜Žç¡®ä¸ºã€Œå¢“ã€ä½™æ°”ã€ï¼‰

#### âš ï¸ å…³é”®å·®å¼‚
1. **è¾°æœˆæœ¨çš„æƒé‡**ï¼šçŽ°æœ‰ 0.6 â†’ æ–°æ–¹æ¡ˆ 0.3ï¼ˆ**é™ä½Ž50%**ï¼‰
2. **æƒé‡å æ¯”**ï¼šçŽ°æœ‰ 0.45 â†’ æ–°æ–¹æ¡ˆ 0.40ï¼ˆ**é™ä½Ž11%**ï¼‰
3. **æ ‡å‡†åŒ–ç¨‹åº¦**ï¼šæ–°æ–¹æ¡ˆæ›´ç¬¦åˆä¼ ç»Ÿã€Œæ—ºç›¸ä¼‘å›šæ­»ã€ç†è®º

---

### 2. è—å¹²æƒé‡ï¼ˆå¾—åœ°è®¡ç®—åŸºç¡€ï¼‰

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **æƒé‡ä½“ç³»**ï¼šæ¯ä¸ªåœ°æ”¯è—å¹²æƒé‡æ€»å’Œ â‰ˆ 1.0
- **ç¤ºä¾‹**ï¼šè¾° = æˆŠ0.6 + ä¹™0.2 + ç™¸0.2 = 1.0

```28:41:core/engine/analysis/constants.js
// åœ°æ”¯è—å¹²è¡¨ï¼ˆå¸¦æƒé‡ï¼‰
export const HIDDEN_STEMS = {
  'å­': [{stem:'ç™¸', weight:1}],
  'ä¸‘': [{stem:'å·±', weight:0.6}, {stem:'ç™¸', weight:0.2}, {stem:'è¾›', weight:0.2}],
  'å¯…': [{stem:'ç”²', weight:0.6}, {stem:'ä¸™', weight:0.3}, {stem:'æˆŠ', weight:0.1}],
  'å¯': [{stem:'ä¹™', weight:1}],
  'è¾°': [{stem:'æˆŠ', weight:0.6}, {stem:'ä¹™', weight:0.2}, {stem:'ç™¸', weight:0.2}],
  'å·³': [{stem:'ä¸™', weight:0.6}, {stem:'åºš', weight:0.2}, {stem:'æˆŠ', weight:0.2}],
  'åˆ': [{stem:'ä¸', weight:0.7}, {stem:'å·±', weight:0.3}],
  'æœª': [{stem:'å·±', weight:0.6}, {stem:'ä¹™', weight:0.2}, {stem:'ä¸', weight:0.2}],
  'ç”³': [{stem:'åºš', weight:0.6}, {stem:'å£¬', weight:0.3}, {stem:'æˆŠ', weight:0.1}],
  'é…‰': [{stem:'è¾›', weight:1}],
  'æˆŒ': [{stem:'æˆŠ', weight:0.6}, {stem:'è¾›', weight:0.2}, {stem:'ä¸', weight:0.2}],
  'äº¥': [{stem:'å£¬', weight:0.8}, {stem:'ç”²', weight:0.2}],
};
```

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **æƒé‡ä½“ç³»**ï¼šæ­£æ°”0.70ã€ä¸­æ°”0.30ã€ä½™æ°”0.15ï¼ˆ**æ›´ä¿å®ˆ**ï¼‰
- **ç¤ºä¾‹**ï¼šè¾° = æˆŠ0.70ï¼ˆæ­£ï¼‰+ ä¹™0.30ï¼ˆä¸­ï¼‰+ ç™¸0.15ï¼ˆä½™ï¼‰= 1.15ï¼ˆä½†å®žé™…ä½¿ç”¨æ—¶æŒ‰æ¯”ä¾‹å½’ä¸€ï¼‰

#### âš ï¸ å…³é”®å·®å¼‚
1. **æƒé‡æ€»é‡**ï¼šæ–°æ–¹æ¡ˆæ›´ä¿å®ˆï¼Œé¿å…ã€Œè—å¹²åŠ›é‡è†¨èƒ€ã€
2. **æ­£/ä¸­/ä½™åŒºåˆ†**ï¼šæ–°æ–¹æ¡ˆæ˜Žç¡®åŒºåˆ†ï¼ŒçŽ°æœ‰ç®—æ³•æœªæ˜Žç¡®æ ‡æ³¨
3. **å½±å“èŒƒå›´**ï¼šéœ€è¦é‡æž„ `HIDDEN_STEMS` è¡¨ç»“æž„

---

### 3. å¾—åœ°ï¼ˆé€šæ ¹ï¼‰è®¡ç®—

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **è®¡ç®—èŒƒå›´**ï¼šæ‰€æœ‰è—å¹²ä¸­ä¸Žæ—¥ä¸»åŒäº”è¡Œæˆ–åŒå¤©å¹²
- **æƒé‡å æ¯”**ï¼š0.35
- **å½’ä¸€åŒ–**ï¼šè½¯å½’ä¸€åŒ– scale=1.50
- **é¢å¤–åŠ åˆ†**ï¼šæ—¥æ”¯æ—ºåœ°åŠ åˆ†ï¼ˆrootStageBonusï¼‰

```81:109:core/engine/analysis/daymaster.js
  // 2. å¾—åœ°ï¼ˆé€šæ ¹ï¼‰ï¼šæ—¥ä¸»åœ¨å„æ”¯çš„è—å¹²å‡ºçŽ°
  // âœ… V3.0 ä¿®æ­£ï¼šä½¿ç”¨ filter å…è®¸ä¸€æ”¯å¤šæ ¹ï¼ˆåŽŸ find åªå–ç¬¬ä¸€ä¸ªï¼‰
  let root = 0;
  const rootWeights = {};
  ['year', 'month', 'day', 'hour'].forEach((k) => {
    const p = pillars[k];
    if (!p) return;
    
    const hidden = p.canggan || HIDDEN_STEMS[p.branch] || [];
    // âœ… ä½¿ç”¨ filter æ‰¾å‡ºæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è—å¹²
    const hits = hidden.filter(h => {
      const hStem = typeof h === 'string' ? h : h.stem;
      return hStem === dayStem || STEM_ELEMENT[hStem] === dmElement;
    });
    
    // âœ… ç´¯åŠ æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è—å¹²æƒé‡
    hits.forEach(hit => {
      const hStem = typeof hit === 'string' ? hit : hit.stem;
      const hWeight = typeof hit === 'string' ? 1 / hidden.length : hit.weight;
      // åŒå¹²æƒé‡1.0ï¼ŒåŒäº”è¡Œæƒé‡0.6
      const w = hStem === dayStem ? 1.0 : 0.6;
      root += w;
      rootWeights[k] = (rootWeights[k] || 0) + w;
    });
  });
  
  // âœ… æ·»åŠ æ—¥æ”¯ä¸ºæ—ºåœ°çš„åŠ åˆ†
  const dayBranchBonus = rootStageBonus(dmElement, pillars.day.branch);
  root += dayBranchBonus * cfg.rootBonusScale;
```

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **è®¡ç®—èŒƒå›´**ï¼š**åªçœ‹æ—¥ä¸»åŒäº”è¡Œçš„è—å¹²**ï¼ˆä¸å†çœ‹å°æ˜Ÿã€è´¢å®˜ç­‰ï¼‰
- **æƒé‡å æ¯”**ï¼š0.30ï¼ˆ**é™ä½Ž14%**ï¼‰
- **ä½ç½®åŠ æƒ**ï¼šå¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8
- **è—å¹²åŠ æƒ**ï¼šæ­£0.70ã€ä¸­0.30ã€ä½™0.15

#### âš ï¸ å…³é”®å·®å¼‚
1. **è®¡ç®—èŒƒå›´ç¼©å°**ï¼šçŽ°æœ‰ç®—æ³•å¯èƒ½æŠŠã€Œå°æ˜Ÿè—å¹²ã€ä¹Ÿç®—è¿›å¾—åœ°ï¼Œæ–°æ–¹æ¡ˆæ˜Žç¡®æŽ’é™¤
2. **é¿å…åŒé‡è®¡ç®—**ï¼šæ–°æ–¹æ¡ˆç¡®ä¿ã€Œå¾—åœ°ã€å’Œã€Œå¾—åŠ©ã€ä¸é‡å¤è®¡ç®—è—å¹²
3. **æƒé‡é™ä½Ž**ï¼š0.35 â†’ 0.30

---

### 4. å¾—åŠ©ï¼ˆæ¯”åŠ«+å°æ˜Ÿï¼‰è®¡ç®—

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **è®¡ç®—èŒƒå›´**ï¼š**å¤©å¹² + è—å¹²**ä¸­çš„æ¯”åŠ«å’Œå°æ˜Ÿ
- **æƒé‡å æ¯”**ï¼š0.25
- **å½’ä¸€åŒ–**ï¼šè½¯å½’ä¸€åŒ– scale=3.50
- **ä½ç½®åŠ æƒ**ï¼šæœˆæŸ±1.3å€ã€æ—¥æŸ±1.15å€
- **å­£èŠ‚åŠ æƒ**ï¼šå½“ä»¤åç¥žæƒé‡æ›´é«˜ï¼ˆ0.7~1.3å€ï¼‰

```111:152:core/engine/analysis/daymaster.js
  // 3. æ¯”åŠ«åŠ©èº« & å°æ˜ŸæŠ¤èº«ï¼›è´¢å®˜é£Ÿä¼¤è€—èº«ï¼ˆè€ƒè™‘ä½ç½®åŠ æƒå’Œå­£èŠ‚åŠ æƒï¼‰
  // âœ… V3.0 ä¿®æ­£ï¼šåˆ†ç¦» biPower å’Œ printPowerï¼Œé¿å…é‡å¤è®¡ç®—
  let biPower = 0, printPower = 0, drain = 0;
  const helperDetail = {};
  
  ['year', 'month', 'day', 'hour'].forEach((k, i) => {
    const p = pillars[k];
    if (!p) return;
    
    // âœ… ä½ç½®åŠ æƒ
    const placeBoost = p === pillars.month ? cfg.monthBoost 
                      : p === pillars.day ? cfg.dayBoost 
                      : 1.0;
    
    const idx = ['Y', 'M', 'D', 'H'][i];
    collectAllStems(p).forEach(h => {
      const tg = tenGodOf(dayStem, h.stem);
      
      // âœ… å­£èŠ‚åŠ æƒ
      const tgSeason = seasonSupportOfTG(dmElement, tg, monthIdx);
      const seasonBoost = 0.7 + 0.6 * tgSeason; // 0.7~1.3
      
      const w = h.weight * placeBoost * seasonBoost;
      
      if (tg === 'æ¯”è‚©' || tg === 'åŠ«è´¢') {
        biPower += 0.8 * w;  // âœ… æ¯”åŠ«å•ç‹¬è®°å½•
        helperDetail[idx + tg] = (helperDetail[idx + tg] || 0) + 0.8 * w;
      } else if (tg === 'æ­£å°' || tg === 'åå°') {
        printPower += 0.85 * w;  // âœ… å°æ˜Ÿå•ç‹¬è®°å½•
        helperDetail[idx + tg] = (helperDetail[idx + tg] || 0) + 0.85 * w;
      } else if (tg === 'æ­£å®˜' || tg === 'ä¸ƒæ€') {
        drain += 0.85 * w;
      } else if (tg === 'æ­£è´¢' || tg === 'åè´¢') {
        drain += 0.75 * w;
      } else if (tg === 'é£Ÿç¥ž' || tg === 'ä¼¤å®˜') {
        drain += 0.55 * w;
      }
    });
  });
```

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **è®¡ç®—èŒƒå›´**ï¼š**åªçœ‹å¤©å¹²æ˜Žé€**çš„æ¯”åŠ«å’Œå°æ˜Ÿï¼ˆ**ä¸å†ç®—è—å¹²**ï¼‰
- **æƒé‡å æ¯”**ï¼š0.30ï¼ˆ**æå‡20%**ï¼‰
- **ä½ç½®åŠ æƒ**ï¼šå¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8
- **åŸºç¡€æƒé‡**ï¼šæ¯”åŠ«1.0ã€å°æ˜Ÿ0.8

#### âš ï¸ å…³é”®å·®å¼‚
1. **è®¡ç®—èŒƒå›´ç¼©å°**ï¼šçŽ°æœ‰ç®—æ³•åŒ…å«è—å¹²ï¼Œæ–°æ–¹æ¡ˆåªç®—å¤©å¹²ï¼ˆ**é¿å…ä¸Žå¾—åœ°é‡å¤**ï¼‰
2. **æƒé‡æå‡**ï¼š0.25 â†’ 0.30ï¼ˆè¡¥å¿è—å¹²ç§»é™¤çš„å½±å“ï¼‰
3. **å­£èŠ‚åŠ æƒç§»é™¤**ï¼šæ–°æ–¹æ¡ˆæœªæåŠå­£èŠ‚åŠ æƒ
4. **å½±å“**ï¼šå¯¹äºŽã€Œè—å¹²å°æ˜Ÿå¤šã€å¤©å¹²å°æ˜Ÿå°‘ã€çš„å‘½å±€ï¼Œæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼±

---

### 5. å—åˆ¶ï¼ˆè€—èº«ï¼‰è®¡ç®—

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **è®¡ç®—èŒƒå›´**ï¼š**å¤©å¹² + è—å¹²**ä¸­çš„è´¢å®˜é£Ÿä¼¤
- **æƒé‡å æ¯”**ï¼š0.35
- **å½’ä¸€åŒ–**ï¼šè½¯å½’ä¸€åŒ– scale=1.50
- **ä½ç½®åŠ æƒ**ï¼šæœˆæŸ±1.3å€ã€æ—¥æŸ±1.15å€
- **å­£èŠ‚åŠ æƒ**ï¼šå½“ä»¤åç¥žæƒé‡æ›´é«˜ï¼ˆ0.7~1.3å€ï¼‰
- **è€—èº«ç³»æ•°**ï¼šå®˜æ€0.85ã€è´¢0.75ã€é£Ÿä¼¤0.55

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **è®¡ç®—èŒƒå›´**ï¼š**åªçœ‹å¤©å¹²æ˜Žé€**çš„è´¢å®˜é£Ÿä¼¤ï¼ˆ**ä¸å†ç®—è—å¹²**ï¼‰
- **æƒé‡å æ¯”**ï¼š0.30ï¼ˆ**é™ä½Ž14%**ï¼‰
- **ä½ç½®åŠ æƒ**ï¼šå¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8
- **è€—èº«ç³»æ•°**ï¼šå®˜æ€1.1ã€è´¢1.0ã€é£Ÿä¼¤0.8

#### âš ï¸ å…³é”®å·®å¼‚
1. **è®¡ç®—èŒƒå›´ç¼©å°**ï¼šçŽ°æœ‰ç®—æ³•åŒ…å«è—å¹²ï¼Œæ–°æ–¹æ¡ˆåªç®—å¤©å¹²
2. **æƒé‡é™ä½Ž**ï¼š0.35 â†’ 0.30
3. **è€—èº«ç³»æ•°è°ƒæ•´**ï¼šå®˜æ€ä»Ž0.85æå‡åˆ°1.1ï¼ˆ**æ›´å¼ºè°ƒå®˜æ€è€—èº«**ï¼‰
4. **å½±å“**ï¼šå¯¹äºŽã€Œè—å¹²è´¢å®˜å¤šã€å¤©å¹²è´¢å®˜å°‘ã€çš„å‘½å±€ï¼Œæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼º

---

### 6. å°æ˜ŸåŒ–æ³„æœºåˆ¶

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **å…¬å¼**ï¼š`drainEffective = drain * (1 - Math.min(0.30, printPower * 0.35))`
- **æœ€å¤§å‡å¹…**ï¼š30%
- **è§¦å‘æ¡ä»¶**ï¼šæ— æ˜Žç¡®é—¨æ§›ï¼ˆåªè¦ printPower > 0 å°±ç”Ÿæ•ˆï¼‰

```154:155:core/engine/analysis/daymaster.js
  // âœ… å°æ˜ŸåŒ–æ€æœºåˆ¶
  const drainEffective = drain * (1 - Math.min(0.30, printPower * 0.35));
```

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **å…¬å¼**ï¼š`effectiveDrain = drain * (1 - ratio)`ï¼Œå…¶ä¸­ `ratio = Math.min(0.20, (yinPower / drain) * 0.10)`
- **æœ€å¤§å‡å¹…**ï¼š20%ï¼ˆ**æ›´ä¿å®ˆ**ï¼‰
- **è§¦å‘æ¡ä»¶**ï¼š**å°æ˜ŸåŠ›é‡ â‰¥ è€—èº«çš„ä¸€åŠ**ï¼ˆ`yinPower >= drain * 0.5`ï¼‰

#### âš ï¸ å…³é”®å·®å¼‚
1. **æœ€å¤§å‡å¹…é™ä½Ž**ï¼š30% â†’ 20%ï¼ˆ**é™ä½Ž33%**ï¼‰
2. **è§¦å‘é—¨æ§›**ï¼šæ–°æ–¹æ¡ˆè¦æ±‚ã€Œå° â‰¥ è€—èº«ä¸€åŠã€æ‰ç”Ÿæ•ˆï¼ˆ**æ›´ä¸¥æ ¼**ï¼‰
3. **å½±å“**ï¼šé¿å…ã€Œä¸€ç‚¹ç‚¹å°æ˜Ÿå°±æŠŠå¤§é‡è€—èº«ç æŽ‰ä¸‰æˆã€çš„å¤¸å¼ çŽ°è±¡
4. **åˆç†æ€§**ï¼šæ–°æ–¹æ¡ˆæ›´ç¬¦åˆä¼ ç»Ÿã€Œå°æ˜ŸåŒ–æ€éœ€æœ‰è¶³å¤ŸåŠ›é‡ã€çš„ç†è®º

---

### 7. ä½ç½®åŠ æƒ

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **å¤©å¹²/åœ°æ”¯ç»Ÿä¸€**ï¼šæœˆæŸ±1.3å€ã€æ—¥æŸ±1.15å€ã€å…¶ä»–1.0å€
- **åº”ç”¨èŒƒå›´**ï¼šå¾—åŠ©ã€è€—èº«è®¡ç®—

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **å¤©å¹²/åœ°æ”¯åˆ†ç¦»**ï¼š
  - å¤©å¹²ï¼šå¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8
  - åœ°æ”¯ï¼šå¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8
- **åº”ç”¨èŒƒå›´**ï¼šå¾—åœ°ã€å¾—åŠ©ã€å—åˆ¶è®¡ç®—

#### âš ï¸ å…³é”®å·®å¼‚
1. **åŠ æƒæ–¹å¼**ï¼šçŽ°æœ‰ç®—æ³•ã€ŒæœˆæŸ±çªå‡ºã€ï¼Œæ–°æ–¹æ¡ˆã€Œå››æŸ±å‡è¡¡ã€
2. **å½±å“**ï¼šæ–°æ–¹æ¡ˆå¯¹å¹´æŸ±ã€æ—¶æŸ±çš„æƒé‡æ›´é«˜

---

### 8. å­£èŠ‚åŠ æƒ

#### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰
- **æœºåˆ¶**ï¼šå½“ä»¤åç¥žæƒé‡æ›´é«˜ï¼ˆ0.7~1.3å€ï¼‰
- **åº”ç”¨èŒƒå›´**ï¼šå¾—åŠ©ã€è€—èº«è®¡ç®—

#### æ–°ç®—æ³•æ–¹æ¡ˆ
- **æœºåˆ¶**ï¼š**æœªæåŠ**ï¼ˆå¯èƒ½ç§»é™¤ï¼‰

#### âš ï¸ å…³é”®å·®å¼‚
1. **ç§»é™¤å­£èŠ‚åŠ æƒ**ï¼šæ–°æ–¹æ¡ˆæ›´ç®€åŒ–ï¼Œä½†å¯èƒ½ä¸¢å¤±ã€Œå½“ä»¤åç¥žæ›´å¼ºã€çš„ä¼ ç»Ÿç†è®º

---

## äºŒã€æ€»ä½“è¯„åˆ†å…¬å¼å¯¹æ¯”

### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰

```160:165:core/engine/analysis/daymaster.js
  // 4. ç»¼åˆè®¡ç®—ï¼ˆV3.0 ä¼˜åŒ–ï¼‰
  const pos = cfg.k_season * w_month 
            + cfg.k_root * norm(root, cfg.normScale.root) 
            + cfg.k_help * norm(help, cfg.normScale.help);
  const baseBonus = cfg.baseBonus !== undefined ? cfg.baseBonus : 0.08;
  const raw = pos - cfg.drainCoef * norm(drainEffective, cfg.normScale.drain) + baseBonus;
```

- **å¾—ä»¤æƒé‡**ï¼š0.45
- **å¾—åœ°æƒé‡**ï¼š0.35
- **å¾—åŠ©æƒé‡**ï¼š0.25
- **è€—èº«æƒé‡**ï¼š0.35ï¼ˆæ‰£åˆ†ï¼‰
- **åŸºç¡€åŠ åˆ†**ï¼š0.12ï¼ˆå­å¹³æ´¾ï¼‰

### æ–°ç®—æ³•æ–¹æ¡ˆ

```js
const W_LING = 0.40;   // å¾—ä»¤
const W_DI   = 0.30;   // å¾—åœ°
const W_ZHU  = 0.30;   // å¾—åŠ©
const W_DRAIN= 0.30;   // å—åˆ¶ï¼ˆæ‰£åˆ†ï¼‰

const positive = W_LING * deLing + W_DI * normDeDi + W_ZHU * normDeZhu;
const negative = W_DRAIN * Math.min(1, drain / 3);
const score = positive - negative;
```

- **å¾—ä»¤æƒé‡**ï¼š0.40ï¼ˆ**é™ä½Ž11%**ï¼‰
- **å¾—åœ°æƒé‡**ï¼š0.30ï¼ˆ**é™ä½Ž14%**ï¼‰
- **å¾—åŠ©æƒé‡**ï¼š0.30ï¼ˆ**æå‡20%**ï¼‰
- **å—åˆ¶æƒé‡**ï¼š0.30ï¼ˆ**é™ä½Ž14%**ï¼‰
- **åŸºç¡€åŠ åˆ†**ï¼šæ— ï¼ˆ**ç§»é™¤**ï¼‰

---

## ä¸‰ã€åˆ†æ¡£é€»è¾‘å¯¹æ¯”

### çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰

```173:199:core/engine/analysis/daymaster.js
  // âœ… V3.0: åˆ†æ¡£é€»è¾‘ï¼ˆå¢žåŠ èº«åå¼±ï¼Œå¯¹ç§°å¤„ç†ï¼‰
  let band;
  if (score >= 0.85) {
    band = 'ä»Žå¼º';
  } else if (score >= 0.62) {
    band = 'èº«å¼º';
  } else if (score >= 0.50) {
    // âœ… 50%-62%ï¼šåˆ¤æ–­ä¸º"èº«åå¼º"ï¼ˆå½“å¸®èº« > 1.2 Ã— è€—èº«ï¼‰æˆ–"å¹³è¡¡"
    if (helpPower > drainPower * 1.2) {
      band = 'èº«åå¼º';
    } else {
      band = 'å¹³è¡¡';
    }
  } else if (score >= 0.45) {
    band = 'å¹³è¡¡';
  } else if (score >= 0.35) {
    // âœ… V3.0 æ–°å¢žï¼š35%-45%ï¼šåˆ¤æ–­ä¸º"èº«åå¼±"ï¼ˆå½“è€—èº« > 1.2 Ã— å¸®èº«ï¼‰æˆ–"èº«å¼±"
    if (drainPower > helpPower * 1.2) {
      band = 'èº«åå¼±';
    } else {
      band = 'èº«å¼±';
    }
  } else if (score >= 0.22) {
    band = 'èº«å¼±';
  } else {
    band = 'ä»Žå¼±';
  }
```

- **ä»Žå¼º**ï¼šâ‰¥ 0.85
- **èº«å¼º**ï¼š0.62 ~ 0.85
- **èº«åå¼º**ï¼š0.50 ~ 0.62ï¼ˆä¸”å¸®èº« > 1.2 Ã— è€—èº«ï¼‰
- **å¹³è¡¡**ï¼š0.45 ~ 0.50 æˆ– 0.50 ~ 0.62ï¼ˆä¸”å¸®èº« â‰¤ 1.2 Ã— è€—èº«ï¼‰
- **èº«åå¼±**ï¼š0.35 ~ 0.45ï¼ˆä¸”è€—èº« > 1.2 Ã— å¸®èº«ï¼‰
- **èº«å¼±**ï¼š0.22 ~ 0.35 æˆ– 0.35 ~ 0.45ï¼ˆä¸”è€—èº« â‰¤ 1.2 Ã— å¸®èº«ï¼‰
- **ä»Žå¼±**ï¼š< 0.22

### æ–°ç®—æ³•æ–¹æ¡ˆ

```js
function judgeBody(score) {
  if (score >= 0.25) return 'èº«å¼º';
  if (score <= -0.10) return 'èº«å¼±';
  return 'åå¼±/ä¸­å’Œ';
}
```

- **èº«å¼º**ï¼šâ‰¥ 0.25
- **èº«å¼±**ï¼šâ‰¤ -0.10
- **åå¼±/ä¸­å’Œ**ï¼š-0.10 ~ 0.25

#### âš ï¸ å…³é”®å·®å¼‚
1. **åˆ†æ¡£ç®€åŒ–**ï¼šæ–°æ–¹æ¡ˆåªæœ‰3æ¡£ï¼ŒçŽ°æœ‰ç®—æ³•æœ‰7æ¡£
2. **é—¨æ§›å·®å¼‚**ï¼šæ–°æ–¹æ¡ˆçš„ã€Œèº«å¼ºã€é—¨æ§›ï¼ˆ0.25ï¼‰è¿œä½ŽäºŽçŽ°æœ‰ç®—æ³•ï¼ˆ0.62ï¼‰
3. **ä»Žæ ¼å¤„ç†**ï¼šæ–°æ–¹æ¡ˆæœªæåŠä»Žå¼º/ä»Žå¼±

---

## å››ã€æ ¸å¿ƒå·®å¼‚æ€»ç»“

### ðŸ“Š æ•°å€¼å·®å¼‚æ±‡æ€»

| é¡¹ç›® | çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰ | æ–°ç®—æ³•æ–¹æ¡ˆ | å·®å¼‚ |
|------|-----------------|-----------|------|
| **å¾—ä»¤æƒé‡** | 0.45 | 0.40 | â¬‡ï¸ -11% |
| **å¾—åœ°æƒé‡** | 0.35 | 0.30 | â¬‡ï¸ -14% |
| **å¾—åŠ©æƒé‡** | 0.25 | 0.30 | â¬†ï¸ +20% |
| **å—åˆ¶æƒé‡** | 0.35 | 0.30 | â¬‡ï¸ -14% |
| **å°æ˜ŸåŒ–æ³„æœ€å¤§å‡å¹…** | 30% | 20% | â¬‡ï¸ -33% |
| **è¾°æœˆæœ¨æƒé‡** | 0.6 | 0.3 | â¬‡ï¸ -50% |
| **åŸºç¡€åŠ åˆ†** | 0.12 | 0 | â¬‡ï¸ -100% |

### ðŸ” é€»è¾‘å·®å¼‚æ±‡æ€»

| é¡¹ç›® | çŽ°æœ‰ç®—æ³•ï¼ˆV3.0ï¼‰ | æ–°ç®—æ³•æ–¹æ¡ˆ | å½±å“ |
|------|-----------------|-----------|------|
| **å¾—åœ°è®¡ç®—èŒƒå›´** | æ‰€æœ‰è—å¹²ï¼ˆå«å°æ˜Ÿï¼‰ | åªçœ‹æ—¥ä¸»åŒäº”è¡Œè—å¹² | âš ï¸ ç¼©å°èŒƒå›´ |
| **å¾—åŠ©è®¡ç®—èŒƒå›´** | å¤©å¹² + è—å¹² | åªçœ‹å¤©å¹²æ˜Žé€ | âš ï¸ ç¼©å°èŒƒå›´ |
| **å—åˆ¶è®¡ç®—èŒƒå›´** | å¤©å¹² + è—å¹² | åªçœ‹å¤©å¹²æ˜Žé€ | âš ï¸ ç¼©å°èŒƒå›´ |
| **å°æ˜ŸåŒ–æ³„è§¦å‘** | æ— é—¨æ§› | éœ€å° â‰¥ è€—èº«ä¸€åŠ | âš ï¸ æ›´ä¸¥æ ¼ |
| **ä½ç½®åŠ æƒ** | æœˆ1.3ã€æ—¥1.15 | å¹´0.7ã€æœˆ1.0ã€æ—¥0.9ã€æ—¶0.8 | âš ï¸ æ›´å‡è¡¡ |
| **å­£èŠ‚åŠ æƒ** | æœ‰ï¼ˆ0.7~1.3å€ï¼‰ | æ—  | âš ï¸ ç§»é™¤ |

---

## äº”ã€å½±å“è¯„ä¼°

### âœ… æ–°æ–¹æ¡ˆçš„ä¼˜åŠ¿

1. **é¿å…åŒé‡è®¡ç®—**ï¼šå¾—åœ°å’Œå¾—åŠ©ä¸å†é‡å¤è®¡ç®—è—å¹²ï¼Œé€»è¾‘æ›´æ¸…æ™°
2. **å°æ˜ŸåŒ–æ³„æ›´åˆç†**ï¼šæœ‰è§¦å‘é—¨æ§›ï¼Œé¿å…ã€Œä¸€ç‚¹ç‚¹å°æ˜Ÿå°±å¤§å¹…å‡è€—èº«ã€
3. **è¾°æœˆå¢“åº“å¤„ç†**ï¼šæ˜Žç¡®é™ä½Žå¢“åº“æƒé‡ï¼ˆ0.3ï¼‰ï¼Œæ›´ç¬¦åˆä¼ ç»Ÿç†è®º
4. **è—å¹²æƒé‡ä¿å®ˆ**ï¼šé¿å…ã€Œè—å¹²åŠ›é‡è†¨èƒ€ã€é—®é¢˜

### âš ï¸ æ–°æ–¹æ¡ˆçš„é£Žé™©

1. **è®¡ç®—èŒƒå›´ç¼©å°**ï¼šåªç®—å¤©å¹²ï¼Œå¯èƒ½ä½Žä¼°ã€Œè—å¹²å°æ˜Ÿå¤šã€å¤©å¹²å°æ˜Ÿå°‘ã€çš„å‘½å±€
2. **å­£èŠ‚åŠ æƒç§»é™¤**ï¼šä¸¢å¤±ã€Œå½“ä»¤åç¥žæ›´å¼ºã€çš„ä¼ ç»Ÿç†è®º
3. **åˆ†æ¡£ç®€åŒ–**ï¼šåªæœ‰3æ¡£ï¼Œå¯èƒ½ä¸¢å¤±ã€Œèº«åå¼º/èº«åå¼±ã€çš„ç»†åˆ†åˆ¤æ–­
4. **åŸºç¡€åŠ åˆ†ç§»é™¤**ï¼šå¯èƒ½è®©æ•´ä½“è¯„åˆ†åä½Ž

### ðŸ“ˆ é¢„æœŸå½±å“èŒƒå›´

1. **è—å¹²å°æ˜Ÿå¤šçš„å‘½å±€**ï¼šæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼±ï¼ˆå› ä¸ºå¾—åŠ©ä¸å†ç®—è—å¹²ï¼‰
2. **è—å¹²è´¢å®˜å¤šçš„å‘½å±€**ï¼šæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼ºï¼ˆå› ä¸ºå—åˆ¶ä¸å†ç®—è—å¹²ï¼‰
3. **è¾°æœˆæœ¨æ—¥ä¸»**ï¼šæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼±ï¼ˆè¾°æœˆæƒé‡ä»Ž0.6é™åˆ°0.3ï¼‰
4. **å°æ˜ŸåŒ–æ€å‘½å±€**ï¼šæ–°æ–¹æ¡ˆä¼šåˆ¤å¾—æ›´å¼±ï¼ˆåŒ–æ³„å‡å¹…ä»Ž30%é™åˆ°20%ï¼Œä¸”æœ‰è§¦å‘é—¨æ§›ï¼‰

---

## å…­ã€å®žæ–½å»ºè®®

### ðŸŽ¯ å»ºè®®é‡‡ç”¨æ–°æ–¹æ¡ˆçš„ç†ç”±

1. **é€»è¾‘æ›´æ¸…æ™°**ï¼šé¿å…åŒé‡è®¡ç®—ï¼Œå¾—åœ°/å¾—åŠ©/å—åˆ¶èŒè´£æ˜Žç¡®
2. **æ›´è´´è¿‘ä¼ ç»Ÿ**ï¼šæ—ºç›¸ä¼‘å›šæ­»æ˜ å°„ã€å°æ˜ŸåŒ–æ³„é—¨æ§›ã€å¢“åº“æƒé‡é™ä½Ž
3. **æ•°å€¼æ›´ä¿å®ˆ**ï¼šé¿å…ã€Œè—å¹²åŠ›é‡è†¨èƒ€ã€å’Œã€Œå°æ˜ŸåŒ–æ³„è¿‡åº¦ã€

### âš ï¸ éœ€è¦è°ƒæ•´çš„åœ°æ–¹

1. **åˆ†æ¡£é€»è¾‘**ï¼šå»ºè®®ä¿ç•™çŽ°æœ‰ç®—æ³•çš„7æ¡£åˆ†æ¡£ï¼ˆä»Žå¼º/èº«å¼º/èº«åå¼º/å¹³è¡¡/èº«åå¼±/èº«å¼±/ä»Žå¼±ï¼‰
2. **å­£èŠ‚åŠ æƒ**ï¼šå»ºè®®ä¿ç•™ï¼Œä½†å¯ä»¥é™ä½Žæƒé‡ï¼ˆå¦‚0.8~1.2å€ï¼‰
3. **è—å¹²è®¡ç®—**ï¼šå¯ä»¥è€ƒè™‘ã€Œå¾—åœ°ç®—è—å¹²ï¼Œå¾—åŠ©åªç®—å¤©å¹²ã€çš„æ··åˆæ–¹æ¡ˆ

### ðŸ“ å®žæ–½æ­¥éª¤

1. **ç¬¬ä¸€æ­¥**ï¼šé‡æž„ `SEASON_WEIGHT` è¡¨ï¼Œé‡‡ç”¨æ—ºç›¸ä¼‘å›šæ­»æ˜ å°„
2. **ç¬¬äºŒæ­¥**ï¼šé‡æž„ `HIDDEN_STEMS` è¡¨ï¼Œæ˜Žç¡®æ­£/ä¸­/ä½™æ°”æƒé‡
3. **ç¬¬ä¸‰æ­¥**ï¼šä¿®æ”¹å¾—åœ°è®¡ç®—ï¼Œåªçœ‹æ—¥ä¸»åŒäº”è¡Œè—å¹²
4. **ç¬¬å››æ­¥**ï¼šä¿®æ”¹å¾—åŠ©è®¡ç®—ï¼Œåªçœ‹å¤©å¹²æ˜Žé€
5. **ç¬¬äº”æ­¥**ï¼šä¿®æ”¹å—åˆ¶è®¡ç®—ï¼Œåªçœ‹å¤©å¹²æ˜Žé€
6. **ç¬¬å…­æ­¥**ï¼šä¿®æ”¹å°æ˜ŸåŒ–æ³„æœºåˆ¶ï¼ŒåŠ å…¥è§¦å‘é—¨æ§›
7. **ç¬¬ä¸ƒæ­¥**ï¼šè°ƒæ•´ä½ç½®åŠ æƒå’Œæƒé‡å æ¯”
8. **ç¬¬å…«æ­¥**ï¼šä¿ç•™çŽ°æœ‰åˆ†æ¡£é€»è¾‘ï¼Œä½†è°ƒæ•´é—¨æ§›å€¼

---

## ä¸ƒã€æµ‹è¯•å»ºè®®

### ðŸ§ª æµ‹è¯•ç”¨ä¾‹

1. **ä¹™æœ¨æ—¥ä¸»ï¼ˆå·±å·³ã€æˆŠè¾°ã€ä¹™å·³ã€ç™¸æœªï¼‰**
   - çŽ°æœ‰ç®—æ³•ï¼šå¯èƒ½åˆ¤ã€Œèº«å¼±ã€æˆ–ã€Œå¹³è¡¡ã€
   - æ–°æ–¹æ¡ˆï¼šé¢„æœŸåˆ¤ã€Œèº«å¼±ã€ï¼ˆè¾°æœˆæƒé‡é™ä½Žã€å°æ˜ŸåŒ–æ³„æ›´ä¸¥æ ¼ï¼‰

2. **è—å¹²å°æ˜Ÿå¤šçš„å‘½å±€**
   - çŽ°æœ‰ç®—æ³•ï¼šå¯èƒ½åˆ¤ã€Œèº«åå¼ºã€
   - æ–°æ–¹æ¡ˆï¼šé¢„æœŸåˆ¤ã€Œèº«å¼±ã€ï¼ˆå¾—åŠ©ä¸å†ç®—è—å¹²ï¼‰

3. **è—å¹²è´¢å®˜å¤šçš„å‘½å±€**
   - çŽ°æœ‰ç®—æ³•ï¼šå¯èƒ½åˆ¤ã€Œèº«å¼±ã€
   - æ–°æ–¹æ¡ˆï¼šé¢„æœŸåˆ¤ã€Œèº«åå¼ºã€ï¼ˆå—åˆ¶ä¸å†ç®—è—å¹²ï¼‰

4. **å°æ˜ŸåŒ–æ€å‘½å±€**
   - çŽ°æœ‰ç®—æ³•ï¼šå¯èƒ½åˆ¤ã€Œèº«å¼ºã€ï¼ˆåŒ–æ³„30%ï¼‰
   - æ–°æ–¹æ¡ˆï¼šé¢„æœŸåˆ¤ã€Œèº«å¼±ã€ï¼ˆåŒ–æ³„20%ï¼Œä¸”æœ‰è§¦å‘é—¨æ§›ï¼‰

---

## å…«ã€ç»“è®º

### ðŸ“Š å·®å¼‚ç¨‹åº¦è¯„ä¼°

**æ€»ä½“å·®å¼‚ï¼šä¸­ç­‰åé«˜ï¼ˆçº¦40-50%çš„æ ¸å¿ƒé€»è¾‘éœ€è¦è°ƒæ•´ï¼‰**

- **æœˆä»¤æƒé‡**ï¼šéœ€è¦é‡æž„è¡¨æ ¼ï¼ˆå½±å“èŒƒå›´ï¼šé«˜ï¼‰
- **è—å¹²æƒé‡**ï¼šéœ€è¦é‡æž„è¡¨æ ¼ï¼ˆå½±å“èŒƒå›´ï¼šé«˜ï¼‰
- **å¾—åœ°è®¡ç®—**ï¼šéœ€è¦ä¿®æ”¹é€»è¾‘ï¼ˆå½±å“èŒƒå›´ï¼šä¸­ï¼‰
- **å¾—åŠ©è®¡ç®—**ï¼šéœ€è¦ä¿®æ”¹é€»è¾‘ï¼ˆå½±å“èŒƒå›´ï¼šé«˜ï¼‰
- **å—åˆ¶è®¡ç®—**ï¼šéœ€è¦ä¿®æ”¹é€»è¾‘ï¼ˆå½±å“èŒƒå›´ï¼šé«˜ï¼‰
- **å°æ˜ŸåŒ–æ³„**ï¼šéœ€è¦ä¿®æ”¹é€»è¾‘ï¼ˆå½±å“èŒƒå›´ï¼šä¸­ï¼‰
- **ä½ç½®åŠ æƒ**ï¼šéœ€è¦è°ƒæ•´æ•°å€¼ï¼ˆå½±å“èŒƒå›´ï¼šä½Žï¼‰
- **åˆ†æ¡£é€»è¾‘**ï¼šå»ºè®®ä¿ç•™çŽ°æœ‰ï¼ˆå½±å“èŒƒå›´ï¼šä½Žï¼‰

### âœ… å»ºè®®

1. **é‡‡ç”¨æ–°æ–¹æ¡ˆçš„æ ¸å¿ƒæ€è·¯**ï¼šé¿å…åŒé‡è®¡ç®—ã€å°æ˜ŸåŒ–æ³„æ›´åˆç†ã€å¢“åº“æƒé‡é™ä½Ž
2. **ä¿ç•™çŽ°æœ‰ç®—æ³•çš„éƒ¨åˆ†ä¼˜åŠ¿**ï¼š7æ¡£åˆ†æ¡£ã€å­£èŠ‚åŠ æƒï¼ˆå¯é™ä½Žæƒé‡ï¼‰
3. **åˆ†é˜¶æ®µå®žæ–½**ï¼šå…ˆæ”¹æœˆä»¤æƒé‡å’Œè—å¹²æƒé‡ï¼Œå†æ”¹è®¡ç®—é€»è¾‘ï¼Œæœ€åŽè°ƒæ•´åˆ†æ¡£é—¨æ§›

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**ï¼š2025-01-27  
**è¯„ä¼°äºº**ï¼šAI Assistant  
**è¯„ä¼°ä¾æ®**ï¼šçŽ°æœ‰ç®—æ³•ä»£ç ï¼ˆV3.0ï¼‰vs æ–°ç®—æ³•æ–¹æ¡ˆæ–‡æ¡£



# 🔥 紧急修复：iPhone 网络错误

## 问题原因

错误日志显示 API Base URL 是 `http://localhost:3000`，而不是 `http://10.89.148.75:3000`。

**根本原因**：Expo 缓存了旧的代码，导致环境变量没有正确更新。

## ✅ 已完成的修复

1. **修复了 `apiClient.ts`**：
   - 直接使用 `API_BASE_URL` 常量，不依赖 `ENV`（避免模块加载顺序问题）
   - 添加了详细的调试日志

2. **清除了所有缓存**：
   - 清除了 `.expo` 目录
   - 清除了 `node_modules/.cache`

3. **重新启动了 Expo**：
   - 使用 `--clear` 参数强制清除缓存

## 📱 请在 iPhone 上执行以下操作

### ⚠️ 重要：必须完全重新加载应用

1. **完全关闭 Expo Go**：
   - 从 iPhone 的多任务中完全划掉 Expo Go
   - 不要只是切换到后台

2. **重新打开 Expo Go**：
   - 重新打开 Expo Go
   - 扫描终端中显示的二维码
   - 或者输入终端显示的 URL

3. **验证修复**：
   - 重新加载后，在控制台应该看到：
     ```
     [apiClient] 🔗 创建 axios 实例，baseURL: http://10.89.148.75:3000
     [ENV Config] 🔗 当前 API Base URL: http://10.89.148.75:3000
     ```
   - **不应该**再看到 `localhost:3000`

## 🔍 如果还是报错

如果重新加载后还是显示 `localhost:3000`，请：

1. **检查终端输出**：
   - 查看 Expo 启动时是否有错误
   - 确认 Expo 服务正常运行

2. **手动清除 iPhone 缓存**：
   - 摇动 iPhone → 选择 "Settings"
   - 选择 "Clear cache"
   - 重新加载

3. **重新安装 Expo Go**（最后手段）：
   - 删除 Expo Go
   - 重新从 App Store 安装
   - 重新扫描二维码

## 📊 当前配置

- **电脑 IP**: `10.89.148.75`
- **API Base URL**: `http://10.89.148.75:3000`
- **Core 服务**: ✅ 运行中（端口 3000）

## ✅ 验证步骤

1. 重新加载应用后，尝试登录
2. 查看控制台日志，确认 baseURL 是 `10.89.148.75:3000`
3. 如果还是 `localhost:3000`，说明缓存没有清除，需要完全重新安装

---

**修复时间**: 2025-11-28  
**状态**: ✅ 代码已修复，等待用户重新加载应用






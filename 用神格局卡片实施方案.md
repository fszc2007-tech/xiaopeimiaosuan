# 用神格局卡片实施方案

## 📋 方案概述

**目标**：将前端"結構 & 格局"卡片替换为"用神格局"卡片，展示用神相关的核心信息。

**卡片名称**：`用神格局`（四字）

**核心要回答的问题**：
- 命局真正依賴的是哪幾種力量？
- 用神有沒有力？流通順不順？體用能不能扛得住？
- 哪條做功線是主打路線？

---

## 一、数据结构设计

### 1.1 对外数据结构（前端看到的）

统一挂在 `analysis.yongshenPattern` 下面：

```typescript
yongshenPattern: {
  mainYongshen: {
    elements: string[];      // 例如 ["火", "土"]
    tenGods?: string[];      // 例如 ["正印", "偏印"]，可选
    type: '單一用神' | '複合用神';
  },
  assistElements: string[];  // 例如 ["木"]
  tabooElements: string[];   // 例如 ["金", "水"]
  yongshenPower: {
    score: number;           // 0–100
    level: '偏弱' | '中等' | '較強' | '很強';
  },
  flow: {
    level: '順暢' | '通而不暢' | '阻塞較多' | '嚴重阻塞';
    score?: number;          // 0–100，可选
  },
  tiYongBalance: {
    level: '體強用弱' | '體弱用強' | '體用相協' | '體用失衡';
    carrierScore?: number;   // 承載度 0–100
    passScore?: number;      // 通關度 0–100
  },
  workPatterns: {
    mainLine: string;        // 核心做功線，如 "食傷生財"、"印比護身"
    strength: '強' | '中' | '弱';
    tags: string[];          // 其他做功類型標籤，如 ["食傷生財", "印星護身"]
  },
  tiaohouLabel?: string     // 可选，如 "寒重喜火"、"燥重喜水"
}
```

---

## 二、字段映射表（与系统参数对齐）

| 新字段                          | 来源模块                       | 现有数据路径（系统参数）                                                      | 转换逻辑                                                    | 状态 |
| ---------------------------- | -------------------------- | --------------------------------------------------------------- | ------------------------------------------------------- | ---- |
| `mainYongshen.elements`      | `favored.js`               | `favoredAvoid.favored`                                         | 取第一个或前两个作为主用神（按稀缺度已排序）                                 | ✅ 一致 |
| `mainYongshen.tenGods`       | **需计算**                 | 从四柱中提取对应主用神五行的十神                                          | 遍历四柱，找出五行匹配主用神的十神（可选字段）                                         | ⚠️ 需补充 |
| `mainYongshen.type`          | `favored.js`               | `favoredAvoid.favored.length`                                  | 长度为 1 → `單一用神`，>1 → `複合用神`                              | ✅ 一致 |
| `assistElements`             | `favored.js`               | `favoredAvoid.favored`                                         | 取除主用神外的其他喜用神（若主用神取前1-2个，则剩余为辅助）                                      | ✅ 一致 |
| `tabooElements`              | `favored.js`               | `favoredAvoid.avoid`                                           | 直接使用忌神五行数组                                              | ✅ 一致 |
| `yongshenPower.score`        | `purity.js` + `tiyong.js` | `purityResult.details.yongshenPurity` (0-100) 或 `tiyongResult.useStrength` (0-1) | 优先使用 `yongshenPurity`，若无则用 `useStrength * 100`                | ✅ 一致 |
| `yongshenPower.level`        | `yongshenPower.score`      | 同上                                                              | `>= 80: '很強'; >= 65: '較強'; >= 50: '中等'; 其餘 '偏弱'`        | ✅ 一致 |
| `flow.score`                 | `purity.js`                | `purityResult.details.wuxingFlow`                              | 直接使用（保证 0–100）                            | ✅ 一致 |
| `flow.level`                 | `flow.score`               | 同上                                                              | `>= 80: '順暢'; >= 60: '通而不暢'; >= 40: '阻塞較多'; 其餘: '嚴重阻塞'` | ✅ 一致 |
| `tiYongBalance.level`        | `tiyong.js`                | `tiyongResult.carryingCapacity` + `bodyStrength` + `useStrength` | 根据体势和用势对比，映射到：`'體強用弱'｜'體弱用強'｜'體用相協'｜'體用失衡'`                       | ⚠️ 需计算 |
| `tiYongBalance.carrierScore` | `tiyong.js`                | `tiyongResult.carryingCapacity`                                 | 映射成 0–100 分：`carryingCapacity * 100`                                             | ✅ 一致 |
| `tiYongBalance.passScore`    | `tiyong.js`                | `tiyongResult.passThroughDegree`                                | 映射成 0–100 分：`passThroughDegree * 100`                                             | ✅ 一致 |
| `workPatterns.mainLine`      | `dogong.js`                | `dogongResult.coreLine.path` 或 `dogongResult.coreLine.type`                                    | 优先使用 `coreLine.type`，若无则从 `coreLine.path` 提取名称                                   | ⚠️ 需适配 |
| `workPatterns.strength`      | `dogong.js`                | `dogongResult.coreLine.workForce` 或 `dogongResult.coreLine.intensity`                               | 根据 `workForce` 或 `intensity` 映射：高→'強'，中→'中'，低→'弱'                                 | ⚠️ 需适配 |
| `workPatterns.tags`          | `dogong.js`                | `dogongResult.strongestPaths` 或 `dogongResult.workTypeSummary`                                            | 从 `strongestPaths` 提取类型标签，或从 `workTypeSummary` 生成标签                        | ⚠️ 需适配 |
| `tiaohouLabel`（可选）           | `tiaohou.js`               | `tiaohouResult`                                                 | 复用 `generateTiaohouLabel(tiaohouResult)`，例如 "寒重喜火"      | ✅ 一致 |

---

## 三、系统参数不一致点分析

### 3.1 需要补充的计算

#### ❗ 问题1：主用神对应的十神信息缺失

**现状**：
- `favoredAvoid.favored` 只返回五行数组（如 `["火", "土"]`）
- 没有对应的十神信息

**解决方案**：
- 在 `buildYongshenPattern` 函数中，遍历四柱（天干+藏干），找出五行匹配主用神的十神
- 例如：主用神是"火"，则找出四柱中所有"火"对应的十神（如"正印"、"偏印"、"食神"等）

**实现位置**：`core/engine/index.js` 的 `buildYongshenPattern` 函数

---

#### ❗ 问题2：体用平衡等级映射逻辑缺失

**现状**：
- `tiyongResult` 返回：
  - `carryingCapacity`: 0-1（承载度）
  - `bodyStrength`: 0-1（体势）
  - `useStrength`: 0-1（用势）
- 但没有直接的"体用平衡等级"

**解决方案**：
- 根据 `bodyStrength` 和 `useStrength` 的对比关系，判断体用平衡：
  - `bodyStrength > useStrength * 1.2` → `體強用弱`
  - `useStrength > bodyStrength * 1.2` → `體弱用強`
  - `Math.abs(bodyStrength - useStrength) < 0.15` → `體用相協`
  - 其他 → `體用失衡`

**实现位置**：`core/engine/index.js` 的 `mapTiYongLevel` 函数

---

#### ❗ 问题3：做功路径名称提取逻辑需适配

**现状分析**：
- `dogongResult.coreLine` 实际结构（来自 `dogong.js` 第214-223行）：
  ```javascript
  {
    from: string,        // 起始节点，如 "日主"
    to: string,          // 结束节点，如 "正官"
    path: string[],      // 十神路径数组，如 ["日主", "正印", "正官"]
    relations: string[], // 关系数组，如 ["生", "生"]
    workForce: number,   // 做功力度，如 0.65
    type: string,        // 做功类型，由 classifyWorkType 返回：'生助' | '克制' | '合取' | '未知'
    cleanliness: number,
    cumWeight: number
  }
  ```
- **关键问题**：
  - `type` 字段返回的是**类型**（"生助"、"克制"、"合取"、"未知"），不是**路径名称**
  - 用户方案需要的是**有意义的路径名称**（如"食傷生財"、"印比護身"、"食神制杀"）
  - `path` 数组是十神名称数组，需要根据十神组合和关系生成传统命理中的做功路径名称

**解决方案**：
需要建立一个**路径名称生成规则**，根据路径中的十神组合和关系类型，生成传统命理中的做功路径名称：

1. **建立路径名称映射表**：
   ```javascript
   // 根据路径中的十神分组和关系，生成路径名称
   const WORK_PATTERN_NAMES = {
     // 生助类路径
     '食伤→财星': '食傷生財',
     '食神→财星': '食神生財',
     '伤官→财星': '傷官生財',
     '财星→官杀': '財生官殺',
     '印星→比劫': '印比護身',
     '正印→比劫': '印比護身',
     '偏印→比劫': '梟印護身',
     '官杀→印星': '官印相生',
     '七杀→印星': '殺印相生',
     
     // 克制类路径
     '食神→七杀': '食神制殺',
     '伤官→正官': '傷官見官',
     '比劫→财星': '比劫奪財',
     '财星→印星': '財壞印',
     '官杀→比劫': '官殺克身',
     
     // 其他常见组合
     '比劫→食伤→财星': '比劫生食傷生財',
     '印星→比劫→食伤': '印比生食傷',
     '食伤→财星→官杀': '食傷生財生官',
   };
   ```

2. **路径名称生成函数**：
   ```javascript
   /**
    * 根据路径和关系生成做功路径名称
    * @param {string[]} path - 十神路径数组，如 ["日主", "正印", "正官"]
    * @param {string[]} relations - 关系数组，如 ["生", "生"]
    * @returns {string} 路径名称，如 "印比護身"、"食傷生財"
    */
   function generateWorkLineName(path, relations) {
     // 1. 过滤掉 "日主"，只保留十神
     const shishenPath = path.filter(node => node !== '日主');
     
     // 2. 将具体十神转换为分组（如 "正印" → "印星"）
     const groups = shishenPath.map(shishen => getTenGodGroup(shishen));
     
     // 3. 生成路径描述（如 "印星→比劫" 或 "食伤→财星"）
     const pathKey = groups.join('→');
     
     // 4. 查找映射表
     if (WORK_PATTERN_NAMES[pathKey]) {
       return WORK_PATTERN_NAMES[pathKey];
     }
     
     // 5. 如果路径较长（3个以上节点），尝试匹配部分路径
     if (groups.length >= 3) {
       // 尝试匹配前两个节点
       const twoNodeKey = `${groups[0]}→${groups[1]}`;
       if (WORK_PATTERN_NAMES[twoNodeKey]) {
         return WORK_PATTERN_NAMES[twoNodeKey];
       }
     }
     
     // 6. 兜底：根据关系类型生成通用名称
     if (relations.every(r => r === '生')) {
       return `${groups[0]}生${groups[groups.length - 1]}`;
     } else if (relations.every(r => r === '克')) {
       return `${groups[0]}克${groups[groups.length - 1]}`;
     }
     
     // 7. 最终兜底：返回类型
     return classifyWorkType(relations);
   }
   ```

3. **十神分组函数**（复用 `utils.js` 中的逻辑）：
   ```javascript
   function getTenGodGroup(shishen) {
     const TEN_GOD_GROUPS = {
       '比劫': ['比肩', '劫财'],
       '食伤': ['食神', '伤官'],
       '财星': ['正财', '偏财'],
       '官杀': ['正官', '七杀'],
       '印星': ['正印', '偏印']
     };
     
     for (const [group, members] of Object.entries(TEN_GOD_GROUPS)) {
       if (members.includes(shishen)) {
         return group;
       }
     }
     return shishen; // 如果不在分组中，返回原值
   }
   ```

**实现位置**：`core/engine/index.js` 的 `buildYongshenPattern` 函数中，添加 `extractWorkLineName` 辅助函数

---

#### ❗ 问题4：做功强度等级映射需适配

**现状**：
- `dogongResult.coreLine.workForce` 是数值，但没有明确的等级划分标准

**解决方案**：
- 根据 `workForce` 的数值范围映射：
  - 需要先分析现有数据的 `workForce` 分布范围
  - 建议：`>= 0.7` → '強'，`>= 0.4` → '中'，`< 0.4` → '弱'
  - 如果 `coreLine` 有 `intensity` 字段，优先使用

**实现位置**：`core/engine/index.js` 的 `mapWorkIntensityToLevel` 函数

---

#### ❗ 问题5：做功类型标签提取需适配

**现状**：
- `dogongResult.strongestPaths` 是路径数组
- `dogongResult.workTypeSummary` 是统计对象（如 `{ 克制: 2, 生助: 1 }`）

**解决方案**：
- 从 `strongestPaths` 中提取每个路径的 `type`，去重后作为标签
- 或从 `workTypeSummary` 的 key 生成标签数组

**实现位置**：`core/engine/index.js` 的 `buildYongshenPattern` 函数

---

## 四、组装函数设计

### 4.1 函数签名

```javascript
/**
 * 组装「用神格局」数据
 * @param {Object} wuxingResult - 五行分布结果（可选）
 * @param {Object} favoredResult - 喜用神结果（favoredAvoid）
 * @param {Object} tiyongResult - 体用分析结果
 * @param {Object} dogongResult - 做功分析结果
 * @param {Object} purityResult - 清浊分析结果
 * @param {Object} tiaohouResult - 调候分析结果（可选）
 * @param {Object} pillars - 四柱数据（用于提取十神）
 * @param {String} dayStem - 日主天干（用于计算十神）
 * @returns {Object} yongshenPattern 对象
 */
function buildYongshenPattern(
  wuxingResult,
  favoredResult,
  tiyongResult,
  dogongResult,
  purityResult,
  tiaohouResult,
  pillars,
  dayStem
)
```

### 4.2 辅助函数

```javascript
/**
 * 从四柱中提取指定五行对应的十神
 * @param {Object} pillars - 四柱数据
 * @param {String} dayStem - 日主天干
 * @param {String[]} elements - 五行数组（如 ["火", "土"]）
 * @returns {String[]} 十神数组（如 ["正印", "偏印"]）
 */
function extractTenGodsForElements(pillars, dayStem, elements)

/**
 * 归一化分数到 0-100
 * @param {Number} raw - 原始分数（可能是 0-1 或 0-100）
 * @returns {Number} 0-100 的分数
 */
function normalizeTo100(raw)

/**
 * 用神力度分級
 * @param {Number} score - 0-100 的分数
 * @returns {String} '偏弱' | '中等' | '較強' | '很強'
 */
function mapYongshenPowerLevel(score)

/**
 * 流通度等級
 * @param {Number} score - 0-100 的分数
 * @returns {String} '順暢' | '通而不暢' | '阻塞較多' | '嚴重阻塞'
 */
function mapFlowScoreToLevel(score)

/**
 * 體用等級映射
 * @param {Object} tiyongResult - 体用分析结果
 * @returns {String} '體強用弱' | '體弱用強' | '體用相協' | '體用失衡'
 */
function mapTiYongLevel(tiyongResult)

/**
 * 做功強度等級
 * @param {Number|Object} intensity - 强度值或 coreLine 对象
 * @returns {String} '強' | '中' | '弱'
 */
function mapWorkIntensityToLevel(intensity)

/**
 * 提取做功路径名称
 * @param {Object} coreLine - 核心做功线对象
 * @returns {String} 路径名称（如 "食傷生財"、"印比護身"）
 */
function extractWorkLineName(coreLine) {
  if (!coreLine || !coreLine.path) {
    return '';
  }
  
  // 使用路径和关系生成名称
  return generateWorkLineName(coreLine.path, coreLine.relations || []);
}

/**
 * 根据路径和关系生成做功路径名称
 * @param {string[]} path - 十神路径数组
 * @param {string[]} relations - 关系数组
 * @returns {string} 路径名称
 */
function generateWorkLineName(path, relations)

/**
 * 提取做功类型标签
 * @param {Object} dogongResult - 做功分析结果
 * @returns {String[]} 标签数组
 */
function extractWorkPatternTags(dogongResult)
```

---

## 五、实现位置

### 5.1 引擎层（`core/engine/index.js`）

1. 在 `BaziEngine.compute()` 方法中，调用 `buildYongshenPattern` 组装数据
2. 将结果挂到 `analysis.yongshenPattern`

**调用时机**：
- 在计算完所有分析模块后（`tiyongResult`、`dogongResult`、`purityResult` 都计算完成后）

**代码位置**：
```javascript
// 在 analysis 对象中添加
analysis: {
  // ... 其他字段
  yongshenPattern: this.buildYongshenPattern(
    wuxingPercent,
    favoredAvoid,
    tiyongResult,
    dogongResult,
    purityResult,
    tiaohouResult,
    pillars,
    dayP.stem
  )
}
```

---

## 六、前端适配

### 6.1 类型定义（`app/src/types/chart.ts`）

需要在 `BaziChartDto` 的 `analysis` 中添加：

```typescript
yongshenPattern?: {
  mainYongshen: {
    elements: string[];
    tenGods?: string[];
    type: '單一用神' | '複合用神';
  };
  assistElements: string[];
  tabooElements: string[];
  yongshenPower: {
    score: number;
    level: '偏弱' | '中等' | '較強' | '很強';
  };
  flow: {
    level: '順暢' | '通而不暢' | '阻塞較多' | '嚴重阻塞';
    score?: number;
  };
  tiYongBalance: {
    level: '體強用弱' | '體弱用強' | '體用相協' | '體用失衡';
    carrierScore?: number;
    passScore?: number;
  };
  workPatterns: {
    mainLine: string;
    strength: '強' | '中' | '弱';
    tags: string[];
  };
  tiaohouLabel?: string;
};
```

### 6.2 UI 组件（`app/src/screens/ChartDetail/ChartOverviewTab.tsx`）

替换现有的"结构格局卡"（第 180-245 行）为"用神格局卡"：

```typescript
{/* 用神格局卡 */}
<TouchableOpacity
  style={styles.card}
  activeOpacity={0.7}
  onPress={() => handleOneClickRead('yongshenPattern', '請詳細解讀我的用神格局')}
>
  <View style={styles.cardHeader}>
    <Text style={styles.cardTitle}>用神格局</Text>
    <Text style={styles.oneClickReadTag}>{t('chartDetail.overview.oneClickRead')}</Text>
  </View>
  {result?.analysis?.yongshenPattern ? (
    <View style={styles.indicatorContainer}>
      {/* 主用神 */}
      <View style={styles.indicatorRow}>
        <Text style={styles.indicatorLabel}>主用神：</Text>
        <Text style={styles.indicatorValue}>
          {result.analysis.yongshenPattern.mainYongshen.elements.join('、')}
          {result.analysis.yongshenPattern.mainYongshen.type === '複合用神' ? '（複合）' : ''}
        </Text>
      </View>
      
      {/* 辅喜五行 */}
      {result.analysis.yongshenPattern.assistElements.length > 0 && (
        <View style={styles.indicatorRow}>
          <Text style={styles.indicatorLabel}>辅喜五行：</Text>
          <View style={styles.tagContainer}>
            {result.analysis.yongshenPattern.assistElements.map((el, idx) => (
              <View key={idx} style={styles.tag}>
                <Text style={styles.tagText}>{el}</Text>
              </View>
            ))}
          </View>
        </View>
      )}
      
      {/* 忌神 */}
      <View style={styles.indicatorRow}>
        <Text style={styles.indicatorLabel}>忌神：</Text>
        <View style={styles.tagContainer}>
          {result.analysis.yongshenPattern.tabooElements.map((el, idx) => (
            <View key={idx} style={[styles.tag, styles.tagNegative]}>
              <Text style={[styles.tagText, styles.tagTextNegative]}>{el}</Text>
            </View>
          ))}
        </View>
      </View>
      
      {/* 用神力度 */}
      <View style={styles.indicatorRow}>
        <Text style={styles.indicatorLabel}>用神力度：</Text>
        <Text style={styles.indicatorValue}>
          {result.analysis.yongshenPattern.yongshenPower.score}/100 · {result.analysis.yongshenPattern.yongshenPower.level}
        </Text>
      </View>
      
      {/* 流通等级 */}
      <View style={styles.indicatorRow}>
        <Text style={styles.indicatorLabel}>流通等級：</Text>
        <Text style={styles.indicatorValue}>
          {result.analysis.yongshenPattern.flow.level}
          {result.analysis.yongshenPattern.flow.score !== undefined && 
            ` (${result.analysis.yongshenPattern.flow.score}/100)`}
        </Text>
      </View>
      
      {/* 體用平衡 */}
      <View style={styles.indicatorRow}>
        <Text style={styles.indicatorLabel}>體用平衡：</Text>
        <Text style={styles.indicatorValue}>
          {result.analysis.yongshenPattern.tiYongBalance.level}
        </Text>
      </View>
      
      {/* 做功格局 */}
      {result.analysis.yongshenPattern.workPatterns.mainLine && (
        <View style={styles.indicatorRow}>
          <Text style={styles.indicatorLabel}>核心做功：</Text>
          <Text style={styles.indicatorValue}>
            {result.analysis.yongshenPattern.workPatterns.mainLine} · {result.analysis.yongshenPattern.workPatterns.strength}
          </Text>
        </View>
      )}
      
      {/* 调候标签（可选） */}
      {result.analysis.yongshenPattern.tiaohouLabel && (
        <View style={styles.indicatorRow}>
          <Text style={styles.indicatorLabel}>調候：</Text>
          <Text style={styles.indicatorValue}>
            {result.analysis.yongshenPattern.tiaohouLabel}
          </Text>
        </View>
      )}
    </View>
  ) : (
    <Text style={styles.placeholderText}>用神格局（待實現）</Text>
  )}
</TouchableOpacity>
```

---

## 七、实施步骤

### Phase 1: 引擎层实现 ✅（待实施）

1. ✅ 在 `core/engine/index.js` 中添加 `buildYongshenPattern` 函数
2. ✅ 实现所有辅助函数（`extractTenGodsForElements`、`normalizeTo100`、`mapYongshenPowerLevel` 等）
3. ✅ 在 `BaziEngine.compute()` 中调用并组装数据
4. ✅ 测试数据组装逻辑

### Phase 2: 类型定义 ✅（待实施）

1. ✅ 在 `app/src/types/chart.ts` 中添加 `yongshenPattern` 类型定义

### Phase 3: 前端UI ✅（待实施）

1. ✅ 在 `ChartOverviewTab.tsx` 中替换"结构格局卡"为"用神格局卡"
2. ✅ 测试UI显示效果

---

## 八、注意事项

### 8.1 向后兼容

- 保留原有的 `analysis.structure` 字段，不删除
- 前端可以同时支持两种卡片（通过配置切换，或逐步迁移）

### 8.2 数据完整性

- 如果某个模块的计算结果缺失，使用默认值或空数组，避免前端报错
- 所有可选字段（如 `tenGods`、`tiaohouLabel`）都要做空值检查

### 8.3 性能考虑

- `extractTenGodsForElements` 函数需要遍历四柱，但数据量小，性能影响可忽略

---

## 九、待确认事项

1. **主用神数量**：用户方案中提到"主用神"可能是1个或2个，是否需要明确规则？
   - 建议：取 `favoredAvoid.favored` 的前1-2个作为主用神，其余为辅助

2. **做功路径名称**：如果 `coreLine.type` 是英文或代码，是否需要翻译成中文？
   - 建议：建立映射表，将英文类型映射为中文名称

3. **调候标签**：是否在"用神格局"卡片中显示调候标签？
   - 建议：可选显示，因为"命格總評"卡片中已有调候信息

---

## 十、总结

### ✅ 与系统参数一致的部分

- 主用神五行、辅喜五行、忌神五行：直接使用 `favoredAvoid`
- 用神力度：使用 `purityResult.details.yongshenPurity`
- 流通等级：使用 `purityResult.details.wuxingFlow`
- 承载度、通关度：使用 `tiyongResult` 的对应字段
- 调候标签：复用 `generateTiaohouLabel`

### ⚠️ 需要补充/适配的部分

- 主用神对应的十神信息：需要从四柱中提取
- 体用平衡等级：需要根据体势和用势对比计算
- 做功路径名称：需要适配 `coreLine` 的数据结构
- 做功强度等级：需要定义映射规则
- 做功类型标签：需要从 `strongestPaths` 或 `workTypeSummary` 提取

---

---

## 十一、做功路径名称提取问题总结

### 11.1 问题核心

**现状**：
- `dogongResult.coreLine.type` 返回的是**类型**（"生助"、"克制"、"合取"、"未知"），不是**路径名称**
- 用户方案需要的是**有意义的路径名称**（如"食傷生財"、"印比護身"、"食神制杀"）

**根本原因**：
- `dogong.js` 的 `classifyWorkType` 函数只返回类型，不生成路径名称
- 路径名称需要根据**十神组合**和**关系类型**，映射到传统命理中的做功路径名称

### 11.2 解决方案要点

1. **建立路径名称映射表**：将常见的十神组合映射到传统命理名称
2. **路径解析**：从 `path` 数组中提取十神，转换为分组（如"正印"→"印星"）
3. **名称生成**：根据路径和关系，查找映射表或生成描述性名称
4. **兜底策略**：如果映射表中没有，根据关系类型生成通用名称

### 11.3 实现优先级

- **高优先级**：实现常见路径的映射（食傷生財、印比護身、食神制杀等）
- **中优先级**：实现路径解析和分组转换
- **低优先级**：实现兜底策略和通用名称生成

---

**文档版本**：v1.1  
**创建时间**：2024年12月  
**最后更新**：2024年12月（补充做功路径名称提取详细方案）


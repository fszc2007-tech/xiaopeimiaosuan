# 手机热点网络配置指南

## 当前网络状态

- **电脑 IP（手机热点）**：`172.20.10.2`
- **Metro Bundler 端口**：`8081`
- **后端 API 端口**：`3000`

---

## 手机热点场景分析

### iOS 模拟器（当前情况）

**特点**：
- 模拟器运行在电脑上，可以直接访问 `localhost`
- **不受手机热点影响**，因为模拟器使用电脑的网络栈

**配置**：
- Metro Bundler：使用 `localhost:8081` ✅
- 后端 API：使用 `localhost:3000` ✅（已配置）

### 真机测试（如果将来需要）

**特点**：
- 真机通过手机热点连接到电脑
- 需要通过电脑的热点 IP 访问服务

**配置**：
- Metro Bundler：需要使用 `172.20.10.2:8081`
- 后端 API：需要使用 `172.20.10.2:3000`

---

## 当前问题诊断

### 问题 1：Metro Bundler 连接

**可能原因**：
1. Metro Bundler 只绑定到 `localhost`，没有绑定到网络接口
2. Expo 的 URL 配置问题

**解决方案**：

#### 方案 A：使用 LAN 模式（推荐）

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app

# 停止当前的 Metro bundler
pkill -f "expo start"

# 使用 LAN 模式启动（会绑定到所有网络接口）
npx expo start --lan --clear
```

**说明**：
- `--lan` 模式会让 Metro bundler 绑定到所有网络接口
- 模拟器可以通过 `localhost` 访问
- 真机可以通过 `172.20.10.2` 访问

#### 方案 B：明确指定 localhost（仅模拟器）

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app

# 停止当前的 Metro bundler
pkill -f "expo start"

# 明确使用 localhost
npx expo start --localhost --clear
```

---

## 完整配置步骤

### 步骤 1：重启 Metro Bundler（使用 LAN 模式）

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app

# 停止所有相关进程
pkill -f "expo start"
pkill -f "metro"

# 等待 2 秒
sleep 2

# 使用 LAN 模式启动（推荐）
npx expo start --lan --clear
```

### 步骤 2：在模拟器中重新加载

1. 按 `Cmd + R` 重新加载
2. 或按 `Cmd + D` → 选择 "Reload"

### 步骤 3：验证连接

启动后，Metro bundler 应该显示类似：
```
Metro waiting on exp://172.20.10.2:8081
```

**注意**：即使显示的是 IP 地址，iOS 模拟器仍然可以通过 `localhost` 访问。

---

## 后端 API 配置（已修复）

当前配置使用 `localhost:3000`，这对 iOS 模拟器是正确的。

**如果将来需要真机测试**，需要设置环境变量：

```bash
# 在 app 目录创建 .env 文件
cd /Users/gaoxuxu/Desktop/xiaopei-app/app
echo "EXPO_PUBLIC_API_BASE_URL=http://172.20.10.2:3000" > .env
```

---

## 常见问题

### Q1: 为什么模拟器显示 IP 地址而不是 localhost？

**A**: 这是正常的。Expo 会显示网络 IP，但模拟器内部仍然使用 localhost 访问。不影响使用。

### Q2: 手机热点 IP 会变化吗？

**A**: 可能会。每次连接热点时，IP 可能会不同。如果 IP 变化：
1. 重新运行 `ifconfig | grep "inet " | grep -v 127.0.0.1` 获取新 IP
2. 更新环境变量（如果需要真机测试）

### Q3: 使用手机热点会影响性能吗？

**A**: 
- **模拟器**：不受影响（使用 localhost）
- **真机**：可能会有轻微延迟，但通常可以接受

### Q4: 如何同时支持模拟器和真机？

**A**: 使用 `--lan` 模式启动 Metro bundler：
```bash
npx expo start --lan
```

这样：
- 模拟器可以通过 `localhost:8081` 访问
- 真机可以通过 `172.20.10.2:8081` 访问

---

## 推荐配置（手机热点场景）

### 开发环境（模拟器 + 真机）

```bash
# 启动 Metro Bundler
cd /Users/gaoxuxu/Desktop/xiaopei-app/app
npx expo start --lan --clear

# 启动后端 API（确保运行在 localhost:3000）
cd /Users/gaoxuxu/Desktop/xiaopei-app/core
npm start
```

### 环境变量配置（可选）

如果需要真机测试，创建 `.env` 文件：

```bash
# app/.env
EXPO_PUBLIC_API_BASE_URL=http://172.20.10.2:3000
```

**注意**：iOS 模拟器会自动使用 `localhost`，不受此环境变量影响。

---

## 快速修复命令

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app

# 停止所有进程
pkill -f "expo start"; pkill -f "metro"

# 使用 LAN 模式重启（推荐）
npx expo start --lan --clear
```

然后在模拟器中按 `Cmd + R` 重新加载。

---

## 总结

**手机热点对 iOS 模拟器的影响**：
- ✅ **无影响**：模拟器使用 localhost，不依赖网络接口
- ⚠️ **Metro Bundler 配置**：建议使用 `--lan` 模式，确保绑定到所有接口
- ✅ **后端 API**：已配置为 localhost，模拟器可以正常访问

**当前建议**：
1. 使用 `npx expo start --lan --clear` 重启 Metro Bundler
2. 在模拟器中按 `Cmd + R` 重新加载
3. 如果还有问题，检查防火墙设置

---

**最后更新**：2024-12-XX  
**当前热点 IP**：172.20.10.2




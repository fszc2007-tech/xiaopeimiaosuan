# 訂閱頁面重構實施方案

> **基於**：會員訂閱與AI解讀次數限制-優化方案.md（精簡技術方案 v1）  
> **目標文件**：`app/src/screens/Pro/ProSubscriptionScreen.tsx`（保留這個，刪除另一個）

---

## 一、當前頁面問題

### 1. 價格方案不符
- **當前**：月度 ¥28、年度 ¥198、終身 ¥599
- **新方案**：月度 NT$ 39、季度 NT$ 99、年度 NT$ 348

### 2. 缺少必要信息
- ❌ 沒有顯示「今日解讀次數」（`aiCallsToday / aiDailyLimit`）
- ❌ 沒有精簡的權益對比表（非會員 vs 小佩會員）
- ❌ 沒有 CTA 文案：「想要更自由地問小佩，就升級成小佩會員吧。」

### 3. 權益描述過於複雜
- 當前有很多詳細的權益說明，但新方案要求精簡
- 只需要 3 行權益對比表

---

## 二、新頁面結構（從上到下）

### 1. 頂部導航欄
- 返回按鈕（左側）
- 標題：「小佩 Pro」+ Crown 圖標

### 2. 當前狀態卡片
```
[Crown 圖標] 當前狀態
           免費用戶 · 已解鎖基礎排盤與簡要解讀
           [想要更深入的陪伴？]
```

**新增**：顯示今日解讀次數
```
今日解讀：3 / 10 次
```

### 3. 小佩 Pro 介紹卡片（保留，但簡化）
- 渐变背景（綠色系）
- 標題：「升級小佩 Pro」
- 簡短說明（保留現有文案）
- 兩個理念說明（保留）

### 4. 權益對比表（新增，替換原來的「升級後你可以獲得」）

```
| | 非會員 | 小佩會員 |
|---|---|---|
| 命盤數量 | 最多 10 個 | 更寬鬆，適合長期使用 |
| AI 解讀 / 問答 | 首日 10 次，之後每天 5 次 | 每天 100 次 |
| 功能 | 可體驗全部功能 | 全功能 + 高額度，不易受限 |
```

**CTA 文案**：想要更自由地問小佩，就升級成小佩會員吧。

### 5. 價格方案區（修改）

**新方案**：
- 月付方案：NT$ 39 / 月（標籤：早鳥價）
- 季付方案：NT$ 99 / 季（標籤：早鳥價 · 推薦）
- 年付方案：NT$ 348 / 年（標籤：早鳥價）

**移除**：終身會員方案

### 6. 選中方案摘要 + CTA（保留）
```
已選擇：季付方案 · NT$ 99 / 季
[開通小佩 Pro]
```

### 7. FAQ 區域（簡化）
保留 4 個常見問題，但調整內容：
1. 免費版與小佩會員有什麼差別？
2. 可以隨時取消續費嗎？
3. 支付後多久生效？
4. 更換手機後訂閱還有效嗎？

### 8. 底部鏈接（保留）
- 恢復購買
- 用戶協議 · 隱私政策

---

## 三、需要修改的代碼部分

### 3.1 數據配置

#### 修改 PLANS 數組

```tsx
const PLANS: Plan[] = [
  {
    id: 'monthly',
    label: '月付方案',
    tag: '早鳥價',
    description: '先體驗一個月，看小佩是否適合你',
    priceLabel: 'NT$ 39 / 月',
    price: 39,
    subLabel: '',
    highlight: false,
  },
  {
    id: 'quarterly',
    label: '季付方案',
    tag: '早鳥價 · 推薦',
    description: '適合穩定追蹤一段時間的你',
    priceLabel: 'NT$ 99 / 季',
    price: 99,
    subLabel: '約 NT$ 33 / 月',
    highlight: true,
  },
  {
    id: 'yearly',
    label: '年付方案',
    tag: '早鳥價',
    description: '長期使用小佩的最佳選擇',
    priceLabel: 'NT$ 348 / 年',
    price: 348,
    subLabel: '約 NT$ 29 / 月',
    highlight: false,
  },
];
```

#### 修改類型定義

```tsx
type PlanId = 'yearly' | 'monthly' | 'quarterly'; // 移除 'lifetime'
```

#### 移除 PLAN_BENEFITS_MAP
不再需要這個複雜的權益映射，改為固定的權益對比表。

#### 修改 FAQ_DATA

```tsx
const FAQ_DATA = [
  {
    question: '免費版與小佩會員有什麼差別？',
    answer: '免費版：命盤最多 10 個，AI 解讀首日 10 次、之後每天 5 次。小佩會員：命盤更寬鬆，AI 解讀每天 100 次，全功能 + 高額度。',
  },
  {
    question: '可以隨時取消續費嗎？',
    answer: '是的。月度、季度和年度方案都可以隨時在應用商店取消自動續費，已支付的週期內權益不會被中斷。',
  },
  {
    question: '支付後多久生效？',
    answer: '支付成功後立即生效，您可以立即使用所有小佩會員功能。',
  },
  {
    question: '更換手機後訂閱還有效嗎？',
    answer: '有效。使用相同帳號登錄後，訂閱權益會自動同步。您也可以點擊「恢復購買」來手動同步。',
  },
];
```

---

### 3.2 新增：會員狀態 Hook

```tsx
import { useEffect, useState } from 'react';
import { proService } from '@/services/api';

interface MembershipStatus {
  isPro: boolean;
  proPlan: string | null;
  proExpiresAt: string | null;
  aiCallsToday: number;
  aiDailyLimit: number;
  aiRemaining: number;
}

export const useMembershipStatus = () => {
  const [status, setStatus] = useState<MembershipStatus | null>(null);
  const [loading, setLoading] = useState(true);

  const fetchStatus = async () => {
    try {
      setLoading(true);
      const response = await proService.getStatus();
      setStatus(response.data);
    } catch (error) {
      console.error('Failed to fetch membership status:', error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchStatus();
  }, []);

  return { status, loading, refetch: fetchStatus };
};
```

---

### 3.3 修改組件結構

#### 在組件頂部使用 Hook

```tsx
export const ProSubscriptionScreen: React.FC = () => {
  const navigation = useNavigation();
  const [selectedPlanId, setSelectedPlanId] = useState<PlanId>('quarterly'); // 默認選中季付
  const [expandedFaqIndex, setExpandedFaqIndex] = useState<number | null>(null);
  
  // 新增：獲取會員狀態
  const { status, loading, refetch } = useMembershipStatus();

  const selectedPlan = PLANS.find((p) => p.id === selectedPlanId) || PLANS[1];

  // ... 其他代碼
};
```

#### 修改「當前狀態卡片」

```tsx
{/* 2. 当前状态卡片 */}
<View style={styles.statusCard}>
  <View style={styles.statusIconContainer}>
    <Crown color={colors.brandGreen} size={20} />
  </View>

  <View style={styles.statusContent}>
    <Text style={styles.statusLabel}>當前狀態</Text>
    <Text style={styles.statusText}>
      {status?.isPro ? '小佩會員' : '免費用戶'} · 已解鎖基礎排盤與簡要解讀
    </Text>
    
    {/* 新增：今日解讀次數 */}
    {status && (
      <Text style={styles.statusQuota}>
        今日解讀：{status.aiCallsToday} / {status.aiDailyLimit} 次
      </Text>
    )}
  </View>

  <View style={styles.statusTag}>
    <Text style={styles.statusTagText}>想要更深入的陪伴？</Text>
  </View>
</View>
```

#### 替換「權益總覽卡片」為「權益對比表」

```tsx
{/* 4. 权益对比表 */}
<View style={styles.section}>
  <View style={styles.comparisonTable}>
    {/* 表头 */}
    <View style={styles.tableRow}>
      <View style={[styles.tableCell, styles.tableCellHeader, styles.tableCellFirst]} />
      <View style={[styles.tableCell, styles.tableCellHeader]}>
        <Text style={styles.tableHeaderText}>非會員</Text>
      </View>
      <View style={[styles.tableCell, styles.tableCellHeader]}>
        <Text style={styles.tableHeaderText}>小佩會員</Text>
      </View>
    </View>

    {/* 命盘数量 */}
    <View style={styles.tableRow}>
      <View style={[styles.tableCell, styles.tableCellFirst]}>
        <Text style={styles.tableCellText}>命盤數量</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={styles.tableCellText}>最多 10 個</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={[styles.tableCellText, styles.tableCellHighlight]}>
          更寬鬆，適合長期使用
        </Text>
      </View>
    </View>

    {/* AI 解读 / 问答 */}
    <View style={styles.tableRow}>
      <View style={[styles.tableCell, styles.tableCellFirst]}>
        <Text style={styles.tableCellText}>AI 解讀 / 問答</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={styles.tableCellText}>首日 10 次{'\n'}之後每天 5 次</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={[styles.tableCellText, styles.tableCellHighlight]}>
          每天 100 次
        </Text>
      </View>
    </View>

    {/* 功能 */}
    <View style={styles.tableRow}>
      <View style={[styles.tableCell, styles.tableCellFirst]}>
        <Text style={styles.tableCellText}>功能</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={styles.tableCellText}>可體驗全部功能</Text>
      </View>
      <View style={styles.tableCell}>
        <Text style={[styles.tableCellText, styles.tableCellHighlight]}>
          全功能 + 高額度{'\n'}不易受限
        </Text>
      </View>
    </View>
  </View>

  {/* CTA 文案 */}
  <Text style={styles.ctaText}>
    想要更自由地問小佩，就升級成小佩會員吧。
  </Text>
</View>
```

#### 修改「開通 Pro」按鈕處理

```tsx
// 处理开通 Pro
const handleSubscribe = async () => {
  try {
    // TODO: 目前使用假支付 API
    // 未來接入真實支付時，這裡會調用 Apple / Google IAP
    
    const response = await proService.fakeSubscribe({
      plan: selectedPlanId,
    });
    
    if (response.success) {
      // 刷新會員狀態
      await refetch();
      
      Alert.alert(
        '開通成功',
        '您已成功升級為小佩會員！',
        [
          {
            text: '好的',
            onPress: () => navigation.goBack(),
          },
        ]
      );
    }
  } catch (error) {
    console.error('Subscribe failed:', error);
    Alert.alert('開通失敗', '請稍後再試');
  }
};
```

---

### 3.4 新增樣式

```tsx
// 今日解读次数
statusQuota: {
  fontSize: fontSizes.xs,
  color: colors.brandGreen,
  fontWeight: fontWeights.medium,
  marginTop: spacing.xs,
},

// 权益对比表
comparisonTable: {
  backgroundColor: colors.cardBg,
  borderRadius: radius.lg,
  borderWidth: 1,
  borderColor: colors.border,
  overflow: 'hidden',
  marginBottom: spacing.md,
},
tableRow: {
  flexDirection: 'row',
  borderBottomWidth: 1,
  borderBottomColor: colors.border,
},
tableCell: {
  flex: 1,
  padding: spacing.sm,
  justifyContent: 'center',
},
tableCellFirst: {
  backgroundColor: `${colors.disabledBg}66`,
},
tableCellHeader: {
  backgroundColor: `${colors.brandGreen}1A`,
},
tableHeaderText: {
  fontSize: fontSizes.sm,
  fontWeight: fontWeights.semibold,
  color: colors.ink,
  textAlign: 'center',
},
tableCellText: {
  fontSize: fontSizes.sm,
  color: colors.textSecondary,
  lineHeight: 18,
  textAlign: 'center',
},
tableCellHighlight: {
  color: colors.brandGreen,
  fontWeight: fontWeights.medium,
},

// CTA 文案
ctaText: {
  fontSize: fontSizes.sm,
  color: colors.textSecondary,
  textAlign: 'center',
  lineHeight: 20,
  paddingHorizontal: spacing.md,
},
```

---

## 四、API 服務層

### 4.1 新增 proService 方法

在 `app/src/services/api/proService.ts` 中新增：

```tsx
// 獲取會員狀態（包含 AI 次數信息）
export const getStatus = async (): Promise<ApiResponse<MembershipStatus>> => {
  return apiClient.get('/pro/status');
};

// 假支付訂閱（測試用）
export const fakeSubscribe = async (data: {
  plan: 'monthly' | 'quarterly' | 'yearly';
}): Promise<ApiResponse<any>> => {
  return apiClient.post('/pro/fake-subscribe', data);
};
```

---

## 五、實施步驟

### P0（必做）

1. ✅ **修改 PLANS 數組**
   - 移除 `lifetime`
   - 新增 `quarterly`
   - 更新價格為 NT$ 39 / 99 / 348

2. ✅ **新增 useMembershipStatus Hook**
   - 調用 `/api/v1/pro/status`
   - 返回會員狀態和 AI 次數信息

3. ✅ **修改「當前狀態卡片」**
   - 顯示今日解讀次數

4. ✅ **替換「權益總覽卡片」為「權益對比表」**
   - 3 行精簡對比表
   - CTA 文案

5. ✅ **修改 FAQ 內容**
   - 調整為符合新方案的問答

6. ✅ **修改「開通 Pro」按鈕處理**
   - 調用假支付 API
   - 成功後刷新狀態

7. ✅ **新增 API 服務方法**
   - `getStatus()`
   - `fakeSubscribe()`

### P1（可選優化）

- 添加加載狀態
- 添加錯誤處理
- 優化動畫效果
- 添加骨架屏

---

## 六、測試要點

1. **會員狀態顯示**
   - 非會員：顯示「免費用戶」+ 今日次數
   - 會員：顯示「小佩會員」+ 今日次數

2. **方案選擇**
   - 默認選中「季付方案」
   - 可切換三個方案
   - 選中方案高亮顯示

3. **假支付流程**
   - 點擊「開通小佩 Pro」
   - 調用假支付 API
   - 成功後刷新狀態
   - 顯示成功提示

4. **權益對比表**
   - 顯示 3 行對比
   - 小佩會員列高亮顯示
   - CTA 文案正確顯示

---

## 七、注意事項

1. **保留哪個文件**
   - 保留：`app/src/screens/Pro/ProSubscriptionScreen.tsx`
   - 刪除：`app/src/screens/ProSubscription/ProSubscriptionScreen.tsx`

2. **價格單位**
   - 使用 NT$（新台幣）
   - 不要使用 ¥（人民幣）

3. **方案命名**
   - 統一使用：月付方案、季付方案、年付方案
   - 不要使用：月度會員、年度會員

4. **文案統一**
   - 使用「小佩會員」，不要使用「小佩 Pro」
   - 但頁面標題和代碼中可以保留「Pro」

---

**文檔結束**



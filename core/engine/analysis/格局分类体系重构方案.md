# 八字格局分类体系重构方案

## 一、当前问题诊断

### 1. 分类混乱
- **正格类**中混入了"十神组合格局"和"月令主格"
- **从强格**与**专旺格**概念重复
- 格局细分方式不当（真/假/一般应作为属性而非独立格局）

### 2. 命名不标准
- "财官相辅"应改为"财官双美"或归入普通描述
- "杀印相生(盲)"标注不当，非盲派独有

### 3. 逻辑错误
- "从财杀格"不符合从格纯粹性要求
- "伤官见官(盲)"是破格因素，不是格局

---

## 二、新格局分类体系

### 【第一类：月令主格】（正八格 + 外格）

**定义**：以月令（月支）为核心确定的格局，是八字格局判断的基础。

#### 1.1 正八格（月令主格核心）
1. **正官格** - 月令为正官
2. **七杀格** - 月令为七杀
3. **正印格** - 月令为正印
4. **偏印格（枭印格）** - 月令为偏印
5. **正财格** - 月令为正财
6. **偏财格** - 月令为偏财
7. **食神格** - 月令为食神
8. **伤官格** - 月令为伤官

#### 1.2 外格（特殊月令格局）
9. **建禄格** - 月干在月支的禄位（临官位）
10. **阳刃格** - 月令为日主的阳刃（帝旺位）
11. **月劫格** - 月令为比劫，但非建禄非阳刃

**说明**：
- 正八格是传统子平法的核心格局
- 外格是特殊情况下的月令格局
- 每个格局可以有"纯度属性"（真/假/一般），但不作为独立格局

---

### 【第二类：十神组合格局】

**定义**：基于十神之间的生克关系形成的组合格局，不依赖月令。

1. **食神生财** - 食神旺，财星有气，食神生财
2. **伤官配印** - 伤官旺，印星来化泄
3. **财官双美** - 财能生官，势成体系（原"财官相辅"）
4. **杀印相生** - 七杀旺，印星化为用神
5. **官印相生** - 正官旺，正印生扶
6. **食神制杀** - 食神强旺制伏七杀，化压力为权力（顶级组合）
7. **羊刃驾杀** - 羊刃与七杀形成对峙，主武职魄力（重要组合）
8. **伤官伤尽** - 八字中完全无官杀，伤官才华纯粹释放（特殊组合）

**说明**：
- 这些格局可以与月令主格并存
- 用于描述十神之间的配合关系
- 不是独立的格局分类，而是辅助判断
- 优先级：食神制杀 > 羊刃驾杀 > 其他组合

---

### 【第三类：特殊格局】

#### 3.1 专旺格（统一名称，删除"从强格"）
**定义**：日主得令，同类五行成势，无破格因素。

1. **曲直仁寿格** - 木专旺
2. **炎上格** - 火专旺
3. **稼穑格** - 土专旺
4. **从革格** - 金专旺
5. **润下格** - 水专旺

**说明**：
- 删除"从强格"分类，统一使用"专旺格"
- 删除"比劫专旺/印星专旺/比印并旺"等细分
- 这些状态可以通过纯度属性体现

#### 3.2 从弱格
**定义**：日主极弱，完全从于旺神。

**子类**：
1. **从财格** - 从财星（真/假/一般作为纯度属性）
2. **从杀格** - 从官杀（真/假/一般作为纯度属性）
3. **从儿格** - 从食伤（真/假/一般作为纯度属性）
4. **从势格** - 多势混杂，日主完全无助（包含原"从财杀格"）

**说明**：
- 删除"从财杀格"，归入"从势格"
- "真/假/一般"作为格局的纯度属性，不是独立格局名称

#### 3.3 化气格
**定义**：天干五合化气成功。

1. **甲己化土格**
2. **乙庚化金格**
3. **丙辛化水格**
4. **丁壬化木格**
5. **戊癸化火格**

**说明**：
- 每种化气格都有纯度属性（真化/假化）

---

### 【第四类：普通格局】

1. **平格** - 平衡杂气，未成主象，无法归入上述任何有成格局

**说明**：
- 作为兜底分类
- 表示命局没有明显的格局特征

---

## 三、格局属性体系

### 纯度属性（适用于所有格局）
- **真** - 格局纯粹，无破格因素，用神有力
- **假** - 格局成立但有破格因素，可在大运中救应
- **一般** - 格局成立但纯度不高，需要大运扶助

### 破格因素（独立分析，非格局）
1. **官杀混杂** - 正官和七杀同时出现，格局不清（最严重）
2. **伤官见官** - 官格遇伤官，破坏官格
3. **比劫夺财** - 财格遇比劫，夺取财星
4. **财星坏印** - 印格遇财星，破坏印格
5. **枭神夺食** - 食神格遇偏印，夺取食神

**说明**：
- 破格因素独立分析，不作为格局
- 影响格局的纯度评分
- 在 `pogeFactors` 中详细列出

---

## 四、重构后的格局统计

### 月令主格：11个
- 正八格：8个（正官、七杀、正印、偏印、食神、伤官、正财、偏财）
- 外格：3个（建禄、阳刃、月劫）

### 十神组合格局：8个
- 食神生财、伤官配印、财官双美、杀印相生、官印相生
- 食神制杀、羊刃驾杀、伤官伤尽

### 特殊格局：15个
- 专旺格：5个（曲直、炎上、稼穑、从革、润下）
- 从弱格：4个（从财、从杀、从儿、从势）
- 化气格：5个（甲己化土、乙庚化金、丙辛化水、丁壬化木、戊癸化火）

### 普通格局：1个
- 平格

### 破格因素：5个（独立分析，非格局）
- 官杀混杂、伤官见官、比劫夺财、财星坏印、枭神夺食

**总计：35个格局类型 + 5个破格因素**

---

## 五、实现要点

### 1. 格局判断优先级（已细化，见第九节）

### 2. 纯度属性
- 每个格局计算时，同时计算纯度（真/假/一般）
- 纯度作为格局的属性，不是独立格局名称
- 在返回结果中包含 `purity: { level: '真' | '假' | '一般', factors: [...] }`

### 3. 破格因素
- 独立分析，不作为格局
- 在 `pogeFactors` 中详细列出
- 影响格局的纯度评分

---

## 六、需要修改的代码

### 1. 删除的格局
- ❌ 从强格（合并到专旺格）
- ❌ 从财杀格（归入从势格）
- ❌ 比劫专旺/印星专旺/比印并旺（作为属性）
- ❌ 伤官见官(盲)（改为破格因素）
- ❌ 杀印相生(盲)（改为十神组合格局）

### 2. 重命名的格局
- "财官相辅" → "财官双美"
- "从强格" → "专旺格"

### 3. 新增的格局
- **月令主格**：正官格、七杀格、正印格、食神格、伤官格（正八格）
- **外格**：阳刃格、月劫格
- **十神组合**：食神制杀、羊刃驾杀、伤官伤尽

### 4. 调整的分类
- 建禄格、枭印格 → 提升为月令主格
- 食神生财等 → 移入十神组合格局

---

## 七、疑问确认与回答 ✅

### 1. 正八格判断方法

**回答**：需要同时判断月支藏干透出和月支本气。

**具体判断流程**：
```javascript
// 伪代码示例
function 判断月令主格(八字) {
  const 月支 = 八字.月支;
  const 藏干 = 获取月支藏干(月支);
  const 透出天干 = 检查藏干是否透出(藏干, 八字.天干);
  
  if (透出天干) {
    return 十神转换(透出天干); // 取透出十神为格
  } else {
    return 十神转换(月支.本气); // 取本气十神为格
  }
}
```

**各格局具体判断**：
- **正官格**：月支藏干透出为正官 或 月支本气为正官
- **七杀格**：月支藏干透出为七杀 或 月支本气为七杀
- **正印格**：月支藏干透出为正印 或 月支本气为正印
- **偏印格（枭印格）**：月支藏干透出为偏印 或 月支本气为偏印
- **食神格**：月支藏干透出为食神 或 月支本气为食神
- **伤官格**：月支藏干透出为伤官 或 月支本气为伤官
- **正财格**：月支藏干透出为正财 或 月支本气为正财
- **偏财格**：月支藏干透出为偏财 或 月支本气为偏财

### 2. 阳刃格是否需要实现

**回答**：**必须实现，非常重要！**

**判断条件**：
- 月支为日主的帝旺之地
- 且月支十神为劫财

**示例**：
- 甲日主见卯月（卯为甲的帝旺，卯中藏乙为劫财）
- 丙日主见午月（午为丙的帝旺，午中藏丁为劫财）
- 庚日主见酉月（酉为庚的帝旺，酉中藏辛为劫财）

**注意**：阳刃格是特例，不看你透不透，只要月令是日主的"阳刃"（劫财+帝旺），即入此格。

### 3. 月劫格是否需要实现

**回答**：建议实现，但优先级低于阳刃格。

**判断条件**：
- 月支为比肩或劫财
- 但不是建禄（临官）也不是阳刃（帝旺）

**示例**：需要查表确认具体组合

### 4. 十神组合格局与月令主格的关系

**回答**：**可以同时存在，不是互斥关系。**

**正确理解**：
```javascript
// 一个八字可以同时有：
const 格局 = {
  月令主格: "正官格",
  十神组合: ["官印相生", "财官双美"],
  特殊格局: null,
  纯度: "真",
  破格因素: []
};
```

### 5. 纯度属性是否前端显示

**回答**：**强烈建议前端显示，这是专业性的体现。**

**显示建议**：
```javascript
// 前端显示格式
格局详情：
- 主格：正官格 (纯度：真)
- 组合：官印相生
- 破格因素：无

// 或者用视觉化表示
正官格 ● 真
官印相生 ●
```

**理由**：纯度属性直接关系到格局的成败高低，是用户最关心的信息之一。

---

## 八、补充的重要格局和因素

### 8.1 需要补充的重要十神组合

**原列表**：
1. 食神生财
2. 伤官配印
3. 财官双美
4. 杀印相生
5. 官印相生

**需要补充**：
6. **食神制杀** - 顶级组合，必须加入
7. **羊刃驾杀** - 重要组合
8. **伤官伤尽** - 特殊组合

### 8.2 破格因素（独立分析，非格局）

1. **官杀混杂** - 正官和七杀同时出现
2. **财星坏印** - 财星过旺破坏印星
3. **比劫夺财** - 比劫过旺夺取财星
4. **枭神夺食** - 偏印过旺夺取食神

---

## 九、格局判断优先级细化

**明确判断顺序**：
```javascript
1. 先判断是否化气格（条件最苛刻）
2. 再判断是否专旺格/从弱格
3. 然后判断月令主格（正八格+外格）
4. 最后分析十神组合和破格因素
```

**详细流程**：
1. **化气格**：检查天干五合，计算化气纯度
2. **专旺格**：检查是否同类五行成势
3. **从弱格**：检查是否日主极弱从于旺神
4. **月令主格**：
   - 先判断外格（建禄、阳刃、月劫）
   - 再判断正八格（正官、七杀、正印、偏印、食神、伤官、正财、偏财）
5. **十神组合**：在确定主格后，分析组合关系
6. **破格因素**：独立分析，影响纯度

---

## 十、纯度判断标准建议

为每个格局定义具体的纯度判断条件：

### 10.1 纯度等级定义

- **真**：无任何破格因素，用神有力，格局纯粹
- **假**：有轻微破格但可救应，格局成立但有瑕疵
- **一般**：格局成立但纯度不高，用神力量一般

### 10.2 纯度判断通用标准

**真格条件**：
- 用神透干或通根有力
- 无破格因素
- 用神得令或得生
- 忌神受制或无力

**假格条件**：
- 用神有力但存在轻微破格因素
- 破格因素可在大运中救应
- 格局成立但层次降低

**一般格条件**：
- 格局成立但用神力量一般
- 存在多个破格因素但未完全破坏格局
- 需要大运扶助才能发挥

---

## 十一、十神组合与破格因素的计算方法

### 11.1 食神制杀

**核心**：以食神为手段，克制七杀，化压力为权力。

**判断流程**：
1. **前提**：日主身强或中和，能承受克泄。若身弱，则制杀无力，反被其害。
2. **条件1**：七杀强旺（在八字中力量大，对日主有威胁）。
3. **条件2**：食神也强旺（有力量去制伏七杀）。
4. **条件3**：食神与七杀在位置上临近（如透干相邻，或地支相合/冲），形成直接的克制关系。
5. **条件4（关键）**：八字中不见正官与印星来破格。
   - 见正官则成"官杀混杂"，食神去制，目标不专。
   - 见强印则"印星化杀"，夺食护杀，食神失去制杀作用。

**结论**：同时满足以上条件，则构成"食神制杀"，主权威、胆识、技术管理能力。

### 11.2 羊刃驾杀

**核心**：以自身的极致力量（羊刃）去对抗强大的压力（七杀）。

**判断流程**：
1. **前提**：日主极强，因为有羊刃（月令或日支为佳）作为根基。
2. **条件1**：七杀强旺（通根或透干，直接冲克日主）。
3. **条件2**：羊刃与七杀形成对峙（如：甲日主，卯月而年支或时支见庚申）。
4. **条件3**：八字中不见官星（官杀混杂则破格）。
5. **条件4（关键）**：不喜见强力的食伤和印星。
   - 见强食伤，则变成"食伤制杀"，羊刃驾杀的性质减弱。
   - 见强印星，则变成"杀印相生"，化杀了，羊刃驾杀的性质也改变。

**结论**：同时满足条件，则构成"羊刃驾杀"，主武职、魄力、在激烈竞争中成功。

### 11.3 伤官伤尽

**核心**：八字中毫无官星，伤官的才华得到完全、纯粹的释放。

**判断流程**：
1. **前提**：八字为伤官格，或伤官极旺。
2. **核心条件**：八字四柱天干和地支藏干中，完全不见一丁点"正官"和"七杀"。
   - 这是最严格的条件，需要仔细排查所有地支藏干。
3. **辅助条件**：日主身旺，或有财星、印星配合，能承担和转化伤官的才华。

**结论**：满足核心条件，即为"伤官伤尽"。主不畏权贵、敢于创新、能成就常人所不能之事，但也易偏激。

### 11.4 官杀混杂（破格因素）

**核心**：这是破格因素，而非一个独立的格局。指格局不清，使命主心性不定。

**判断流程**：
1. **条件**：天干同时出现正官和七杀。这是最典型的官杀混杂。
2. **扩展条件**：即使天干只透其一，但地支官杀齐备且力量强，也算混杂，但程度较轻。

**影响**：
- 对正官格：是严重的破格，主事业摇摆、职位不稳、是非多。
- 对七杀格：也降低格局层次，主压力来源复杂，内心矛盾。

**结论**：一旦出现，即判定为"官杀混杂"，需要在大运/流年中寻找"取清"的年份（如合掉官或杀），运势方能顺畅。

---

## 十二、实施步骤建议

1. **第一阶段**：整理文档，确认理解正确 ✅（当前步骤）
2. **第二阶段**：实现月令主格判断（正八格 + 外格）
3. **第三阶段**：重构从格判断（合并从强格到专旺格）
4. **第四阶段**：实现十神组合格局判断
5. **第五阶段**：实现纯度属性系统
6. **第六阶段**：调整破格因素分析
7. **第七阶段**：测试和验证

---

请确认以上理解是否正确，特别是：
- 格局分类是否准确？
- 需要新增的格局（正官格、七杀格等）是否需要实现？
- 十神组合格局与月令主格的关系如何处理？


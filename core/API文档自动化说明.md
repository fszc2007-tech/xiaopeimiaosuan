# API æ–‡æ¡£è‡ªåŠ¨åŒ–ç³»ç»Ÿ

## ğŸ“š åŠŸèƒ½è¯´æ˜

è¿™æ˜¯ä¸€ä¸ª API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿï¼Œå¯ä»¥ï¼š
1. **è‡ªåŠ¨ä»ä»£ç æå– API ä¿¡æ¯**
2. **ç”Ÿæˆ Markdown æ ¼å¼çš„ API æ–‡æ¡£**
3. **ä¿æŒæ–‡æ¡£ä¸ä»£ç åŒæ­¥**

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åœ¨è·¯ç”±æ–‡ä»¶ä¸­æ³¨å†Œ API

åœ¨æ¯ä¸ªè·¯ç”±æ–‡ä»¶çš„å¼€å¤´ï¼Œä½¿ç”¨ `registerApi()` æ³¨å†Œ API ä¿¡æ¯ï¼š

```typescript
import { registerApi } from '../utils/apiDocs';

// æ³¨å†Œ API æ–‡æ¡£
registerApi({
  method: 'POST',
  path: '/api/v1/auth/login',
  description: 'ç”¨æˆ·ç™»å½•',
  auth: false,
  request: {
    body: {
      phone: 'æ‰‹æœºå·',
      code: 'éªŒè¯ç ',
    },
  },
  response: {
    success: {
      token: 'JWT Token',
      user: { /* ç”¨æˆ·ä¿¡æ¯ */ },
    },
    error: ['INVALID_CREDENTIALS', 'CODE_EXPIRED'],
  },
  example: `curl -X POST http://localhost:3000/api/v1/auth/login \\
  -H "Content-Type: application/json" \\
  -d '{"phone":"13800138000","code":"123456"}'`,
});
```

### 2. ç”Ÿæˆ API æ–‡æ¡£

è¿è¡Œå‘½ä»¤ï¼š

```bash
npm run docs:generate
```

è¿™ä¼šè‡ªåŠ¨ç”Ÿæˆ `APIæ¥å£æ–‡æ¡£-è‡ªåŠ¨ç”Ÿæˆ.md` æ–‡ä»¶ã€‚

### 3. æ–‡æ¡£è‡ªåŠ¨æ›´æ–°

æ¯æ¬¡ä¿®æ”¹è·¯ç”±åï¼Œåªéœ€ï¼š
1. æ›´æ–°å¯¹åº”çš„ `registerApi()` è°ƒç”¨
2. é‡æ–°è¿è¡Œ `npm run docs:generate`
3. æ–‡æ¡£è‡ªåŠ¨åŒæ­¥æ›´æ–°

---

## ğŸ“‹ API æ³¨å†Œå­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `method` | string | âœ… | HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETEï¼‰ |
| `path` | string | âœ… | API è·¯å¾„ |
| `description` | string | âœ… | API æè¿° |
| `auth` | boolean | âœ… | æ˜¯å¦éœ€è¦è®¤è¯ |
| `request.params` | object | âŒ | è·¯å¾„å‚æ•° |
| `request.query` | object | âŒ | æŸ¥è¯¢å‚æ•° |
| `request.body` | object | âŒ | è¯·æ±‚ä½“ |
| `response.success` | any | âœ… | æˆåŠŸå“åº”ç¤ºä¾‹ |
| `response.error` | string[] | âŒ | å¯èƒ½çš„é”™è¯¯ç åˆ—è¡¨ |
| `example` | string | âŒ | curl ç¤ºä¾‹ |

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ apiDocs.ts              # API æ–‡æ¡£å·¥å…·
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ auth.ts                 # è®¤è¯è·¯ç”±ï¼ˆå·²æ³¨å†Œï¼‰
â”‚       â”œâ”€â”€ bazi.ts                 # å‘½ç›˜è·¯ç”±ï¼ˆå¾…æ³¨å†Œï¼‰
â”‚       â””â”€â”€ reading.ts              # è§£è¯»è·¯ç”±ï¼ˆå¾…æ³¨å†Œï¼‰
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ generateApiDocs.ts          # æ–‡æ¡£ç”Ÿæˆè„šæœ¬
â””â”€â”€ APIæ¥å£æ–‡æ¡£-è‡ªåŠ¨ç”Ÿæˆ.md         # è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£
```

---

## âœ¨ ä¼˜åŠ¿

### 1. **ä»£ç å³æ–‡æ¡£**
- API å®šä¹‰å’Œæ–‡æ¡£åœ¨åŒä¸€å¤„
- ä¿®æ”¹ API æ—¶è‡ªç„¶ä¼šæ›´æ–°æ–‡æ¡£
- é¿å…æ–‡æ¡£ä¸ä»£ç ä¸åŒæ­¥

### 2. **è‡ªåŠ¨åŒ–**
- ä¸€é”®ç”Ÿæˆå®Œæ•´æ–‡æ¡£
- æŒ‰æ¨¡å—è‡ªåŠ¨åˆ†ç»„
- è‡ªåŠ¨ç»Ÿè®¡æ¥å£æ•°é‡

### 3. **æ˜“ç»´æŠ¤**
- ç»“æ„åŒ–çš„ API ä¿¡æ¯
- TypeScript ç±»å‹å®‰å…¨
- æ¸…æ™°çš„å­—æ®µå®šä¹‰

### 4. **æ ¼å¼ç»Ÿä¸€**
- æ‰€æœ‰ API éµå¾ªç›¸åŒæ ¼å¼
- Markdown æ ¼å¼æ˜“è¯»æ˜“åˆ†äº«
- æ”¯æŒå¯¼å‡ºä¸º PDF/HTML

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å·²å®Œæˆ
- âœ… API æ–‡æ¡£å·¥å…·å®ç°
- âœ… æ–‡æ¡£ç”Ÿæˆè„šæœ¬
- âœ… è®¤è¯æ¨¡å— API æ³¨å†Œ

### å¾…å®Œæˆ
- [ ] å‘½ç›˜æ¨¡å— API æ³¨å†Œ
- [ ] è§£è¯»æ¨¡å— API æ³¨å†Œ
- [ ] å¯¹è¯æ¨¡å— API æ³¨å†Œï¼ˆæœªæ¥ï¼‰
- [ ] Pro è®¢é˜…æ¨¡å— API æ³¨å†Œï¼ˆæœªæ¥ï¼‰
- [ ] Admin æ¨¡å— API æ³¨å†Œï¼ˆæœªæ¥ï¼‰

### å¯é€‰å¢å¼º
- [ ] ç”Ÿæˆ OpenAPI (Swagger) æ ¼å¼
- [ ] ç”Ÿæˆ Postman Collection
- [ ] è‡ªåŠ¨ç”Ÿæˆå‰ç«¯ TypeScript ç±»å‹
- [ ] é›†æˆåˆ° CI/CD æµç¨‹

---

## ğŸ’¡ ç¤ºä¾‹

è¿è¡Œ `npm run docs:generate` åï¼Œä¼šç”Ÿæˆç±»ä¼¼è¿™æ ·çš„æ–‡æ¡£ï¼š

```markdown
# API æ¥å£æ–‡æ¡£

> **è‡ªåŠ¨ç”Ÿæˆæ—¶é—´**: 2024-11-18T14:00:00.000Z  
> **ç‰ˆæœ¬**: v1.0

---

## authæ¨¡å—

### POST /api/v1/auth/login

**æè¿°**: ç”¨æˆ·ç™»å½•

**è®¤è¯**: âŒ ä¸éœ€è¦

**è¯·æ±‚ä½“**:
```json
{
  "phone": "æ‰‹æœºå·",
  "code": "éªŒè¯ç "
}
```

**æˆåŠŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "token": "JWT Token",
    "user": { /* ... */ }
  }
}
```

**é”™è¯¯ç **:
- `INVALID_CREDENTIALS`
- `CODE_EXPIRED`

**ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","code":"123456"}'
```

---
```

---

## ğŸ”§ é…ç½®

å¦‚éœ€ä¿®æ”¹ç”Ÿæˆçš„æ–‡æ¡£æ ¼å¼ï¼Œç¼–è¾‘ `src/utils/apiDocs.ts` ä¸­çš„ `generateMarkdown()` å‡½æ•°ã€‚

---

**ç°åœ¨ï¼ŒAPI æ–‡æ¡£ä¼šéšä»£ç è‡ªåŠ¨æ›´æ–°ï¼** ğŸ“šâœ¨


# æ•°æ®åº“é…ç½®ç¡®è®¤

**ç¡®è®¤æ—¶é—´**: 2024-11-18  
**æ•°æ®åº“ç±»å‹**: MySQL

---

## âœ… ç¡®è®¤ï¼šä½¿ç”¨ MySQL æ•°æ®åº“

### 1. æ•°æ®åº“é…ç½®

**ä½ç½®**: `core/.env`

```env
# MySQL æ•°æ®åº“é…ç½®
XIAOPEI_MYSQL_HOST=localhost
XIAOPEI_MYSQL_PORT=3306
XIAOPEI_MYSQL_USER=root
XIAOPEI_MYSQL_PASSWORD=your_password
XIAOPEI_MYSQL_DATABASE=xiaopei
```

### 2. æ•°æ®åº“è¿æ¥

**æ–‡ä»¶**: `core/src/database/connection.ts`

```typescript
import mysql from 'mysql2/promise';

// åˆ›å»º MySQL è¿æ¥æ± 
const pool = mysql.createPool({
  host: process.env.XIAOPEI_MYSQL_HOST || 'localhost',
  port: parseInt(process.env.XIAOPEI_MYSQL_PORT || '3306'),
  user: process.env.XIAOPEI_MYSQL_USER || 'root',
  password: process.env.XIAOPEI_MYSQL_PASSWORD,
  database: process.env.XIAOPEI_MYSQL_DATABASE || 'xiaopei',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0,
});
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

**SQL è„šæœ¬**: `core/src/database/migrations/001_create_tables.sql`

```bash
# åˆ›å»ºæ•°æ®åº“
mysql -u root -p -e "CREATE DATABASE xiaopei CHARACTER SET utf8mb4;"

# å¯¼å…¥è¡¨ç»“æ„
mysql -u root -p xiaopei < core/src/database/migrations/001_create_tables.sql
```

### 4. å·²åˆ›å»ºçš„è¡¨ï¼ˆ12 å¼ ï¼‰

| è¡¨å | ç”¨é€” |
|------|------|
| `users` | ç”¨æˆ·ä¿¡æ¯ |
| `verification_codes` | éªŒè¯ç  |
| `chart_profiles` | å‘½ä¸»æ¡£æ¡ˆ |
| `bazi_charts` | å‘½ç›˜ç»“æœ |
| `conversations` | å¯¹è¯è®°å½• |
| `messages` | èŠå¤©æ¶ˆæ¯ |
| `readings` | è§£è¯»è®°å½• |
| `user_settings` | ç”¨æˆ·è®¾ç½® |
| `feedbacks` | ç”¨æˆ·åé¦ˆ |
| `llm_api_configs` | LLM API é…ç½® |
| `admin_users` | ç®¡ç†å‘˜ç”¨æˆ· |
| `rate_limits` | API é™æµ |

---

## ğŸ“Š æ•°æ®åº“ç‰¹æ€§

### å­—ç¬¦é›†
- **æ•°æ®åº“**: `utf8mb4`
- **è¡¨**: `utf8mb4`
- **æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`

### å­˜å‚¨å¼•æ“
- **å¼•æ“**: `InnoDB`
- **æ”¯æŒäº‹åŠ¡**: âœ…
- **æ”¯æŒå¤–é”®**: âœ…

### ç´¢å¼•ç­–ç•¥
- âœ… ä¸»é”®ç´¢å¼•ï¼ˆæ‰€æœ‰è¡¨ï¼‰
- âœ… å¤–é”®ç´¢å¼•ï¼ˆå…³è”è¡¨ï¼‰
- âœ… ä¸šåŠ¡ç´¢å¼•ï¼ˆæŸ¥è¯¢ä¼˜åŒ–ï¼‰

---

## ğŸ”§ æ•°æ®åº“ç®¡ç†å·¥å…·

### æ¨èå·¥å…·
1. **MySQL Workbench** - å®˜æ–¹å›¾å½¢åŒ–å·¥å…·
2. **Sequel Ace** - Mac ç«¯è½»é‡çº§å·¥å…·
3. **DBeaver** - è·¨å¹³å°æ•°æ®åº“ç®¡ç†å·¥å…·
4. **å‘½ä»¤è¡Œ** - `mysql` CLI

### å¿«é€Ÿå‘½ä»¤

```bash
# è¿æ¥æ•°æ®åº“
mysql -u root -p xiaopei

# æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

# æŸ¥çœ‹è¡¨ç»“æ„
DESC users;

# æŸ¥çœ‹è¡¨æ•°æ®
SELECT * FROM users LIMIT 10;

# å¯¼å‡ºæ•°æ®åº“
mysqldump -u root -p xiaopei > backup.sql

# å¯¼å…¥æ•°æ®åº“
mysql -u root -p xiaopei < backup.sql
```

---

## ğŸ¯ æ•°æ®åº“è®¾è®¡æ–‡æ¡£

è¯¦ç»†çš„æ•°æ®åº“è®¾è®¡è§ï¼š
- `core.doc/æ•°æ®åº“ä¸APIè®¾è®¡æ–¹æ¡ˆ.md`

---

## âœ… ç¡®è®¤

**æ˜¯çš„ï¼Œé¡¹ç›®ä½¿ç”¨ MySQL æ•°æ®åº“ï¼**

- âœ… æœ¬åœ°å¼€å‘ï¼šMySQLï¼ˆlocalhostï¼‰
- âœ… ç”Ÿäº§ç¯å¢ƒï¼šMySQLï¼ˆéƒ¨ç½²æ—¶é…ç½®ï¼‰
- âœ… è¿æ¥æ–¹å¼ï¼šmysql2/promiseï¼ˆè¿æ¥æ± ï¼‰
- âœ… å­—ç¬¦é›†ï¼šutf8mb4ï¼ˆæ”¯æŒä¸­æ–‡å’Œ emojiï¼‰

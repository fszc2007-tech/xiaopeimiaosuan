# æœªæäº¤æ›´æ”¹è¯¦ç»†è¯´æ˜

**æ£€æŸ¥æ—¶é—´**: 2025-01-XX  
**Git çŠ¶æ€**: æœ‰ 43 ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œ2712 è¡Œæ–°å¢ï¼Œ2601 è¡Œåˆ é™¤

---

## ğŸ“‹ ä¸€ã€å‰ç«¯ App ä¿®æ”¹ï¼ˆé‡è¦ï¼‰

### 1.1 ç”¨æˆ·åè®®æ˜¾ç¤ºæ–¹å¼æ”¹è¿› âœ…

**æ–‡ä»¶**: `app/src/screens/Auth/PolicyViewerScreen.tsx`

**ä¸»è¦å˜æ›´**:
- âŒ **ç§»é™¤**: PDF WebView åŠ è½½æ–¹å¼
- âœ… **æ–°å¢**: Markdown æ–‡æœ¬æ˜¾ç¤ºæ–¹å¼
- âœ… **æ–°å¢**: ä½¿ç”¨ `react-native-markdown-display` åº“
- âœ… **æ–°å¢**: ä»æœ¬åœ°æ–‡ä»¶å¯¼å…¥åè®®å†…å®¹ï¼ˆ`@/assets/policies/policies`ï¼‰

**å½±å“**:
- âœ… ç”¨æˆ·åè®®åŠ è½½æ›´å¿«ï¼ˆæ— éœ€ç½‘ç»œè¯·æ±‚ï¼‰
- âœ… ç¦»çº¿å¯ç”¨ï¼ˆåè®®å†…å®¹æ‰“åŒ…åœ¨ App ä¸­ï¼‰
- âœ… æ›´å¥½çš„æ ·å¼æ§åˆ¶

**çŠ¶æ€**: âœ… **å»ºè®®æäº¤**ï¼ˆè¿™æ˜¯é‡è¦çš„åŠŸèƒ½æ”¹è¿›ï¼‰

---

### 1.2 Google ç™»å½•å¼¹çª—æŒ‰é’®é®æŒ¡ä¿®å¤ âœ…

**æ–‡ä»¶**: `app/src/components/auth/GoogleLoginSheet.tsx`

**ä¸»è¦å˜æ›´**:
- âœ… **ä¿®å¤**: æŒ‰é’®è¢«åº•éƒ¨å¯¼èˆªæ é®æŒ¡çš„é—®é¢˜
- âœ… **æ–°å¢**: ä½¿ç”¨ `SafeAreaView` åŒ…è£¹å¼¹çª—
- âœ… **ä¿®å¤**: `sheetHeight` è®¡ç®—æ—¶åŠ ä¸Š `insets.bottom`
- âœ… **ä¿®å¤**: `paddingBottom` ä½¿ç”¨ `insets.bottom + spacing.lg`
- âš ï¸ **æ–°å¢**: è°ƒè¯•æ—¥å¿—ï¼ˆå‘é€åˆ° `http://127.0.0.1:7243`ï¼‰

**å…³é”®ä¿®å¤ä»£ç **:
```typescript
// ä¿®å¤å‰
const sheetHeight = Math.min(baseHeight, calculatedHeight);

// ä¿®å¤å
const sheetHeight = Math.min(baseHeight, calculatedHeight) + insets.bottom;
```

**çŠ¶æ€**: âœ… **å»ºè®®æäº¤**ï¼ˆä½†éœ€è¦ç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰

---

### 1.3 ç¯å¢ƒé…ç½®ä¼˜åŒ– âš ï¸

**æ–‡ä»¶**: `app/src/config/env.ts`

**ä¸»è¦å˜æ›´**:
- âœ… **ä¼˜åŒ–**: API è¶…æ—¶æ—¶é—´ä» 30 ç§’å¢åŠ åˆ° 60 ç§’
- âœ… **ä¼˜åŒ–**: æ”¹è¿›ç¯å¢ƒå˜é‡è¯»å–é€»è¾‘
- âœ… **æ–°å¢**: æ›´è¯¦ç»†çš„é”™è¯¯æç¤ºï¼ˆçœŸæœºæµ‹è¯•æ—¶ localhost é—®é¢˜ï¼‰
- âš ï¸ **æ–°å¢**: è°ƒè¯•æ—¥å¿—ï¼ˆå‘é€åˆ° `http://127.0.0.1:7243`ï¼‰

**çŠ¶æ€**: âš ï¸ **å»ºè®®æäº¤**ï¼ˆä½†éœ€è¦ç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰

---

### 1.4 API å®¢æˆ·ç«¯é”™è¯¯å¤„ç†æ”¹è¿› âœ…

**æ–‡ä»¶**: `app/src/services/api/apiClient.ts`

**ä¸»è¦å˜æ›´**:
- âœ… **æ–°å¢**: æ›´è¯¦ç»†çš„ç½‘ç»œé”™è¯¯è¯Šæ–­ä¿¡æ¯
- âœ… **æ–°å¢**: è¶…æ—¶é”™è¯¯çš„ç‰¹æ®Šæç¤º
- âœ… **æ–°å¢**: çœŸæœºæµ‹è¯•æ—¶çš„è§£å†³æ–¹æ¡ˆæç¤º
- âš ï¸ **æ–°å¢**: è°ƒè¯•æ—¥å¿—ï¼ˆå‘é€åˆ° `http://127.0.0.1:7243`ï¼‰

**çŠ¶æ€**: âœ… **å»ºè®®æäº¤**ï¼ˆä½†éœ€è¦ç§»é™¤è°ƒè¯•æ—¥å¿—ï¼‰

---

### 1.5 ä¾èµ–åŒ…ç‰ˆæœ¬è°ƒæ•´ âš ï¸

**æ–‡ä»¶**: `app/package.json`

**ä¸»è¦å˜æ›´**:
- `@react-native-picker/picker`: `^2.11.4` â†’ `2.11.1` (é”å®šç‰ˆæœ¬)
- `babel-preset-expo`: `~54.0.0` â†’ `~54.0.9`
- `expo`: `^54.0.25` â†’ `~54.0.30`
- `expo-clipboard`: `~8.0.7` â†’ `~8.0.8`
- `expo-linear-gradient`: `~15.0.7` â†’ `~15.0.8`
- `expo-status-bar`: `~3.0.8` â†’ `~3.0.9`
- `react-native-screens`: `^4.18.0` â†’ `~4.16.0` (é™çº§)
- `react-native-svg`: `^15.15.0` â†’ `15.12.1` (é”å®šç‰ˆæœ¬)
- `@types/jest`: `^30.0.0` â†’ `29.5.14` (é™çº§)
- `jest`: `^30.2.0` â†’ `~29.7.0` (é™çº§)
- âœ… **æ–°å¢**: `expo.install.exclude` é…ç½®

**çŠ¶æ€**: âš ï¸ **éœ€è¦ç¡®è®¤**ï¼ˆç‰ˆæœ¬é™çº§å¯èƒ½æœ‰åŸå› ï¼Œå»ºè®®ç¡®è®¤æ˜¯å¦å¿…è¦ï¼‰

---

### 1.6 Metro é…ç½®è°ƒæ•´

**æ–‡ä»¶**: `app/metro.config.js`

**å˜æ›´**: 2 è¡Œæ–°å¢

**çŠ¶æ€**: âš ï¸ **éœ€è¦æŸ¥çœ‹å…·ä½“å†…å®¹ç¡®è®¤**

---

## ğŸ“‹ äºŒã€åç«¯ Core ä¿®æ”¹

### 2.1 è®¤è¯è·¯ç”±æ”¹è¿› âœ…

**æ–‡ä»¶**: `core/src/routes/auth.ts`

**ä¸»è¦å˜æ›´**:
- âœ… **æ–°å¢**: Google ç™»å½•é”™è¯¯å¤„ç†ï¼ˆtry-catchï¼‰
- âœ… **æ–°å¢**: å“åº”å¤´å·²å‘é€æ£€æŸ¥ï¼ˆé˜²æ­¢é‡å¤å‘é€å“åº”ï¼‰
- âœ… **æ–°å¢**: æ›´è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… **æ–°å¢**: ç»“æœéªŒè¯ï¼ˆç¡®ä¿ result ä¸ä¸ºç©ºï¼‰

**çŠ¶æ€**: âœ… **å»ºè®®æäº¤**ï¼ˆé‡è¦çš„é”™è¯¯å¤„ç†æ”¹è¿›ï¼‰

---

### 2.2 å…¶ä»–åç«¯æ–‡ä»¶ä¿®æ”¹

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `core/src/modules/auth/authService.ts` - 14 è¡Œä¿®æ”¹
- `core/src/modules/auth/thirdPartyAuthService.ts` - 32 è¡Œä¿®æ”¹
- `core/src/modules/admin/adminUserService.ts` - 47 è¡Œä¿®æ”¹
- `core/src/database/connection.ts` - 4 è¡Œä¿®æ”¹
- `core/src/jobs/accountDeletionJob.ts` - 11 è¡Œä¿®æ”¹
- `core/src/server.ts` - 24 è¡Œæ–°å¢
- `core/src/routes/dev.ts` - 3 è¡Œä¿®æ”¹
- `core/src/types/database.ts` - 2 è¡Œä¿®æ”¹
- `core/src/utils/fieldMapper.ts` - 6 è¡Œä¿®æ”¹
- `core/Dockerfile` - 3 è¡Œæ–°å¢
- `core/package.json` - 1 è¡Œæ–°å¢

**çŠ¶æ€**: âš ï¸ **éœ€è¦æŸ¥çœ‹å…·ä½“å†…å®¹ç¡®è®¤**

---

## ğŸ“‹ ä¸‰ã€æ„å»ºäº§ç‰©æ–‡ä»¶ï¼ˆå¯å¿½ç•¥ï¼‰

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `core/dist/**/*` - æ‰€æœ‰ç¼–è¯‘åçš„ JavaScript å’Œç±»å‹å®šä¹‰æ–‡ä»¶

**è¯´æ˜**: è¿™äº›æ˜¯ TypeScript ç¼–è¯‘åçš„äº§ç‰©ï¼Œé€šå¸¸ä¸éœ€è¦æäº¤åˆ° Git

**çŠ¶æ€**: âŒ **ä¸å»ºè®®æäº¤**ï¼ˆåº”è¯¥åœ¨ `.gitignore` ä¸­å¿½ç•¥ï¼‰

---

## ğŸ“‹ å››ã€å…¶ä»–æ–‡ä»¶

### 4.1 ç³»ç»Ÿæ–‡ä»¶ï¼ˆå¯å¿½ç•¥ï¼‰
- `.DS_Store` - macOS ç³»ç»Ÿæ–‡ä»¶
- `.cursor/debug.log` - Cursor IDE æ—¥å¿—æ–‡ä»¶

**çŠ¶æ€**: âŒ **ä¸å»ºè®®æäº¤**

### 4.2 è„šæœ¬æ–‡ä»¶
- `push-to-github.sh` - 49 è¡Œä¿®æ”¹

**çŠ¶æ€**: âš ï¸ **éœ€è¦æŸ¥çœ‹å…·ä½“å†…å®¹ç¡®è®¤**

---

## âš ï¸ äº”ã€éœ€è¦æ³¨æ„çš„é—®é¢˜

### 5.1 è°ƒè¯•æ—¥å¿—é—®é¢˜

**é—®é¢˜**: å¤šä¸ªæ–‡ä»¶åŒ…å«è°ƒè¯•æ—¥å¿—ï¼Œå‘é€åˆ° `http://127.0.0.1:7243`

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/components/auth/GoogleLoginSheet.tsx`
- `app/src/config/env.ts`
- `app/src/services/api/apiClient.ts`
- `core/src/routes/auth.ts`

**å»ºè®®**: 
- âš ï¸ **æ„å»ºå‰å¿…é¡»ç§»é™¤**è¿™äº›è°ƒè¯•æ—¥å¿—
- æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶ï¼ˆä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨ï¼‰

---

### 5.2 ä¾èµ–ç‰ˆæœ¬é™çº§

**é—®é¢˜**: éƒ¨åˆ†ä¾èµ–åŒ…ç‰ˆæœ¬è¢«é™çº§

**æ¶‰åŠåŒ…**:
- `react-native-screens`: `^4.18.0` â†’ `~4.16.0`
- `@types/jest`: `^30.0.0` â†’ `29.5.14`
- `jest`: `^30.2.0` â†’ `~29.7.0`

**å»ºè®®**: 
- âš ï¸ **ç¡®è®¤é™çº§åŸå› **ï¼ˆå¯èƒ½æ˜¯å…¼å®¹æ€§é—®é¢˜ï¼‰
- å¦‚æœæ˜¯å¿…è¦çš„ï¼Œåº”è¯¥è®°å½•åŸå› 

---

## âœ… å…­ã€å»ºè®®çš„æäº¤ç­–ç•¥

### 6.1 ç«‹å³æäº¤ï¼ˆé‡è¦åŠŸèƒ½æ”¹è¿›ï¼‰

1. âœ… **ç”¨æˆ·åè®® Markdown æ˜¾ç¤º** (`PolicyViewerScreen.tsx`)
   - è¿™æ˜¯é‡è¦çš„åŠŸèƒ½æ”¹è¿›
   - ä½†éœ€è¦å…ˆç§»é™¤è°ƒè¯•æ—¥å¿—

2. âœ… **Google ç™»å½•æŒ‰é’®é®æŒ¡ä¿®å¤** (`GoogleLoginSheet.tsx`)
   - é‡è¦çš„ UI ä¿®å¤
   - ä½†éœ€è¦å…ˆç§»é™¤è°ƒè¯•æ—¥å¿—

3. âœ… **API é”™è¯¯å¤„ç†æ”¹è¿›** (`apiClient.ts`)
   - æ”¹è¿›ç”¨æˆ·ä½“éªŒ
   - ä½†éœ€è¦å…ˆç§»é™¤è°ƒè¯•æ—¥å¿—

4. âœ… **åç«¯è®¤è¯è·¯ç”±æ”¹è¿›** (`core/src/routes/auth.ts`)
   - é‡è¦çš„é”™è¯¯å¤„ç†æ”¹è¿›

---

### 6.2 éœ€è¦ç¡®è®¤åæäº¤

1. âš ï¸ **ä¾èµ–ç‰ˆæœ¬è°ƒæ•´** (`package.json`)
   - ç¡®è®¤é™çº§åŸå› 
   - ç¡®è®¤æ˜¯å¦å¿…è¦

2. âš ï¸ **å…¶ä»–åç«¯æ–‡ä»¶ä¿®æ”¹**
   - æŸ¥çœ‹å…·ä½“ä¿®æ”¹å†…å®¹
   - ç¡®è®¤æ˜¯å¦å¿…è¦

---

### 6.3 ä¸å»ºè®®æäº¤

1. âŒ **æ„å»ºäº§ç‰©** (`core/dist/**/*`)
   - åº”è¯¥åœ¨ `.gitignore` ä¸­å¿½ç•¥

2. âŒ **ç³»ç»Ÿæ–‡ä»¶** (`.DS_Store`, `.cursor/debug.log`)
   - åº”è¯¥åœ¨ `.gitignore` ä¸­å¿½ç•¥

---

## ğŸš€ ä¸ƒã€æ„å»ºå‰å¿…é¡»æ“ä½œ

### 7.1 ç§»é™¤è°ƒè¯•æ—¥å¿—

**éœ€è¦ç§»é™¤çš„ä»£ç æ¨¡å¼**:
```typescript
// #region agent log
fetch('http://127.0.0.1:7243/ingest/...', ...).catch(()=>{});
// #endregion
```

**æ¶‰åŠæ–‡ä»¶**:
- `app/src/components/auth/GoogleLoginSheet.tsx`
- `app/src/config/env.ts`
- `app/src/services/api/apiClient.ts`

---

### 7.2 ç¡®è®¤ä¾èµ–ç‰ˆæœ¬

**æ£€æŸ¥é¡¹**:
- [ ] ç¡®è®¤ `react-native-screens` é™çº§åŸå› 
- [ ] ç¡®è®¤ `@types/jest` å’Œ `jest` é™çº§åŸå› 
- [ ] ç¡®è®¤å…¶ä»–ç‰ˆæœ¬è°ƒæ•´æ˜¯å¦å¿…è¦

---

### 7.3 æ£€æŸ¥ .gitignore

**ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶/ç›®å½•è¢«å¿½ç•¥**:
- `core/dist/`
- `.DS_Store`
- `.cursor/debug.log`

---

## ğŸ“ å…«ã€æ¨èçš„æäº¤æ­¥éª¤

### æ­¥éª¤ 1: æ¸…ç†è°ƒè¯•æ—¥å¿—

```bash
# ç§»é™¤æ‰€æœ‰è°ƒè¯•æ—¥å¿—
# å¯ä»¥ä½¿ç”¨æœç´¢æ›¿æ¢æˆ–æ‰‹åŠ¨åˆ é™¤
```

### æ­¥éª¤ 2: æäº¤é‡è¦åŠŸèƒ½æ”¹è¿›

```bash
cd app
git add src/screens/Auth/PolicyViewerScreen.tsx
git add src/components/auth/GoogleLoginSheet.tsx
git add src/services/api/apiClient.ts
git add src/config/env.ts
git commit -m "feat: ç”¨æˆ·åè®®æ”¹ä¸º Markdown æ˜¾ç¤ºï¼Œä¿®å¤ Google ç™»å½•æŒ‰é’®é®æŒ¡é—®é¢˜"
```

### æ­¥éª¤ 3: æäº¤åç«¯æ”¹è¿›

```bash
cd core
git add src/routes/auth.ts
git add src/modules/auth/*.ts
git commit -m "fix: æ”¹è¿›è®¤è¯è·¯ç”±é”™è¯¯å¤„ç†å’Œå“åº”å¤´æ£€æŸ¥"
```

### æ­¥éª¤ 4: ç¡®è®¤å¹¶æäº¤ä¾èµ–è°ƒæ•´

```bash
cd app
git add package.json package-lock.json
git commit -m "chore: è°ƒæ•´ä¾èµ–ç‰ˆæœ¬ï¼ˆéœ€è¦ç¡®è®¤åŸå› ï¼‰"
```

---

## ğŸ¯ æ€»ç»“

### âœ… é‡è¦æ”¹è¿›ï¼ˆå»ºè®®æäº¤ï¼‰
1. ç”¨æˆ·åè®® Markdown æ˜¾ç¤º
2. Google ç™»å½•æŒ‰é’®é®æŒ¡ä¿®å¤
3. API é”™è¯¯å¤„ç†æ”¹è¿›
4. åç«¯è®¤è¯è·¯ç”±æ”¹è¿›

### âš ï¸ éœ€è¦æ³¨æ„
1. **è°ƒè¯•æ—¥å¿—**: æ„å»ºå‰å¿…é¡»ç§»é™¤
2. **ä¾èµ–ç‰ˆæœ¬**: éœ€è¦ç¡®è®¤é™çº§åŸå› 
3. **æ„å»ºäº§ç‰©**: ä¸åº”è¯¥æäº¤

### ğŸ“Œ ä¸‹ä¸€æ­¥
1. ç§»é™¤æ‰€æœ‰è°ƒè¯•æ—¥å¿—
2. ç¡®è®¤ä¾èµ–ç‰ˆæœ¬è°ƒæ•´åŸå› 
3. æäº¤é‡è¦åŠŸèƒ½æ”¹è¿›
4. ç„¶åæ‰§è¡Œæ„å»º

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-XX  
**æ£€æŸ¥äººå‘˜**: AI Assistant


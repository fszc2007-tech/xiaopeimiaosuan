# 立即重新构建 - 清除缓存版本

## ✅ 已完成的修复

1. **更新版本号**: `1.0.1` → `1.0.2`
2. **添加 versionCode**: `android.versionCode: 2`
3. **准备使用 `--clear-cache` 重新构建**

---

## 🚀 立即执行构建

### 命令（必须使用 --clear-cache）

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app
eas build --platform android --profile production --clear-cache --non-interactive
```

### 关键点

1. **`--clear-cache`**: 清除所有构建缓存，确保使用最新代码
2. **`--non-interactive`**: 非交互模式，避免提示中断
3. **版本号已更新**: 从 1.0.1 到 1.0.2，避免缓存问题

---

## 📋 构建后验证

### 1. 检查版本号

安装 APK 后，在 App 设置中查看版本号应该是 **1.0.2**

### 2. 检查环境变量诊断

```bash
adb logcat | grep "ENV DIAGNOSTIC"
```

**必须看到**：
```
[ENV DIAGNOSTIC] 🔍 API_BASE_URL: https://xiaopei-core-343578696044.asia-east2.run.app
[ENV DIAGNOSTIC] 🔍 EXPO_PUBLIC_API_BASE_URL: https://xiaopei-core-343578696044.asia-east2.run.app
[ENV DIAGNOSTIC] 🔍 APP_ENV: production
```

### 3. 检查用户协议

- 打开用户协议页面
- **必须看到**：如果加载失败，有错误提示和"在浏览器中打开"选项

### 4. 检查 Google 登录弹窗

- 点击"通过 Google 登录"
- **必须看到**：弹窗高度适配，不超过屏幕 50%

---

## ⚠️ 如果仍然不生效

### 检查构建日志

1. 查看构建日志：`eas build:view [BUILD_ID]`
2. 搜索 "Clearing build cache" - 确认缓存被清除
3. 搜索 "Compressing project files" - 确认文件被压缩
4. 检查文件大小 - 应该包含所有 src/ 文件

### 检查代码是否被上传

在构建日志中搜索：
- `PolicyViewerScreen.tsx` - 确认文件被包含
- `GoogleLoginSheet.tsx` - 确认文件被包含
- `env.ts` - 确认文件被包含

---

## 🎯 执行命令

```bash
cd /Users/gaoxuxu/Desktop/xiaopei-app/app
eas build --platform android --profile production --clear-cache --non-interactive
```


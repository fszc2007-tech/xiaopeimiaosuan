# 小佩會員中心開發完成報告

> **開發時間**：2025-01-XX  
> **參考文檔**：`app.doc/会员中心设计方案-最终版.md`  
> **狀態**：✅ 開發完成，待測試

---

## 📋 開發內容總覽

按照最終版設計方案，已完成以下內容：

### 1️⃣ 工具函數 & 狀態管理

**文件**：`app/src/screens/ProMemberCenter/utils/membershipState.ts`

**功能**：
- ✅ `MembershipState` 枚舉定義（`non_pro` / `pro_active` / `pro_expiring` / `pro_expired`）
- ✅ `getMembershipState()` - 統一狀態判斷函數
- ✅ `getDaysUntilExpiry()` - 計算距離到期天數
- ✅ `formatDate()` - 日期格式化（YYYY-MM-DD）
- ✅ `getPlanLabel()` - 獲取會員標籤文案
- ✅ `getPriceLabel()` - 獲取價格文案

**特點**：
- 所有狀態判斷邏輯統一在此處，避免到處重複計算
- 提供完整的類型定義和註釋

---

### 2️⃣ UI 組件

#### StatusCard - 頂部狀態卡

**文件**：`app/src/screens/ProMemberCenter/components/StatusCard.tsx`

**功能**：
- ✅ 顯示會員類型和到期時間
- ✅ 即將到期時顯示黃底警告提示（7 天內）
- ✅ 提供「管理訂閱」按鈕
- ✅ 標題根據 `membershipState` 動態變化

**UI 特點**：
- 使用系統統一的卡片樣式
- 警告提示使用黃色背景 + 圖標
- 會員標籤使用 Badge 樣式

---

#### UsageCard - 使用情況卡

**文件**：`app/src/screens/ProMemberCenter/components/UsageCard.tsx`

**功能**：
- ✅ 顯示今日 AI 使用次數
- ✅ 顯示進度條（處理邊界情況）
- ✅ 提供「去問小佩」按鈕（4 字 CTA）
- ✅ 顯示重置時間和鼓勵文案

**UI 特點**：
- 進度條使用主色調
- 使用次數高亮顯示
- 按鈕帶圖標

---

#### BenefitsCard - 會員權益卡

**文件**：`app/src/screens/ProMemberCenter/components/BenefitsCard.tsx`

**功能**：
- ✅ 顯示會員權益列表
- ✅ 使用「已解鎖」的語氣
- ✅ 權益項帶綠色勾選圖標
- ✅ 支持動態顯示 AI 次數和命盤數量

**UI 特點**：
- 每個權益項帶圓形勾選圖標
- 使用成功色（綠色）
- 底部有小字說明

---

#### ManagementCard - 訂閱管理卡

**文件**：`app/src/screens/ProMemberCenter/components/ManagementCard.tsx`

**功能**：
- ✅ 顯示當前訂閱方案和價格
- ✅ 顯示下一次扣款日期
- ✅ 顯示扣款平台（App Store）
- ✅ 提供「管理訂閱」按鈕
- ✅ 小字提示如何調整或取消續訂

**UI 特點**：
- 信息行使用左右對齊佈局
- 價格和日期右對齊
- 按鈕帶設置圖標

---

### 3️⃣ 主頁面

**文件**：`app/src/screens/ProMemberCenter/ProMemberCenterScreen.tsx`

**功能**：
- ✅ 進入前檢查會員狀態
- ✅ 已過期或未訂閱自動跳轉銷售頁
- ✅ 顯示 Loading 狀態（骨架屏）
- ✅ 顯示 Error 狀態（錯誤提示 + 重試按鈕）
- ✅ 集成所有卡片組件
- ✅ 管理訂閱跳轉到 App Store
- ✅ 去問小佩跳轉到首頁

**數據流**：
```tsx
1. 加載會員狀態 (proService.getStatus())
2. 判斷狀態 (getMembershipState())
3. 檢查是否過期/未訂閱 → 跳轉銷售頁
4. 顯示會員中心內容
```

**特點**：
- 完整的錯誤處理
- Loading 和 Error 狀態
- 自動跳轉邏輯
- Toast 提示

---

### 4️⃣ 導航集成

#### 路由註冊

**修改文件**：
- `app/src/constants/routes.ts` - 新增 `PRO_MEMBER_CENTER` 常量
- `app/src/navigation/types.ts` - 新增 `ProMemberCenter` 類型定義
- `app/src/navigation/RootNavigator.tsx` - 註冊路由和導入組件

#### MeScreen 導航邏輯

**修改文件**：`app/src/screens/Me/MeScreen.tsx`

**邏輯**：
```tsx
const membershipState = getMembershipState(profile?.isPro, profile?.proExpiresAt);

if (membershipState === 'pro_active' || membershipState === 'pro_expiring') {
  // 跳轉到會員中心
  navigate(SCREEN_NAMES.PRO_MEMBER_CENTER);
} else {
  // 跳轉到銷售頁
  navigate(SCREEN_NAMES.PRO_SUBSCRIPTION);
}
```

**UI 變化**：
- 已訂閱：顯示「小佩會員」+ 綠色背景 + 「查看會員狀態與權益」
- 未訂閱：顯示「升級 Pro」+ 橙色背景 + 「推薦」標籤

---

### 5️⃣ API 擴展

**修改文件**：`app/src/services/api/proService.ts`

**新增字段**：
```ts
export interface MembershipStatus {
  // ... 原有字段
  maxCharts?: number; // 命盤數量限制，null 或 0 表示無限制
}
```

---

## 📁 文件結構

```
app/src/screens/ProMemberCenter/
├── ProMemberCenterScreen.tsx      # 主頁面
├── index.ts                       # 導出
├── utils/
│   └── membershipState.ts         # 狀態判斷工具函數
└── components/
    ├── StatusCard.tsx             # 頂部狀態卡
    ├── UsageCard.tsx              # 使用情況卡
    ├── BenefitsCard.tsx           # 會員權益卡
    └── ManagementCard.tsx         # 訂閱管理卡
```

---

## ✅ 設計規範遵循

### 1. 狀態管理
- ✅ 使用統一的 `MembershipState` 枚舉
- ✅ 所有狀態判斷使用 `getMembershipState()`
- ✅ 不在組件中重複計算狀態

### 2. 導航邏輯
- ✅ 根據 `membershipState` 決定跳轉
- ✅ 已過期自動跳轉銷售頁
- ✅ 進入前檢查狀態

### 3. UI 規範
- ✅ 統一 4 字 CTA（管理訂閱、去問小佩、重試一次）
- ✅ 使用系統統一的卡片樣式
- ✅ 使用系統統一的顏色和字體

### 4. 文案規範
- ✅ 所有文案使用繁體中文
- ✅ 日期格式：YYYY-MM-DD
- ✅ 價格格式：HK$ XX / 期

### 5. 錯誤處理
- ✅ Loading 狀態（骨架屏）
- ✅ Error 狀態（錯誤提示 + 重試）
- ✅ Toast 提示

---

## 🎯 功能特點

### 1. 智能狀態判斷
- 自動識別會員狀態（未訂閱/有效/即將到期/已過期）
- 根據狀態顯示不同 UI 和文案
- 自動跳轉邏輯

### 2. 完整的用戶體驗
- Loading 和 Error 狀態
- Toast 提示
- 平滑的頁面跳轉
- 清晰的按鈕文案

### 3. 可擴展性
- 組件化設計
- 統一的工具函數
- 清晰的類型定義
- 易於維護和擴展

---

## 🧪 測試建議

### 1. 狀態測試
- [ ] 未訂閱用戶：應跳轉到銷售頁
- [ ] 已訂閱用戶（有效期內）：應顯示會員中心
- [ ] 即將到期用戶（7 天內）：應顯示警告提示
- [ ] 已過期用戶：應自動跳轉到銷售頁

### 2. UI 測試
- [ ] 所有卡片正常顯示
- [ ] 進度條正常工作
- [ ] 按鈕可點擊
- [ ] 文案正確

### 3. 交互測試
- [ ] 管理訂閱：跳轉到 App Store
- [ ] 去問小佩：跳轉到首頁
- [ ] 重試按鈕：重新加載數據
- [ ] 返回按鈕：返回上一頁

### 4. 邊界測試
- [ ] 網絡錯誤時顯示 Error 狀態
- [ ] API 返回錯誤時顯示錯誤提示
- [ ] 數據為空時的處理
- [ ] 進度條超過 100% 的處理

---

## 📝 後續優化建議

### P1 優化
1. **埋點集成**
   - 進入會員中心
   - 點擊管理訂閱
   - 點擊去問小佩
   - 點擊重試

2. **骨架屏優化**
   - 使用真正的骨架屏組件
   - 更好的 Loading 體驗

3. **動畫效果**
   - 卡片進入動畫
   - 進度條動畫
   - 頁面切換動畫

### P2 優化
1. **恢復購買功能**
   - 在銷售頁或設置頁添加
   - 完整的恢復購買流程

2. **訂閱歷史**
   - 查看訂閱歷史記錄
   - 查看扣款記錄

3. **會員特權詳情**
   - 點擊權益項查看詳情
   - 更詳細的說明

---

## 🔗 相關文檔

- 設計方案：`app.doc/会员中心设计方案-最终版.md`
- API 文檔：`core/src/routes/pro.ts`
- UI 規範：`app.doc/UI_SPEC.md`（如果有）

---

## ✨ 總結

已按照最終版設計方案完成所有開發內容：

1. ✅ 創建 membershipState 工具函數
2. ✅ 創建 StatusCard 組件
3. ✅ 創建 UsageCard 組件
4. ✅ 創建 BenefitsCard 組件
5. ✅ 創建 ManagementCard 組件
6. ✅ 創建 ProMemberCenterScreen 主頁面
7. ✅ 更新 MeScreen 導航邏輯
8. ✅ 註冊路由並集成

**代碼質量**：
- ✅ 無 Linter 錯誤
- ✅ 完整的類型定義
- ✅ 清晰的註釋
- ✅ 統一的代碼風格

**下一步**：
1. 啟動 App 進行功能測試
2. 測試所有狀態和交互
3. 根據測試結果進行調整
4. 集成埋點功能

---

**開發完成時間**：2025-01-XX  
**開發者**：AI Assistant  
**狀態**：✅ 開發完成，待測試

